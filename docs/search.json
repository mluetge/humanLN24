[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "humanLN24",
    "section": "",
    "text": "Analysis human lymph node FRCs"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "Analysis human lymph node FRCs"
  },
  {
    "objectID": "analysis/mergeSamples.html",
    "href": "analysis/mergeSamples.html",
    "title": "Merge human LN stromal cells",
    "section": "",
    "text": "suppressPackageStartupMessages({\n  library(tidyverse)\n  library(Seurat)\n  library(magrittr)\n  library(dplyr)\n  library(purrr)\n  library(ggplot2)\n  library(here)\n  library(runSeurat3)\n  library(ggsci)\n})"
  },
  {
    "objectID": "analysis/mergeSamples.html#load-packages",
    "href": "analysis/mergeSamples.html#load-packages",
    "title": "Merge human LN stromal cells",
    "section": "",
    "text": "suppressPackageStartupMessages({\n  library(tidyverse)\n  library(Seurat)\n  library(magrittr)\n  library(dplyr)\n  library(purrr)\n  library(ggplot2)\n  library(here)\n  library(runSeurat3)\n  library(ggsci)\n})"
  },
  {
    "objectID": "analysis/mergeSamples.html#set-dir",
    "href": "analysis/mergeSamples.html#set-dir",
    "title": "Merge human LN stromal cells",
    "section": "set dir",
    "text": "set dir\n\nbasedir &lt;- here()\nmetaDat &lt;- read_tsv(paste0(basedir, \"/data/metadataStroma.txt\"), col_names = T)"
  },
  {
    "objectID": "analysis/mergeSamples.html#load-and-assign-samples",
    "href": "analysis/mergeSamples.html#load-and-assign-samples",
    "title": "Merge human LN stromal cells",
    "section": "load and assign samples",
    "text": "load and assign samples\n\nassignSamples &lt;- function(smpNam, basedirSmp, smpPat, smpGrp, smpOri,\n                          smpImm, smpVDJ){\n  smpNamFull &lt;- list.files(path = paste0(basedirSmp, \"/data/stroma/\"),\n                 pattern = paste0(smpNam, \".*_seurat.rds\"))\n  seuratSmp &lt;- readRDS(paste0(basedirSmp, \"/data/stroma/\", smpNamFull))\n  seuratSmp$patient &lt;- smpPat\n  seuratSmp$cond &lt;- smpGrp\n  seuratSmp$origin &lt;- smpOri\n  seuratSmp$immCell &lt;- smpImm\n  seuratSmp$vdj &lt;- smpVDJ\n  return(seuratSmp)\n}\n\n\n####################################################################\n\nfor(i in 1:length(metaDat$dataset)){\n  seuratX &lt;- assignSamples(smpNam = metaDat$dataset[i],\n                           basedirSmp = basedir,\n                           smpPat =  metaDat$patient[i],\n                           smpGrp = metaDat$cond[i],\n                           smpOri = metaDat$origin[i],\n                           smpImm = metaDat$immuneCells[i],\n                           smpVDJ = metaDat$VDJ[i])\n  if(exists(\"seurat\")){\n    seurat &lt;- merge(x = seurat, y = seuratX, project = \"LymphNode_FSC\")\n  }else{\n    seurat &lt;- seuratX\n  }\n}\n\nremove(seuratX)"
  },
  {
    "objectID": "analysis/mergeSamples.html#filter-cells",
    "href": "analysis/mergeSamples.html#filter-cells",
    "title": "Merge human LN stromal cells",
    "section": "filter cells",
    "text": "filter cells\n\ndim(seurat)\n\n[1]  36098 129116\n\n## reprocess\nres &lt;- c(0.8,0.6,0.4,0.25)\n\nseurat &lt;- NormalizeData(object = seurat)\nseurat &lt;- FindVariableFeatures(object = seurat)\nseurat &lt;- ScaleData(object = seurat, verbose = FALSE)\nseurat &lt;- RunPCA(object = seurat, npcs = 30, verbose = FALSE)\nseurat &lt;- RunTSNE(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- RunUMAP(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- FindNeighbors(object = seurat, reduction = \"pca\", \n                        dims = 1:20)\nfor (i in 1:length(res)) {\n    seurat &lt;- FindClusters(object = seurat, resolution = res[i], \n                           random.seed = 1234)\n    }\n\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 129116\nNumber of edges: 4228551\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9118\nNumber of communities: 32\nElapsed time: 50 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 129116\nNumber of edges: 4228551\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9228\nNumber of communities: 29\nElapsed time: 63 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 129116\nNumber of edges: 4228551\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9379\nNumber of communities: 23\nElapsed time: 72 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 129116\nNumber of edges: 4228551\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9531\nNumber of communities: 19\nElapsed time: 76 seconds\n\n## remove cluster with high expression of CD3E, PTPRC, CD79A (b + T cells)\n## remove cluster with high expression of LTF, KRTs, S100A.. ()\n## remove cluster with high expression of PLP1, NRXN1, MPZ.. (Neurons)\n\nseurat &lt;- subset(seurat, RNA_snn_res.0.25 %in% c(\"6\", \"9\", \"10\", \"12\",\n                                                 \"13\",\"16\"), invert = T)\n\ndim(seurat)\n\n[1]  36098 117137\n\n## reprocess\nres &lt;- c(0.8,0.6,0.4,0.25)\n\nseurat &lt;- NormalizeData(object = seurat)\nseurat &lt;- FindVariableFeatures(object = seurat)\nseurat &lt;- ScaleData(object = seurat, verbose = FALSE)\nseurat &lt;- RunPCA(object = seurat, npcs = 30, verbose = FALSE)\nseurat &lt;- RunTSNE(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- RunUMAP(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- FindNeighbors(object = seurat, reduction = \"pca\", \n                        dims = 1:20)\nfor (i in 1:length(res)) {\n    seurat &lt;- FindClusters(object = seurat, resolution = res[i], \n                           random.seed = 1234)\n    }\n\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 117137\nNumber of edges: 3719822\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9061\nNumber of communities: 27\nElapsed time: 43 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 117137\nNumber of edges: 3719822\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9176\nNumber of communities: 24\nElapsed time: 47 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 117137\nNumber of edges: 3719822\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9329\nNumber of communities: 19\nElapsed time: 48 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 117137\nNumber of edges: 3719822\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9473\nNumber of communities: 14\nElapsed time: 54 seconds"
  },
  {
    "objectID": "analysis/mergeSamples.html#visualize-data",
    "href": "analysis/mergeSamples.html#visualize-data",
    "title": "Merge human LN stromal cells",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\ncolPal &lt;- c(pal_nejm()(8),pal_futurama()(12))[1:length(levels(seurat))]\nnames(colPal) &lt;- levels(seurat)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\ncolPat &lt;- c(pal_jco()(10),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncondition\n\ncolCond &lt;- pal_igv()(length(unique(seurat$cond)))\nnames(colCond) &lt;- unique(seurat$cond)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond, group.by = \"cond\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\ncolOrig &lt;- pal_aaas()(length(unique(seurat$origin)))\nnames(colCond) &lt;- unique(seurat$cond)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOrig, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/mergeSamples.html#save-seurat-object",
    "href": "analysis/mergeSamples.html#save-seurat-object",
    "title": "Merge human LN stromal cells",
    "section": "save seurat object",
    "text": "save seurat object\n\nsaveRDS(seurat, file=paste0(basedir, \"/data/AllPatCM_LNFSCMerged_seurat.rds\"))"
  },
  {
    "objectID": "analysis/mergeSamples.html#session-info",
    "href": "analysis/mergeSamples.html#session-info",
    "title": "Merge human LN stromal cells",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] ggsci_3.0.0        runSeurat3_0.1.0   here_1.0.1         magrittr_2.0.3     Seurat_5.0.1      \n [6] SeuratObject_5.0.1 sp_2.1-3           lubridate_1.9.3    forcats_1.0.0      stringr_1.5.1     \n[11] dplyr_1.1.4        purrr_1.0.2        readr_2.1.5        tidyr_1.3.1        tibble_3.2.1      \n[16] ggplot2_3.4.4      tidyverse_2.0.0   \n\nloaded via a namespace (and not attached):\n  [1] RColorBrewer_1.1-3          rstudioapi_0.15.0           jsonlite_1.8.8             \n  [4] spatstat.utils_3.0-4        farver_2.1.1                rmarkdown_2.25             \n  [7] zlibbioc_1.46.0             vctrs_0.6.5                 ROCR_1.0-11                \n [10] spatstat.explore_3.2-6      RCurl_1.98-1.14             S4Arrays_1.0.6             \n [13] htmltools_0.5.7             sctransform_0.4.1           parallelly_1.37.0          \n [16] KernSmooth_2.23-22          htmlwidgets_1.6.4           ica_1.0-3                  \n [19] plyr_1.8.9                  plotly_4.10.4               zoo_1.8-12                 \n [22] igraph_2.0.2                mime_0.12                   lifecycle_1.0.4            \n [25] pkgconfig_2.0.3             Matrix_1.6-5                R6_2.5.1                   \n [28] fastmap_1.1.1               GenomeInfoDbData_1.2.10     MatrixGenerics_1.12.3      \n [31] fitdistrplus_1.1-11         future_1.33.1               shiny_1.8.0                \n [34] digest_0.6.34               colorspace_2.1-0            S4Vectors_0.40.1           \n [37] patchwork_1.2.0             rprojroot_2.0.4             tensor_1.5                 \n [40] RSpectra_0.16-1             irlba_2.3.5.1               GenomicRanges_1.52.1       \n [43] labeling_0.4.3              progressr_0.14.0            fansi_1.0.6                \n [46] spatstat.sparse_3.0-3       timechange_0.3.0            httr_1.4.7                 \n [49] polyclip_1.10-6             abind_1.4-5                 compiler_4.3.0             \n [52] bit64_4.0.5                 withr_3.0.0                 fastDummies_1.7.3          \n [55] MASS_7.3-60.0.1             DelayedArray_0.26.7         tools_4.3.0                \n [58] lmtest_0.9-40               httpuv_1.6.14               future.apply_1.11.1        \n [61] goftest_1.2-3               glue_1.7.0                  nlme_3.1-164               \n [64] promises_1.2.1              grid_4.3.0                  Rtsne_0.17                 \n [67] cluster_2.1.6               reshape2_1.4.4              generics_0.1.3             \n [70] gtable_0.3.4                spatstat.data_3.0-4         tzdb_0.4.0                 \n [73] data.table_1.15.0           hms_1.1.3                   XVector_0.40.0             \n [76] utf8_1.2.4                  BiocGenerics_0.48.0         spatstat.geom_3.2-8        \n [79] RcppAnnoy_0.0.22            ggrepel_0.9.5               RANN_2.6.1                 \n [82] pillar_1.9.0                vroom_1.6.5                 spam_2.10-0                \n [85] RcppHNSW_0.6.0              later_1.3.2                 splines_4.3.0              \n [88] lattice_0.22-5              bit_4.0.5                   survival_3.5-8             \n [91] deldir_2.0-2                tidyselect_1.2.0            SingleCellExperiment_1.22.0\n [94] miniUI_0.1.1.1              pbapply_1.7-2               knitr_1.45                 \n [97] gridExtra_2.3               IRanges_2.36.0              SummarizedExperiment_1.30.2\n[100] scattermore_1.2             stats4_4.3.0                xfun_0.42                  \n[103] Biobase_2.60.0              matrixStats_1.2.0           pheatmap_1.0.12            \n[106] stringi_1.8.3               lazyeval_0.2.2              yaml_2.3.8                 \n[109] evaluate_0.23               codetools_0.2-19            cli_3.6.2                  \n[112] uwot_0.1.16                 xtable_1.8-4                reticulate_1.35.0          \n[115] munsell_0.5.0               GenomeInfoDb_1.36.4         Rcpp_1.0.12                \n[118] globals_0.16.2              spatstat.random_3.2-2       png_0.1-8                  \n[121] parallel_4.3.0              ellipsis_0.3.2              dotCall64_1.1-1            \n[124] bitops_1.0-7                listenv_0.9.1               viridisLite_0.4.2          \n[127] scales_1.3.0                ggridges_0.5.6              crayon_1.5.2               \n[130] leiden_0.4.3.1              rlang_1.1.3                 cowplot_1.1.3              \n\ndate()\n\n[1] \"Sun Mar  3 16:52:25 2024\""
  },
  {
    "objectID": "analysis/vis_plus_sum_data_woCD.html",
    "href": "analysis/vis_plus_sum_data_woCD.html",
    "title": "visualize data human LN without CD patients",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/vis_plus_sum_data_woCD.html#load-packages",
    "href": "analysis/vis_plus_sum_data_woCD.html#load-packages",
    "title": "visualize data human LN without CD patients",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/vis_plus_sum_data_woCD.html#load-seurat-object",
    "href": "analysis/vis_plus_sum_data_woCD.html#load-seurat-object",
    "title": "visualize data human LN without CD patients",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\n## load seurat object from previous analysis\nseurat &lt;- readRDS(file=paste0(basedir, \"/data/AllPatCM_LNFSCMerged_seurat.rds\"))"
  },
  {
    "objectID": "analysis/vis_plus_sum_data_woCD.html#remove-cd-pat",
    "href": "analysis/vis_plus_sum_data_woCD.html#remove-cd-pat",
    "title": "visualize data human LN without CD patients",
    "section": "remove CD pat",
    "text": "remove CD pat\n\ndim(seurat)\n\n[1]  36098 117137\n\nseurat &lt;- subset(seurat, cond %in% c(\"UCD\", \"CDsusp\"), invert=T)\nseurat &lt;- subset(seurat, patient %in% c(\"ucd003\"), invert=T)\ndim(seurat)\n\n[1] 36098 62604\n\n## reprocess\nres &lt;- c(0.8,0.6,0.4,0.25)\n\nseurat &lt;- NormalizeData(object = seurat)\nseurat &lt;- FindVariableFeatures(object = seurat)\nseurat &lt;- ScaleData(object = seurat, verbose = FALSE)\nseurat &lt;- RunPCA(object = seurat, npcs = 30, verbose = FALSE)\nseurat &lt;- RunTSNE(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- RunUMAP(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- FindNeighbors(object = seurat, reduction = \"pca\", \n                        dims = 1:20)\nfor (i in 1:length(res)) {\n    seurat &lt;- FindClusters(object = seurat, resolution = res[i], \n                           random.seed = 1234)\n    }\n\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 62604\nNumber of edges: 2073920\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9061\nNumber of communities: 24\nElapsed time: 15 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 62604\nNumber of edges: 2073920\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9177\nNumber of communities: 20\nElapsed time: 17 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 62604\nNumber of edges: 2073920\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9322\nNumber of communities: 17\nElapsed time: 16 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 62604\nNumber of edges: 2073920\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9468\nNumber of communities: 12\nElapsed time: 15 seconds\n\n## remove contaminating epithelial cells from UPENN\nseurat &lt;- subset(seurat, RNA_snn_res.0.25 %in% c(\"10\"), invert=T)\ndim(seurat)\n\n[1] 36098 61459\n\nseurat &lt;- RunPCA(object = seurat, npcs = 30, verbose = FALSE)\nseurat &lt;- RunTSNE(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- RunUMAP(object = seurat, reduction = \"pca\", dims = 1:20)\n\ncolPal &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(levels(seurat))]\nnames(colPal) &lt;- levels(seurat)"
  },
  {
    "objectID": "analysis/vis_plus_sum_data_woCD.html#assign-groups",
    "href": "analysis/vis_plus_sum_data_woCD.html#assign-groups",
    "title": "visualize data human LN without CD patients",
    "section": "assign groups",
    "text": "assign groups\n\nseurat$grp &lt;- \"FRC\"\nseurat$grp[which(seurat$seurat_clusters %in% c(\"3\", \"6\"))] &lt;- \"BEC\"\nseurat$grp[which(seurat$seurat_clusters %in% c(\"7\", \"9\"))] &lt;- \"LEC\"\nseurat$grp[which(seurat$seurat_clusters %in% c(\"1\"))] &lt;- \"SMC\""
  },
  {
    "objectID": "analysis/vis_plus_sum_data_woCD.html#visualize-data",
    "href": "analysis/vis_plus_sum_data_woCD.html#visualize-data",
    "title": "visualize data human LN without CD patients",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\ncolPat &lt;- c(pal_jco()(10),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond\n\ncolTon &lt;- pal_igv()(length(unique(seurat$cond)))\nnames(colTon) &lt;- unique(seurat$cond)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colTon, group.by = \"cond\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ngrp\n\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/vis_plus_sum_data_woCD.html#cnt-tables",
    "href": "analysis/vis_plus_sum_data_woCD.html#cnt-tables",
    "title": "visualize data human LN without CD patients",
    "section": "cnt tables",
    "text": "cnt tables\n\ncol Grp\n\ngrps_per_Pat &lt;- data.frame(table(seurat$patient, seurat$grp))\ncolnames(grps_per_Pat) &lt;- c(\"patient\", \"group\", \"cnt\")\n\nggplot(grps_per_Pat, aes(x = patient, y = cnt)) +\n  geom_bar(aes(color = group, fill = group, alpha = 0.8),\n           stat = \"identity\") +\n  scale_color_manual(values = colGrp) +\n  scale_fill_manual(values = colGrp) +\n  theme_bw() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1))\n\n\n\n\n\n\ncol Pat\n\nggplot(grps_per_Pat, aes(x = patient, y = cnt)) +\n  geom_bar(aes(color = patient, fill = patient),\n           stat = \"identity\") +\n  scale_color_manual(values = colPat) +\n  scale_fill_manual(values = colPat) +\n  theme_bw() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1))\n\n\n\n\n\n\ncol Cond\n\ngrps_per_Pat &lt;- data.frame(table(seurat$patient, seurat$cond))\ncolnames(grps_per_Pat) &lt;- c(\"patient\", \"cond\", \"cnt\")\n\nggplot(grps_per_Pat, aes(x = patient, y = cnt)) +\n  geom_bar(aes(color = cond, fill = cond),\n           stat = \"identity\") +\n  scale_color_manual(values = colTon) +\n  scale_fill_manual(values = colTon) +\n  theme_bw() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1))\n\n\n\n\n\n\ncol dataset\n\ngrps_per_Pat &lt;- data.frame(table(seurat$patient, seurat$dataset))\ncolnames(grps_per_Pat) &lt;- c(\"patient\", \"dataset\", \"cnt\")\ncolDat &lt;- c(pal_npg()(10),pal_futurama()(12))[1:length(unique(seurat$dataset))]\nnames(colDat) &lt;- unique(seurat$dataset)\n\nggplot(grps_per_Pat, aes(x = patient, y = cnt)) +\n  geom_bar(aes(color = dataset, fill = dataset),\n           stat = \"identity\") +\n  scale_color_manual(values = colDat) +\n  scale_fill_manual(values = colDat) +\n  theme_bw() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1))"
  },
  {
    "objectID": "analysis/vis_plus_sum_data_woCD.html#vis-cluster-characterization",
    "href": "analysis/vis_plus_sum_data_woCD.html#vis-cluster-characterization",
    "title": "visualize data human LN without CD patients",
    "section": "vis cluster characterization",
    "text": "vis cluster characterization\n\navgHeatmap &lt;- function(seurat, selGenes, colVecIdent, colVecCond=NULL,\n                       ordVec=NULL, gapVecR=NULL, gapVecC=NULL,cc=FALSE,\n                       cr=FALSE, condCol=FALSE){\n  \n  selGenes &lt;- selGenes$gene\n  \n  ## assay data\n  clusterAssigned &lt;- as.data.frame(Idents(seurat)) %&gt;%\n  dplyr::mutate(cell=rownames(.))\n  colnames(clusterAssigned)[1] &lt;- \"ident\"\n  seuratDat &lt;- GetAssayData(seurat)\n  \n  ## genes of interest\n  genes &lt;- data.frame(gene=rownames(seurat)) %&gt;% \n    mutate(geneID=gsub(\"^.*\\\\.\", \"\", gene)) %&gt;% filter(geneID %in% selGenes)\n\n  ## matrix with averaged cnts per ident\n  logNormExpres &lt;- as.data.frame(t(as.matrix(\n    seuratDat[which(rownames(seuratDat) %in% genes$gene),])))\n  logNormExpres &lt;- logNormExpres %&gt;% dplyr::mutate(cell=rownames(.)) %&gt;%\n    dplyr::left_join(.,clusterAssigned, by=c(\"cell\")) %&gt;%\n    dplyr::select(-cell) %&gt;% dplyr::group_by(ident) %&gt;%\n    dplyr::summarise_all(mean)\n  logNormExpresMa &lt;- logNormExpres %&gt;% dplyr::select(-ident) %&gt;% as.matrix()\n  rownames(logNormExpresMa) &lt;- logNormExpres$ident\n  logNormExpresMa &lt;- t(logNormExpresMa)\n  rownames(logNormExpresMa) &lt;- gsub(\"^.*?\\\\.\",\"\",rownames(logNormExpresMa))\n  \n  ## remove genes if they are all the same in all groups\n  ind &lt;- apply(logNormExpresMa, 1, sd) == 0\n  logNormExpresMa &lt;- logNormExpresMa[!ind,]\n  genes &lt;- genes[!ind,]\n\n  ## color columns according to cluster\n  annotation_col &lt;- as.data.frame(gsub(\"(^.*?_)\",\"\",\n                                       colnames(logNormExpresMa)))%&gt;%\n    dplyr::mutate(celltype=gsub(\"(_.*$)\",\"\",colnames(logNormExpresMa)))\n  colnames(annotation_col)[1] &lt;- \"col1\"\n  annotation_col &lt;- annotation_col %&gt;%\n    dplyr::mutate(cond = gsub(\"(^[0-9]_?)\",\"\",col1)) %&gt;%\n    dplyr::select(cond, celltype)\n  rownames(annotation_col) &lt;- colnames(logNormExpresMa) \n\n  ann_colors = list(\n      cond = colVecCond,\n      celltype=colVecIdent)\n  if(is.null(ann_colors$cond)){\n    annotation_col$cond &lt;- NULL\n  }\n  \n  ## adjust order\n  logNormExpresMa &lt;- logNormExpresMa[selGenes,]\n  if(is.null(ordVec)){\n    ordVec &lt;- levels(seurat)\n  }\n  logNormExpresMa &lt;- logNormExpresMa[,ordVec]\n\n  ## scaled row-wise\n  pheatmap(logNormExpresMa, scale=\"row\" ,treeheight_row = 0, cluster_rows = cr, \n         cluster_cols = cc,\n         color = colorRampPalette(c(\"#2166AC\", \"#F7F7F7\", \"#B2182B\"))(50),\n         annotation_col = annotation_col, cellwidth=15, cellheight=10,\n         annotation_colors = ann_colors, gaps_row = gapVecR, gaps_col = gapVecC)\n}\n\n\nselMarker &lt;- list(LEC = c(\"PROX1\", \"PECAM1\"),                  \n                  BEC = c(\"CD34\", \"ENG\", \"CDH5\"),\n                  SMC = c(\"ACTA2\"),\n                  FRC = c(\"PDPN\", \"CCL19\", \"CCL21\", \"CLU\", \"CXCL13\",\n                          \"CD34\", \"PI16\"))\n\n\navg heatmap\n\nselGenes &lt;- data.frame(gene=unlist(selMarker)) %&gt;%\n  rownames_to_column(var=\"grp\") %&gt;% mutate(Grp=gsub(\".{1}$\", \"\", grp))\ngrpCnt &lt;- selGenes %&gt;% group_by(Grp) %&gt;% summarise(cnt=n())\ngapR &lt;- data.frame(Grp=unique(selGenes$Grp)) %&gt;% \n  left_join(.,grpCnt, by=\"Grp\") %&gt;% mutate(cumSum=cumsum(cnt)) \nordVec &lt;- levels(seurat)\n\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenes,\n                  colVecIdent = colPal, \n                  ordVec=ordVec,\n                  gapVecR=gapR$cumSum, gapVecC=NULL,cc=T,\n                  cr=F, condCol=F)"
  },
  {
    "objectID": "analysis/vis_plus_sum_data_woCD.html#save-seurat-object",
    "href": "analysis/vis_plus_sum_data_woCD.html#save-seurat-object",
    "title": "visualize data human LN without CD patients",
    "section": "save seurat object",
    "text": "save seurat object\n\nsaveRDS(seurat, file=paste0(basedir,\n                            \"/data/AllPatWithoutCM_LNFSCMerged_seurat.rds\"))"
  },
  {
    "objectID": "analysis/vis_plus_sum_data_woCD.html#session-info",
    "href": "analysis/vis_plus_sum_data_woCD.html#session-info",
    "title": "visualize data human LN without CD patients",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] scater_1.28.0               scuttle_1.10.3              SingleCellExperiment_1.22.0\n [4] SummarizedExperiment_1.30.2 Biobase_2.60.0              GenomicRanges_1.52.1       \n [7] GenomeInfoDb_1.36.4         IRanges_2.36.0              S4Vectors_0.40.1           \n[10] BiocGenerics_0.48.0         MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[13] pheatmap_1.0.12             ggsci_3.0.0                 here_1.0.1                 \n[16] runSeurat3_0.1.0            ggpubr_0.6.0                lubridate_1.9.3            \n[19] forcats_1.0.0               stringr_1.5.1               readr_2.1.5                \n[22] tidyr_1.3.1                 tibble_3.2.1                tidyverse_2.0.0            \n[25] Seurat_5.0.1                SeuratObject_5.0.1          sp_2.1-3                   \n[28] purrr_1.0.2                 cowplot_1.1.3               ggplot2_3.4.4              \n[31] reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             rprojroot_2.0.4          \n [10] globals_0.16.2            lattice_0.22-5            MASS_7.3-60.0.1          \n [13] backports_1.4.1           magrittr_2.0.3            plotly_4.10.4            \n [16] rmarkdown_2.25            yaml_2.3.8                httpuv_1.6.14            \n [19] sctransform_0.4.1         spam_2.10-0               spatstat.sparse_3.0-3    \n [22] reticulate_1.35.0         pbapply_1.7-2             RColorBrewer_1.1-3       \n [25] abind_1.4-5               zlibbioc_1.46.0           Rtsne_0.17               \n [28] RCurl_1.98-1.14           GenomeInfoDbData_1.2.10   ggrepel_0.9.5            \n [31] irlba_2.3.5.1             listenv_0.9.1             spatstat.utils_3.0-4     \n [34] goftest_1.2-3             RSpectra_0.16-1           spatstat.random_3.2-2    \n [37] fitdistrplus_1.1-11       parallelly_1.37.0         DelayedMatrixStats_1.22.6\n [40] leiden_0.4.3.1            codetools_0.2-19          DelayedArray_0.26.7      \n [43] tidyselect_1.2.0          farver_2.1.1              viridis_0.6.5            \n [46] ScaledMatrix_1.8.1        spatstat.explore_3.2-6    jsonlite_1.8.8           \n [49] BiocNeighbors_1.18.0      ellipsis_0.3.2            progressr_0.14.0         \n [52] ggridges_0.5.6            survival_3.5-8            tools_4.3.0              \n [55] ica_1.0-3                 Rcpp_1.0.12               glue_1.7.0               \n [58] gridExtra_2.3             xfun_0.42                 withr_3.0.0              \n [61] fastmap_1.1.1             fansi_1.0.6               rsvd_1.0.5               \n [64] digest_0.6.34             timechange_0.3.0          R6_2.5.1                 \n [67] mime_0.12                 colorspace_2.1-0          scattermore_1.2          \n [70] tensor_1.5                spatstat.data_3.0-4       utf8_1.2.4               \n [73] generics_0.1.3            data.table_1.15.0         httr_1.4.7               \n [76] htmlwidgets_1.6.4         S4Arrays_1.0.6            uwot_0.1.16              \n [79] pkgconfig_2.0.3           gtable_0.3.4              lmtest_0.9-40            \n [82] XVector_0.40.0            htmltools_0.5.7           carData_3.0-5            \n [85] dotCall64_1.1-1           scales_1.3.0              png_0.1-8                \n [88] knitr_1.45                rstudioapi_0.15.0         tzdb_0.4.0               \n [91] nlme_3.1-164              zoo_1.8-12                KernSmooth_2.23-22       \n [94] vipor_0.4.7               parallel_4.3.0            miniUI_0.1.1.1           \n [97] pillar_1.9.0              grid_4.3.0                vctrs_0.6.5              \n[100] RANN_2.6.1                promises_1.2.1            BiocSingular_1.16.0      \n[103] car_3.1-2                 beachmat_2.16.0           xtable_1.8-4             \n[106] cluster_2.1.6             beeswarm_0.4.0            evaluate_0.23            \n[109] cli_3.6.2                 compiler_4.3.0            rlang_1.1.3              \n[112] crayon_1.5.2              future.apply_1.11.1       ggsignif_0.6.4           \n[115] labeling_0.4.3            ggbeeswarm_0.7.2          plyr_1.8.9               \n[118] stringi_1.8.3             BiocParallel_1.34.2       viridisLite_0.4.2        \n[121] deldir_2.0-2              munsell_0.5.0             lazyeval_0.2.2           \n[124] spatstat.geom_3.2-8       Matrix_1.6-5              RcppHNSW_0.6.0           \n[127] hms_1.1.3                 patchwork_1.2.0           sparseMatrixStats_1.12.2 \n[130] future_1.33.1             shiny_1.8.0               ROCR_1.0-11              \n[133] igraph_2.0.2              broom_1.0.5              \n\ndate()\n\n[1] \"Mon Mar  4 11:56:09 2024\""
  },
  {
    "objectID": "analysis/visMarkerGenes_woCM.html",
    "href": "analysis/visMarkerGenes_woCM.html",
    "title": "visualize marker genes all stromal cells",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visMarkerGenes_woCM.html#load-packages",
    "href": "analysis/visMarkerGenes_woCM.html#load-packages",
    "title": "visualize marker genes all stromal cells",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visMarkerGenes_woCM.html#load-seurat-object",
    "href": "analysis/visMarkerGenes_woCM.html#load-seurat-object",
    "title": "visualize marker genes all stromal cells",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\n## load seurat object from previous analysis\nseurat &lt;- readRDS(file=paste0(basedir,\n                              \"/data/AllPatWithoutCM_LNFSCMerged_seurat.rds\"))\n\n## set col palettes\ncolPal &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(levels(seurat))]\ncolPal &lt;- c(\"#c29f2d\", \"#cb6021\", \"#893149\", \"#524b86\", \"#1f84aa\",\n            \"#d38c6e\",\"#50a565\",\"#242a8b\",\"#297563\",\"#667c63\",\"#c94141\")\nnames(colPal) &lt;- levels(seurat)\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond) &lt;- unique(seurat$cond)\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)"
  },
  {
    "objectID": "analysis/visMarkerGenes_woCM.html#visualize-data",
    "href": "analysis/visMarkerGenes_woCM.html#visualize-data",
    "title": "visualize marker genes all stromal cells",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPal, pt.size=0.5)+\n  theme_void()\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()\n\n\n\n\n\n\ncond\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond, group.by = \"cond\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colCond, group.by = \"cond\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()\n\n\n\n\n\n\ngrp\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/visMarkerGenes_woCM.html#vis-cluster-marker",
    "href": "analysis/visMarkerGenes_woCM.html#vis-cluster-marker",
    "title": "visualize marker genes all stromal cells",
    "section": "vis cluster marker",
    "text": "vis cluster marker\n\nmarker genes\n\nseurat_markers_all &lt;- FindAllMarkers(object = seurat, assay =\"RNA\",\n                                     only.pos = TRUE, min.pct = 0.25,\n                                     logfc.threshold = 0.25,\n                                     test.use = \"wilcox\")\n\n\n\navg heatmap\n\ncluster &lt;- levels(seurat)\nselGenesAll &lt;- seurat_markers_all %&gt;% group_by(cluster) %&gt;% \n  top_n(-15, p_val_adj) %&gt;% \n  top_n(15, avg_log2FC)\nselGenesAll &lt;- selGenesAll %&gt;% mutate(geneIDval=gsub(\"^.*\\\\.\", \"\", gene)) %&gt;% filter(nchar(geneIDval)&gt;1)\n\nIdents(seurat) &lt;- seurat$RNA_snn_res.0.25\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=FALSE,\n                  cr=T, condCol=F)"
  },
  {
    "objectID": "analysis/visMarkerGenes_woCM.html#write-table",
    "href": "analysis/visMarkerGenes_woCM.html#write-table",
    "title": "visualize marker genes all stromal cells",
    "section": "write table",
    "text": "write table\n\nwrite.table(seurat_markers_all,\n            file=paste0(basedir,\n                        \"/data/AllPatWithoutCM_LNFSCMerged_markerGenes.txt\"),\n            row.names = FALSE, col.names = TRUE, quote = FALSE, sep = \"\\t\")"
  },
  {
    "objectID": "analysis/visMarkerGenes_woCM.html#vis-selected-stroma-marker",
    "href": "analysis/visMarkerGenes_woCM.html#vis-selected-stroma-marker",
    "title": "visualize marker genes all stromal cells",
    "section": "vis selected stroma marker",
    "text": "vis selected stroma marker\n\ngenes &lt;- data.frame(gene=rownames(seurat)) %&gt;% \n    mutate(geneID=gsub(\"^.*\\\\.\", \"\", gene)) \n\nselGenesAll &lt;- read_tsv(file = paste0(basedir,\n                                      \"/data/overallStromaMarker.txt\")) %&gt;% \n  left_join(., genes, by = \"geneID\")\nselGenesAll &lt;- selGenesAll %&gt;% filter(!gene == \"ENSG00000232995.RGS5\")\n\nIdents(seurat) &lt;- seurat$RNA_snn_res.0.25\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=T,\n                  cr=F, condCol=F)\n\n\n\n\n\nDotplot\n\nDotPlot(seurat, assay=\"RNA\", features = selGenesAll$gene, scale =T,\n        cluster.idents = T) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=selGenesAll$gene, labels=selGenesAll$geneID) +\n  xlab(\"\") + ylab(\"\")\n\n\n\nDotPlot(seurat, assay=\"RNA\", features = selGenesAll$gene, scale =F,\n        cluster.idents = T) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=selGenesAll$gene, labels=selGenesAll$geneID) +\n  xlab(\"\") + ylab(\"\")\n\n\n\nselGenesAll &lt;- selGenesAll %&gt;% filter(!geneID == \"CCL21\")\n\nDotPlot(seurat, assay=\"RNA\", features = selGenesAll$gene, scale =F,\n        cluster.idents = T) +\n  scale_color_gradientn(colors=colorRampPalette(c(viridis::viridis(12),\"#FDE725FF\"))(50)) +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=selGenesAll$gene, labels=selGenesAll$geneID) +\n  xlab(\"\") + ylab(\"\")"
  },
  {
    "objectID": "analysis/visMarkerGenes_woCM.html#session-info",
    "href": "analysis/visMarkerGenes_woCM.html#session-info",
    "title": "visualize marker genes all stromal cells",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] scater_1.28.0               scuttle_1.10.3              SingleCellExperiment_1.22.0\n [4] SummarizedExperiment_1.30.2 Biobase_2.60.0              GenomicRanges_1.52.1       \n [7] GenomeInfoDb_1.36.4         IRanges_2.36.0              S4Vectors_0.40.1           \n[10] BiocGenerics_0.48.0         MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[13] pheatmap_1.0.12             ggsci_3.0.0                 here_1.0.1                 \n[16] runSeurat3_0.1.0            ggpubr_0.6.0                lubridate_1.9.3            \n[19] forcats_1.0.0               stringr_1.5.1               readr_2.1.5                \n[22] tidyr_1.3.1                 tibble_3.2.1                tidyverse_2.0.0            \n[25] Seurat_5.0.1                SeuratObject_5.0.1          sp_2.1-3                   \n[28] purrr_1.0.2                 cowplot_1.1.3               ggplot2_3.4.4              \n[31] reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             rprojroot_2.0.4          \n [10] vroom_1.6.5               globals_0.16.2            lattice_0.22-5           \n [13] MASS_7.3-60.0.1           backports_1.4.1           magrittr_2.0.3           \n [16] limma_3.56.2              plotly_4.10.4             rmarkdown_2.25           \n [19] yaml_2.3.8                httpuv_1.6.14             sctransform_0.4.1        \n [22] spam_2.10-0               spatstat.sparse_3.0-3     reticulate_1.35.0        \n [25] pbapply_1.7-2             RColorBrewer_1.1-3        abind_1.4-5              \n [28] zlibbioc_1.46.0           Rtsne_0.17                RCurl_1.98-1.14          \n [31] GenomeInfoDbData_1.2.10   ggrepel_0.9.5             irlba_2.3.5.1            \n [34] listenv_0.9.1             spatstat.utils_3.0-4      goftest_1.2-3            \n [37] RSpectra_0.16-1           spatstat.random_3.2-2     fitdistrplus_1.1-11      \n [40] parallelly_1.37.0         DelayedMatrixStats_1.22.6 leiden_0.4.3.1           \n [43] codetools_0.2-19          DelayedArray_0.26.7       tidyselect_1.2.0         \n [46] farver_2.1.1              viridis_0.6.5             ScaledMatrix_1.8.1       \n [49] spatstat.explore_3.2-6    jsonlite_1.8.8            BiocNeighbors_1.18.0     \n [52] ellipsis_0.3.2            progressr_0.14.0          ggridges_0.5.6           \n [55] survival_3.5-8            tools_4.3.0               ica_1.0-3                \n [58] Rcpp_1.0.12               glue_1.7.0                gridExtra_2.3            \n [61] xfun_0.42                 withr_3.0.0               fastmap_1.1.1            \n [64] fansi_1.0.6               rsvd_1.0.5                digest_0.6.34            \n [67] timechange_0.3.0          R6_2.5.1                  mime_0.12                \n [70] colorspace_2.1-0          scattermore_1.2           tensor_1.5               \n [73] spatstat.data_3.0-4       utf8_1.2.4                generics_0.1.3           \n [76] data.table_1.15.0         httr_1.4.7                htmlwidgets_1.6.4        \n [79] S4Arrays_1.0.6            uwot_0.1.16               pkgconfig_2.0.3          \n [82] gtable_0.3.4              lmtest_0.9-40             XVector_0.40.0           \n [85] htmltools_0.5.7           carData_3.0-5             dotCall64_1.1-1          \n [88] scales_1.3.0              png_0.1-8                 knitr_1.45               \n [91] rstudioapi_0.15.0         tzdb_0.4.0                nlme_3.1-164             \n [94] zoo_1.8-12                KernSmooth_2.23-22        vipor_0.4.7              \n [97] parallel_4.3.0            miniUI_0.1.1.1            pillar_1.9.0             \n[100] grid_4.3.0                vctrs_0.6.5               RANN_2.6.1               \n[103] promises_1.2.1            BiocSingular_1.16.0       car_3.1-2                \n[106] beachmat_2.16.0           xtable_1.8-4              cluster_2.1.6            \n[109] beeswarm_0.4.0            evaluate_0.23             cli_3.6.2                \n[112] compiler_4.3.0            rlang_1.1.3               crayon_1.5.2             \n[115] future.apply_1.11.1       ggsignif_0.6.4            labeling_0.4.3           \n[118] ggbeeswarm_0.7.2          plyr_1.8.9                stringi_1.8.3            \n[121] BiocParallel_1.34.2       viridisLite_0.4.2         deldir_2.0-2             \n[124] munsell_0.5.0             lazyeval_0.2.2            spatstat.geom_3.2-8      \n[127] Matrix_1.6-5              RcppHNSW_0.6.0            hms_1.1.3                \n[130] patchwork_1.2.0           bit64_4.0.5               sparseMatrixStats_1.12.2 \n[133] future_1.33.1             shiny_1.8.0               ROCR_1.0-11              \n[136] igraph_2.0.2              broom_1.0.5               bit_4.0.5                \n\ndate()\n\n[1] \"Tue Mar  5 16:54:28 2024\""
  },
  {
    "objectID": "analysis/subsetFRCs.html",
    "href": "analysis/subsetFRCs.html",
    "title": "Subset FRCs and VSMCs human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/subsetFRCs.html#load-packages",
    "href": "analysis/subsetFRCs.html#load-packages",
    "title": "Subset FRCs and VSMCs human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/subsetFRCs.html#load-seurat-object",
    "href": "analysis/subsetFRCs.html#load-seurat-object",
    "title": "Subset FRCs and VSMCs human LN",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\n## load seurat object from previous analysis\nseurat &lt;- readRDS(file=paste0(basedir, \"/data/AllPatWithoutCM_LNFSCMerged_seurat.rds\"))\n\ncolPal &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(levels(seurat))]\nnames(colPal) &lt;- levels(seurat)"
  },
  {
    "objectID": "analysis/subsetFRCs.html#visualize-data",
    "href": "analysis/subsetFRCs.html#visualize-data",
    "title": "Subset FRCs and VSMCs human LN",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\ncolPat &lt;- c(pal_jco()(10),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond\n\ncolTon &lt;- pal_igv()(length(unique(seurat$cond)))\nnames(colTon) &lt;- unique(seurat$cond)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colTon, group.by = \"cond\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ngrp\n\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/subsetFRCs.html#subset-on-frcs-and-smcs",
    "href": "analysis/subsetFRCs.html#subset-on-frcs-and-smcs",
    "title": "Subset FRCs and VSMCs human LN",
    "section": "subset on FRCs and SMCs",
    "text": "subset on FRCs and SMCs\n\ndim(seurat)\n\n[1] 36098 61459\n\nseurat &lt;- subset(seurat, grp %in% c(\"FRC\", \"SMC\"))\ndim(seurat)\n\n[1] 36098 43858\n\n## reprocess\nres &lt;- c(0.8,0.6,0.4,0.25)\n\nseurat &lt;- NormalizeData(object = seurat)\nseurat &lt;- FindVariableFeatures(object = seurat)\nseurat &lt;- ScaleData(object = seurat, verbose = FALSE)\nseurat &lt;- RunPCA(object = seurat, npcs = 30, verbose = FALSE)\nseurat &lt;- RunTSNE(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- RunUMAP(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- FindNeighbors(object = seurat, reduction = \"pca\", \n                        dims = 1:20)\nfor (i in 1:length(res)) {\n    seurat &lt;- FindClusters(object = seurat, resolution = res[i], \n                           random.seed = 1234)\n}\n\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 43858\nNumber of edges: 1433199\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.8893\nNumber of communities: 22\nElapsed time: 9 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 43858\nNumber of edges: 1433199\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9029\nNumber of communities: 20\nElapsed time: 9 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 43858\nNumber of edges: 1433199\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9174\nNumber of communities: 18\nElapsed time: 8 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 43858\nNumber of edges: 1433199\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9326\nNumber of communities: 11\nElapsed time: 8 seconds"
  },
  {
    "objectID": "analysis/subsetFRCs.html#visualize-data-1",
    "href": "analysis/subsetFRCs.html#visualize-data-1",
    "title": "Subset FRCs and VSMCs human LN",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\ncolPat &lt;- c(pal_jco()(10),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        shuffle = T)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond\n\ncolTon &lt;- pal_igv()(length(unique(seurat$cond)))\nnames(colTon) &lt;- unique(seurat$cond)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colTon, group.by = \"cond\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ngrp\n\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\",\n        shuffle = T)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/subsetFRCs.html#save-seurat-object",
    "href": "analysis/subsetFRCs.html#save-seurat-object",
    "title": "Subset FRCs and VSMCs human LN",
    "section": "save seurat object",
    "text": "save seurat object\n\nsaveRDS(seurat, file=paste0(basedir, \"/data/AllPatWithoutCM_FRConly_seurat.rds\"))"
  },
  {
    "objectID": "analysis/subsetFRCs.html#integrate-data",
    "href": "analysis/subsetFRCs.html#integrate-data",
    "title": "Subset FRCs and VSMCs human LN",
    "section": "integrate data",
    "text": "integrate data\n\nIdents(seurat) &lt;- seurat$patient\n\nseurat.list &lt;- SplitObject(object = seurat, split.by = \"patient\")\nfor (i in 1:length(x = seurat.list)) {\n    seurat.list[[i]] &lt;- NormalizeData(object = seurat.list[[i]],\n                                      verbose = FALSE)\n    seurat.list[[i]] &lt;- FindVariableFeatures(object = seurat.list[[i]], \n        selection.method = \"vst\", nfeatures = 2000, verbose = FALSE)\n}\n\nseurat.anchors &lt;- FindIntegrationAnchors(object.list = seurat.list, dims = 1:15)\nseurat.int &lt;- IntegrateData(anchorset = seurat.anchors, dims = 1:15)\nDefaultAssay(object = seurat.int) &lt;- \"integrated\"\n\n# rerun seurat\nseurat.int &lt;- ScaleData(object = seurat.int, verbose = FALSE,\n                        features = rownames(seurat.int))\nseurat.int &lt;- RunPCA(object = seurat.int, npcs = 20, verbose = FALSE)\nseurat.int &lt;- RunTSNE(object = seurat.int, reduction = \"pca\", dims = 1:20)\nseurat.int &lt;- RunUMAP(object = seurat.int, reduction = \"pca\", dims = 1:20)\n\nseurat.int &lt;- FindNeighbors(object = seurat.int, reduction = \"pca\", dims = 1:20)\nres &lt;- c(0.6,0.8,0.4,0.25)\nfor(i in 1:length(res)){\n  seurat.int &lt;- FindClusters(object = seurat.int, resolution = res[i],\n                             random.seed = 1234)\n}"
  },
  {
    "objectID": "analysis/subsetFRCs.html#saveload-int-object",
    "href": "analysis/subsetFRCs.html#saveload-int-object",
    "title": "Subset FRCs and VSMCs human LN",
    "section": "save/load int object",
    "text": "save/load int object\n\n#saveRDS(seurat.int,\n#        file= paste0(basedir, \"/data/AllPatWithoutCM_FRConly_intOrig_seurat.rds\"))\n\nseurat.int &lt;- readRDS(file= paste0(basedir,\n                               \"/data/AllPatWithoutCM_FRConly_intOrig_seurat.rds\"))\nDefaultAssay(object = seurat.int) &lt;- \"RNA\"\nseurat.int$intCluster &lt;- seurat.int$integrated_snn_res.0.25\nIdents(seurat.int) &lt;- seurat.int$intCluster"
  },
  {
    "objectID": "analysis/subsetFRCs.html#visualize-int-data",
    "href": "analysis/subsetFRCs.html#visualize-int-data",
    "title": "Subset FRCs and VSMCs human LN",
    "section": "visualize int data",
    "text": "visualize int data\n\nclustering\n\ncolPal &lt;- c(pal_nejm()(8),pal_futurama()(12))[1:length(levels(seurat.int))]\nnames(colPal) &lt;- levels(seurat.int)\n\n## visualize input data\nDimPlot(seurat.int, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\ncolPat &lt;- c(pal_jco()(10),\n            pal_futurama()(12))[1:length(unique(seurat.int$patient))]\nnames(colPat) &lt;- unique(seurat.int$patient)\n\n## visualize input data\nDimPlot(seurat.int, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond\n\ncolTon &lt;- pal_igv()(length(unique(seurat.int$cond)))\nnames(colTon) &lt;- unique(seurat.int$cond)\n\n## visualize input data\nDimPlot(seurat.int, reduction = \"umap\", cols=colTon, group.by = \"cond\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/subsetFRCs.html#session-info",
    "href": "analysis/subsetFRCs.html#session-info",
    "title": "Subset FRCs and VSMCs human LN",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] scater_1.28.0               scuttle_1.10.3              SingleCellExperiment_1.22.0\n [4] SummarizedExperiment_1.30.2 Biobase_2.60.0              GenomicRanges_1.52.1       \n [7] GenomeInfoDb_1.36.4         IRanges_2.36.0              S4Vectors_0.40.1           \n[10] BiocGenerics_0.48.0         MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[13] pheatmap_1.0.12             ggsci_3.0.0                 here_1.0.1                 \n[16] runSeurat3_0.1.0            ggpubr_0.6.0                lubridate_1.9.3            \n[19] forcats_1.0.0               stringr_1.5.1               readr_2.1.5                \n[22] tidyr_1.3.1                 tibble_3.2.1                tidyverse_2.0.0            \n[25] Seurat_5.0.1                SeuratObject_5.0.1          sp_2.1-3                   \n[28] purrr_1.0.2                 cowplot_1.1.3               ggplot2_3.4.4              \n[31] reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             rprojroot_2.0.4          \n [10] globals_0.16.2            lattice_0.22-5            MASS_7.3-60.0.1          \n [13] backports_1.4.1           magrittr_2.0.3            plotly_4.10.4            \n [16] rmarkdown_2.25            yaml_2.3.8                httpuv_1.6.14            \n [19] sctransform_0.4.1         spam_2.10-0               spatstat.sparse_3.0-3    \n [22] reticulate_1.35.0         pbapply_1.7-2             RColorBrewer_1.1-3       \n [25] abind_1.4-5               zlibbioc_1.46.0           Rtsne_0.17               \n [28] RCurl_1.98-1.14           GenomeInfoDbData_1.2.10   ggrepel_0.9.5            \n [31] irlba_2.3.5.1             listenv_0.9.1             spatstat.utils_3.0-4     \n [34] goftest_1.2-3             RSpectra_0.16-1           spatstat.random_3.2-2    \n [37] fitdistrplus_1.1-11       parallelly_1.37.0         DelayedMatrixStats_1.22.6\n [40] leiden_0.4.3.1            codetools_0.2-19          DelayedArray_0.26.7      \n [43] tidyselect_1.2.0          farver_2.1.1              viridis_0.6.5            \n [46] ScaledMatrix_1.8.1        spatstat.explore_3.2-6    jsonlite_1.8.8           \n [49] BiocNeighbors_1.18.0      ellipsis_0.3.2            progressr_0.14.0         \n [52] ggridges_0.5.6            survival_3.5-8            tools_4.3.0              \n [55] ica_1.0-3                 Rcpp_1.0.12               glue_1.7.0               \n [58] gridExtra_2.3             xfun_0.42                 withr_3.0.0              \n [61] fastmap_1.1.1             fansi_1.0.6               rsvd_1.0.5               \n [64] digest_0.6.34             timechange_0.3.0          R6_2.5.1                 \n [67] mime_0.12                 colorspace_2.1-0          scattermore_1.2          \n [70] tensor_1.5                spatstat.data_3.0-4       utf8_1.2.4               \n [73] generics_0.1.3            data.table_1.15.0         httr_1.4.7               \n [76] htmlwidgets_1.6.4         S4Arrays_1.0.6            uwot_0.1.16              \n [79] pkgconfig_2.0.3           gtable_0.3.4              lmtest_0.9-40            \n [82] XVector_0.40.0            htmltools_0.5.7           carData_3.0-5            \n [85] dotCall64_1.1-1           scales_1.3.0              png_0.1-8                \n [88] knitr_1.45                rstudioapi_0.15.0         tzdb_0.4.0               \n [91] nlme_3.1-164              zoo_1.8-12                KernSmooth_2.23-22       \n [94] vipor_0.4.7               parallel_4.3.0            miniUI_0.1.1.1           \n [97] pillar_1.9.0              grid_4.3.0                vctrs_0.6.5              \n[100] RANN_2.6.1                promises_1.2.1            BiocSingular_1.16.0      \n[103] car_3.1-2                 beachmat_2.16.0           xtable_1.8-4             \n[106] cluster_2.1.6             beeswarm_0.4.0            evaluate_0.23            \n[109] cli_3.6.2                 compiler_4.3.0            rlang_1.1.3              \n[112] crayon_1.5.2              future.apply_1.11.1       ggsignif_0.6.4           \n[115] labeling_0.4.3            ggbeeswarm_0.7.2          plyr_1.8.9               \n[118] stringi_1.8.3             BiocParallel_1.34.2       viridisLite_0.4.2        \n[121] deldir_2.0-2              munsell_0.5.0             lazyeval_0.2.2           \n[124] spatstat.geom_3.2-8       Matrix_1.6-5              RcppHNSW_0.6.0           \n[127] hms_1.1.3                 patchwork_1.2.0           sparseMatrixStats_1.12.2 \n[130] future_1.33.1             shiny_1.8.0               ROCR_1.0-11              \n[133] igraph_2.0.2              broom_1.0.5              \n\ndate()\n\n[1] \"Tue Mar  5 15:19:43 2024\""
  },
  {
    "objectID": "analysis/visFRC_DEgenesCond2_woCM.html",
    "href": "analysis/visFRC_DEgenesCond2_woCM.html",
    "title": "visualize DE genes FRCs",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visFRC_DEgenesCond2_woCM.html#load-packages",
    "href": "analysis/visFRC_DEgenesCond2_woCM.html#load-packages",
    "title": "visualize DE genes FRCs",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visFRC_DEgenesCond2_woCM.html#load-seurat-object",
    "href": "analysis/visFRC_DEgenesCond2_woCM.html#load-seurat-object",
    "title": "visualize DE genes FRCs",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\nseurat &lt;- readRDS(file= paste0(basedir,\n                               \"/data/AllPatWithoutCM_FRConly_intOrig_seurat.rds\"))\n\n## remove cluster with cycling cells\nseurat &lt;- subset(seurat, integrated_snn_res.0.25 == \"8\", invert=T)\n\n\nDefaultAssay(object = seurat) &lt;- \"RNA\"\nseurat$intCluster &lt;- as.character(seurat$integrated_snn_res.0.25)\nIdents(seurat) &lt;- seurat$intCluster\n\n\n## set col palettes\ncolPal &lt;- c(pal_uchicago()(6), \"#6692a3\", \"#3b7f60\")\nnames(colPal) &lt;- c(\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\")\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond) &lt;- unique(seurat$cond)\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\ncolTon &lt;- colCond\n\n## all activated in one grp\nseurat$cond2 &lt;- seurat$cond\nseurat$cond2[which(seurat$cond %in% c(\"chronic\", \"acute\"))] &lt;- \"activated\"\n\ncolCond2 &lt;- c(\"#6692a3\",\"#971c1c\")\nnames(colCond2) &lt;- c(\"resting\", \"activated\")"
  },
  {
    "objectID": "analysis/visFRC_DEgenesCond2_woCM.html#visualize-data",
    "href": "analysis/visFRC_DEgenesCond2_woCM.html#visualize-data",
    "title": "visualize DE genes FRCs",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\nclustering split by cond2\n\nDimPlot(seurat, reduction = \"umap\", cols=colPal, pt.size=0.5,\n        split.by = \"cond2\")+\n  theme_void()\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond, group.by = \"cond\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond2\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\",\n        shuffle = T)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()\n\n\n\n\n\n\ngrp\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/visFRC_DEgenesCond2_woCM.html#relative-cluster-abundances-per-cond2",
    "href": "analysis/visFRC_DEgenesCond2_woCM.html#relative-cluster-abundances-per-cond2",
    "title": "visualize DE genes FRCs",
    "section": "relative cluster abundances per cond2",
    "text": "relative cluster abundances per cond2\n\nclustCond &lt;- data.frame(table(seurat$cond2, seurat$intCluster))\ncolnames(clustCond) &lt;- c(\"cond\", \"intCluster\", \"cnt\")\nclustTot &lt;- data.frame(table(seurat$intCluster))\ncolnames(clustTot) &lt;- c(\"intCluster\", \"tot\")\nclustDat &lt;- clustCond %&gt;%  left_join(., clustTot, by = \"intCluster\") %&gt;% \n  mutate(relAb = cnt/tot * 100)\n\nggbarplot(clustDat, x=\"intCluster\", y=\"relAb\",\n          fill=\"cond\",\n          colour= \"cond\",\n          palette = colCond2,\n          xlab = \"cluster\",\n          ylab = \"percentage\")\n\n\n\n## relative abundance per cond\nclustCond &lt;- data.frame(table(seurat$cond2, seurat$intCluster))\ncolnames(clustCond) &lt;- c(\"cond\", \"intCluster\", \"cnt\")\ncondTot &lt;- data.frame(table(seurat$cond2))\ncolnames(condTot) &lt;- c(\"cond\", \"tot\")\ncolPaldat &lt;- data.frame(col=colPal) %&gt;%\n  rownames_to_column(var = \"intCluster\")\nclustDat2 &lt;- clustCond %&gt;%  left_join(., condTot, by = \"cond\") %&gt;% \n  mutate(relAb = cnt/tot * 100) %&gt;%\n  left_join(., colPaldat, by = \"intCluster\")\n\nknitr::kable(clustDat2)\n\n\n\n\ncond\nintCluster\ncnt\ntot\nrelAb\ncol\n\n\n\n\nactivated\n0\n6373\n25449\n25.042241\n#800000FF\n\n\nresting\n0\n6049\n18322\n33.014955\n#800000FF\n\n\nactivated\n1\n3969\n25449\n15.595898\n#767676FF\n\n\nresting\n1\n4080\n18322\n22.268311\n#767676FF\n\n\nactivated\n2\n3164\n25449\n12.432709\n#FFA319FF\n\n\nresting\n2\n3773\n18322\n20.592730\n#FFA319FF\n\n\nactivated\n3\n4244\n25449\n16.676490\n#8A9045FF\n\n\nresting\n3\n1560\n18322\n8.514354\n#8A9045FF\n\n\nactivated\n4\n2767\n25449\n10.872726\n#155F83FF\n\n\nresting\n4\n724\n18322\n3.951534\n#155F83FF\n\n\nactivated\n5\n1917\n25449\n7.532712\n#C16622FF\n\n\nresting\n5\n986\n18322\n5.381509\n#C16622FF\n\n\nactivated\n6\n1528\n25449\n6.004165\n#6692a3\n\n\nresting\n6\n760\n18322\n4.148019\n#6692a3\n\n\nactivated\n7\n1487\n25449\n5.843059\n#3b7f60\n\n\nresting\n7\n390\n18322\n2.128589\n#3b7f60\n\n\n\n\nlapply(names(colCond2), function(co){\n  clustDat2sel &lt;- clustDat2 %&gt;% filter(cond==co)\n  pie(clustDat2sel$relAb,\n      labels = clustDat2sel$intCluster,\n      col = clustDat2sel$col,\n      main = co)\n  symbols(0, 0, circles = 1, add=TRUE, bg=\"white\")\n})\n\n\n\n\n\n\n\n[[1]]\nNULL\n\n[[2]]\nNULL\n\nlapply(names(colCond2), function(co){\n  clustDat2sel &lt;- clustDat2 %&gt;% filter(cond==co)\n  pie(clustDat2sel$relAb,\n      labels = clustDat2sel$intCluster,\n      col = clustDat2sel$col,\n      main = co)\n})\n\n\n\n\n\n\n\n[[1]]\nNULL\n\n[[2]]\nNULL\n\n### different sorting stratgies for the first samples..\nseuratSub &lt;- subset(seurat, patient %in% c(\"ucd010\",\"ucd13\",\"ucd14\",\n                                           \"P_20220201\",\"P_20220202\",\n                                           \"P_20200220\"))\nclustCond &lt;- data.frame(table(seuratSub$cond2, seuratSub$intCluster))\ncolnames(clustCond) &lt;- c(\"cond\", \"intCluster\", \"cnt\")\nclustTot &lt;- data.frame(table(seuratSub$intCluster))\ncolnames(clustTot) &lt;- c(\"intCluster\", \"tot\")\nclustDat &lt;- clustCond %&gt;%  left_join(., clustTot, by = \"intCluster\") %&gt;% \n  mutate(relAb = cnt/tot * 100)\n\nggbarplot(clustDat, x=\"intCluster\", y=\"relAb\",\n          fill=\"cond\",\n          colour= \"cond\",\n          palette = colCond2,\n          xlab = \"cluster\",\n          ylab = \"percentage\")\n\n\n\n## relative abundance per cond\nclustCond &lt;- data.frame(table(seuratSub$cond2, seuratSub$intCluster))\ncolnames(clustCond) &lt;- c(\"cond\", \"intCluster\", \"cnt\")\ncondTot &lt;- data.frame(table(seuratSub$cond2))\ncolnames(condTot) &lt;- c(\"cond\", \"tot\")\ncolPaldat &lt;- data.frame(col=colPal) %&gt;%\n  rownames_to_column(var = \"intCluster\")\nclustDat2 &lt;- clustCond %&gt;%  left_join(., condTot, by = \"cond\") %&gt;% \n  mutate(relAb = cnt/tot * 100) %&gt;%\n  left_join(., colPaldat, by = \"intCluster\")\n\nknitr::kable(clustDat2)\n\n\n\n\ncond\nintCluster\ncnt\ntot\nrelAb\ncol\n\n\n\n\nactivated\n0\n3464\n18575\n18.648721\n#800000FF\n\n\nresting\n0\n2189\n7849\n27.888903\n#800000FF\n\n\nactivated\n1\n2327\n18575\n12.527591\n#767676FF\n\n\nresting\n1\n1431\n7849\n18.231622\n#767676FF\n\n\nactivated\n2\n1990\n18575\n10.713324\n#FFA319FF\n\n\nresting\n2\n1941\n7849\n24.729265\n#FFA319FF\n\n\nactivated\n3\n4021\n18575\n21.647375\n#8A9045FF\n\n\nresting\n3\n728\n7849\n9.275067\n#8A9045FF\n\n\nactivated\n4\n2704\n18575\n14.557201\n#155F83FF\n\n\nresting\n4\n412\n7849\n5.249076\n#155F83FF\n\n\nactivated\n5\n1664\n18575\n8.958277\n#C16622FF\n\n\nresting\n5\n498\n7849\n6.344757\n#C16622FF\n\n\nactivated\n6\n1344\n18575\n7.235532\n#6692a3\n\n\nresting\n6\n477\n7849\n6.077207\n#6692a3\n\n\nactivated\n7\n1061\n18575\n5.711978\n#3b7f60\n\n\nresting\n7\n173\n7849\n2.204102\n#3b7f60\n\n\n\n\nlapply(names(colCond2), function(co){\n  clustDat2sel &lt;- clustDat2 %&gt;% filter(cond==co)\n  pie(clustDat2sel$relAb,\n      labels = clustDat2sel$intCluster,\n      col = clustDat2sel$col,\n      main = paste0(co, \"- only same sorting\"))\n  symbols(0, 0, circles = 1, add=TRUE, bg=\"white\")\n})\n\n\n\n\n\n\n\n[[1]]\nNULL\n\n[[2]]\nNULL\n\nlapply(names(colCond2), function(co){\n  clustDat2sel &lt;- clustDat2 %&gt;% filter(cond==co)\n  pie(clustDat2sel$relAb,\n      labels = clustDat2sel$intCluster,\n      col = clustDat2sel$col,\n      main = paste0(co, \"- only same sorting\"))\n})\n\n\n\n\n\n\n\n[[1]]\nNULL\n\n[[2]]\nNULL"
  },
  {
    "objectID": "analysis/visFRC_DEgenesCond2_woCM.html#relative-cluster-abundances-per-patient",
    "href": "analysis/visFRC_DEgenesCond2_woCM.html#relative-cluster-abundances-per-patient",
    "title": "visualize DE genes FRCs",
    "section": "relative cluster abundances per patient",
    "text": "relative cluster abundances per patient\n\nclustCond &lt;- data.frame(table(seurat$patient, seurat$intCluster))\ncolnames(clustCond) &lt;- c(\"patient\", \"intCluster\", \"cnt\")\nclustTot &lt;- data.frame(table(seurat$patient))\ncolnames(clustTot) &lt;- c(\"patient\", \"tot\")\npatCond &lt;- data.frame(seurat$patient, seurat$cond2) %&gt;% unique()\ncolnames(patCond) &lt;- c(\"patient\", \"cond\")\nclustDat &lt;- clustCond %&gt;%  left_join(., clustTot, by = \"patient\") %&gt;% \n  mutate(relAb = cnt/tot * 100) %&gt;% left_join(., patCond, by = \"patient\")\n\nggbarplot(clustDat, x=\"patient\", y=\"relAb\",\n          width = NULL,\n          fill=\"intCluster\",\n          colour= \"intCluster\",\n          palette = colPal,\n          xlab = \"patient\",\n          ylab = \"percentage\",\n          legend = \"right\",\n          legend.title = \"\") + \n  rotate_x_text(angle = 90) +\n  facet_grid(~cond, scales = \"free\", space = \"free\")"
  },
  {
    "objectID": "analysis/visFRC_DEgenesCond2_woCM.html#vis-overall-de-genes",
    "href": "analysis/visFRC_DEgenesCond2_woCM.html#vis-overall-de-genes",
    "title": "visualize DE genes FRCs",
    "section": "vis overall DE genes",
    "text": "vis overall DE genes\n\nmarker genes\n\nIdents(seurat) &lt;- seurat$cond2\nseurat_markers_all &lt;- FindAllMarkers(object = seurat, assay =\"RNA\",\n                                     only.pos = TRUE, min.pct = 0.25,\n                                     logfc.threshold = 0.25,\n                                     test.use = \"wilcox\")\n\n\n\navg heatmap\n\ncluster &lt;- levels(seurat)\nselGenesAll &lt;- seurat_markers_all %&gt;% group_by(cluster) %&gt;% \n  top_n(-15, p_val_adj) %&gt;% \n  top_n(15, avg_log2FC)\nselGenesAll &lt;- selGenesAll %&gt;% mutate(geneIDval=gsub(\"^.*\\\\.\", \"\", gene)) %&gt;% filter(nchar(geneIDval)&gt;1)\n\nseurat$clust_plus_cond &lt;- paste0(seurat$intCluster, \"_\", seurat$cond2)\nIdents(seurat) &lt;- seurat$clust_plus_cond\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=FALSE,\n                  cr=T, condCol=T, colVecCond = colCond2)\n\n\n\n\n\n\nsc Heatmap\n\nDefaultAssay(object = seurat) &lt;- \"RNA\"\nseurat &lt;- ScaleData(seurat, features = rownames(seurat))\n\n### plot DE genes top 25 avg logFC\nDEGenesAll &lt;- seurat_markers_all %&gt;% group_by(cluster) %&gt;% \n  top_n(30, avg_log2FC) \n\nselFeatures &lt;- DEGenesAll %&gt;% mutate(label=gsub(\"^.*\\\\.\", \"\", gene))\nDoHeatmap(seurat, features = selFeatures$gene, group.by = \"cond2\", \n          group.colors = colCond2, slot = 'scale.data', label = F,\n          disp.min = -0.5, disp.max = 1.5) +\n  scale_fill_continuous(type = \"viridis\") +\n  scale_y_discrete(breaks=selFeatures$gene, labels=selFeatures$label)"
  },
  {
    "objectID": "analysis/visFRC_DEgenesCond2_woCM.html#cw-de-genes",
    "href": "analysis/visFRC_DEgenesCond2_woCM.html#cw-de-genes",
    "title": "visualize DE genes FRCs",
    "section": "cw DE genes",
    "text": "cw DE genes\n\nIdents(seurat) &lt;- seurat$cond2\ngrpVec &lt;- unique(seurat$intCluster)\n\nclustDE &lt;- lapply(grpVec, function(grp){\n  grpSub &lt;- unique(seurat$intCluster)[which(\n    unique(seurat$intCluster)==grp)]\n  seuratSub &lt;- subset(seurat, intCluster == grpSub)\n  DEgenes &lt;-FindAllMarkers(seuratSub, only.pos=T, logfc.threshold = 0.1,\n                           min.pct = 0.01)\n  if(nrow(DEgenes)&gt;1){\n    DEgenes &lt;- DEgenes %&gt;% filter(p_val_adj&lt;0.01) %&gt;%\n      mutate(group=paste0(grp, \"_\", cluster)) %&gt;% \n      mutate(geneID=gsub(\".*\\\\.\", \"\",  gene)) %&gt;% \n      filter(nchar(geneID)&gt;1)\n    }\n})\n\nnames(clustDE) &lt;- grpVec\n\nclustDE_Dat &lt;- data.frame(do.call(\"rbind\", clustDE))\n\nwrite.table(clustDE_Dat,\n            file=paste0(basedir, \"/data/AllPatWithoutCM_FRConly_intOrig_cond2\", \n                        \"_cwDEGenes.txt\"),\n            row.names = FALSE, col.names = TRUE, quote = FALSE, sep = \"\\t\")\n\n\navg Heatmap top cwDE genes\n\n5\n\n\n\n\n\n\n\n1\n\n\n\n\n\n\n\n2\n\n\n\n\n\n\n\n0\n\n\n\n\n\n\n\n4\n\n\n\n\n\n\n\n7\n\n\n\n\n\n\n\n3\n\n\n\n\n\n\n\n6\n\n\n\n\n\n\n\n\nscatterplot cw DE genes cond 2\n\n## scatterplot\n## in red are all genes with an adjusted p_val &lt; 0.01 and avg_logFC &gt;0.25\n\n################################################################################\n### include only genes expressed in at least 10 % of cells in one condition ####\n################################################################################\ngrpVec &lt;- unique(seurat$integrated_snn_res.0.25)\n\nlapply(grpVec, function(x){\n  allID &lt;- subset(seurat, integrated_snn_res.0.25 == x)\n  Idents(allID) &lt;-allID$cond2\n  avg.allID &lt;- AverageExpression(allID, group.by=\"cond2\",\n                                 show.progress = FALSE)\n  avg.allID &lt;- data.frame(log1p(avg.allID$RNA)) %&gt;% \n    rownames_to_column(var=\"gene\")\n  \n  ## expression frequency\n  GeneFreqSel &lt;- as.data.frame(GetAssayData(allID, assay = \"RNA\",\n                                            slot = \"data\")) %&gt;%\n    tibble::rownames_to_column(var=\"gene\") %&gt;% mutate(count=rowSums(.!=0)-1) %&gt;%\n    mutate(countFreq=count/ncol(allID)) %&gt;%\n    dplyr::select(gene,count, countFreq) %&gt;%\n    dplyr::filter(countFreq&gt;=0.1)\n  \n  signGenes2 &lt;- clustDE_Dat %&gt;% mutate(grp=gsub(\"_.*\", \"\", group)) %&gt;%\n    dplyr::filter(grp == x) %&gt;% \n    dplyr::filter(p_val_adj&lt;0.01 & (avg_log2FC &gt; 0.25)) \n  \n  genes.to.label &lt;- signGenes2 %&gt;% group_by(.,cluster) %&gt;% \n    slice_max(avg_log2FC, n=15) %&gt;% mutate(labelNam=geneID)\n  \n  avg.allID &lt;- avg.allID %&gt;% mutate(labelNam=gsub(\"^.*\\\\.\", \"\", gene)) %&gt;%\n    mutate(colourGrp=ifelse(gene %in% genes.to.label$gene, \"lab\",\n                            ifelse(gene%in%signGenes2$gene, \"sig\", \"notSig\"))) %&gt;%\n    dplyr::filter(gene%in%GeneFreqSel$gene)\n  \n  \n  p_allID &lt;- ggscatter(avg.allID, x=\"resting\", y=\"activated\",\n                      color = \"colourGrp\",\n                      palette = c(\"#660000\", \"#808080\", \"#FF3333\"),\n                      label=\"labelNam\",\n                      label.select = genes.to.label$labelNam,\n                      repel = F,\n                      label.rectangle=F,\n                      xlab=\"resting\",\n                      ylab = \"activated\",\n                      title=paste0(\"average expression - cluster \", x),\n                      legend=\"none\",\n                      font.label=10,\n                      alpha=0.9,\n                      size=0.5)\n  \n  p_allID \n\n})\n\n[[1]]\n\n\n\n\n\n\n[[2]]\n\n\n\n\n\n\n[[3]]\n\n\n\n\n\n\n[[4]]\n\n\n\n\n\n\n[[5]]\n\n\n\n\n\n\n[[6]]\n\n\n\n\n\n\n[[7]]\n\n\n\n\n\n\n[[8]]\n\n\n\n\n\n\n\nsc heatmap across all top cw DE genes\n\ncolPal2 &lt;- rep(colPal, each=2)\nnames(colPal2) &lt;- as.vector(t(outer(names(colPal), names(colCond2), paste,\n                                    sep=\"_\"))) \n\n### plot DE genes top 15 avg logFC\nDEGenesAll &lt;- clustDE_Dat %&gt;% group_by(group) %&gt;% \n  top_n(15, avg_log2FC) \n\nselFeatures &lt;- DEGenesAll %&gt;% mutate(label=gsub(\"^.*\\\\.\", \"\", gene))\nDoHeatmap(seurat, features = unique(selFeatures$gene),\n          group.by = \"clust_plus_cond\", \n          group.colors = colPal2, slot = 'scale.data', label = F,\n          disp.min = -0.5, disp.max = 1.5) +\n  scale_fill_continuous(type = \"viridis\") +\n  scale_y_discrete(breaks=selFeatures$gene, labels=selFeatures$label)"
  },
  {
    "objectID": "analysis/visFRC_DEgenesCond2_woCM.html#session-info",
    "href": "analysis/visFRC_DEgenesCond2_woCM.html#session-info",
    "title": "visualize DE genes FRCs",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] scater_1.28.0               scuttle_1.10.3              SingleCellExperiment_1.22.0\n [4] SummarizedExperiment_1.30.2 Biobase_2.60.0              GenomicRanges_1.52.1       \n [7] GenomeInfoDb_1.36.4         IRanges_2.36.0              S4Vectors_0.40.1           \n[10] BiocGenerics_0.48.0         MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[13] pheatmap_1.0.12             ggsci_3.0.0                 here_1.0.1                 \n[16] runSeurat3_0.1.0            ggpubr_0.6.0                lubridate_1.9.3            \n[19] forcats_1.0.0               stringr_1.5.1               readr_2.1.5                \n[22] tidyr_1.3.1                 tibble_3.2.1                tidyverse_2.0.0            \n[25] Seurat_5.0.1                SeuratObject_5.0.1          sp_2.1-3                   \n[28] purrr_1.0.2                 cowplot_1.1.3               ggplot2_3.4.4              \n[31] reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             rprojroot_2.0.4          \n [10] globals_0.16.2            lattice_0.22-5            MASS_7.3-60.0.1          \n [13] backports_1.4.1           magrittr_2.0.3            limma_3.56.2             \n [16] plotly_4.10.4             rmarkdown_2.25            yaml_2.3.8               \n [19] httpuv_1.6.14             sctransform_0.4.1         spam_2.10-0              \n [22] spatstat.sparse_3.0-3     reticulate_1.35.0         pbapply_1.7-2            \n [25] RColorBrewer_1.1-3        abind_1.4-5               zlibbioc_1.46.0          \n [28] Rtsne_0.17                RCurl_1.98-1.14           GenomeInfoDbData_1.2.10  \n [31] ggrepel_0.9.5             irlba_2.3.5.1             listenv_0.9.1            \n [34] spatstat.utils_3.0-4      goftest_1.2-3             RSpectra_0.16-1          \n [37] spatstat.random_3.2-2     fitdistrplus_1.1-11       parallelly_1.37.0        \n [40] DelayedMatrixStats_1.22.6 leiden_0.4.3.1            codetools_0.2-19         \n [43] DelayedArray_0.26.7       tidyselect_1.2.0          farver_2.1.1             \n [46] viridis_0.6.5             ScaledMatrix_1.8.1        spatstat.explore_3.2-6   \n [49] jsonlite_1.8.8            BiocNeighbors_1.18.0      ellipsis_0.3.2           \n [52] progressr_0.14.0          ggridges_0.5.6            survival_3.5-8           \n [55] tools_4.3.0               ica_1.0-3                 Rcpp_1.0.12              \n [58] glue_1.7.0                gridExtra_2.3             xfun_0.42                \n [61] withr_3.0.0               fastmap_1.1.1             fansi_1.0.6              \n [64] rsvd_1.0.5                digest_0.6.34             timechange_0.3.0         \n [67] R6_2.5.1                  mime_0.12                 colorspace_2.1-0         \n [70] scattermore_1.2           tensor_1.5                spatstat.data_3.0-4      \n [73] utf8_1.2.4                generics_0.1.3            data.table_1.15.0        \n [76] httr_1.4.7                htmlwidgets_1.6.4         S4Arrays_1.0.6           \n [79] uwot_0.1.16               pkgconfig_2.0.3           gtable_0.3.4             \n [82] lmtest_0.9-40             XVector_0.40.0            htmltools_0.5.7          \n [85] carData_3.0-5             dotCall64_1.1-1           scales_1.3.0             \n [88] png_0.1-8                 knitr_1.45                rstudioapi_0.15.0        \n [91] tzdb_0.4.0                nlme_3.1-164              zoo_1.8-12               \n [94] KernSmooth_2.23-22        vipor_0.4.7               parallel_4.3.0           \n [97] miniUI_0.1.1.1            pillar_1.9.0              grid_4.3.0               \n[100] vctrs_0.6.5               RANN_2.6.1                promises_1.2.1           \n[103] BiocSingular_1.16.0       car_3.1-2                 beachmat_2.16.0          \n[106] xtable_1.8-4              cluster_2.1.6             beeswarm_0.4.0           \n[109] evaluate_0.23             cli_3.6.2                 compiler_4.3.0           \n[112] rlang_1.1.3               crayon_1.5.2              future.apply_1.11.1      \n[115] ggsignif_0.6.4            labeling_0.4.3            ggbeeswarm_0.7.2         \n[118] plyr_1.8.9                stringi_1.8.3             BiocParallel_1.34.2      \n[121] viridisLite_0.4.2         deldir_2.0-2              munsell_0.5.0            \n[124] lazyeval_0.2.2            spatstat.geom_3.2-8       Matrix_1.6-5             \n[127] RcppHNSW_0.6.0            hms_1.1.3                 patchwork_1.2.0          \n[130] sparseMatrixStats_1.12.2  future_1.33.1             shiny_1.8.0              \n[133] ROCR_1.0-11               igraph_2.0.2              broom_1.0.5              \n\ndate()\n\n[1] \"Tue Mar  5 16:24:47 2024\""
  },
  {
    "objectID": "analysis/subsetLEC.html",
    "href": "analysis/subsetLEC.html",
    "title": "Subset LECs human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/subsetLEC.html#load-packages",
    "href": "analysis/subsetLEC.html#load-packages",
    "title": "Subset LECs human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/subsetLEC.html#load-seurat-object",
    "href": "analysis/subsetLEC.html#load-seurat-object",
    "title": "Subset LECs human LN",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\n## load seurat object from previous analysis\nseurat &lt;- readRDS(file=paste0(basedir, \"/data/AllPatWithoutCM_LNFSCMerged_seurat.rds\"))\n\ncolPal &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(levels(seurat))]\nnames(colPal) &lt;- levels(seurat)\n\n## all activated in one grp\nseurat$cond2 &lt;- seurat$cond\nseurat$cond2[which(seurat$cond %in% c(\"chronic\", \"acute\"))] &lt;- \"activated\"\n\ncolCond2 &lt;- c(\"#6692a3\",\"#971c1c\")\nnames(colCond2) &lt;- c(\"resting\", \"activated\")"
  },
  {
    "objectID": "analysis/subsetLEC.html#visualize-data",
    "href": "analysis/subsetLEC.html#visualize-data",
    "title": "Subset LECs human LN",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\ncolPat &lt;- c(pal_jco()(10),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond2\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ngrp\n\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/subsetLEC.html#subset-on-lec",
    "href": "analysis/subsetLEC.html#subset-on-lec",
    "title": "Subset LECs human LN",
    "section": "subset on LEC",
    "text": "subset on LEC\n\ndim(seurat)\n\n[1] 36098 61459\n\nseurat &lt;- subset(seurat, grp %in% c(\"LEC\"))\ndim(seurat)\n\n[1] 36098  5222\n\n## reprocess\nres &lt;- c(0.8,0.6,0.4,0.25)\n\nseurat &lt;- NormalizeData(object = seurat)\nseurat &lt;- FindVariableFeatures(object = seurat)\nseurat &lt;- ScaleData(object = seurat, verbose = FALSE)\nseurat &lt;- RunPCA(object = seurat, npcs = 30, verbose = FALSE)\nseurat &lt;- RunTSNE(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- RunUMAP(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- FindNeighbors(object = seurat, reduction = \"pca\", \n                        dims = 1:20)\nfor (i in 1:length(res)) {\n    seurat &lt;- FindClusters(object = seurat, resolution = res[i], \n                           random.seed = 1234)\n}\n\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 5222\nNumber of edges: 179313\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.8442\nNumber of communities: 15\nElapsed time: 0 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 5222\nNumber of edges: 179313\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.8644\nNumber of communities: 13\nElapsed time: 0 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 5222\nNumber of edges: 179313\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.8885\nNumber of communities: 11\nElapsed time: 0 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 5222\nNumber of edges: 179313\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9089\nNumber of communities: 8\nElapsed time: 0 seconds"
  },
  {
    "objectID": "analysis/subsetLEC.html#visualize-data-1",
    "href": "analysis/subsetLEC.html#visualize-data-1",
    "title": "Subset LECs human LN",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        shuffle = T)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond2\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ngrp\n\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\",\n        shuffle = T)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/subsetLEC.html#save-seurat-object",
    "href": "analysis/subsetLEC.html#save-seurat-object",
    "title": "Subset LECs human LN",
    "section": "save seurat object",
    "text": "save seurat object\n\nsaveRDS(seurat, file=paste0(basedir,\"/data/AllPatWithoutCM_LEConly_seurat.rds\"))"
  },
  {
    "objectID": "analysis/subsetLEC.html#integrate-data",
    "href": "analysis/subsetLEC.html#integrate-data",
    "title": "Subset LECs human LN",
    "section": "integrate data",
    "text": "integrate data\n\npatSel &lt;- names(table(seurat$patient))[which(table(seurat$patient)&gt;10)]\nseurat &lt;- subset(seurat, patient %in% patSel)\ntable(seurat$patient)\n\n\nP_20200220 P_20220201 P_20220202     ucd010      ucd13      ucd14 \n      3628        612        104        262        264        340 \n\nIdents(seurat) &lt;- seurat$patient\n\nseurat.list &lt;- SplitObject(object = seurat, split.by = \"patient\")\nfor (i in 1:length(x = seurat.list)) {\n    seurat.list[[i]] &lt;- NormalizeData(object = seurat.list[[i]],\n                                      verbose = FALSE)\n    seurat.list[[i]] &lt;- FindVariableFeatures(object = seurat.list[[i]], \n        selection.method = \"vst\", nfeatures = 2000, verbose = FALSE)\n}\n\nseurat.anchors &lt;- FindIntegrationAnchors(object.list = seurat.list, dims = 1:15)\nseurat.int &lt;- IntegrateData(anchorset = seurat.anchors, dims = 1:15)\nDefaultAssay(object = seurat.int) &lt;- \"integrated\"\n\n# rerun seurat\nseurat.int &lt;- ScaleData(object = seurat.int, verbose = FALSE,\n                        features = rownames(seurat.int))\nseurat.int &lt;- RunPCA(object = seurat.int, npcs = 20, verbose = FALSE)\nseurat.int &lt;- RunTSNE(object = seurat.int, reduction = \"pca\", dims = 1:20)\nseurat.int &lt;- RunUMAP(object = seurat.int, reduction = \"pca\", dims = 1:20)\n\nseurat.int &lt;- FindNeighbors(object = seurat.int, reduction = \"pca\", dims = 1:20)\nres &lt;- c(0.6,0.8,0.4,0.25)\nfor(i in 1:length(res)){\n  seurat.int &lt;- FindClusters(object = seurat.int, resolution = res[i],\n                             random.seed = 1234)\n}\n\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 5210\nNumber of edges: 186531\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.8368\nNumber of communities: 12\nElapsed time: 0 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 5210\nNumber of edges: 186531\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.8105\nNumber of communities: 14\nElapsed time: 0 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 5210\nNumber of edges: 186531\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.8680\nNumber of communities: 10\nElapsed time: 0 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 5210\nNumber of edges: 186531\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9011\nNumber of communities: 8\nElapsed time: 0 seconds"
  },
  {
    "objectID": "analysis/subsetLEC.html#remove-becfrc-cluster",
    "href": "analysis/subsetLEC.html#remove-becfrc-cluster",
    "title": "Subset LECs human LN",
    "section": "remove BEC/FRC cluster",
    "text": "remove BEC/FRC cluster\n\n## remove 2 cluster with no LECs (based on CCL19, CD34, JAM2 expression) \n## described here: PMID 31402260\nseurat.int$intCluster &lt;- seurat.int$integrated_snn_res.0.25\nseurat.int &lt;- subset(seurat.int, intCluster %in% c(\"5\", \"6\"), invert=T)\n\nDefaultAssay(object = seurat.int) &lt;- \"integrated\"\n\n# rerun seurat\nseurat.int &lt;- ScaleData(object = seurat.int, verbose = FALSE,\n                        features = rownames(seurat.int))\nseurat.int &lt;- RunPCA(object = seurat.int, npcs = 20, verbose = FALSE)\nseurat.int &lt;- RunTSNE(object = seurat.int, reduction = \"pca\", dims = 1:20)\nseurat.int &lt;- RunUMAP(object = seurat.int, reduction = \"pca\", dims = 1:20)"
  },
  {
    "objectID": "analysis/subsetLEC.html#save-int-object",
    "href": "analysis/subsetLEC.html#save-int-object",
    "title": "Subset LECs human LN",
    "section": "save int object",
    "text": "save int object\n\nDefaultAssay(object = seurat.int) &lt;- \"RNA\"\nIdents(seurat.int) &lt;- seurat.int$intCluster\n\nsaveRDS(seurat.int,\n        file= paste0(basedir,\n                     \"/data/AllPatWithoutCM_LEConly_intOrig_seurat.rds\"))"
  },
  {
    "objectID": "analysis/subsetLEC.html#visualize-int-data",
    "href": "analysis/subsetLEC.html#visualize-int-data",
    "title": "Subset LECs human LN",
    "section": "visualize int data",
    "text": "visualize int data\n\nclustering\n\ncolPal &lt;- c(pal_nejm()(8),pal_futurama()(12))[1:length(levels(seurat.int))]\nnames(colPal) &lt;- levels(seurat.int)\n\nDimPlot(seurat.int, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat.int, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond\n\nDimPlot(seurat.int, reduction = \"umap\", cols=colCond2, group.by = \"cond2\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/subsetLEC.html#session-info",
    "href": "analysis/subsetLEC.html#session-info",
    "title": "Subset LECs human LN",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] scater_1.28.0               scuttle_1.10.3              SingleCellExperiment_1.22.0\n [4] SummarizedExperiment_1.30.2 Biobase_2.60.0              GenomicRanges_1.52.1       \n [7] GenomeInfoDb_1.36.4         IRanges_2.36.0              S4Vectors_0.40.1           \n[10] BiocGenerics_0.48.0         MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[13] pheatmap_1.0.12             ggsci_3.0.0                 here_1.0.1                 \n[16] runSeurat3_0.1.0            ggpubr_0.6.0                lubridate_1.9.3            \n[19] forcats_1.0.0               stringr_1.5.1               readr_2.1.5                \n[22] tidyr_1.3.1                 tibble_3.2.1                tidyverse_2.0.0            \n[25] Seurat_5.0.1                SeuratObject_5.0.1          sp_2.1-3                   \n[28] purrr_1.0.2                 cowplot_1.1.3               ggplot2_3.4.4              \n[31] reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             rprojroot_2.0.4          \n [10] globals_0.16.2            lattice_0.22-5            MASS_7.3-60.0.1          \n [13] backports_1.4.1           magrittr_2.0.3            plotly_4.10.4            \n [16] rmarkdown_2.25            yaml_2.3.8                httpuv_1.6.14            \n [19] sctransform_0.4.1         spam_2.10-0               spatstat.sparse_3.0-3    \n [22] reticulate_1.35.0         pbapply_1.7-2             RColorBrewer_1.1-3       \n [25] abind_1.4-5               zlibbioc_1.46.0           Rtsne_0.17               \n [28] RCurl_1.98-1.14           GenomeInfoDbData_1.2.10   ggrepel_0.9.5            \n [31] irlba_2.3.5.1             listenv_0.9.1             spatstat.utils_3.0-4     \n [34] goftest_1.2-3             RSpectra_0.16-1           spatstat.random_3.2-2    \n [37] fitdistrplus_1.1-11       parallelly_1.37.0         DelayedMatrixStats_1.22.6\n [40] leiden_0.4.3.1            codetools_0.2-19          DelayedArray_0.26.7      \n [43] tidyselect_1.2.0          farver_2.1.1              viridis_0.6.5            \n [46] ScaledMatrix_1.8.1        spatstat.explore_3.2-6    jsonlite_1.8.8           \n [49] BiocNeighbors_1.18.0      ellipsis_0.3.2            progressr_0.14.0         \n [52] ggridges_0.5.6            survival_3.5-8            tools_4.3.0              \n [55] ica_1.0-3                 Rcpp_1.0.12               glue_1.7.0               \n [58] gridExtra_2.3             xfun_0.42                 withr_3.0.0              \n [61] fastmap_1.1.1             fansi_1.0.6               rsvd_1.0.5               \n [64] digest_0.6.34             timechange_0.3.0          R6_2.5.1                 \n [67] mime_0.12                 colorspace_2.1-0          scattermore_1.2          \n [70] tensor_1.5                spatstat.data_3.0-4       utf8_1.2.4               \n [73] generics_0.1.3            data.table_1.15.0         httr_1.4.7               \n [76] htmlwidgets_1.6.4         S4Arrays_1.0.6            uwot_0.1.16              \n [79] pkgconfig_2.0.3           gtable_0.3.4              lmtest_0.9-40            \n [82] XVector_0.40.0            htmltools_0.5.7           carData_3.0-5            \n [85] dotCall64_1.1-1           scales_1.3.0              png_0.1-8                \n [88] knitr_1.45                rstudioapi_0.15.0         tzdb_0.4.0               \n [91] nlme_3.1-164              zoo_1.8-12                KernSmooth_2.23-22       \n [94] vipor_0.4.7               parallel_4.3.0            miniUI_0.1.1.1           \n [97] pillar_1.9.0              grid_4.3.0                vctrs_0.6.5              \n[100] RANN_2.6.1                promises_1.2.1            BiocSingular_1.16.0      \n[103] car_3.1-2                 beachmat_2.16.0           xtable_1.8-4             \n[106] cluster_2.1.6             beeswarm_0.4.0            evaluate_0.23            \n[109] cli_3.6.2                 compiler_4.3.0            rlang_1.1.3              \n[112] crayon_1.5.2              future.apply_1.11.1       ggsignif_0.6.4           \n[115] labeling_0.4.3            ggbeeswarm_0.7.2          plyr_1.8.9               \n[118] stringi_1.8.3             BiocParallel_1.34.2       viridisLite_0.4.2        \n[121] deldir_2.0-2              munsell_0.5.0             lazyeval_0.2.2           \n[124] spatstat.geom_3.2-8       Matrix_1.6-5              RcppHNSW_0.6.0           \n[127] hms_1.1.3                 patchwork_1.2.0           sparseMatrixStats_1.12.2 \n[130] future_1.33.1             shiny_1.8.0               ROCR_1.0-11              \n[133] igraph_2.0.2              broom_1.0.5              \n\ndate()\n\n[1] \"Tue Mar  5 11:06:37 2024\""
  },
  {
    "objectID": "analysis/subsetBEC.html",
    "href": "analysis/subsetBEC.html",
    "title": "Subset BECs human lymph nodes",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/subsetBEC.html#load-packages",
    "href": "analysis/subsetBEC.html#load-packages",
    "title": "Subset BECs human lymph nodes",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/subsetBEC.html#load-seurat-object",
    "href": "analysis/subsetBEC.html#load-seurat-object",
    "title": "Subset BECs human lymph nodes",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\n## load seurat object from previous analysis\nseurat &lt;- readRDS(file=paste0(basedir, \"/data/AllPatWithoutCM_LNFSCMerged_seurat.rds\"))\n\ncolPal &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(levels(seurat))]\nnames(colPal) &lt;- levels(seurat)\n\n## all activated in one grp\nseurat$cond2 &lt;- seurat$cond\nseurat$cond2[which(seurat$cond %in% c(\"chronic\", \"acute\"))] &lt;- \"activated\"\n\ncolCond2 &lt;- c(\"#6692a3\",\"#971c1c\")\nnames(colCond2) &lt;- c(\"resting\", \"activated\")"
  },
  {
    "objectID": "analysis/subsetBEC.html#visualize-data",
    "href": "analysis/subsetBEC.html#visualize-data",
    "title": "Subset BECs human lymph nodes",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\ncolPat &lt;- c(pal_jco()(10),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond2\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ngrp\n\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/subsetBEC.html#subset-on-lec",
    "href": "analysis/subsetBEC.html#subset-on-lec",
    "title": "Subset BECs human lymph nodes",
    "section": "subset on LEC",
    "text": "subset on LEC\n\ndim(seurat)\n\n[1] 36098 61459\n\nseurat &lt;- subset(seurat, grp %in% c(\"BEC\"))\ndim(seurat)\n\n[1] 36098 12379\n\n## reprocess\nres &lt;- c(0.8,0.6,0.4,0.25)\n\nseurat &lt;- NormalizeData(object = seurat)\nseurat &lt;- FindVariableFeatures(object = seurat)\nseurat &lt;- ScaleData(object = seurat, verbose = FALSE)\nseurat &lt;- RunPCA(object = seurat, npcs = 30, verbose = FALSE)\nseurat &lt;- RunTSNE(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- RunUMAP(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- FindNeighbors(object = seurat, reduction = \"pca\", \n                        dims = 1:20)\nfor (i in 1:length(res)) {\n    seurat &lt;- FindClusters(object = seurat, resolution = res[i], \n                           random.seed = 1234)\n}\n\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 12379\nNumber of edges: 433943\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.8830\nNumber of communities: 15\nElapsed time: 1 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 12379\nNumber of edges: 433943\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.8993\nNumber of communities: 13\nElapsed time: 1 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 12379\nNumber of edges: 433943\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9177\nNumber of communities: 12\nElapsed time: 1 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 12379\nNumber of edges: 433943\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9337\nNumber of communities: 8\nElapsed time: 1 seconds"
  },
  {
    "objectID": "analysis/subsetBEC.html#visualize-data-1",
    "href": "analysis/subsetBEC.html#visualize-data-1",
    "title": "Subset BECs human lymph nodes",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        shuffle = T)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond2\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ngrp\n\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\",\n        shuffle = T)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/subsetBEC.html#save-seurat-object",
    "href": "analysis/subsetBEC.html#save-seurat-object",
    "title": "Subset BECs human lymph nodes",
    "section": "save seurat object",
    "text": "save seurat object\n\nsaveRDS(seurat, file=paste0(basedir,\"/data/AllPatWithoutCM_BEConly_seurat.rds\"))"
  },
  {
    "objectID": "analysis/subsetBEC.html#integrate-data",
    "href": "analysis/subsetBEC.html#integrate-data",
    "title": "Subset BECs human lymph nodes",
    "section": "integrate data",
    "text": "integrate data\n\npatSel &lt;- names(table(seurat$patient))[which(table(seurat$patient)&gt;10)]\nseurat &lt;- subset(seurat, patient %in% patSel)\ntable(seurat$patient)\n\n\nP_20200220 P_20210113 P_20220201 P_20220202     ucd010      ucd13      ucd14 \n      2463         85       2812       2711        617       1062       2627 \n\nIdents(seurat) &lt;- seurat$patient\n\nseurat.list &lt;- SplitObject(object = seurat, split.by = \"patient\")\nfor (i in 1:length(x = seurat.list)) {\n    seurat.list[[i]] &lt;- NormalizeData(object = seurat.list[[i]],\n                                      verbose = FALSE)\n    seurat.list[[i]] &lt;- FindVariableFeatures(object = seurat.list[[i]], \n        selection.method = \"vst\", nfeatures = 2000, verbose = FALSE)\n}\n\nseurat.anchors &lt;- FindIntegrationAnchors(object.list = seurat.list, dims = 1:15)\nseurat.int &lt;- IntegrateData(anchorset = seurat.anchors, dims = 1:15, \n                            k.weight = min(table(seurat$patient)))\nDefaultAssay(object = seurat.int) &lt;- \"integrated\"\n\n# rerun seurat\nseurat.int &lt;- ScaleData(object = seurat.int, verbose = FALSE,\n                        features = rownames(seurat.int))\nseurat.int &lt;- RunPCA(object = seurat.int, npcs = 20, verbose = FALSE)\nseurat.int &lt;- RunTSNE(object = seurat.int, reduction = \"pca\", dims = 1:20)\nseurat.int &lt;- RunUMAP(object = seurat.int, reduction = \"pca\", dims = 1:20)\n\nseurat.int &lt;- FindNeighbors(object = seurat.int, reduction = \"pca\", dims = 1:20)\nres &lt;- c(0.6,0.8,0.4,0.25)\nfor(i in 1:length(res)){\n  seurat.int &lt;- FindClusters(object = seurat.int, resolution = res[i],\n                             random.seed = 1234)\n}\n\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 12377\nNumber of edges: 464260\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.8576\nNumber of communities: 12\nElapsed time: 1 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 12377\nNumber of edges: 464260\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.8385\nNumber of communities: 15\nElapsed time: 1 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 12377\nNumber of edges: 464260\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.8819\nNumber of communities: 9\nElapsed time: 1 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 12377\nNumber of edges: 464260\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9059\nNumber of communities: 7\nElapsed time: 1 seconds"
  },
  {
    "objectID": "analysis/subsetBEC.html#remove-becfrc-cluster",
    "href": "analysis/subsetBEC.html#remove-becfrc-cluster",
    "title": "Subset BECs human lymph nodes",
    "section": "remove BEC/FRC cluster",
    "text": "remove BEC/FRC cluster\n\n## remove FRC cluster (based on CCL19, PDPN, COL1A1... expression) \n## described here: PMID 32732867\nseurat.int$intCluster &lt;- seurat.int$integrated_snn_res.0.25\nseurat.int &lt;- subset(seurat.int, intCluster %in% c(\"3\"), invert=T)\n\nDefaultAssay(object = seurat.int) &lt;- \"integrated\"\n\n# rerun seurat\nseurat.int &lt;- ScaleData(object = seurat.int, verbose = FALSE,\n                        features = rownames(seurat.int))\nseurat.int &lt;- RunPCA(object = seurat.int, npcs = 20, verbose = FALSE)\nseurat.int &lt;- RunTSNE(object = seurat.int, reduction = \"pca\", dims = 1:20)\nseurat.int &lt;- RunUMAP(object = seurat.int, reduction = \"pca\", dims = 1:20)"
  },
  {
    "objectID": "analysis/subsetBEC.html#save-int-object",
    "href": "analysis/subsetBEC.html#save-int-object",
    "title": "Subset BECs human lymph nodes",
    "section": "save int object",
    "text": "save int object\n\nDefaultAssay(object = seurat.int) &lt;- \"RNA\"\nIdents(seurat.int) &lt;- seurat.int$intCluster\n\nsaveRDS(seurat.int,\n        file= paste0(basedir,\n                     \"/data/AllPatWithoutCM_BEConly_intOrig_seurat.rds\"))"
  },
  {
    "objectID": "analysis/subsetBEC.html#visualize-int-data",
    "href": "analysis/subsetBEC.html#visualize-int-data",
    "title": "Subset BECs human lymph nodes",
    "section": "visualize int data",
    "text": "visualize int data\n\nclustering\n\ncolPal &lt;- c(pal_nejm()(8),pal_futurama()(12))[1:length(levels(seurat.int))]\nnames(colPal) &lt;- levels(seurat.int)\n\nDimPlot(seurat.int, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat.int, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond\n\nDimPlot(seurat.int, reduction = \"umap\", cols=colCond2, group.by = \"cond2\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/subsetBEC.html#session-info",
    "href": "analysis/subsetBEC.html#session-info",
    "title": "Subset BECs human lymph nodes",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] scater_1.28.0               scuttle_1.10.3              SingleCellExperiment_1.22.0\n [4] SummarizedExperiment_1.30.2 Biobase_2.60.0              GenomicRanges_1.52.1       \n [7] GenomeInfoDb_1.36.4         IRanges_2.36.0              S4Vectors_0.40.1           \n[10] BiocGenerics_0.48.0         MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[13] pheatmap_1.0.12             ggsci_3.0.0                 here_1.0.1                 \n[16] runSeurat3_0.1.0            ggpubr_0.6.0                lubridate_1.9.3            \n[19] forcats_1.0.0               stringr_1.5.1               readr_2.1.5                \n[22] tidyr_1.3.1                 tibble_3.2.1                tidyverse_2.0.0            \n[25] Seurat_5.0.1                SeuratObject_5.0.1          sp_2.1-3                   \n[28] purrr_1.0.2                 cowplot_1.1.3               ggplot2_3.4.4              \n[31] reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             rprojroot_2.0.4          \n [10] globals_0.16.2            lattice_0.22-5            MASS_7.3-60.0.1          \n [13] backports_1.4.1           magrittr_2.0.3            plotly_4.10.4            \n [16] rmarkdown_2.25            yaml_2.3.8                httpuv_1.6.14            \n [19] sctransform_0.4.1         spam_2.10-0               spatstat.sparse_3.0-3    \n [22] reticulate_1.35.0         pbapply_1.7-2             RColorBrewer_1.1-3       \n [25] abind_1.4-5               zlibbioc_1.46.0           Rtsne_0.17               \n [28] RCurl_1.98-1.14           GenomeInfoDbData_1.2.10   ggrepel_0.9.5            \n [31] irlba_2.3.5.1             listenv_0.9.1             spatstat.utils_3.0-4     \n [34] goftest_1.2-3             RSpectra_0.16-1           spatstat.random_3.2-2    \n [37] fitdistrplus_1.1-11       parallelly_1.37.0         DelayedMatrixStats_1.22.6\n [40] leiden_0.4.3.1            codetools_0.2-19          DelayedArray_0.26.7      \n [43] tidyselect_1.2.0          farver_2.1.1              viridis_0.6.5            \n [46] ScaledMatrix_1.8.1        spatstat.explore_3.2-6    jsonlite_1.8.8           \n [49] BiocNeighbors_1.18.0      ellipsis_0.3.2            progressr_0.14.0         \n [52] ggridges_0.5.6            survival_3.5-8            tools_4.3.0              \n [55] ica_1.0-3                 Rcpp_1.0.12               glue_1.7.0               \n [58] gridExtra_2.3             xfun_0.42                 withr_3.0.0              \n [61] fastmap_1.1.1             fansi_1.0.6               rsvd_1.0.5               \n [64] digest_0.6.34             timechange_0.3.0          R6_2.5.1                 \n [67] mime_0.12                 colorspace_2.1-0          scattermore_1.2          \n [70] tensor_1.5                spatstat.data_3.0-4       utf8_1.2.4               \n [73] generics_0.1.3            data.table_1.15.0         httr_1.4.7               \n [76] htmlwidgets_1.6.4         S4Arrays_1.0.6            uwot_0.1.16              \n [79] pkgconfig_2.0.3           gtable_0.3.4              lmtest_0.9-40            \n [82] XVector_0.40.0            htmltools_0.5.7           carData_3.0-5            \n [85] dotCall64_1.1-1           scales_1.3.0              png_0.1-8                \n [88] knitr_1.45                rstudioapi_0.15.0         tzdb_0.4.0               \n [91] nlme_3.1-164              zoo_1.8-12                KernSmooth_2.23-22       \n [94] vipor_0.4.7               parallel_4.3.0            miniUI_0.1.1.1           \n [97] pillar_1.9.0              grid_4.3.0                vctrs_0.6.5              \n[100] RANN_2.6.1                promises_1.2.1            BiocSingular_1.16.0      \n[103] car_3.1-2                 beachmat_2.16.0           xtable_1.8-4             \n[106] cluster_2.1.6             beeswarm_0.4.0            evaluate_0.23            \n[109] cli_3.6.2                 compiler_4.3.0            rlang_1.1.3              \n[112] crayon_1.5.2              future.apply_1.11.1       ggsignif_0.6.4           \n[115] labeling_0.4.3            ggbeeswarm_0.7.2          plyr_1.8.9               \n[118] stringi_1.8.3             BiocParallel_1.34.2       viridisLite_0.4.2        \n[121] deldir_2.0-2              munsell_0.5.0             lazyeval_0.2.2           \n[124] spatstat.geom_3.2-8       Matrix_1.6-5              RcppHNSW_0.6.0           \n[127] hms_1.1.3                 patchwork_1.2.0           sparseMatrixStats_1.12.2 \n[130] future_1.33.1             shiny_1.8.0               ROCR_1.0-11              \n[133] igraph_2.0.2              broom_1.0.5              \n\ndate()\n\n[1] \"Tue Mar  5 11:18:17 2024\""
  },
  {
    "objectID": "analysis/visDEgenesScore.html",
    "href": "analysis/visDEgenesScore.html",
    "title": "DE genes FRCs resting versus activated human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n  library(SingleCellExperiment)\n  library(scran)\n})"
  },
  {
    "objectID": "analysis/visDEgenesScore.html#load-packages",
    "href": "analysis/visDEgenesScore.html#load-packages",
    "title": "DE genes FRCs resting versus activated human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n  library(SingleCellExperiment)\n  library(scran)\n})"
  },
  {
    "objectID": "analysis/visDEgenesScore.html#load-seurat-object",
    "href": "analysis/visDEgenesScore.html#load-seurat-object",
    "title": "DE genes FRCs resting versus activated human LN",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\nseurat &lt;- readRDS(file= paste0(basedir,\n                               \"/data/AllPatWithoutCM_FRConly_intOrig_seurat.rds\"))\n\nDefaultAssay(object = seurat) &lt;- \"RNA\"\nseurat$intCluster &lt;- as.character(seurat$integrated_snn_res.0.25)\nIdents(seurat) &lt;- seurat$intCluster\n\n\n## set col palettes\ncolPal &lt;- c(pal_uchicago()(6), \"#6692a3\", \"#3b7f60\")\nnames(colPal) &lt;- c(\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\")\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond) &lt;- unique(seurat$cond)\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\ncolTon &lt;- colCond\n\n## all activated in one grp\nseurat$cond2 &lt;- seurat$cond\nseurat$cond2[which(seurat$cond %in% c(\"chronic\", \"acute\"))] &lt;- \"activated\"\n\ncolCond2 &lt;- c(\"#6692a3\",\"#971c1c\")\nnames(colCond2) &lt;- c(\"resting\", \"activated\")"
  },
  {
    "objectID": "analysis/visDEgenesScore.html#visualize-data",
    "href": "analysis/visDEgenesScore.html#visualize-data",
    "title": "DE genes FRCs resting versus activated human LN",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond2\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ngrp\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/visDEgenesScore.html#overall-de-genes",
    "href": "analysis/visDEgenesScore.html#overall-de-genes",
    "title": "DE genes FRCs resting versus activated human LN",
    "section": "overall DE genes",
    "text": "overall DE genes\n\nsce &lt;- as.SingleCellExperiment(seurat)\n#m.out &lt;- scoreMarkers(sce, sce$cond2, block=sce$patient)\nm.out &lt;- scoreMarkers(sce, sce$cond2)\n\n\nplot DE genes mean AUC\n\ncluVec &lt;- unique(names(m.out))\nlapply(cluVec, function(cl){\n  outSub &lt;- data.frame(m.out@listData[[cl]]) %&gt;%\n    rownames_to_column(var = \"gene\") %&gt;%\n    slice_max(., order_by=mean.AUC, n=26)\n  plotExpression(sce, features=outSub$gene, \n    x=\"patient\", colour_by=\"cond2\") +\n    scale_color_manual(values = colCond2)\n})\n\n[[1]]\n\n\n\n\n\n\n[[2]]\n\n\n\n\n\n\n\nplot DE genes mean.logFC.cohen\n\ncluVec &lt;- unique(names(m.out))\nlapply(cluVec, function(cl){\n  outSub &lt;- data.frame(m.out@listData[[cl]]) %&gt;%\n    rownames_to_column(var = \"gene\") %&gt;%\n    slice_max(., order_by=mean.logFC.cohen, n=26)\n  plotExpression(sce, features=outSub$gene, \n    x=\"patient\", colour_by=\"cond2\") +\n    scale_color_manual(values = colCond2)\n})\n\n[[1]]\n\n\n\n\n\n\n[[2]]\n\n\n\n\n\n\n\nplot DE genes mean.logFC.detected\n\ncluVec &lt;- unique(names(m.out))\nlapply(cluVec, function(cl){\n  outSub &lt;- data.frame(m.out@listData[[cl]]) %&gt;%\n    rownames_to_column(var = \"gene\") %&gt;%\n    slice_max(., order_by=mean.logFC.detected, n=26)\n  plotExpression(sce, features=outSub$gene, \n    x=\"patient\", colour_by=\"cond\") +\n    scale_color_manual(values = colCond2)\n})\n\n[[1]]\n\n\n\n\n\n\n[[2]]"
  },
  {
    "objectID": "analysis/visDEgenesScore.html#cw-de-genes",
    "href": "analysis/visDEgenesScore.html#cw-de-genes",
    "title": "DE genes FRCs resting versus activated human LN",
    "section": "cw DE genes",
    "text": "cw DE genes\n\ncluVec &lt;- unique(sce$integrated_snn_res.0.25)\nlapply(cluVec, function(cl){\n  sceSub &lt;- sce[,which(sce$integrated_snn_res.0.25 == cl)]\n  m.out &lt;- scoreMarkers(sceSub, sceSub$cond2)\n  condVec &lt;- unique(names(m.out))\n  lapply(condVec, function(co){\n    outSub &lt;- data.frame(m.out@listData[[co]]) %&gt;%\n      rownames_to_column(var = \"gene\") %&gt;%\n      slice_max(., order_by=mean.AUC, n=26)\n    plotExpression(sceSub, features=outSub$gene, \n      x=\"patient\", colour_by=\"cond2\") +\n      scale_color_manual(values = colCond2)\n  })\n})\n\n[[1]]\n[[1]][[1]]\n\n\n\n\n\n\n[[1]][[2]]\n\n\n\n\n\n\n\n[[2]]\n[[2]][[1]]\n\n\n\n\n\n\n[[2]][[2]]\n\n\n\n\n\n\n\n[[3]]\n[[3]][[1]]\n\n\n\n\n\n\n[[3]][[2]]\n\n\n\n\n\n\n\n[[4]]\n[[4]][[1]]\n\n\n\n\n\n\n[[4]][[2]]\n\n\n\n\n\n\n\n[[5]]\n[[5]][[1]]\n\n\n\n\n\n\n[[5]][[2]]\n\n\n\n\n\n\n\n[[6]]\n[[6]][[1]]\n\n\n\n\n\n\n[[6]][[2]]\n\n\n\n\n\n\n\n[[7]]\n[[7]][[1]]\n\n\n\n\n\n\n[[7]][[2]]\n\n\n\n\n\n\n\n[[8]]\n[[8]][[1]]\n\n\n\n\n\n\n[[8]][[2]]\n\n\n\n\n\n\ndistribution of logFC of top 100 cw DE genes activated\n\ncluVec &lt;- unique(sce$integrated_snn_res.0.25)\nlogFCgrps &lt;- c(\"mean.logFC.cohen\", \"mean.AUC\", \"mean.logFC.detected\")\n\nlapply(logFCgrps, function(lFC){\n  outAct &lt;- lapply(cluVec, function(cl){\n    sceSub &lt;- sce[,which(sce$integrated_snn_res.0.25 == cl)]\n    m.out &lt;- scoreMarkers(sceSub, sceSub$cond2)\n    condVec &lt;- unique(names(m.out))\n    co &lt;- \"activated\"\n    outSub &lt;- data.frame(m.out@listData[[co]]) %&gt;%\n      rownames_to_column(var = \"gene\") %&gt;%\n      slice_max(., order_by=.[[lFC]], n=100)%&gt;%\n      mutate(condCl=paste0(co, \"_\", cl)) %&gt;% \n      mutate(cluster=cl)\n  })\n\n  outActDat &lt;- do.call(\"rbind\", outAct)\n\n  p1 &lt;-ggdensity(outActDat, x = lFC,\n   add = \"median\", rug = TRUE,\n   color = \"cluster\", fill = \"cluster\",\n   palette = colPal)\n\n  p2 &lt;- ggviolin(outActDat, x = \"cluster\", y = lFC, fill = \"cluster\",\n          palette = colPal,\n          add = \"median_iqr\")\n  \n  p3 &lt;- ggboxplot(outActDat, x = \"cluster\", y = lFC,\n            color = \"cluster\", palette =colPal,\n            add = \"jitter\")\n  gridExtra::grid.arrange(p1, p2, p3, ncol=2)\n})\n\n\n\n\n\n\n\n\n\n\n[[1]]\nTableGrob (2 x 2) \"arrange\": 3 grobs\n  z     cells    name           grob\n1 1 (1-1,1-1) arrange gtable[layout]\n2 2 (1-1,2-2) arrange gtable[layout]\n3 3 (2-2,1-1) arrange gtable[layout]\n\n[[2]]\nTableGrob (2 x 2) \"arrange\": 3 grobs\n  z     cells    name           grob\n1 1 (1-1,1-1) arrange gtable[layout]\n2 2 (1-1,2-2) arrange gtable[layout]\n3 3 (2-2,1-1) arrange gtable[layout]\n\n[[3]]\nTableGrob (2 x 2) \"arrange\": 3 grobs\n  z     cells    name           grob\n1 1 (1-1,1-1) arrange gtable[layout]\n2 2 (1-1,2-2) arrange gtable[layout]\n3 3 (2-2,1-1) arrange gtable[layout]\n\n\n\n\ndistribution of logFC of top 100 cw DE genes resting\n\ncluVec &lt;- unique(sce$integrated_snn_res.0.25)\nlogFCgrps &lt;- c(\"mean.logFC.cohen\", \"mean.AUC\", \"mean.logFC.detected\")\n\nlapply(logFCgrps, function(lFC){\n  outAct &lt;- lapply(cluVec, function(cl){\n    sceSub &lt;- sce[,which(sce$integrated_snn_res.0.25 == cl)]\n    m.out &lt;- scoreMarkers(sceSub, sceSub$cond2)\n    condVec &lt;- unique(names(m.out))\n    co &lt;- \"resting\"\n    outSub &lt;- data.frame(m.out@listData[[co]]) %&gt;%\n      rownames_to_column(var = \"gene\") %&gt;%\n      slice_max(., order_by=.[[lFC]], n=100)%&gt;%\n      mutate(condCl=paste0(co, \"_\", cl)) %&gt;% \n      mutate(cluster=cl)\n  })\n\n  outActDat &lt;- do.call(\"rbind\", outAct)\n\n  p1 &lt;-ggdensity(outActDat, x = lFC,\n   add = \"median\", rug = TRUE,\n   color = \"cluster\", fill = \"cluster\",\n   palette = colPal)\n\n  p2 &lt;- ggviolin(outActDat, x = \"cluster\", y = lFC, fill = \"cluster\",\n          palette = colPal,\n          add = \"median_iqr\")\n  \n  p3 &lt;- ggboxplot(outActDat, x = \"cluster\", y = lFC,\n            color = \"cluster\", palette =colPal,\n            add = \"jitter\")\n  gridExtra::grid.arrange(p1, p2, p3, ncol=2)\n})\n\n\n\n\n\n\n\n\n\n\n[[1]]\nTableGrob (2 x 2) \"arrange\": 3 grobs\n  z     cells    name           grob\n1 1 (1-1,1-1) arrange gtable[layout]\n2 2 (1-1,2-2) arrange gtable[layout]\n3 3 (2-2,1-1) arrange gtable[layout]\n\n[[2]]\nTableGrob (2 x 2) \"arrange\": 3 grobs\n  z     cells    name           grob\n1 1 (1-1,1-1) arrange gtable[layout]\n2 2 (1-1,2-2) arrange gtable[layout]\n3 3 (2-2,1-1) arrange gtable[layout]\n\n[[3]]\nTableGrob (2 x 2) \"arrange\": 3 grobs\n  z     cells    name           grob\n1 1 (1-1,1-1) arrange gtable[layout]\n2 2 (1-1,2-2) arrange gtable[layout]\n3 3 (2-2,1-1) arrange gtable[layout]"
  },
  {
    "objectID": "analysis/visDEgenesScore.html#session-info",
    "href": "analysis/visDEgenesScore.html#session-info",
    "title": "DE genes FRCs resting versus activated human LN",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] Matrix_1.6-5                scran_1.28.2                scater_1.28.0              \n [4] scuttle_1.10.3              SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2\n [7] Biobase_2.60.0              GenomicRanges_1.52.1        GenomeInfoDb_1.36.4        \n[10] IRanges_2.36.0              S4Vectors_0.40.1            BiocGenerics_0.48.0        \n[13] MatrixGenerics_1.12.3       matrixStats_1.2.0           pheatmap_1.0.12            \n[16] ggsci_3.0.0                 here_1.0.1                  runSeurat3_0.1.0           \n[19] ggpubr_0.6.0                lubridate_1.9.3             forcats_1.0.0              \n[22] stringr_1.5.1               readr_2.1.5                 tidyr_1.3.1                \n[25] tibble_3.2.1                tidyverse_2.0.0             Seurat_5.0.1               \n[28] SeuratObject_5.0.1          sp_2.1-3                    purrr_1.0.2                \n[31] ggplot2_3.4.4               reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             edgeR_3.42.4             \n [10] rprojroot_2.0.4           globals_0.16.2            lattice_0.22-5           \n [13] MASS_7.3-60.0.1           backports_1.4.1           magrittr_2.0.3           \n [16] limma_3.56.2              plotly_4.10.4             rmarkdown_2.25           \n [19] yaml_2.3.8                metapod_1.8.0             httpuv_1.6.14            \n [22] sctransform_0.4.1         spam_2.10-0               spatstat.sparse_3.0-3    \n [25] reticulate_1.35.0         cowplot_1.1.3             pbapply_1.7-2            \n [28] RColorBrewer_1.1-3        abind_1.4-5               zlibbioc_1.46.0          \n [31] Rtsne_0.17                RCurl_1.98-1.14           GenomeInfoDbData_1.2.10  \n [34] ggrepel_0.9.5             irlba_2.3.5.1             listenv_0.9.1            \n [37] spatstat.utils_3.0-4      goftest_1.2-3             RSpectra_0.16-1          \n [40] dqrng_0.3.2               spatstat.random_3.2-2     fitdistrplus_1.1-11      \n [43] parallelly_1.37.0         DelayedMatrixStats_1.22.6 leiden_0.4.3.1           \n [46] codetools_0.2-19          DelayedArray_0.26.7       tidyselect_1.2.0         \n [49] farver_2.1.1              viridis_0.6.5             ScaledMatrix_1.8.1       \n [52] spatstat.explore_3.2-6    jsonlite_1.8.8            BiocNeighbors_1.18.0     \n [55] ellipsis_0.3.2            progressr_0.14.0          ggridges_0.5.6           \n [58] survival_3.5-8            tools_4.3.0               ica_1.0-3                \n [61] Rcpp_1.0.12               glue_1.7.0                gridExtra_2.3            \n [64] xfun_0.42                 withr_3.0.0               fastmap_1.1.1            \n [67] bluster_1.10.0            fansi_1.0.6               rsvd_1.0.5               \n [70] digest_0.6.34             timechange_0.3.0          R6_2.5.1                 \n [73] mime_0.12                 colorspace_2.1-0          scattermore_1.2          \n [76] tensor_1.5                spatstat.data_3.0-4       utf8_1.2.4               \n [79] generics_0.1.3            data.table_1.15.0         httr_1.4.7               \n [82] htmlwidgets_1.6.4         S4Arrays_1.0.6            uwot_0.1.16              \n [85] pkgconfig_2.0.3           gtable_0.3.4              lmtest_0.9-40            \n [88] XVector_0.40.0            htmltools_0.5.7           carData_3.0-5            \n [91] dotCall64_1.1-1           scales_1.3.0              png_0.1-8                \n [94] knitr_1.45                rstudioapi_0.15.0         tzdb_0.4.0               \n [97] nlme_3.1-164              zoo_1.8-12                KernSmooth_2.23-22       \n[100] vipor_0.4.7               parallel_4.3.0            miniUI_0.1.1.1           \n[103] pillar_1.9.0              grid_4.3.0                vctrs_0.6.5              \n[106] RANN_2.6.1                promises_1.2.1            BiocSingular_1.16.0      \n[109] car_3.1-2                 beachmat_2.16.0           xtable_1.8-4             \n[112] cluster_2.1.6             beeswarm_0.4.0            evaluate_0.23            \n[115] locfit_1.5-9.8            cli_3.6.2                 compiler_4.3.0           \n[118] rlang_1.1.3               crayon_1.5.2              future.apply_1.11.1      \n[121] ggsignif_0.6.4            labeling_0.4.3            ggbeeswarm_0.7.2         \n[124] plyr_1.8.9                stringi_1.8.3             BiocParallel_1.34.2      \n[127] viridisLite_0.4.2         deldir_2.0-2              munsell_0.5.0            \n[130] lazyeval_0.2.2            spatstat.geom_3.2-8       RcppHNSW_0.6.0           \n[133] hms_1.1.3                 patchwork_1.2.0           sparseMatrixStats_1.12.2 \n[136] future_1.33.1             statmod_1.5.0             shiny_1.8.0              \n[139] ROCR_1.0-11               igraph_2.0.2              broom_1.0.5              \n\ndate()\n\n[1] \"Tue Mar  5 19:01:58 2024\""
  },
  {
    "objectID": "analysis/visRestingLNonly.html",
    "href": "analysis/visRestingLNonly.html",
    "title": "visualize marker genes FRCs - resting LN only",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n  library(clusterProfiler)\n  library(org.Hs.eg.db)\n  library(DOSE)\n  library(enrichplot)\n})"
  },
  {
    "objectID": "analysis/visRestingLNonly.html#load-packages",
    "href": "analysis/visRestingLNonly.html#load-packages",
    "title": "visualize marker genes FRCs - resting LN only",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n  library(clusterProfiler)\n  library(org.Hs.eg.db)\n  library(DOSE)\n  library(enrichplot)\n})"
  },
  {
    "objectID": "analysis/visRestingLNonly.html#load-seurat-object",
    "href": "analysis/visRestingLNonly.html#load-seurat-object",
    "title": "visualize marker genes FRCs - resting LN only",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\nseurat &lt;- readRDS(file= paste0(basedir,\n                               \"/data/AllPatWithoutCM_FRConly_intOrig_seurat.rds\"))\n\nDefaultAssay(object = seurat) &lt;- \"RNA\"\n\n## set col palettes\ncolPal &lt;- c(pal_uchicago()(6), \"#6692a3\", \"#3b7f60\")\nnames(colPal) &lt;- c(\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\")\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond2 &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond2) &lt;- unique(seurat$cond)\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\n\n## all activated in one grp\nseurat$cond2 &lt;- seurat$cond\nseurat$cond[which(seurat$cond %in% c(\"chronic\", \"acute\"))] &lt;- \"activated\"\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\")\nnames(colCond) &lt;- c(\"resting\", \"activated\")"
  },
  {
    "objectID": "analysis/visRestingLNonly.html#subset-only-resting",
    "href": "analysis/visRestingLNonly.html#subset-only-resting",
    "title": "visualize marker genes FRCs - resting LN only",
    "section": "subset only resting",
    "text": "subset only resting\n\nseurat &lt;- subset(seurat, cond==\"resting\")"
  },
  {
    "objectID": "analysis/visRestingLNonly.html#visualize-data",
    "href": "analysis/visRestingLNonly.html#visualize-data",
    "title": "visualize marker genes FRCs - resting LN only",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPal, pt.size=1)+\n  theme_void()\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()\n\n\n\n\n\n\ncond\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond, group.by = \"cond\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colCond, group.by = \"cond\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()\n\n\n\n\n\n\ngrp\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/visRestingLNonly.html#vis-selected-stroma-marker",
    "href": "analysis/visRestingLNonly.html#vis-selected-stroma-marker",
    "title": "visualize marker genes FRCs - resting LN only",
    "section": "vis selected stroma marker",
    "text": "vis selected stroma marker\n\nIdents(seurat) &lt;- seurat$intCluster\ncluster &lt;- levels(seurat)\n\ngenes &lt;- data.frame(gene=rownames(seurat)) %&gt;% \n    mutate(geneID=gsub(\"^.*\\\\.\", \"\", gene)) \n\nselGenesAll &lt;- read_tsv(file = paste0(basedir,\n                                      \"/data/overallFRCMarker.txt\")) %&gt;% \n  left_join(., genes, by = \"geneID\") %&gt;% \n  filter(!gene == \"ENSG00000232995.RGS5\")\n\nseurat$intCluster &lt;- factor(seurat$intCluster, levels = c(\"7\", \"2\",\"0\",\"1\",\n                                                          \"5\", \"6\", \"3\", \"4\"))\nIdents(seurat) &lt;- seurat$intCluster\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=F,\n                  cr=F, condCol=F)\n\n\n\n\n\nDotplot\n\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenesAll$gene), scale =T,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenesAll$gene), labels=rev(selGenesAll$geneID)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenesAll$gene), scale =F,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenesAll$gene), labels=rev(selGenesAll$geneID)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\n\n\n\nFeatureplot\n\npList &lt;- sapply(selGenesAll$gene, function(x){\np &lt;- FeaturePlot(seurat, reduction = \"umap\", \n            features = x,\n            cols=c(\"lightgrey\", \"darkred\"),\n            order = F)+\n  theme(legend.position=\"right\")\n  plot(p)\n})"
  },
  {
    "objectID": "analysis/visRestingLNonly.html#project-signatures",
    "href": "analysis/visRestingLNonly.html#project-signatures",
    "title": "visualize marker genes FRCs - resting LN only",
    "section": "project signatures",
    "text": "project signatures\n\ngenesDat &lt;- data.frame(EnsID=rownames(seurat)) %&gt;% \n  mutate(gene=gsub(\".*\\\\.\", \"\", EnsID))\nselGenes &lt;- data.frame(gene=c(\"ACTA2\", \"TAGLN\", \"MYH11\", \"TPM1\", \"MCAM\", \"RGS5\")) %&gt;% \n  left_join(., genesDat, by=\"gene\")\n\nseurat &lt;- AddModuleScore(\n  object = seurat,\n  features = list(c(selGenes$EnsID)),\n  ctrl = 5,\n  name = 'VSMCsign'\n)\n\ncut &lt;- 0.8*max(seurat$VSMCsign1)\nselSign &lt;- \"VSMCsign1\" \np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=c(\"#00155e\", \"#4575B4\", \"#FFFFBF\" ,\"#f6aa3e\", \n                    \"#d64141\",\"#8c0128\"),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)\n\n\n\np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=rev(c(\"#D73027\", \"#FC8D59\",\"#FEE090\", \"#E0F3F8\", \"#91BFDB\", \"#4575B4\")),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)\n\n\n\np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=c( '#d7eae7', '#74a6b3' ,'#5b8ea9', '#2c5c9e', '#00429d', \"#00155e\"),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)\n\n\n\np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=c('#dadada', '#c3b0b1' ,'#9c676b', '#93003a', '#6c1835'),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)\n\n\n\nIdents(seurat) &lt;- seurat$intCluster\nselGenesForm &lt;- selGenes %&gt;% mutate(geneID=gene) %&gt;%\n  dplyr::select(geneID, EnsID) %&gt;% mutate(gene=EnsID)\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesForm,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=F,\n                  cr=F, condCol=F)\n\n\n\nselGenes &lt;- data.frame(gene=c(\"CCL19\", \"CCL21\", \"CXCL13\", \"LUM\", \"THY1\",\n                              \"PDGFRA\", \"PDGFRB\", \"COL1A1\", \"COL1A2\", \"COL3A1\")) %&gt;% \n  left_join(., genesDat, by=\"gene\")\n\nseurat &lt;- AddModuleScore(\n  object = seurat,\n  features = list(c(selGenes$EnsID)),\n  ctrl = 5,\n  name = 'FRCsign'\n)\n\ncut &lt;- 0.8*max(seurat$FRCsign1)\nselSign &lt;- \"FRCsign1\" \np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=c(\"#00155e\", \"#4575B4\", \"#FFFFBF\" ,\"#f6aa3e\", \n                    \"#d64141\",\"#8c0128\"),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)\n\n\n\np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=rev(c(\"#D73027\", \"#FC8D59\",\"#FEE090\", \"#E0F3F8\", \"#91BFDB\", \"#4575B4\")),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)\n\n\n\np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=c( '#d7eae7', '#74a6b3' ,'#5b8ea9', '#2c5c9e', '#00429d', \"#00155e\"),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)\n\n\n\np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=c('#dadada', '#c3b0b1' ,'#9c676b', '#93003a', '#6c1835'),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)\n\n\n\nselGenesForm &lt;- selGenes %&gt;% mutate(geneID=gene) %&gt;%\n  dplyr::select(geneID, EnsID) %&gt;% mutate(gene=EnsID)\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesForm,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=F,\n                  cr=F, condCol=F)\n\n\n\nselGenes &lt;- data.frame(gene=c(\"CCL19\", \"CCL21\", \"CXCL13\", \"LUM\", \"PDGFRA\",\n                              \"PGFRB\")) %&gt;% \n  left_join(., genesDat, by=\"gene\")\n\nIdents(seurat) &lt;- seurat$grp\nseurat &lt;- AddModuleScore(\n  object = seurat,\n  features = list(c(selGenes$EnsID)),\n  ctrl = 5,\n  name = 'FRC2sign'\n)\n\ncut &lt;- 0.8*max(seurat$FRC2sign1)\nselSign &lt;- \"FRC2sign1\" \np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=c(\"#00155e\", \"#4575B4\",\"#E0F3F8\", \"#FFFFBF\" ,\"#f6aa3e\",\"#d64141\"),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)\n\n\n\np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=rev(c(\"#D73027\", \"#FC8D59\",\"#FEE090\", \"#E0F3F8\", \"#91BFDB\", \"#4575B4\")),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)\n\n\n\np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=c( '#d7eae7', '#74a6b3' ,'#5b8ea9', '#2c5c9e', '#00429d', \"#00155e\"),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)\n\n\n\np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=c('#dadada', '#c3b0b1' ,'#9c676b', '#93003a', '#6c1835'),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)"
  },
  {
    "objectID": "analysis/visRestingLNonly.html#gene-signature-perivasular-niche",
    "href": "analysis/visRestingLNonly.html#gene-signature-perivasular-niche",
    "title": "visualize marker genes FRCs - resting LN only",
    "section": "gene signature perivasular niche",
    "text": "gene signature perivasular niche\n\nperiCluster &lt;- c(\"3\", \"4\", \"5\", \"6\")\nothers &lt;- c(\"0\", \"1\", \"2\", \"7\")\nseurat$peri &lt;- \"peri\"\nseurat$peri[which(seurat$intCluster %in% others)] &lt;- \"other\"\nIdents(seurat) &lt;- seurat$peri\n\nclustDE &lt;- lapply(periCluster, function(cl){\n  seuratSub &lt;- subset(seurat, intCluster %in% c(cl, others))\n  DEgenes &lt;-FindAllMarkers(seuratSub, only.pos=T, logfc.threshold = 0.1,\n                           min.pct = 0.01)\n  if(nrow(DEgenes)&gt;1){\n    DEgenes &lt;- DEgenes %&gt;% filter(p_val_adj&lt;0.01) %&gt;%\n      mutate(group=paste0(cl, \"_\", cluster)) %&gt;% \n      mutate(geneID=gsub(\".*\\\\.\", \"\",  gene)) \n    }\n})\n\nnames(clustDE) &lt;- periCluster\n\nclustDE_Dat &lt;- data.frame(do.call(\"rbind\", clustDE))\n\nintersectMarker &lt;- clustDE_Dat %&gt;% group_by(cluster, gene) %&gt;%\n  summarize(cnt=n())\n\nselGenes &lt;- data.frame(gene=c(\"ANXA1\",\"ASPN\", \"CD9\", \"ANGPT1\", \"EBF1\", \"EBF2\",\n                              \"A2M\",\"SPARCL1\", \"CAV1\", \"CAV2\",  \"ENPEP\")) %&gt;% \n  left_join(., genesDat, by=\"gene\")\n\nseurat &lt;- AddModuleScore(\n  object = seurat,\n  features = list(c(selGenes$EnsID)),\n  ctrl = 5,\n  name = 'PRCsign'\n)\n\ncut &lt;- 0.8*max(seurat$PRCsign1)\nselSign &lt;- \"PRCsign1\" \np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=c(\"#00155e\", \"#4575B4\",\"#E0F3F8\", \"#FFFFBF\" ,\"#f6aa3e\",\"#d64141\"),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)\n\n\n\np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=rev(c(\"#D73027\", \"#FC8D59\",\"#FEE090\", \"#E0F3F8\", \"#91BFDB\", \"#4575B4\")),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)\n\n\n\np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=c( '#d7eae7', '#74a6b3' ,'#5b8ea9', '#2c5c9e', '#00429d', \"#00155e\"),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)\n\n\n\np &lt;- FeaturePlot(seurat, reduction = \"umap\", pt.size = 1, max.cutoff = cut,\n            features = selSign,\n            cols=c('#dadada', '#c3b0b1' ,'#9c676b', '#93003a', '#6c1835'),\n            order = F)+\n  theme(legend.position=\"right\")\nplot(p)\n\n\n\n\n\ndotplot perivascular gene signature\n\nIdents(seurat) &lt;- seurat$intCluster\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenes$EnsID), scale =T,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenes$EnsID), labels=rev(selGenes$gene)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenes$EnsID), scale =F,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenes$EnsID), labels=rev(selGenes$gene)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\n\n\n\nheatmap\n\nselGenesForm &lt;- selGenes %&gt;% mutate(geneID=gene) %&gt;%\n  dplyr::select(geneID, EnsID) %&gt;% mutate(gene=EnsID)\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesForm,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=F,\n                  cr=F, condCol=F)\n\n\n\n\n\n\nGO term enrichment\n\ncolPeri &lt;- c(\"#394e9a\", \"#aeafb1\")\nnames(colPeri) &lt;- c(\"peri\", \"others\")\n\nselGenesGO &lt;- intersectMarker %&gt;% dplyr::filter(cluster==\"peri\" & cnt==4) %&gt;% \n  mutate(EnsID = gsub(\"\\\\..*$\", \"\", gene))\negoA &lt;- enrichGO(gene         = unique(selGenesGO$EnsID),\n                OrgDb         = org.Hs.eg.db,\n                keyType       = 'ENSEMBL',\n                ont           = \"BP\",\n                pAdjustMethod = \"BH\",\n                pvalueCutoff  = 0.05,\n                qvalueCutoff  = 0.05)\negoA &lt;- setReadable(egoA, OrgDb = org.Hs.eg.db)\negoADat &lt;- egoA@result\nselGO &lt;- c(\"GO:0006936\", \"GO:0031032\", \"GO:0031589\",\n           \"GO:1903522\", \"GO:0097746\", \"GO:0071711\", \"GO:1901888\", \"GO:0050878\")\n\nselGODat &lt;- egoADat %&gt;% filter(ID %in% selGO) %&gt;% mutate(cluster=\"peri\")\nselGODat &lt;- selGODat %&gt;% mutate(qscore=-log(p.adjust, base=10)) \np &lt;- ggbarplot(selGODat, x = \"Description\", y = \"qscore\",\n          fill = \"cluster\",               \n          color = \"cluster\",            \n          palette = colPeri,            \n          sort.val = \"asc\",           \n          sort.by.groups = TRUE      \n          #x.text.angle = 90           \n          ) + \n  rotate()\np"
  },
  {
    "objectID": "analysis/visRestingLNonly.html#session-info",
    "href": "analysis/visRestingLNonly.html#session-info",
    "title": "visualize marker genes FRCs - resting LN only",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] enrichplot_1.20.3           DOSE_3.26.2                 org.Hs.eg.db_3.17.0        \n [4] AnnotationDbi_1.62.2        clusterProfiler_4.8.3       scater_1.28.0              \n [7] scuttle_1.10.3              SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2\n[10] Biobase_2.60.0              GenomicRanges_1.52.1        GenomeInfoDb_1.36.4        \n[13] IRanges_2.36.0              S4Vectors_0.40.1            BiocGenerics_0.48.0        \n[16] MatrixGenerics_1.12.3       matrixStats_1.2.0           pheatmap_1.0.12            \n[19] ggsci_3.0.0                 here_1.0.1                  runSeurat3_0.1.0           \n[22] ggpubr_0.6.0                lubridate_1.9.3             forcats_1.0.0              \n[25] stringr_1.5.1               readr_2.1.5                 tidyr_1.3.1                \n[28] tibble_3.2.1                tidyverse_2.0.0             Seurat_5.0.1               \n[31] SeuratObject_5.0.1          sp_2.1-3                    purrr_1.0.2                \n[34] cowplot_1.1.3               ggplot2_3.4.4               reshape2_1.4.4             \n[37] dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] fs_1.6.3                  spatstat.sparse_3.0-3     bitops_1.0-7             \n  [4] HDO.db_0.99.1             httr_1.4.7                RColorBrewer_1.1-3       \n  [7] tools_4.3.0               sctransform_0.4.1         backports_1.4.1          \n [10] utf8_1.2.4                R6_2.5.1                  lazyeval_0.2.2           \n [13] uwot_0.1.16               withr_3.0.0               gridExtra_2.3            \n [16] progressr_0.14.0          cli_3.6.2                 spatstat.explore_3.2-6   \n [19] fastDummies_1.7.3         scatterpie_0.2.1          labeling_0.4.3           \n [22] spatstat.data_3.0-4       ggridges_0.5.6            pbapply_1.7-2            \n [25] yulab.utils_0.1.4         gson_0.1.0                parallelly_1.37.0        \n [28] limma_3.56.2              rstudioapi_0.15.0         RSQLite_2.3.5            \n [31] gridGraphics_0.5-1        generics_0.1.3            vroom_1.6.5              \n [34] ica_1.0-3                 spatstat.random_3.2-2     car_3.1-2                \n [37] GO.db_3.17.0              Matrix_1.6-5              ggbeeswarm_0.7.2         \n [40] fansi_1.0.6               abind_1.4-5               lifecycle_1.0.4          \n [43] yaml_2.3.8                carData_3.0-5             qvalue_2.32.0            \n [46] Rtsne_0.17                grid_4.3.0                blob_1.2.4               \n [49] promises_1.2.1            crayon_1.5.2              miniUI_0.1.1.1           \n [52] lattice_0.22-5            beachmat_2.16.0           KEGGREST_1.40.1          \n [55] pillar_1.9.0              knitr_1.45                fgsea_1.26.0             \n [58] future.apply_1.11.1       codetools_0.2-19          fastmatch_1.1-4          \n [61] leiden_0.4.3.1            glue_1.7.0                ggfun_0.1.4              \n [64] downloader_0.4            data.table_1.15.0         treeio_1.24.3            \n [67] vctrs_0.6.5               png_0.1-8                 spam_2.10-0              \n [70] gtable_0.3.4              cachem_1.0.8              xfun_0.42                \n [73] S4Arrays_1.0.6            mime_0.12                 tidygraph_1.3.1          \n [76] survival_3.5-8            ellipsis_0.3.2            fitdistrplus_1.1-11      \n [79] ROCR_1.0-11               nlme_3.1-164              ggtree_3.8.2             \n [82] bit64_4.0.5               RcppAnnoy_0.0.22          rprojroot_2.0.4          \n [85] irlba_2.3.5.1             vipor_0.4.7               KernSmooth_2.23-22       \n [88] colorspace_2.1-0          DBI_1.2.2                 tidyselect_1.2.0         \n [91] bit_4.0.5                 compiler_4.3.0            BiocNeighbors_1.18.0     \n [94] DelayedArray_0.26.7       plotly_4.10.4             shadowtext_0.1.3         \n [97] scales_1.3.0              lmtest_0.9-40             digest_0.6.34            \n[100] goftest_1.2-3             spatstat.utils_3.0-4      rmarkdown_2.25           \n[103] XVector_0.40.0            htmltools_0.5.7           pkgconfig_2.0.3          \n[106] sparseMatrixStats_1.12.2  fastmap_1.1.1             rlang_1.1.3              \n[109] htmlwidgets_1.6.4         shiny_1.8.0               DelayedMatrixStats_1.22.6\n[112] farver_2.1.1              zoo_1.8-12                jsonlite_1.8.8           \n[115] BiocParallel_1.34.2       GOSemSim_2.26.1           BiocSingular_1.16.0      \n[118] RCurl_1.98-1.14           magrittr_2.0.3            ggplotify_0.1.2          \n[121] GenomeInfoDbData_1.2.10   dotCall64_1.1-1           patchwork_1.2.0          \n[124] munsell_0.5.0             Rcpp_1.0.12               ape_5.7-1                \n[127] viridis_0.6.5             reticulate_1.35.0         stringi_1.8.3            \n[130] ggraph_2.1.0              zlibbioc_1.46.0           MASS_7.3-60.0.1          \n[133] plyr_1.8.9                parallel_4.3.0            listenv_0.9.1            \n[136] ggrepel_0.9.5             deldir_2.0-2              graphlayouts_1.1.0       \n[139] Biostrings_2.68.1         splines_4.3.0             tensor_1.5               \n[142] hms_1.1.3                 igraph_2.0.2              spatstat.geom_3.2-8      \n[145] ggsignif_0.6.4            RcppHNSW_0.6.0            ScaledMatrix_1.8.1       \n[148] evaluate_0.23             tzdb_0.4.0                tweenr_2.0.2             \n[151] httpuv_1.6.14             RANN_2.6.1                polyclip_1.10-6          \n[154] future_1.33.1             scattermore_1.2           ggforce_0.4.2            \n[157] rsvd_1.0.5                broom_1.0.5               xtable_1.8-4             \n[160] tidytree_0.4.6            RSpectra_0.16-1           rstatix_0.7.2            \n[163] later_1.3.2               viridisLite_0.4.2         aplot_0.2.2              \n[166] memoise_2.0.1             beeswarm_0.4.0            cluster_2.1.6            \n[169] timechange_0.3.0          globals_0.16.2           \n\ndate()\n\n[1] \"Tue Mar  5 18:23:50 2024\""
  },
  {
    "objectID": "analysis/visFRCMarkerGenes_woCMResting.html",
    "href": "analysis/visFRCMarkerGenes_woCMResting.html",
    "title": "visualize marker genes stromal cells - resting LN only",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visFRCMarkerGenes_woCMResting.html#load-packages",
    "href": "analysis/visFRCMarkerGenes_woCMResting.html#load-packages",
    "title": "visualize marker genes stromal cells - resting LN only",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visFRCMarkerGenes_woCMResting.html#load-seurat-object",
    "href": "analysis/visFRCMarkerGenes_woCMResting.html#load-seurat-object",
    "title": "visualize marker genes stromal cells - resting LN only",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\n## load seurat object from previous analysis\nseurat &lt;- readRDS(file=paste0(basedir,\n                              \"/data/AllPatWithoutCM_LNFSCMerged_seurat.rds\"))\nseurat &lt;- subset(seurat, cond==\"resting\")\n## set col palettes\ncolPal &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(levels(seurat))]\ncolPal &lt;- c(\"#c29f2d\", \"#cb6021\", \"#893149\", \"#524b86\", \"#1f84aa\",\n            \"#d38c6e\",\"#50a565\",\"#242a8b\",\"#297563\",\"#667c63\",\"#c94141\")\nnames(colPal) &lt;- levels(seurat)\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond) &lt;- unique(seurat$cond)\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)"
  },
  {
    "objectID": "analysis/visFRCMarkerGenes_woCMResting.html#visualize-data",
    "href": "analysis/visFRCMarkerGenes_woCMResting.html#visualize-data",
    "title": "visualize marker genes stromal cells - resting LN only",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPal, pt.size=0.5)+\n  theme_void()\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()\n\n\n\n\n\n\ngrp\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/visFRCMarkerGenes_woCMResting.html#vis-selected-stroma-marker",
    "href": "analysis/visFRCMarkerGenes_woCMResting.html#vis-selected-stroma-marker",
    "title": "visualize marker genes stromal cells - resting LN only",
    "section": "vis selected stroma marker",
    "text": "vis selected stroma marker\n\ngenes &lt;- data.frame(gene=rownames(seurat)) %&gt;% \n    mutate(geneID=gsub(\"^.*\\\\.\", \"\", gene)) \n\nselGenesAll &lt;- read_tsv(file = paste0(basedir,\n                                      \"/data/overallStromaMarkerRest.txt\")) %&gt;% \n  left_join(., genes, by = \"geneID\")\nselGenesAll &lt;- selGenesAll %&gt;% filter(!gene == \"ENSG00000232995.RGS5\")\n\nseurat$RNA_snn_res.0.25 &lt;- factor(seurat$RNA_snn_res.0.25,\n                                  levels = c(\"1\", \"8\", \"4\", \"0\", \"2\", \"5\", \"11\",\n                                             \"7\", \"9\", \"3\", \"6\"))\n\nIdents(seurat) &lt;- seurat$RNA_snn_res.0.25\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=T,\n                  cr=F, condCol=F)\n\n\n\n\n\nDotplot\n\nDotPlot(seurat, assay=\"RNA\", features = selGenesAll$gene, scale =T,\n        cluster.idents = T) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=selGenesAll$gene, labels=selGenesAll$geneID) +\n  xlab(\"\") + ylab(\"\")\n\n\n\nDotPlot(seurat, assay=\"RNA\", features = selGenesAll$gene, scale =F,\n        cluster.idents = T) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=selGenesAll$gene, labels=selGenesAll$geneID) +\n  xlab(\"\") + ylab(\"\")\n\n\n\nselGenesAll &lt;- selGenesAll %&gt;% filter(!geneID == \"CCL21\")\n\nDotPlot(seurat, assay=\"RNA\", features = selGenesAll$gene, scale =F,\n        cluster.idents = T) +\n  scale_color_gradientn(colors=colorRampPalette(c(viridis::viridis(12),\"#FDE725FF\"))(50)) +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=selGenesAll$gene, labels=selGenesAll$geneID) +\n  xlab(\"\") + ylab(\"\")"
  },
  {
    "objectID": "analysis/visFRCMarkerGenes_woCMResting.html#session-info",
    "href": "analysis/visFRCMarkerGenes_woCMResting.html#session-info",
    "title": "visualize marker genes stromal cells - resting LN only",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] scater_1.28.0               scuttle_1.10.3              SingleCellExperiment_1.22.0\n [4] SummarizedExperiment_1.30.2 Biobase_2.60.0              GenomicRanges_1.52.1       \n [7] GenomeInfoDb_1.36.4         IRanges_2.36.0              S4Vectors_0.40.1           \n[10] BiocGenerics_0.48.0         MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[13] pheatmap_1.0.12             ggsci_3.0.0                 here_1.0.1                 \n[16] runSeurat3_0.1.0            ggpubr_0.6.0                lubridate_1.9.3            \n[19] forcats_1.0.0               stringr_1.5.1               readr_2.1.5                \n[22] tidyr_1.3.1                 tibble_3.2.1                tidyverse_2.0.0            \n[25] Seurat_5.0.1                SeuratObject_5.0.1          sp_2.1-3                   \n[28] purrr_1.0.2                 cowplot_1.1.3               ggplot2_3.4.4              \n[31] reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             rprojroot_2.0.4          \n [10] vroom_1.6.5               globals_0.16.2            lattice_0.22-5           \n [13] MASS_7.3-60.0.1           backports_1.4.1           magrittr_2.0.3           \n [16] plotly_4.10.4             rmarkdown_2.25            yaml_2.3.8               \n [19] httpuv_1.6.14             sctransform_0.4.1         spam_2.10-0              \n [22] spatstat.sparse_3.0-3     reticulate_1.35.0         pbapply_1.7-2            \n [25] RColorBrewer_1.1-3        abind_1.4-5               zlibbioc_1.46.0          \n [28] Rtsne_0.17                RCurl_1.98-1.14           GenomeInfoDbData_1.2.10  \n [31] ggrepel_0.9.5             irlba_2.3.5.1             listenv_0.9.1            \n [34] spatstat.utils_3.0-4      goftest_1.2-3             RSpectra_0.16-1          \n [37] spatstat.random_3.2-2     fitdistrplus_1.1-11       parallelly_1.37.0        \n [40] DelayedMatrixStats_1.22.6 leiden_0.4.3.1            codetools_0.2-19         \n [43] DelayedArray_0.26.7       tidyselect_1.2.0          farver_2.1.1             \n [46] viridis_0.6.5             ScaledMatrix_1.8.1        spatstat.explore_3.2-6   \n [49] jsonlite_1.8.8            BiocNeighbors_1.18.0      ellipsis_0.3.2           \n [52] progressr_0.14.0          ggridges_0.5.6            survival_3.5-8           \n [55] tools_4.3.0               ica_1.0-3                 Rcpp_1.0.12              \n [58] glue_1.7.0                gridExtra_2.3             xfun_0.42                \n [61] withr_3.0.0               fastmap_1.1.1             fansi_1.0.6              \n [64] rsvd_1.0.5                digest_0.6.34             timechange_0.3.0         \n [67] R6_2.5.1                  mime_0.12                 colorspace_2.1-0         \n [70] scattermore_1.2           tensor_1.5                spatstat.data_3.0-4      \n [73] utf8_1.2.4                generics_0.1.3            data.table_1.15.0        \n [76] httr_1.4.7                htmlwidgets_1.6.4         S4Arrays_1.0.6           \n [79] uwot_0.1.16               pkgconfig_2.0.3           gtable_0.3.4             \n [82] lmtest_0.9-40             XVector_0.40.0            htmltools_0.5.7          \n [85] carData_3.0-5             dotCall64_1.1-1           scales_1.3.0             \n [88] png_0.1-8                 knitr_1.45                rstudioapi_0.15.0        \n [91] tzdb_0.4.0                nlme_3.1-164              zoo_1.8-12               \n [94] KernSmooth_2.23-22        vipor_0.4.7               parallel_4.3.0           \n [97] miniUI_0.1.1.1            pillar_1.9.0              grid_4.3.0               \n[100] vctrs_0.6.5               RANN_2.6.1                promises_1.2.1           \n[103] BiocSingular_1.16.0       car_3.1-2                 beachmat_2.16.0          \n[106] xtable_1.8-4              cluster_2.1.6             beeswarm_0.4.0           \n[109] evaluate_0.23             cli_3.6.2                 compiler_4.3.0           \n[112] rlang_1.1.3               crayon_1.5.2              future.apply_1.11.1      \n[115] ggsignif_0.6.4            labeling_0.4.3            ggbeeswarm_0.7.2         \n[118] plyr_1.8.9                stringi_1.8.3             BiocParallel_1.34.2      \n[121] viridisLite_0.4.2         deldir_2.0-2              munsell_0.5.0            \n[124] lazyeval_0.2.2            spatstat.geom_3.2-8       Matrix_1.6-5             \n[127] RcppHNSW_0.6.0            hms_1.1.3                 patchwork_1.2.0          \n[130] bit64_4.0.5               sparseMatrixStats_1.12.2  future_1.33.1            \n[133] shiny_1.8.0               ROCR_1.0-11               igraph_2.0.2             \n[136] broom_1.0.5               bit_4.0.5                \n\ndate()\n\n[1] \"Tue Mar  5 16:25:29 2024\""
  },
  {
    "objectID": "analysis/visFRCMarkerGenes_woCM.html",
    "href": "analysis/visFRCMarkerGenes_woCM.html",
    "title": "visualize marker genes FRC subsets",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visFRCMarkerGenes_woCM.html#load-packages",
    "href": "analysis/visFRCMarkerGenes_woCM.html#load-packages",
    "title": "visualize marker genes FRC subsets",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visFRCMarkerGenes_woCM.html#load-seurat-object",
    "href": "analysis/visFRCMarkerGenes_woCM.html#load-seurat-object",
    "title": "visualize marker genes FRC subsets",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\nseurat &lt;- readRDS(file= paste0(basedir,\n                               \"/data/AllPatWithoutCM_FRConly_intOrig_seurat.rds\"))\n\nDefaultAssay(object = seurat) &lt;- \"RNA\"\nseurat$intCluster &lt;- seurat$integrated_snn_res.0.25\nIdents(seurat) &lt;- seurat$intCluster\nseurat &lt;- subset(seurat, intCluster==\"8\", invert=T)\n\n## set col palettes\ncolPal &lt;- c(pal_uchicago()(6), \"#6692a3\", \"#3b7f60\")\nnames(colPal) &lt;- c(\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\")\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond) &lt;- unique(seurat$cond)\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)"
  },
  {
    "objectID": "analysis/visFRCMarkerGenes_woCM.html#visualize-data",
    "href": "analysis/visFRCMarkerGenes_woCM.html#visualize-data",
    "title": "visualize marker genes FRC subsets",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPal, pt.size=0.5)+\n  theme_void()\n\n\n\n\n\n\ncluster split by cond\n\nDimPlot(seurat, reduction = \"umap\", cols=colPal, pt.size=0.5,\n        split.by = \"cond\")+\n  theme_void()\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()\n\n\n\n\n\n\ncond\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond, group.by = \"cond\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colCond, group.by = \"cond\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()\n\n\n\n\n\n\ngrp\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/visFRCMarkerGenes_woCM.html#vis-cluster-marker",
    "href": "analysis/visFRCMarkerGenes_woCM.html#vis-cluster-marker",
    "title": "visualize marker genes FRC subsets",
    "section": "vis cluster marker",
    "text": "vis cluster marker\n\nmarker genes\n\nseurat_markers_all &lt;- FindAllMarkers(object = seurat, assay =\"RNA\",\n                                     only.pos = TRUE, min.pct = 0.25,\n                                     logfc.threshold = 0.25,\n                                     test.use = \"wilcox\")\n\n\n\navg heatmap\n\ncluster &lt;- levels(seurat)\nselGenesAll &lt;- seurat_markers_all %&gt;% group_by(cluster) %&gt;% \n  top_n(-20, p_val_adj) %&gt;% \n  top_n(20, avg_log2FC)\nselGenesAll &lt;- selGenesAll %&gt;% mutate(geneIDval=gsub(\"^.*\\\\.\", \"\", gene)) %&gt;% filter(nchar(geneIDval)&gt;1)\n\nIdents(seurat) &lt;- seurat$intCluster\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=FALSE,\n                  cr=T, condCol=F)"
  },
  {
    "objectID": "analysis/visFRCMarkerGenes_woCM.html#write-table",
    "href": "analysis/visFRCMarkerGenes_woCM.html#write-table",
    "title": "visualize marker genes FRC subsets",
    "section": "write table",
    "text": "write table\n\nwrite.table(seurat_markers_all,\n            file=paste0(basedir,\n                        \"/data/AllPatWithoutCM_FRConly_intOrig_markerGenes.txt\"),\n            row.names = FALSE, col.names = TRUE, quote = FALSE, sep = \"\\t\")"
  },
  {
    "objectID": "analysis/visFRCMarkerGenes_woCM.html#vis-selected-stroma-marker",
    "href": "analysis/visFRCMarkerGenes_woCM.html#vis-selected-stroma-marker",
    "title": "visualize marker genes FRC subsets",
    "section": "vis selected stroma marker",
    "text": "vis selected stroma marker\n\nIdents(seurat) &lt;- seurat$intCluster\ncluster &lt;- levels(seurat)\n\ngenes &lt;- data.frame(gene=rownames(seurat)) %&gt;% \n    mutate(geneID=gsub(\"^.*\\\\.\", \"\", gene)) \n\nselGenesAll &lt;- read_tsv(file = paste0(basedir,\n                                      \"/data/overallFRCMarker.txt\")) %&gt;% \n  left_join(., genes, by = \"geneID\") %&gt;% \n  filter(!gene == \"ENSG00000232995.RGS5\")\n\nseurat$intCluster &lt;- factor(seurat$intCluster, levels = c(\"7\", \"2\",\"0\",\"1\",\n                                                          \"5\", \"6\", \"3\", \"4\"))\nIdents(seurat) &lt;- seurat$intCluster\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=F,\n                  cr=F, condCol=F)\n\n\n\n\n\nDotplot\n\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenesAll$gene), scale =T,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenesAll$gene), labels=rev(selGenesAll$geneID)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenesAll$gene), scale =F,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenesAll$gene), labels=rev(selGenesAll$geneID)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\n\n\n\nFeatureplot\n\npList &lt;- sapply(selGenesAll$gene, function(x){\np &lt;- FeaturePlot(seurat, reduction = \"umap\", \n            features = x,\n            cols=c(\"lightgrey\", \"darkred\"),\n            order = F)+\n  theme(legend.position=\"right\")\n  plot(p)\n})"
  },
  {
    "objectID": "analysis/visFRCMarkerGenes_woCM.html#session-info",
    "href": "analysis/visFRCMarkerGenes_woCM.html#session-info",
    "title": "visualize marker genes FRC subsets",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] scater_1.28.0               scuttle_1.10.3              SingleCellExperiment_1.22.0\n [4] SummarizedExperiment_1.30.2 Biobase_2.60.0              GenomicRanges_1.52.1       \n [7] GenomeInfoDb_1.36.4         IRanges_2.36.0              S4Vectors_0.40.1           \n[10] BiocGenerics_0.48.0         MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[13] pheatmap_1.0.12             ggsci_3.0.0                 here_1.0.1                 \n[16] runSeurat3_0.1.0            ggpubr_0.6.0                lubridate_1.9.3            \n[19] forcats_1.0.0               stringr_1.5.1               readr_2.1.5                \n[22] tidyr_1.3.1                 tibble_3.2.1                tidyverse_2.0.0            \n[25] Seurat_5.0.1                SeuratObject_5.0.1          sp_2.1-3                   \n[28] purrr_1.0.2                 cowplot_1.1.3               ggplot2_3.4.4              \n[31] reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             rprojroot_2.0.4          \n [10] vroom_1.6.5               globals_0.16.2            lattice_0.22-5           \n [13] MASS_7.3-60.0.1           backports_1.4.1           magrittr_2.0.3           \n [16] limma_3.56.2              plotly_4.10.4             rmarkdown_2.25           \n [19] yaml_2.3.8                httpuv_1.6.14             sctransform_0.4.1        \n [22] spam_2.10-0               spatstat.sparse_3.0-3     reticulate_1.35.0        \n [25] pbapply_1.7-2             RColorBrewer_1.1-3        abind_1.4-5              \n [28] zlibbioc_1.46.0           Rtsne_0.17                RCurl_1.98-1.14          \n [31] GenomeInfoDbData_1.2.10   ggrepel_0.9.5             irlba_2.3.5.1            \n [34] listenv_0.9.1             spatstat.utils_3.0-4      goftest_1.2-3            \n [37] RSpectra_0.16-1           spatstat.random_3.2-2     fitdistrplus_1.1-11      \n [40] parallelly_1.37.0         DelayedMatrixStats_1.22.6 leiden_0.4.3.1           \n [43] codetools_0.2-19          DelayedArray_0.26.7       tidyselect_1.2.0         \n [46] farver_2.1.1              viridis_0.6.5             ScaledMatrix_1.8.1       \n [49] spatstat.explore_3.2-6    jsonlite_1.8.8            BiocNeighbors_1.18.0     \n [52] ellipsis_0.3.2            progressr_0.14.0          ggridges_0.5.6           \n [55] survival_3.5-8            tools_4.3.0               ica_1.0-3                \n [58] Rcpp_1.0.12               glue_1.7.0                gridExtra_2.3            \n [61] xfun_0.42                 withr_3.0.0               fastmap_1.1.1            \n [64] fansi_1.0.6               rsvd_1.0.5                digest_0.6.34            \n [67] timechange_0.3.0          R6_2.5.1                  mime_0.12                \n [70] colorspace_2.1-0          scattermore_1.2           tensor_1.5               \n [73] spatstat.data_3.0-4       utf8_1.2.4                generics_0.1.3           \n [76] data.table_1.15.0         httr_1.4.7                htmlwidgets_1.6.4        \n [79] S4Arrays_1.0.6            uwot_0.1.16               pkgconfig_2.0.3          \n [82] gtable_0.3.4              lmtest_0.9-40             XVector_0.40.0           \n [85] htmltools_0.5.7           carData_3.0-5             dotCall64_1.1-1          \n [88] scales_1.3.0              png_0.1-8                 knitr_1.45               \n [91] rstudioapi_0.15.0         tzdb_0.4.0                nlme_3.1-164             \n [94] zoo_1.8-12                KernSmooth_2.23-22        vipor_0.4.7              \n [97] parallel_4.3.0            miniUI_0.1.1.1            pillar_1.9.0             \n[100] grid_4.3.0                vctrs_0.6.5               RANN_2.6.1               \n[103] promises_1.2.1            BiocSingular_1.16.0       car_3.1-2                \n[106] beachmat_2.16.0           xtable_1.8-4              cluster_2.1.6            \n[109] beeswarm_0.4.0            evaluate_0.23             cli_3.6.2                \n[112] compiler_4.3.0            rlang_1.1.3               crayon_1.5.2             \n[115] future.apply_1.11.1       ggsignif_0.6.4            labeling_0.4.3           \n[118] ggbeeswarm_0.7.2          plyr_1.8.9                stringi_1.8.3            \n[121] BiocParallel_1.34.2       viridisLite_0.4.2         deldir_2.0-2             \n[124] munsell_0.5.0             lazyeval_0.2.2            spatstat.geom_3.2-8      \n[127] Matrix_1.6-5              RcppHNSW_0.6.0            hms_1.1.3                \n[130] patchwork_1.2.0           bit64_4.0.5               sparseMatrixStats_1.12.2 \n[133] future_1.33.1             shiny_1.8.0               ROCR_1.0-11              \n[136] igraph_2.0.2              broom_1.0.5               bit_4.0.5                \n\ndate()\n\n[1] \"Tue Mar  5 17:42:18 2024\""
  },
  {
    "objectID": "analysis/clusterMarkerFRCrestingLNonly.html",
    "href": "analysis/clusterMarkerFRCrestingLNonly.html",
    "title": "Correlation analysis gene expression FRCs",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n  library(scran)\n  library(corrplot)\n  library(RColorBrewer)\n})"
  },
  {
    "objectID": "analysis/clusterMarkerFRCrestingLNonly.html#load-packages",
    "href": "analysis/clusterMarkerFRCrestingLNonly.html#load-packages",
    "title": "Correlation analysis gene expression FRCs",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n  library(scran)\n  library(corrplot)\n  library(RColorBrewer)\n})"
  },
  {
    "objectID": "analysis/clusterMarkerFRCrestingLNonly.html#load-seurat-object",
    "href": "analysis/clusterMarkerFRCrestingLNonly.html#load-seurat-object",
    "title": "Correlation analysis gene expression FRCs",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\nseurat &lt;- readRDS(file= paste0(basedir,\n                               \"/data/AllPatWithoutCM_FRConly_intOrig_seurat.rds\"))\n\nDefaultAssay(object = seurat) &lt;- \"RNA\"\n\n## set col palettes\ncolPal &lt;- c(pal_uchicago()(6), \"#6692a3\", \"#3b7f60\")\nnames(colPal) &lt;- c(\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\")\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond2 &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond2) &lt;- unique(seurat$cond)\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\n\n## all activated in one grp\nseurat$cond2 &lt;- seurat$cond\nseurat$cond[which(seurat$cond %in% c(\"chronic\", \"acute\"))] &lt;- \"activated\"\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\")\nnames(colCond) &lt;- c(\"resting\", \"activated\")"
  },
  {
    "objectID": "analysis/clusterMarkerFRCrestingLNonly.html#subset-only-resting",
    "href": "analysis/clusterMarkerFRCrestingLNonly.html#subset-only-resting",
    "title": "Correlation analysis gene expression FRCs",
    "section": "subset only resting",
    "text": "subset only resting\n\nseurat &lt;- subset(seurat, cond==\"resting\")"
  },
  {
    "objectID": "analysis/clusterMarkerFRCrestingLNonly.html#visualize-data",
    "href": "analysis/clusterMarkerFRCrestingLNonly.html#visualize-data",
    "title": "Correlation analysis gene expression FRCs",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPal, pt.size=1)+\n  theme_void()\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()\n\n\n\n\n\n\ncond\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond, group.by = \"cond\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colCond, group.by = \"cond\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()\n\n\n\n\n\n\ngrp\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/clusterMarkerFRCrestingLNonly.html#generating-pseudobulks-for-each-cluster-across-hvgs",
    "href": "analysis/clusterMarkerFRCrestingLNonly.html#generating-pseudobulks-for-each-cluster-across-hvgs",
    "title": "Correlation analysis gene expression FRCs",
    "section": "generating pseudobulks for each cluster across hvgs",
    "text": "generating pseudobulks for each cluster across hvgs\n\nIdents(seurat) &lt;- seurat$intCluster\nsce &lt;- as.SingleCellExperiment(seurat)\n#sce.hvg &lt;- modelGeneVar(sce)\n#sce.hvg.var &lt;- getTopHVGs(sce.hvg, n=1000)\nsummed &lt;- aggregateAcrossCells(sce, \n    id=colData(sce)[,c(\"intCluster\")])\n#summed &lt;- summed[sce.hvg.var,]\nhvg.mat &lt;- as.matrix(summed@assays@data$counts)\n\ncor.mat &lt;- cor(hvg.mat)\ncorrplot(cor.mat, type=\"full\", order=\"hclust\",\n         col=colorRampPalette(c(\"#050473\",\"#242389\",\"#39388a\",\"#F7F7F7\", \"#B2182B\"))(50),\n         is.corr = FALSE,\n         method = \"color\")\n\n\n\ncorrplot(cor.mat, type=\"full\", order=\"hclust\",\n         col=colorRampPalette(c(\"#050473\",\"#39388a\",\"#F7F7F7\", \"#B2182B\"))(50),\n         is.corr = FALSE,\n         method = \"color\")\n\n\n\ncorrplot(cor.mat, type=\"full\", order=\"hclust\",\n         col=colorRampPalette(c(\"#39388a\",\"#F7F7F7\", \"#B2182B\"))(50),\n         is.corr = FALSE,\n         method = \"color\")\n\n\n\ncorrplot(cor.mat, type=\"full\", order=\"hclust\",\n         col=colorRampPalette(c(\"#F7F7F7\", \"#ead5d5\", \"#B2182B\"))(50),\n         is.corr = FALSE,\n         method = \"color\")\n\n\n\ncorrplot(cor.mat, type=\"full\", order=\"hclust\",\n         col=colorRampPalette(c(\"#ead5d5\", \"#ead5d5\", \"#B2182B\"))(50),\n         is.corr = FALSE,\n         method = \"color\")\n\n\n\nsce.hvg &lt;- modelGeneVar(sce)\nsce.hvg.var &lt;- getTopHVGs(sce.hvg, n=1000)\nsummed &lt;- aggregateAcrossCells(sce, \n    id=colData(sce)[,c(\"intCluster\")])\nsummed &lt;- summed[sce.hvg.var,]\nhvg.mat &lt;- as.matrix(summed@assays@data$counts)\n\ncor.mat &lt;- cor(hvg.mat)\ncorrplot(cor.mat, type=\"full\", order=\"hclust\",\n         col=colorRampPalette(c(\"#ead5d5\", \"#ead5d5\", \"#B2182B\"))(50),\n         is.corr = FALSE,\n         method = \"color\")"
  },
  {
    "objectID": "analysis/clusterMarkerFRCrestingLNonly.html#session-info",
    "href": "analysis/clusterMarkerFRCrestingLNonly.html#session-info",
    "title": "Correlation analysis gene expression FRCs",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] Matrix_1.6-5                RColorBrewer_1.1-3          corrplot_0.92              \n [4] scran_1.28.2                scater_1.28.0               scuttle_1.10.3             \n [7] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2 Biobase_2.60.0             \n[10] GenomicRanges_1.52.1        GenomeInfoDb_1.36.4         IRanges_2.36.0             \n[13] S4Vectors_0.40.1            BiocGenerics_0.48.0         MatrixGenerics_1.12.3      \n[16] matrixStats_1.2.0           pheatmap_1.0.12             ggsci_3.0.0                \n[19] here_1.0.1                  runSeurat3_0.1.0            ggpubr_0.6.0               \n[22] lubridate_1.9.3             forcats_1.0.0               stringr_1.5.1              \n[25] readr_2.1.5                 tidyr_1.3.1                 tibble_3.2.1               \n[28] tidyverse_2.0.0             Seurat_5.0.1                SeuratObject_5.0.1         \n[31] sp_2.1-3                    purrr_1.0.2                 cowplot_1.1.3              \n[34] ggplot2_3.4.4               reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             edgeR_3.42.4             \n [10] rprojroot_2.0.4           globals_0.16.2            lattice_0.22-5           \n [13] MASS_7.3-60.0.1           backports_1.4.1           magrittr_2.0.3           \n [16] limma_3.56.2              plotly_4.10.4             rmarkdown_2.25           \n [19] yaml_2.3.8                metapod_1.8.0             httpuv_1.6.14            \n [22] sctransform_0.4.1         spam_2.10-0               spatstat.sparse_3.0-3    \n [25] reticulate_1.35.0         pbapply_1.7-2             abind_1.4-5              \n [28] zlibbioc_1.46.0           Rtsne_0.17                RCurl_1.98-1.14          \n [31] GenomeInfoDbData_1.2.10   ggrepel_0.9.5             irlba_2.3.5.1            \n [34] listenv_0.9.1             spatstat.utils_3.0-4      goftest_1.2-3            \n [37] RSpectra_0.16-1           dqrng_0.3.2               spatstat.random_3.2-2    \n [40] fitdistrplus_1.1-11       parallelly_1.37.0         DelayedMatrixStats_1.22.6\n [43] leiden_0.4.3.1            codetools_0.2-19          DelayedArray_0.26.7      \n [46] tidyselect_1.2.0          farver_2.1.1              viridis_0.6.5            \n [49] ScaledMatrix_1.8.1        spatstat.explore_3.2-6    jsonlite_1.8.8           \n [52] BiocNeighbors_1.18.0      ellipsis_0.3.2            progressr_0.14.0         \n [55] ggridges_0.5.6            survival_3.5-8            tools_4.3.0              \n [58] ica_1.0-3                 Rcpp_1.0.12               glue_1.7.0               \n [61] gridExtra_2.3             xfun_0.42                 withr_3.0.0              \n [64] fastmap_1.1.1             bluster_1.10.0            fansi_1.0.6              \n [67] rsvd_1.0.5                digest_0.6.34             timechange_0.3.0         \n [70] R6_2.5.1                  mime_0.12                 colorspace_2.1-0         \n [73] scattermore_1.2           tensor_1.5                spatstat.data_3.0-4      \n [76] utf8_1.2.4                generics_0.1.3            data.table_1.15.0        \n [79] httr_1.4.7                htmlwidgets_1.6.4         S4Arrays_1.0.6           \n [82] uwot_0.1.16               pkgconfig_2.0.3           gtable_0.3.4             \n [85] lmtest_0.9-40             XVector_0.40.0            htmltools_0.5.7          \n [88] carData_3.0-5             dotCall64_1.1-1           scales_1.3.0             \n [91] png_0.1-8                 knitr_1.45                rstudioapi_0.15.0        \n [94] tzdb_0.4.0                nlme_3.1-164              zoo_1.8-12               \n [97] KernSmooth_2.23-22        vipor_0.4.7               parallel_4.3.0           \n[100] miniUI_0.1.1.1            pillar_1.9.0              grid_4.3.0               \n[103] vctrs_0.6.5               RANN_2.6.1                promises_1.2.1           \n[106] BiocSingular_1.16.0       car_3.1-2                 beachmat_2.16.0          \n[109] xtable_1.8-4              cluster_2.1.6             beeswarm_0.4.0           \n[112] evaluate_0.23             locfit_1.5-9.8            cli_3.6.2                \n[115] compiler_4.3.0            rlang_1.1.3               crayon_1.5.2             \n[118] future.apply_1.11.1       ggsignif_0.6.4            labeling_0.4.3           \n[121] ggbeeswarm_0.7.2          plyr_1.8.9                stringi_1.8.3            \n[124] BiocParallel_1.34.2       viridisLite_0.4.2         deldir_2.0-2             \n[127] munsell_0.5.0             lazyeval_0.2.2            spatstat.geom_3.2-8      \n[130] RcppHNSW_0.6.0            hms_1.1.3                 patchwork_1.2.0          \n[133] sparseMatrixStats_1.12.2  future_1.33.1             statmod_1.5.0            \n[136] shiny_1.8.0               ROCR_1.0-11               igraph_2.0.2             \n[139] broom_1.0.5              \n\ndate()\n\n[1] \"Tue Mar  5 18:33:05 2024\""
  },
  {
    "objectID": "analysis/visMarkerGenes_woCMResting.html",
    "href": "analysis/visMarkerGenes_woCMResting.html",
    "title": "visualize marker human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visMarkerGenes_woCMResting.html#load-packages",
    "href": "analysis/visMarkerGenes_woCMResting.html#load-packages",
    "title": "visualize marker human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visMarkerGenes_woCMResting.html#load-seurat-object",
    "href": "analysis/visMarkerGenes_woCMResting.html#load-seurat-object",
    "title": "visualize marker human LN",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\n## load seurat object from previous analysis\nseurat &lt;- readRDS(file=paste0(basedir,\n                              \"/data/AllPatWithoutCM_LNFSCMerged_seurat.rds\"))\nseurat &lt;- subset(seurat, cond==\"resting\")\n## set col palettes\ncolPal &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(levels(seurat))]\ncolPal &lt;- c(\"#c29f2d\", \"#cb6021\", \"#893149\", \"#524b86\", \"#1f84aa\",\n            \"#d38c6e\",\"#50a565\",\"#242a8b\",\"#297563\",\"#667c63\",\"#c94141\")\nnames(colPal) &lt;- levels(seurat)\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond) &lt;- unique(seurat$cond)\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)"
  },
  {
    "objectID": "analysis/visMarkerGenes_woCMResting.html#visualize-data",
    "href": "analysis/visMarkerGenes_woCMResting.html#visualize-data",
    "title": "visualize marker human LN",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPal, pt.size=0.5)+\n  theme_void()\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()\n\n\n\n\n\n\ngrp\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/visMarkerGenes_woCMResting.html#vis-selected-stroma-marker",
    "href": "analysis/visMarkerGenes_woCMResting.html#vis-selected-stroma-marker",
    "title": "visualize marker human LN",
    "section": "vis selected stroma marker",
    "text": "vis selected stroma marker\n\ngenes &lt;- data.frame(gene=rownames(seurat)) %&gt;% \n    mutate(geneID=gsub(\"^.*\\\\.\", \"\", gene)) \n\nselGenesAll &lt;- read_tsv(file = paste0(basedir,\n                                      \"/data/overallStromaMarkerRest.txt\")) %&gt;% \n  left_join(., genes, by = \"geneID\")\nselGenesAll &lt;- selGenesAll %&gt;% filter(!gene == \"ENSG00000232995.RGS5\")\n\nseurat$RNA_snn_res.0.25 &lt;- factor(seurat$RNA_snn_res.0.25,\n                                  levels = c(\"1\", \"8\", \"4\", \"0\", \"2\", \"5\", \"11\",\n                                             \"7\", \"9\", \"3\", \"6\"))\n\nIdents(seurat) &lt;- seurat$RNA_snn_res.0.25\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=T,\n                  cr=F, condCol=F)\n\n\n\n\n\nDotplot\n\nDotPlot(seurat, assay=\"RNA\", features = selGenesAll$gene, scale =T,\n        cluster.idents = T) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=selGenesAll$gene, labels=selGenesAll$geneID) +\n  xlab(\"\") + ylab(\"\")\n\n\n\nDotPlot(seurat, assay=\"RNA\", features = selGenesAll$gene, scale =F,\n        cluster.idents = T) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=selGenesAll$gene, labels=selGenesAll$geneID) +\n  xlab(\"\") + ylab(\"\")\n\n\n\nselGenesAll &lt;- selGenesAll %&gt;% filter(!geneID == \"CCL21\")\n\nDotPlot(seurat, assay=\"RNA\", features = selGenesAll$gene, scale =F,\n        cluster.idents = T) +\n  scale_color_gradientn(colors=colorRampPalette(c(viridis::viridis(12),\"#FDE725FF\"))(50)) +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=selGenesAll$gene, labels=selGenesAll$geneID) +\n  xlab(\"\") + ylab(\"\")"
  },
  {
    "objectID": "analysis/visMarkerGenes_woCMResting.html#session-info",
    "href": "analysis/visMarkerGenes_woCMResting.html#session-info",
    "title": "visualize marker human LN",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] scater_1.28.0               scuttle_1.10.3              SingleCellExperiment_1.22.0\n [4] SummarizedExperiment_1.30.2 Biobase_2.60.0              GenomicRanges_1.52.1       \n [7] GenomeInfoDb_1.36.4         IRanges_2.36.0              S4Vectors_0.40.1           \n[10] BiocGenerics_0.48.0         MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[13] pheatmap_1.0.12             ggsci_3.0.0                 here_1.0.1                 \n[16] runSeurat3_0.1.0            ggpubr_0.6.0                lubridate_1.9.3            \n[19] forcats_1.0.0               stringr_1.5.1               readr_2.1.5                \n[22] tidyr_1.3.1                 tibble_3.2.1                tidyverse_2.0.0            \n[25] Seurat_5.0.1                SeuratObject_5.0.1          sp_2.1-3                   \n[28] purrr_1.0.2                 cowplot_1.1.3               ggplot2_3.4.4              \n[31] reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             rprojroot_2.0.4          \n [10] vroom_1.6.5               globals_0.16.2            lattice_0.22-5           \n [13] MASS_7.3-60.0.1           backports_1.4.1           magrittr_2.0.3           \n [16] plotly_4.10.4             rmarkdown_2.25            yaml_2.3.8               \n [19] httpuv_1.6.14             sctransform_0.4.1         spam_2.10-0              \n [22] spatstat.sparse_3.0-3     reticulate_1.35.0         pbapply_1.7-2            \n [25] RColorBrewer_1.1-3        abind_1.4-5               zlibbioc_1.46.0          \n [28] Rtsne_0.17                RCurl_1.98-1.14           GenomeInfoDbData_1.2.10  \n [31] ggrepel_0.9.5             irlba_2.3.5.1             listenv_0.9.1            \n [34] spatstat.utils_3.0-4      goftest_1.2-3             RSpectra_0.16-1          \n [37] spatstat.random_3.2-2     fitdistrplus_1.1-11       parallelly_1.37.0        \n [40] DelayedMatrixStats_1.22.6 leiden_0.4.3.1            codetools_0.2-19         \n [43] DelayedArray_0.26.7       tidyselect_1.2.0          farver_2.1.1             \n [46] viridis_0.6.5             ScaledMatrix_1.8.1        spatstat.explore_3.2-6   \n [49] jsonlite_1.8.8            BiocNeighbors_1.18.0      ellipsis_0.3.2           \n [52] progressr_0.14.0          ggridges_0.5.6            survival_3.5-8           \n [55] tools_4.3.0               ica_1.0-3                 Rcpp_1.0.12              \n [58] glue_1.7.0                gridExtra_2.3             xfun_0.42                \n [61] withr_3.0.0               fastmap_1.1.1             fansi_1.0.6              \n [64] rsvd_1.0.5                digest_0.6.34             timechange_0.3.0         \n [67] R6_2.5.1                  mime_0.12                 colorspace_2.1-0         \n [70] scattermore_1.2           tensor_1.5                spatstat.data_3.0-4      \n [73] utf8_1.2.4                generics_0.1.3            data.table_1.15.0        \n [76] httr_1.4.7                htmlwidgets_1.6.4         S4Arrays_1.0.6           \n [79] uwot_0.1.16               pkgconfig_2.0.3           gtable_0.3.4             \n [82] lmtest_0.9-40             XVector_0.40.0            htmltools_0.5.7          \n [85] carData_3.0-5             dotCall64_1.1-1           scales_1.3.0             \n [88] png_0.1-8                 knitr_1.45                rstudioapi_0.15.0        \n [91] tzdb_0.4.0                nlme_3.1-164              zoo_1.8-12               \n [94] KernSmooth_2.23-22        vipor_0.4.7               parallel_4.3.0           \n [97] miniUI_0.1.1.1            pillar_1.9.0              grid_4.3.0               \n[100] vctrs_0.6.5               RANN_2.6.1                promises_1.2.1           \n[103] BiocSingular_1.16.0       car_3.1-2                 beachmat_2.16.0          \n[106] xtable_1.8-4              cluster_2.1.6             beeswarm_0.4.0           \n[109] evaluate_0.23             cli_3.6.2                 compiler_4.3.0           \n[112] rlang_1.1.3               crayon_1.5.2              future.apply_1.11.1      \n[115] ggsignif_0.6.4            labeling_0.4.3            ggbeeswarm_0.7.2         \n[118] plyr_1.8.9                stringi_1.8.3             BiocParallel_1.34.2      \n[121] viridisLite_0.4.2         deldir_2.0-2              munsell_0.5.0            \n[124] lazyeval_0.2.2            spatstat.geom_3.2-8       Matrix_1.6-5             \n[127] RcppHNSW_0.6.0            hms_1.1.3                 patchwork_1.2.0          \n[130] bit64_4.0.5               sparseMatrixStats_1.12.2  future_1.33.1            \n[133] shiny_1.8.0               ROCR_1.0-11               igraph_2.0.2             \n[136] broom_1.0.5               bit_4.0.5                \n\ndate()\n\n[1] \"Tue Mar  5 19:21:16 2024\""
  },
  {
    "objectID": "analysis/DEgenesPI16RC.html",
    "href": "analysis/DEgenesPI16RC.html",
    "title": "visualize DE genes Pi16+RC human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n  library(SingleCellExperiment)\n  library(scran)\n  library(clusterProfiler)\n  library(org.Hs.eg.db)\n  library(DOSE)\n  library(enrichplot)\n})"
  },
  {
    "objectID": "analysis/DEgenesPI16RC.html#load-packages",
    "href": "analysis/DEgenesPI16RC.html#load-packages",
    "title": "visualize DE genes Pi16+RC human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n  library(SingleCellExperiment)\n  library(scran)\n  library(clusterProfiler)\n  library(org.Hs.eg.db)\n  library(DOSE)\n  library(enrichplot)\n})"
  },
  {
    "objectID": "analysis/DEgenesPI16RC.html#load-seurat-object",
    "href": "analysis/DEgenesPI16RC.html#load-seurat-object",
    "title": "visualize DE genes Pi16+RC human LN",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\nseurat &lt;- readRDS(file= paste0(basedir,\n                               \"/data/AllPatWithoutCM_FRConly_intOrig_seurat.rds\"))\n\nDefaultAssay(object = seurat) &lt;- \"RNA\"\nseurat$intCluster &lt;- as.character(seurat$integrated_snn_res.0.25)\nIdents(seurat) &lt;- seurat$intCluster\n\n\n## set col palettes\ncolPal &lt;- c(pal_uchicago()(6), \"#6692a3\", \"#3b7f60\")\nnames(colPal) &lt;- c(\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\")\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond) &lt;- unique(seurat$cond)\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\ncolTon &lt;- colCond\n\n## all activated in one grp\nseurat$cond2 &lt;- seurat$cond\nseurat$cond2[which(seurat$cond %in% c(\"chronic\", \"acute\"))] &lt;- \"activated\"\n\ncolCond2 &lt;- c(\"#6692a3\",\"#971c1c\")\nnames(colCond2) &lt;- c(\"resting\", \"activated\")"
  },
  {
    "objectID": "analysis/DEgenesPI16RC.html#visualize-data",
    "href": "analysis/DEgenesPI16RC.html#visualize-data",
    "title": "visualize DE genes Pi16+RC human LN",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond2\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ngrp\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/DEgenesPI16RC.html#cw-de-genes",
    "href": "analysis/DEgenesPI16RC.html#cw-de-genes",
    "title": "visualize DE genes Pi16+RC human LN",
    "section": "cw DE genes",
    "text": "cw DE genes\n\nsce &lt;- as.SingleCellExperiment(seurat)\ncluVec &lt;- unique(sce$integrated_snn_res.0.25)\n\ncwDE &lt;- lapply(cluVec, function(cl){\n  sceSub &lt;- sce[,which(sce$integrated_snn_res.0.25 == cl)]\n  m.out &lt;- scoreMarkers(sceSub, sceSub$cond2)\n  condVec &lt;- unique(names(m.out))\n  outCW &lt;- lapply(condVec, function(co){\n    outSub &lt;- data.frame(m.out@listData[[co]]) %&gt;%\n      rownames_to_column(var = \"gene\") %&gt;%\n      slice_max(., order_by=mean.logFC.cohen, n=100) %&gt;%\n      mutate(condCl=paste0(co, \"_\", cl)) %&gt;% \n      mutate(cluster=cl)\n  })\n  outDat &lt;- do.call(\"rbind\", outCW)\n})\n\ncwDEdat &lt;- do.call(\"rbind\", cwDE)"
  },
  {
    "objectID": "analysis/DEgenesPI16RC.html#vis-top-genes-pi16rc-activated",
    "href": "analysis/DEgenesPI16RC.html#vis-top-genes-pi16rc-activated",
    "title": "visualize DE genes Pi16+RC human LN",
    "section": "vis top genes Pi16+RC activated",
    "text": "vis top genes Pi16+RC activated\n\nDEsel &lt;- cwDEdat %&gt;% filter(condCl == \"activated_5\")\n\n\nviolinplot across patients\n\npatDat &lt;- data.frame(table(seurat$patient, seurat$cond2)) %&gt;% \n  filter(Freq&gt;0) %&gt;% \n  mutate(col=ifelse(Var2==\"activated\",\n                    colCond2[\"activated\"],colCond2[\"resting\"]))\ncolPatCond &lt;- patDat$col\nnames(colPatCond) &lt;- patDat$Var1\nseurat$patient &lt;- factor(seurat$patient, levels = patDat$Var1)\n\npList &lt;- sapply(DEsel$gene[1:20], function(x){\n  p &lt;- VlnPlot(seurat, features = x, pt.size = 0, \n               group.by = \"patient\") +\n    scale_fill_manual(values = colPatCond) +\n    theme(legend.position = \"none\")\n  plot(p)\n})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\navg Heatmap\n\nselGenesAll &lt;- DEsel %&gt;% \n  slice_max(., order_by=mean.logFC.cohen, n=30)\nselGenesAll &lt;- selGenesAll %&gt;% mutate(geneIDval=gsub(\"^.*\\\\.\", \"\", gene)) %&gt;% filter(nchar(geneIDval)&gt;1)\n\nseurat$clust_plus_cond &lt;- paste0(seurat$intCluster, \"_\", seurat$cond2)\nseurat$clust_plus_cond &lt;- as.factor(seurat$clust_plus_cond)\nIdents(seurat) &lt;- seurat$clust_plus_cond\ngapVecCol &lt;- seq(2, length(levels(seurat$clust_plus_cond)), by=2)\n\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=gapVecCol,cc=FALSE,\n                  cr=T, condCol=T, colVecCond = colCond2)\n\n\n\n\n\n\nsc Heatmap\n\nDefaultAssay(object = seurat) &lt;- \"RNA\"\nseurat &lt;- ScaleData(seurat, features = rownames(seurat))\n\ncolPal2 &lt;- rep(colPal, each=2)\nnames(colPal2) &lt;- as.vector(t(outer(names(colPal), names(colCond2), paste,\n                                    sep=\"_\"))) \n\nselFeatures  &lt;- DEsel %&gt;% \n  slice_max(., order_by=mean.logFC.cohen, n=30) %&gt;% \n  mutate(label=gsub(\"^.*\\\\.\", \"\", gene)) %&gt;%\n  filter(nchar(label)&gt;1)\n\nDoHeatmap(seurat, features = selFeatures$gene, group.by = \"clust_plus_cond\", \n          group.colors = colPal2, slot = 'scale.data', label = F,\n          disp.min = -0.5, disp.max = 1.5) +\n  scale_fill_continuous(type = \"viridis\") +\n  scale_y_discrete(breaks=selFeatures$gene, labels=selFeatures$label)"
  },
  {
    "objectID": "analysis/DEgenesPI16RC.html#gsea-top-genes-pi16rc-activated",
    "href": "analysis/DEgenesPI16RC.html#gsea-top-genes-pi16rc-activated",
    "title": "visualize DE genes Pi16+RC human LN",
    "section": "GSEA top genes Pi16+RC activated",
    "text": "GSEA top genes Pi16+RC activated\n\norgMarkerDat &lt;- DEsel %&gt;% mutate(EnsID = gsub(\"\\\\..*$\", \"\", gene))\negoA &lt;- enrichGO(gene         = unique(orgMarkerDat$EnsID),\n                OrgDb         = org.Hs.eg.db,\n                keyType       = 'ENSEMBL',\n                ont           = \"BP\",\n                pAdjustMethod = \"BH\",\n                pvalueCutoff  = 0.05,\n                qvalueCutoff  = 0.05)\negoA &lt;- setReadable(egoA, OrgDb = org.Hs.eg.db)\n \negoADat &lt;- egoA@result\nselGO &lt;- c(\"GO:0030198\", \"GO:0030199\", \"GO:0030510\", \"GO:0048771\",\n           \"GO:0007229\", \"GO:0071559\", \"GO:1901342\", \"GO:0050727\", \"GO:0016055\")\n\nselGO &lt;- c(\"GO:0030198\", \"GO:0030510\", \"GO:0048771\",\n           \"GO:0007229\", \"GO:0071559\", \"GO:1901342\")\n\n\nbarplot sel GO\n\nselGODat &lt;- egoADat %&gt;% filter(ID %in% selGO) %&gt;% mutate(cluster=\"5\")\nselGODat &lt;- selGODat %&gt;% mutate(qscore=-log(p.adjust, base=10)) \np &lt;- ggbarplot(selGODat, x = \"Description\", y = \"qscore\",\n          fill = \"cluster\",               \n          color = \"cluster\",            \n          palette = colPal,            \n          sort.val = \"asc\",           \n          sort.by.groups = TRUE      \n          #x.text.angle = 90           \n          ) + \n  rotate()\np\n\n\n\n\n\n\ncnetplot sel GO\n\negoAsub &lt;- egoA\negoAsub@result &lt;- egoAsub@result[which(egoAsub@result$ID %in% selGO),]\np &lt;- cnetplot(egoAsub, node_label=\"all\", showCategory = length(selGO),\n              color_category=\"#C16622FF\", color_gene=\"#dd9c6c\",\n              shadowtext = \"none\") \np\n\n\n\n\n\n\nheatplot sel GO\n\negoAsub &lt;- egoA\negoAsub@result &lt;- egoAsub@result[which(egoAsub@result$ID %in% selGO),]\nDEsel &lt;- DEsel %&gt;% mutate(EnsID=gsub(\"\\\\..*\", \"\", gene))\nfoldChange &lt;- DEsel$mean.logFC.cohen\nnames(foldChange) &lt;- DEsel$EnsID\np &lt;- heatplot(egoAsub, showCategory = length(selGO), foldChange=foldChange) +\n  scale_fill_gradient(low=\"#f3c2c2\", high=\"#971c1c\")\np\n\n\n\np &lt;- heatplot(egoAsub, showCategory = length(selGO), foldChange=foldChange) +\n  scale_fill_gradient(low=\"#f2c5a4\", high=\"#C16622FF\")\np\n\n\n\n\n\n\navg heatmap with sel genes of sel GO\n\ngenes &lt;- data.frame(gene=rownames(seurat)) %&gt;% \n  mutate(geneID=gsub(\".*\\\\.\", \"\", gene))\nIdents(seurat) &lt;- seurat$clust_plus_cond\ngapVecCol &lt;- seq(2, length(levels(seurat$clust_plus_cond)), by=2)\n\ngeneVec &lt;- data.frame(geneID=unique(p$data$Gene)) %&gt;% \n    left_join(., genes, by=\"geneID\")\n\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = geneVec,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=gapVecCol,cc=FALSE,\n                  cr=T, condCol=T, colVecCond = colCond2)\n\n\n\n\n\n\navg heatmap with genes of each sel GO\n\ngenes &lt;- data.frame(gene=rownames(seurat)) %&gt;% \n  mutate(geneID=gsub(\".*\\\\.\", \"\", gene))\nIdents(seurat) &lt;- seurat$clust_plus_cond\ngapVecCol &lt;- seq(2, length(levels(seurat$clust_plus_cond)), by=2)\n\nlapply(selGO, function(id){\n  geneStr &lt;- egoADat[id,\"geneID\"]\n  geneVec &lt;- data.frame(geneID=unlist(strsplit(geneStr, \"/\"))) %&gt;% \n    left_join(., genes, by=\"geneID\")\n\n  pOut &lt;- avgHeatmap(seurat = seurat, selGenes = geneVec,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=gapVecCol,cc=FALSE,\n                  cr=T, condCol=T, colVecCond = colCond2,\n                  main = egoADat[id,\"Description\"])\n\n})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[[1]]\n\n[[2]]\n\n[[3]]\n\n[[4]]\n\n[[5]]\n\n[[6]]"
  },
  {
    "objectID": "analysis/DEgenesPI16RC.html#vis-top-genes-pi16rc-resting",
    "href": "analysis/DEgenesPI16RC.html#vis-top-genes-pi16rc-resting",
    "title": "visualize DE genes Pi16+RC human LN",
    "section": "vis top genes Pi16+RC resting",
    "text": "vis top genes Pi16+RC resting\n\nDEsel &lt;- cwDEdat %&gt;% filter(condCl == \"resting_5\")\n\n\nviolinplot across patients\n\npatDat &lt;- data.frame(table(seurat$patient, seurat$cond2)) %&gt;% \n  filter(Freq&gt;0) %&gt;% \n  mutate(col=ifelse(Var2==\"activated\",\n                    colCond2[\"activated\"],colCond2[\"resting\"]))\ncolPatCond &lt;- patDat$col\nnames(colPatCond) &lt;- patDat$Var1\nseurat$patient &lt;- factor(seurat$patient, levels = patDat$Var1)\n\npList &lt;- sapply(DEsel$gene[1:20], function(x){\n  p &lt;- VlnPlot(seurat, features = x, pt.size = 0, \n               group.by = \"patient\") +\n    scale_fill_manual(values = colPatCond) +\n    theme(legend.position = \"none\")\n  plot(p)\n})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\navg Heatmap\n\nselGenesAll &lt;- DEsel %&gt;% \n  slice_max(., order_by=mean.logFC.cohen, n=30)\nselGenesAll &lt;- selGenesAll %&gt;% mutate(geneIDval=gsub(\"^.*\\\\.\", \"\", gene)) %&gt;% filter(nchar(geneIDval)&gt;1)\n\nseurat$clust_plus_cond &lt;- paste0(seurat$intCluster, \"_\", seurat$cond2)\nseurat$clust_plus_cond &lt;- as.factor(seurat$clust_plus_cond)\nIdents(seurat) &lt;- seurat$clust_plus_cond\ngapVecCol &lt;- seq(2, length(levels(seurat$clust_plus_cond)), by=2)\n\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=gapVecCol,cc=FALSE,\n                  cr=T, condCol=T, colVecCond = colCond2)\n\n\n\n\n\n\nsc Heatmap\n\nDefaultAssay(object = seurat) &lt;- \"RNA\"\nseurat &lt;- ScaleData(seurat, features = rownames(seurat))\n\ncolPal2 &lt;- rep(colPal, each=2)\nnames(colPal2) &lt;- as.vector(t(outer(names(colPal), names(colCond2), paste,\n                                    sep=\"_\"))) \n\nselFeatures  &lt;- DEsel %&gt;% \n  slice_max(., order_by=mean.logFC.cohen, n=30) %&gt;% \n  mutate(label=gsub(\"^.*\\\\.\", \"\", gene)) %&gt;%\n  filter(nchar(label)&gt;1)\n\nDoHeatmap(seurat, features = selFeatures$gene, group.by = \"clust_plus_cond\", \n          group.colors = colPal2, slot = 'scale.data', label = F,\n          disp.min = -0.5, disp.max = 1.5) +\n  scale_fill_continuous(type = \"viridis\") +\n  scale_y_discrete(breaks=selFeatures$gene, labels=selFeatures$label)"
  },
  {
    "objectID": "analysis/DEgenesPI16RC.html#gsea-top-genes-pi16rc-resting",
    "href": "analysis/DEgenesPI16RC.html#gsea-top-genes-pi16rc-resting",
    "title": "visualize DE genes Pi16+RC human LN",
    "section": "GSEA top genes Pi16+RC resting",
    "text": "GSEA top genes Pi16+RC resting\n\norgMarkerDat &lt;- DEsel %&gt;% mutate(EnsID = gsub(\"\\\\..*$\", \"\", gene))\negoA &lt;- enrichGO(gene         = unique(orgMarkerDat$EnsID),\n                OrgDb         = org.Hs.eg.db,\n                keyType       = 'ENSEMBL',\n                ont           = \"BP\",\n                pAdjustMethod = \"BH\",\n                pvalueCutoff  = 0.05,\n                qvalueCutoff  = 0.05)\negoA &lt;- setReadable(egoA, OrgDb = org.Hs.eg.db)\n \negoADat &lt;- egoA@result\nselGO &lt;- c(\"GO:0048660\", \"GO:0006119\", \"GO:0071774\", \"GO:0046034\",\n           \"GO:0048009\", \"GO:0045333\")\n\n\nbarplot sel GO\n\nselGODat &lt;- egoADat %&gt;% filter(ID %in% selGO) %&gt;% mutate(cluster=\"5\")\nselGODat &lt;- selGODat %&gt;% mutate(qscore=-log(p.adjust, base=10)) \np &lt;- ggbarplot(selGODat, x = \"Description\", y = \"qscore\",\n          fill = \"cluster\",               \n          color = \"cluster\",            \n          palette = \"#6692a3\",            \n          sort.val = \"asc\",           \n          sort.by.groups = TRUE      \n          #x.text.angle = 90           \n          ) + \n  rotate()\np\n\n\n\n\n\n\ncnetplot sel GO\n\negoAsub &lt;- egoA\negoAsub@result &lt;- egoAsub@result[which(egoAsub@result$ID %in% selGO),]\np &lt;- cnetplot(egoAsub, node_label=\"all\", showCategory = length(selGO),\n              color_category=\"#6692a3\", color_gene=\"#a3c5d2\",\n              shadowtext = \"none\") \np\n\n\n\n\n\n\navg heatmap with genes of each sel GO\n\ngenes &lt;- data.frame(gene=rownames(seurat)) %&gt;% \n  mutate(geneID=gsub(\".*\\\\.\", \"\", gene))\nIdents(seurat) &lt;- seurat$clust_plus_cond\ngapVecCol &lt;- seq(2, length(levels(seurat$clust_plus_cond)), by=2)\n\nlapply(selGO, function(id){\n  geneStr &lt;- egoADat[id,\"geneID\"]\n  geneVec &lt;- data.frame(geneID=unlist(strsplit(geneStr, \"/\"))) %&gt;% \n    left_join(., genes, by=\"geneID\")\n  if(length(which(is.na(geneVec$gene))) &gt; 0){\n      geneVec$geneID[which(is.na(geneVec$gene))] &lt;- paste0(\"MT-\",\n                      geneVec$geneID[which(is.na(geneVec$gene))])\n      geneVec &lt;- geneVec %&gt;% dplyr::select(-gene) %&gt;% \n        left_join(., genes, by=\"geneID\") %&gt;% \n        filter(!is.na(gene))\n  }\n\n  pOut &lt;- avgHeatmap(seurat = seurat, selGenes = geneVec,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=gapVecCol,cc=FALSE,\n                  cr=T, condCol=T, colVecCond = colCond2,\n                  main = egoADat[id,\"Description\"])\n\n})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n[[1]]\n\n[[2]]\n\n[[3]]\n\n[[4]]\n\n[[5]]\n\n[[6]]"
  },
  {
    "objectID": "analysis/DEgenesPI16RC.html#session-info",
    "href": "analysis/DEgenesPI16RC.html#session-info",
    "title": "visualize DE genes Pi16+RC human LN",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] Matrix_1.6-5                enrichplot_1.20.3           DOSE_3.26.2                \n [4] org.Hs.eg.db_3.17.0         AnnotationDbi_1.62.2        clusterProfiler_4.8.3      \n [7] scran_1.28.2                scater_1.28.0               scuttle_1.10.3             \n[10] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2 Biobase_2.60.0             \n[13] GenomicRanges_1.52.1        GenomeInfoDb_1.36.4         IRanges_2.36.0             \n[16] S4Vectors_0.40.1            BiocGenerics_0.48.0         MatrixGenerics_1.12.3      \n[19] matrixStats_1.2.0           pheatmap_1.0.12             ggsci_3.0.0                \n[22] here_1.0.1                  runSeurat3_0.1.0            ggpubr_0.6.0               \n[25] lubridate_1.9.3             forcats_1.0.0               stringr_1.5.1              \n[28] readr_2.1.5                 tidyr_1.3.1                 tibble_3.2.1               \n[31] tidyverse_2.0.0             Seurat_5.0.1                SeuratObject_5.0.1         \n[34] sp_2.1-3                    purrr_1.0.2                 ggplot2_3.4.4              \n[37] reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] fs_1.6.3                  spatstat.sparse_3.0-3     bitops_1.0-7             \n  [4] HDO.db_0.99.1             httr_1.4.7                RColorBrewer_1.1-3       \n  [7] tools_4.3.0               sctransform_0.4.1         backports_1.4.1          \n [10] utf8_1.2.4                R6_2.5.1                  lazyeval_0.2.2           \n [13] uwot_0.1.16               withr_3.0.0               gridExtra_2.3            \n [16] progressr_0.14.0          cli_3.6.2                 spatstat.explore_3.2-6   \n [19] fastDummies_1.7.3         scatterpie_0.2.1          labeling_0.4.3           \n [22] spatstat.data_3.0-4       ggridges_0.5.6            pbapply_1.7-2            \n [25] yulab.utils_0.1.4         gson_0.1.0                parallelly_1.37.0        \n [28] limma_3.56.2              rstudioapi_0.15.0         RSQLite_2.3.5            \n [31] gridGraphics_0.5-1        generics_0.1.3            ica_1.0-3                \n [34] spatstat.random_3.2-2     car_3.1-2                 GO.db_3.17.0             \n [37] ggbeeswarm_0.7.2          fansi_1.0.6               abind_1.4-5              \n [40] lifecycle_1.0.4           yaml_2.3.8                edgeR_3.42.4             \n [43] carData_3.0-5             qvalue_2.32.0             Rtsne_0.17               \n [46] grid_4.3.0                blob_1.2.4                promises_1.2.1           \n [49] dqrng_0.3.2               crayon_1.5.2              miniUI_0.1.1.1           \n [52] lattice_0.22-5            beachmat_2.16.0           cowplot_1.1.3            \n [55] KEGGREST_1.40.1           pillar_1.9.0              knitr_1.45               \n [58] metapod_1.8.0             fgsea_1.26.0              future.apply_1.11.1      \n [61] codetools_0.2-19          fastmatch_1.1-4           leiden_0.4.3.1           \n [64] glue_1.7.0                ggfun_0.1.4               downloader_0.4           \n [67] data.table_1.15.0         treeio_1.24.3             vctrs_0.6.5              \n [70] png_0.1-8                 spam_2.10-0               gtable_0.3.4             \n [73] cachem_1.0.8              xfun_0.42                 S4Arrays_1.0.6           \n [76] mime_0.12                 tidygraph_1.3.1           survival_3.5-8           \n [79] statmod_1.5.0             bluster_1.10.0            ellipsis_0.3.2           \n [82] fitdistrplus_1.1-11       ROCR_1.0-11               nlme_3.1-164             \n [85] ggtree_3.8.2              bit64_4.0.5               RcppAnnoy_0.0.22         \n [88] rprojroot_2.0.4           irlba_2.3.5.1             vipor_0.4.7              \n [91] KernSmooth_2.23-22        colorspace_2.1-0          DBI_1.2.2                \n [94] ggrastr_1.0.2             tidyselect_1.2.0          bit_4.0.5                \n [97] compiler_4.3.0            BiocNeighbors_1.18.0      DelayedArray_0.26.7      \n[100] plotly_4.10.4             shadowtext_0.1.3          scales_1.3.0             \n[103] lmtest_0.9-40             digest_0.6.34             goftest_1.2-3            \n[106] spatstat.utils_3.0-4      rmarkdown_2.25            XVector_0.40.0           \n[109] htmltools_0.5.7           pkgconfig_2.0.3           sparseMatrixStats_1.12.2 \n[112] fastmap_1.1.1             rlang_1.1.3               htmlwidgets_1.6.4        \n[115] shiny_1.8.0               DelayedMatrixStats_1.22.6 farver_2.1.1             \n[118] zoo_1.8-12                jsonlite_1.8.8            BiocParallel_1.34.2      \n[121] GOSemSim_2.26.1           BiocSingular_1.16.0       RCurl_1.98-1.14          \n[124] magrittr_2.0.3            ggplotify_0.1.2           GenomeInfoDbData_1.2.10  \n[127] dotCall64_1.1-1           patchwork_1.2.0           munsell_0.5.0            \n[130] Rcpp_1.0.12               ape_5.7-1                 viridis_0.6.5            \n[133] reticulate_1.35.0         stringi_1.8.3             ggraph_2.1.0             \n[136] zlibbioc_1.46.0           MASS_7.3-60.0.1           plyr_1.8.9               \n[139] parallel_4.3.0            listenv_0.9.1             ggrepel_0.9.5            \n[142] deldir_2.0-2              graphlayouts_1.1.0        Biostrings_2.68.1        \n[145] splines_4.3.0             tensor_1.5                hms_1.1.3                \n[148] locfit_1.5-9.8            igraph_2.0.2              spatstat.geom_3.2-8      \n[151] ggsignif_0.6.4            RcppHNSW_0.6.0            ScaledMatrix_1.8.1       \n[154] evaluate_0.23             tweenr_2.0.2              tzdb_0.4.0               \n[157] httpuv_1.6.14             RANN_2.6.1                polyclip_1.10-6          \n[160] future_1.33.1             scattermore_1.2           ggforce_0.4.2            \n[163] rsvd_1.0.5                broom_1.0.5               xtable_1.8-4             \n[166] tidytree_0.4.6            RSpectra_0.16-1           rstatix_0.7.2            \n[169] later_1.3.2               viridisLite_0.4.2         aplot_0.2.2              \n[172] memoise_2.0.1             beeswarm_0.4.0            cluster_2.1.6            \n[175] timechange_0.3.0          globals_0.16.2           \n\ndate()\n\n[1] \"Tue Mar  5 20:00:38 2024\""
  },
  {
    "objectID": "analysis/mergeImmCells.html",
    "href": "analysis/mergeImmCells.html",
    "title": "Merge human LN imm cells",
    "section": "",
    "text": "suppressPackageStartupMessages({\n  library(tidyverse)\n  library(Seurat)\n  library(magrittr)\n  library(dplyr)\n  library(purrr)\n  library(ggplot2)\n  library(here)\n  library(runSeurat3)\n  library(ggsci)\n})"
  },
  {
    "objectID": "analysis/mergeImmCells.html#load-packages",
    "href": "analysis/mergeImmCells.html#load-packages",
    "title": "Merge human LN imm cells",
    "section": "",
    "text": "suppressPackageStartupMessages({\n  library(tidyverse)\n  library(Seurat)\n  library(magrittr)\n  library(dplyr)\n  library(purrr)\n  library(ggplot2)\n  library(here)\n  library(runSeurat3)\n  library(ggsci)\n})"
  },
  {
    "objectID": "analysis/mergeImmCells.html#set-dir",
    "href": "analysis/mergeImmCells.html#set-dir",
    "title": "Merge human LN imm cells",
    "section": "set dir",
    "text": "set dir\n\nbasedir &lt;- here()\nmetaDat &lt;- read_tsv(paste0(basedir, \"/data/metadataImm.txt\"), col_names = T)"
  },
  {
    "objectID": "analysis/mergeImmCells.html#load-and-assign-samples",
    "href": "analysis/mergeImmCells.html#load-and-assign-samples",
    "title": "Merge human LN imm cells",
    "section": "load and assign samples",
    "text": "load and assign samples\n\nassignSamples &lt;- function(smpNam, basedirSmp, smpPat, smpGrp, smpOri,\n                          smpSort){\n  smpNamFull &lt;- list.files(path = paste0(basedirSmp, \"/data/immune/\"),\n                 pattern = paste0(smpNam, \".*_seurat.rds\"))\n  seuratSmp &lt;- readRDS(paste0(basedirSmp, \"/data/immune/\", smpNamFull))\n  seuratSmp$patient &lt;- smpPat\n  seuratSmp$cond &lt;- smpGrp\n  seuratSmp$origin &lt;- smpOri\n  seuratSmp$sort &lt;- smpSort\n  return(seuratSmp)\n}\n\n\n####################################################################\n\nfor(i in 1:length(metaDat$dataset)){\n  seuratX &lt;- assignSamples(smpNam = metaDat$dataset[i],\n                           basedirSmp = basedir,\n                           smpPat =  metaDat$patient[i],\n                           smpGrp = metaDat$cond[i],\n                           smpOri = metaDat$origin[i],\n                           smpSort = metaDat$sort[i])\n  if(exists(\"seurat\")){\n    seurat &lt;- merge(x = seurat, y = seuratX, project = \"LymphNode_IMM\")\n  }else{\n    seurat &lt;- seuratX\n  }\n}\n\nremove(seuratX)"
  },
  {
    "objectID": "analysis/mergeImmCells.html#filter-cells",
    "href": "analysis/mergeImmCells.html#filter-cells",
    "title": "Merge human LN imm cells",
    "section": "filter cells",
    "text": "filter cells\n\ndim(seurat)\n\n[1]  36180 170115\n\nseurat$cond2 &lt;- seurat$cond\nseurat$cond2[which(seurat$cond %in% c(\"chronic\", \"acute\"))] &lt;- \"activated\"\n\n## reprocess\nres &lt;- c(0.8,0.6,0.4,0.25)\n\nseurat &lt;- NormalizeData(object = seurat)\nseurat &lt;- FindVariableFeatures(object = seurat)\nseurat &lt;- ScaleData(object = seurat, verbose = FALSE)\nseurat &lt;- RunPCA(object = seurat, npcs = 30, verbose = FALSE)\nseurat &lt;- RunTSNE(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- RunUMAP(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- FindNeighbors(object = seurat, reduction = \"pca\", \n                        dims = 1:20)\nfor (i in 1:length(res)) {\n    seurat &lt;- FindClusters(object = seurat, resolution = res[i], \n                           random.seed = 1234)\n    }\n\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 170115\nNumber of edges: 4993624\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9138\nNumber of communities: 33\nElapsed time: 65 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 170115\nNumber of edges: 4993624\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9228\nNumber of communities: 31\nElapsed time: 64 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 170115\nNumber of edges: 4993624\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9348\nNumber of communities: 26\nElapsed time: 65 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 170115\nNumber of edges: 4993624\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9481\nNumber of communities: 14\nElapsed time: 69 seconds\n\n## remove cluster with high expression of COL1A1, PDPN, LTF, KRTs, PROX1, ..\n## PECAM1 + no PTPRC (stromal cells)\n\nseurat &lt;- subset(seurat, RNA_snn_res.0.25 %in% c(\"10\", \"11\"), invert = T)\n\ndim(seurat)\n\n[1]  36180 168298\n\n## reprocess\nres &lt;- c(0.8,0.6,0.4,0.25)\n\nseurat &lt;- NormalizeData(object = seurat)\nseurat &lt;- FindVariableFeatures(object = seurat)\nseurat &lt;- ScaleData(object = seurat, verbose = FALSE)\nseurat &lt;- RunPCA(object = seurat, npcs = 30, verbose = FALSE)\nseurat &lt;- RunTSNE(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- RunUMAP(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- FindNeighbors(object = seurat, reduction = \"pca\", \n                        dims = 1:20)\nfor (i in 1:length(res)) {\n    seurat &lt;- FindClusters(object = seurat, resolution = res[i], \n                           random.seed = 1234)\n    }\n\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 168298\nNumber of edges: 4986183\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9163\nNumber of communities: 32\nElapsed time: 67 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 168298\nNumber of edges: 4986183\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9252\nNumber of communities: 31\nElapsed time: 73 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 168298\nNumber of edges: 4986183\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9362\nNumber of communities: 24\nElapsed time: 68 seconds\nModularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck\n\nNumber of nodes: 168298\nNumber of edges: 4986183\n\nRunning Louvain algorithm...\nMaximum modularity in 10 random starts: 0.9495\nNumber of communities: 18\nElapsed time: 65 seconds"
  },
  {
    "objectID": "analysis/mergeImmCells.html#visualize-data",
    "href": "analysis/mergeImmCells.html#visualize-data",
    "title": "Merge human LN imm cells",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\ncolPal &lt;- c(pal_nejm()(8),pal_futurama()(12))[1:length(levels(seurat))]\nnames(colPal) &lt;- levels(seurat)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\ncolPat &lt;- c(pal_jco()(10),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncondition\n\ncolCond &lt;- pal_igv()(length(unique(seurat$cond)))\nnames(colCond) &lt;- unique(seurat$cond)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond, group.by = \"cond\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\ncolOrig &lt;- pal_aaas()(length(unique(seurat$origin)))\nnames(colCond) &lt;- unique(seurat$cond)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOrig, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/mergeImmCells.html#save-seurat-object",
    "href": "analysis/mergeImmCells.html#save-seurat-object",
    "title": "Merge human LN imm cells",
    "section": "save seurat object",
    "text": "save seurat object\n\nsaveRDS(seurat, file=paste0(basedir,\n                            \"/data/AllPatWithoutCM_IMMMerged_seurat.rds\"))"
  },
  {
    "objectID": "analysis/mergeImmCells.html#session-info",
    "href": "analysis/mergeImmCells.html#session-info",
    "title": "Merge human LN imm cells",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] ggsci_3.0.0        runSeurat3_0.1.0   here_1.0.1         magrittr_2.0.3     Seurat_5.0.1      \n [6] SeuratObject_5.0.1 sp_2.1-3           lubridate_1.9.3    forcats_1.0.0      stringr_1.5.1     \n[11] dplyr_1.1.4        purrr_1.0.2        readr_2.1.5        tidyr_1.3.1        tibble_3.2.1      \n[16] ggplot2_3.4.4      tidyverse_2.0.0   \n\nloaded via a namespace (and not attached):\n  [1] RColorBrewer_1.1-3          rstudioapi_0.15.0           jsonlite_1.8.8             \n  [4] spatstat.utils_3.0-4        farver_2.1.1                rmarkdown_2.25             \n  [7] zlibbioc_1.46.0             vctrs_0.6.5                 ROCR_1.0-11                \n [10] spatstat.explore_3.2-6      RCurl_1.98-1.14             S4Arrays_1.0.6             \n [13] htmltools_0.5.7             sctransform_0.4.1           parallelly_1.37.0          \n [16] KernSmooth_2.23-22          htmlwidgets_1.6.4           ica_1.0-3                  \n [19] plyr_1.8.9                  plotly_4.10.4               zoo_1.8-12                 \n [22] igraph_2.0.2                mime_0.12                   lifecycle_1.0.4            \n [25] pkgconfig_2.0.3             Matrix_1.6-5                R6_2.5.1                   \n [28] fastmap_1.1.1               GenomeInfoDbData_1.2.10     MatrixGenerics_1.12.3      \n [31] fitdistrplus_1.1-11         future_1.33.1               shiny_1.8.0                \n [34] digest_0.6.34               colorspace_2.1-0            S4Vectors_0.40.1           \n [37] patchwork_1.2.0             rprojroot_2.0.4             tensor_1.5                 \n [40] RSpectra_0.16-1             irlba_2.3.5.1               GenomicRanges_1.52.1       \n [43] labeling_0.4.3              progressr_0.14.0            fansi_1.0.6                \n [46] spatstat.sparse_3.0-3       timechange_0.3.0            httr_1.4.7                 \n [49] polyclip_1.10-6             abind_1.4-5                 compiler_4.3.0             \n [52] bit64_4.0.5                 withr_3.0.0                 fastDummies_1.7.3          \n [55] MASS_7.3-60.0.1             DelayedArray_0.26.7         tools_4.3.0                \n [58] lmtest_0.9-40               httpuv_1.6.14               future.apply_1.11.1        \n [61] goftest_1.2-3               glue_1.7.0                  nlme_3.1-164               \n [64] promises_1.2.1              grid_4.3.0                  Rtsne_0.17                 \n [67] cluster_2.1.6               reshape2_1.4.4              generics_0.1.3             \n [70] gtable_0.3.4                spatstat.data_3.0-4         tzdb_0.4.0                 \n [73] data.table_1.15.0           hms_1.1.3                   XVector_0.40.0             \n [76] utf8_1.2.4                  BiocGenerics_0.48.0         spatstat.geom_3.2-8        \n [79] RcppAnnoy_0.0.22            ggrepel_0.9.5               RANN_2.6.1                 \n [82] pillar_1.9.0                vroom_1.6.5                 spam_2.10-0                \n [85] RcppHNSW_0.6.0              later_1.3.2                 splines_4.3.0              \n [88] lattice_0.22-5              bit_4.0.5                   survival_3.5-8             \n [91] deldir_2.0-2                tidyselect_1.2.0            SingleCellExperiment_1.22.0\n [94] miniUI_0.1.1.1              pbapply_1.7-2               knitr_1.45                 \n [97] gridExtra_2.3               IRanges_2.36.0              SummarizedExperiment_1.30.2\n[100] scattermore_1.2             stats4_4.3.0                xfun_0.42                  \n[103] Biobase_2.60.0              matrixStats_1.2.0           pheatmap_1.0.12            \n[106] stringi_1.8.3               lazyeval_0.2.2              yaml_2.3.8                 \n[109] evaluate_0.23               codetools_0.2-19            cli_3.6.2                  \n[112] uwot_0.1.16                 xtable_1.8-4                reticulate_1.35.0          \n[115] munsell_0.5.0               GenomeInfoDb_1.36.4         Rcpp_1.0.12                \n[118] globals_0.16.2              spatstat.random_3.2-2       png_0.1-8                  \n[121] parallel_4.3.0              ellipsis_0.3.2              dotCall64_1.1-1            \n[124] bitops_1.0-7                listenv_0.9.1               viridisLite_0.4.2          \n[127] scales_1.3.0                ggridges_0.5.6              crayon_1.5.2               \n[130] leiden_0.4.3.1              rlang_1.1.3                 cowplot_1.1.3              \n\ndate()\n\n[1] \"Tue Mar  5 21:29:25 2024\""
  },
  {
    "objectID": "analysis/integrateIMMcells_acrossPat.html",
    "href": "analysis/integrateIMMcells_acrossPat.html",
    "title": "Integrate human LN immune cells",
    "section": "",
    "text": "suppressPackageStartupMessages({\n  library(tidyverse)\n  library(Seurat)\n  library(magrittr)\n  library(dplyr)\n  library(purrr)\n  library(ggplot2)\n  library(here)\n  library(runSeurat3)\n  library(ggsci)\n})"
  },
  {
    "objectID": "analysis/integrateIMMcells_acrossPat.html#load-packages",
    "href": "analysis/integrateIMMcells_acrossPat.html#load-packages",
    "title": "Integrate human LN immune cells",
    "section": "",
    "text": "suppressPackageStartupMessages({\n  library(tidyverse)\n  library(Seurat)\n  library(magrittr)\n  library(dplyr)\n  library(purrr)\n  library(ggplot2)\n  library(here)\n  library(runSeurat3)\n  library(ggsci)\n})"
  },
  {
    "objectID": "analysis/integrateIMMcells_acrossPat.html#set-dir",
    "href": "analysis/integrateIMMcells_acrossPat.html#set-dir",
    "title": "Integrate human LN immune cells",
    "section": "set dir",
    "text": "set dir\n\nbasedir &lt;- here()\nseurat &lt;- readRDS(file=paste0(basedir,\n                            \"/data/AllPatWithoutCM_IMMMerged_seurat.rds\"))"
  },
  {
    "objectID": "analysis/integrateIMMcells_acrossPat.html#visualize-data",
    "href": "analysis/integrateIMMcells_acrossPat.html#visualize-data",
    "title": "Integrate human LN immune cells",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\ncolPal &lt;- c(pal_nejm()(8),pal_futurama()(12))[1:length(levels(seurat))]\nnames(colPal) &lt;- levels(seurat)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal, raster = F)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\ncolPat &lt;- c(pal_jco()(10),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        raster = F)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncondition\n\ncolCond &lt;- pal_igv()(length(unique(seurat$cond)))\nnames(colCond) &lt;- unique(seurat$cond)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond, group.by = \"cond\", raster = F)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\ncolOrig &lt;- pal_aaas()(length(unique(seurat$origin)))\nnames(colCond) &lt;- unique(seurat$cond)\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOrig, group.by = \"origin\", raster = F)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/integrateIMMcells_acrossPat.html#integrate-across-patient",
    "href": "analysis/integrateIMMcells_acrossPat.html#integrate-across-patient",
    "title": "Integrate human LN immune cells",
    "section": "integrate across patient",
    "text": "integrate across patient\n\nIdents(seurat) &lt;- seurat$patient\n\nseurat.list &lt;- SplitObject(object = seurat, split.by = \"patient\")\nfor (i in 1:length(x = seurat.list)) {\n    seurat.list[[i]] &lt;- NormalizeData(object = seurat.list[[i]],\n                                      verbose = FALSE)\n    seurat.list[[i]] &lt;- FindVariableFeatures(object = seurat.list[[i]], \n        selection.method = \"vst\", nfeatures = 2000, verbose = FALSE)\n}\n\nseurat.anchors &lt;- FindIntegrationAnchors(object.list = seurat.list, dims = 1:15)\nseurat.int &lt;- IntegrateData(anchorset = seurat.anchors, dims = 1:15)\nDefaultAssay(object = seurat.int) &lt;- \"integrated\"\n\n# rerun seurat\nseurat.int &lt;- ScaleData(object = seurat.int, verbose = FALSE,\n                        features = rownames(seurat.int))\nseurat.int &lt;- RunPCA(object = seurat.int, npcs = 20, verbose = FALSE)\nseurat.int &lt;- RunTSNE(object = seurat.int, reduction = \"pca\", dims = 1:20)\nseurat.int &lt;- RunUMAP(object = seurat.int, reduction = \"pca\", dims = 1:20)\n\nseurat.int &lt;- FindNeighbors(object = seurat.int, reduction = \"pca\", dims = 1:20)\nres &lt;- c(0.6,0.8,0.4,0.25)\nfor(i in 1:length(res)){\n  seurat.int &lt;- FindClusters(object = seurat.int, resolution = res[i],\n                             random.seed = 1234)\n}\n\nDefaultAssay(object = seurat.int) &lt;- \"RNA\"\nseurat.int$intCluster &lt;- seurat.int$integrated_snn_res.0.25\nIdents(seurat.int) &lt;- seurat.int$intCluster"
  },
  {
    "objectID": "analysis/integrateIMMcells_acrossPat.html#visualize-int-data",
    "href": "analysis/integrateIMMcells_acrossPat.html#visualize-int-data",
    "title": "Integrate human LN immune cells",
    "section": "visualize int data",
    "text": "visualize int data\n\nclustering\n\nseurat.int &lt;- readRDS(file=paste0(basedir,\n                            \"/data/AllPatWithoutCM_IMMMerged_integrated_seurat.rds\"))\n\nIdents(seurat.int) &lt;- seurat.int$intCluster\ncolPal &lt;- c(pal_nejm()(8),pal_futurama()(12))[1:length(levels(seurat.int))]\nnames(colPal) &lt;- levels(seurat.int)\n\n## visualize input data\nDimPlot(seurat.int, reduction = \"umap\", cols=colPal, raster = F)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\ncolPat &lt;- c(pal_jco()(10),\n            pal_futurama()(12))[1:length(unique(seurat.int$patient))]\nnames(colPat) &lt;- unique(seurat.int$patient)\n\n## visualize input data\nDimPlot(seurat.int, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        raster = F)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond\n\ncolTon &lt;- pal_igv()(length(unique(seurat.int$cond)))\nnames(colTon) &lt;- unique(seurat.int$cond)\n\n## visualize input data\nDimPlot(seurat.int, reduction = \"umap\", cols=colTon, group.by = \"cond\", \n        raster = F)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/integrateIMMcells_acrossPat.html#save-seurat-object",
    "href": "analysis/integrateIMMcells_acrossPat.html#save-seurat-object",
    "title": "Integrate human LN immune cells",
    "section": "save seurat object",
    "text": "save seurat object\n\nsaveRDS(seurat.int, file=paste0(basedir,\n                            \"/data/AllPatWithoutCM_IMMMerged_integrated_seurat.rds\"))"
  },
  {
    "objectID": "analysis/integrateIMMcells_acrossPat.html#session-info",
    "href": "analysis/integrateIMMcells_acrossPat.html#session-info",
    "title": "Integrate human LN immune cells",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] ggsci_3.0.0        runSeurat3_0.1.0   here_1.0.1         magrittr_2.0.3     Seurat_5.0.1      \n [6] SeuratObject_5.0.1 sp_2.1-3           lubridate_1.9.3    forcats_1.0.0      stringr_1.5.1     \n[11] dplyr_1.1.4        purrr_1.0.2        readr_2.1.5        tidyr_1.3.1        tibble_3.2.1      \n[16] ggplot2_3.4.4      tidyverse_2.0.0   \n\nloaded via a namespace (and not attached):\n  [1] RColorBrewer_1.1-3          rstudioapi_0.15.0           jsonlite_1.8.8             \n  [4] spatstat.utils_3.0-4        farver_2.1.1                rmarkdown_2.25             \n  [7] zlibbioc_1.46.0             vctrs_0.6.5                 ROCR_1.0-11                \n [10] spatstat.explore_3.2-6      RCurl_1.98-1.14             S4Arrays_1.0.6             \n [13] htmltools_0.5.7             sctransform_0.4.1           parallelly_1.37.0          \n [16] KernSmooth_2.23-22          htmlwidgets_1.6.4           ica_1.0-3                  \n [19] plyr_1.8.9                  plotly_4.10.4               zoo_1.8-12                 \n [22] igraph_2.0.2                mime_0.12                   lifecycle_1.0.4            \n [25] pkgconfig_2.0.3             Matrix_1.6-5                R6_2.5.1                   \n [28] fastmap_1.1.1               GenomeInfoDbData_1.2.10     MatrixGenerics_1.12.3      \n [31] fitdistrplus_1.1-11         future_1.33.1               shiny_1.8.0                \n [34] digest_0.6.34               colorspace_2.1-0            S4Vectors_0.40.1           \n [37] patchwork_1.2.0             rprojroot_2.0.4             tensor_1.5                 \n [40] RSpectra_0.16-1             irlba_2.3.5.1               GenomicRanges_1.52.1       \n [43] labeling_0.4.3              progressr_0.14.0            fansi_1.0.6                \n [46] spatstat.sparse_3.0-3       timechange_0.3.0            httr_1.4.7                 \n [49] polyclip_1.10-6             abind_1.4-5                 compiler_4.3.0             \n [52] withr_3.0.0                 fastDummies_1.7.3           MASS_7.3-60.0.1            \n [55] DelayedArray_0.26.7         tools_4.3.0                 lmtest_0.9-40              \n [58] httpuv_1.6.14               future.apply_1.11.1         goftest_1.2-3              \n [61] glue_1.7.0                  nlme_3.1-164                promises_1.2.1             \n [64] grid_4.3.0                  Rtsne_0.17                  cluster_2.1.6              \n [67] reshape2_1.4.4              generics_0.1.3              gtable_0.3.4               \n [70] spatstat.data_3.0-4         tzdb_0.4.0                  data.table_1.15.0          \n [73] hms_1.1.3                   XVector_0.40.0              utf8_1.2.4                 \n [76] BiocGenerics_0.48.0         spatstat.geom_3.2-8         RcppAnnoy_0.0.22           \n [79] ggrepel_0.9.5               RANN_2.6.1                  pillar_1.9.0               \n [82] spam_2.10-0                 RcppHNSW_0.6.0              later_1.3.2                \n [85] splines_4.3.0               lattice_0.22-5              survival_3.5-8             \n [88] deldir_2.0-2                tidyselect_1.2.0            SingleCellExperiment_1.22.0\n [91] miniUI_0.1.1.1              pbapply_1.7-2               knitr_1.45                 \n [94] gridExtra_2.3               IRanges_2.36.0              SummarizedExperiment_1.30.2\n [97] scattermore_1.2             stats4_4.3.0                xfun_0.42                  \n[100] Biobase_2.60.0              matrixStats_1.2.0           pheatmap_1.0.12            \n[103] stringi_1.8.3               lazyeval_0.2.2              yaml_2.3.8                 \n[106] evaluate_0.23               codetools_0.2-19            cli_3.6.2                  \n[109] uwot_0.1.16                 xtable_1.8-4                reticulate_1.35.0          \n[112] munsell_0.5.0               GenomeInfoDb_1.36.4         Rcpp_1.0.12                \n[115] globals_0.16.2              spatstat.random_3.2-2       png_0.1-8                  \n[118] parallel_4.3.0              ellipsis_0.3.2              dotCall64_1.1-1            \n[121] bitops_1.0-7                listenv_0.9.1               viridisLite_0.4.2          \n[124] scales_1.3.0                ggridges_0.5.6              crayon_1.5.2               \n[127] leiden_0.4.3.1              rlang_1.1.3                 cowplot_1.1.3              \n\ndate()\n\n[1] \"Tue Mar  5 22:17:10 2024\""
  },
  {
    "objectID": "analysis/characterizeImmCellsIntegrated.html",
    "href": "analysis/characterizeImmCellsIntegrated.html",
    "title": "characterize immune cells human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/characterizeImmCellsIntegrated.html#load-packages",
    "href": "analysis/characterizeImmCellsIntegrated.html#load-packages",
    "title": "characterize immune cells human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/characterizeImmCellsIntegrated.html#load-seurat-object",
    "href": "analysis/characterizeImmCellsIntegrated.html#load-seurat-object",
    "title": "characterize immune cells human LN",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\nseurat &lt;- readRDS(file=paste0(basedir,\n                      \"/data/AllPatWithoutCM_IMMMerged_integrated_seurat.rds\"))\nseurat$intCluster &lt;- seurat$integrated_snn_res.0.4\nIdents(seurat) &lt;- seurat$intCluster\n## set col palettes\ncolPal &lt;- colPal &lt;- c(pal_flatui()(10), pal_frontiers()(8),\n                      pal_nejm()(8))[1:length(unique(seurat$intCluster))]\nnames(colPal) &lt;- unique(seurat$intCluster)\n\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond) &lt;- unique(seurat$cond)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\ncolCond2 &lt;- c(\"#6692a3\",\"#971c1c\")\nnames(colCond2) &lt;- c(\"resting\", \"activated\")"
  },
  {
    "objectID": "analysis/characterizeImmCellsIntegrated.html#visualize-data",
    "href": "analysis/characterizeImmCellsIntegrated.html#visualize-data",
    "title": "characterize immune cells human LN",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal, raster = F)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPal, pt.size=0.5, raster = F)+\n  theme_void()\n\n\n\n\n\n\ncluster split by cond\n\nDimPlot(seurat, reduction = \"umap\", cols=colPal, pt.size=0.5,\n        split.by = \"cond2\", raster = F)+\n  theme_void()\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        raster = F)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        pt.size=0.5, shuffle = T, raster = F)+\n  theme_void()\n\n\n\n\n\n\ncond\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\", raster = F)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\",\n        pt.size=0.5, shuffle = T, raster = F)+\n  theme_void()\n\n\n\n\n\n\norigin\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\",\n        raster = F)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/characterizeImmCellsIntegrated.html#vis-cluster-marker",
    "href": "analysis/characterizeImmCellsIntegrated.html#vis-cluster-marker",
    "title": "characterize immune cells human LN",
    "section": "vis cluster marker",
    "text": "vis cluster marker\n\nmarker genes\n\nseurat_markers_all &lt;- FindAllMarkers(object = seurat, assay =\"RNA\",\n                                     only.pos = TRUE, min.pct = 0.25,\n                                     logfc.threshold = 0.25,\n                                     test.use = \"wilcox\")\n\n\n\navg heatmap\n\ncluster &lt;- levels(seurat)\nselGenesAll &lt;- seurat_markers_all %&gt;% group_by(cluster) %&gt;% \n  top_n(-20, p_val_adj) %&gt;% \n  top_n(20, avg_log2FC)\nselGenesAll &lt;- selGenesAll %&gt;% mutate(geneIDval=gsub(\"^.*\\\\.\", \"\", gene)) %&gt;% filter(nchar(geneIDval)&gt;1)\n\nIdents(seurat) &lt;- seurat$RNA_snn_res.0.25\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=FALSE,\n                  cr=T, condCol=F)"
  },
  {
    "objectID": "analysis/characterizeImmCellsIntegrated.html#write-table",
    "href": "analysis/characterizeImmCellsIntegrated.html#write-table",
    "title": "characterize immune cells human LN",
    "section": "write table",
    "text": "write table\n\nwrite.table(seurat_markers_all,\n            file=paste0(basedir,\n                        \"/data/AllPatWithoutCM_IMMMerged_int_markerGenes.txt\"),\n            row.names = FALSE, col.names = TRUE, quote = FALSE, sep = \"\\t\")"
  },
  {
    "objectID": "analysis/characterizeImmCellsIntegrated.html#assign-labels",
    "href": "analysis/characterizeImmCellsIntegrated.html#assign-labels",
    "title": "characterize immune cells human LN",
    "section": "assign labels",
    "text": "assign labels\n\nseurat$intCluster &lt;- seurat$integrated_snn_res.0.4\n\nseurat$label &lt;- \"naiveCD4-1\"\nseurat$label[which(seurat$intCluster %in% c(\"2\"))] &lt;- \"naiveCD4-2\"\nseurat$label[which(seurat$intCluster %in% c(\"7\"))] &lt;- \"naiveCD4-3\"\nseurat$label[which(seurat$intCluster %in% c(\"6\"))] &lt;- \"CD8Tcm\"\nseurat$label[which(seurat$intCluster %in% c(\"4\"))] &lt;- \"CTL/NKcell\"\nseurat$label[which(seurat$intCluster %in% c(\"5\"))] &lt;- \"Treg\"\n\nseurat$label[which(seurat$intCluster %in% c(\"1\"))] &lt;- \"MBC\"\nseurat$label[which(seurat$intCluster %in% c(\"3\"))] &lt;- \"naiveB\"\nseurat$label[which(seurat$intCluster %in% c(\"11\"))] &lt;- \"GCB\"\nseurat$label[which(seurat$intCluster %in% c(\"14\"))] &lt;- \"plasmaCell\"\nseurat$label[which(seurat$intCluster %in% c(\"15\"))] &lt;- \"preB\"\n\nseurat$label[which(seurat$intCluster %in% c(\"9\"))] &lt;- \"Mph/DC-1\"\nseurat$label[which(seurat$intCluster %in% c(\"10\"))] &lt;- \"ILC3\"\nseurat$label[which(seurat$intCluster %in% c(\"8\"))] &lt;- \"pDC-1\"\nseurat$label[which(seurat$intCluster %in% c(\"13\"))] &lt;- \"pDC-2\"\nseurat$label[which(seurat$intCluster %in% c(\"12\"))] &lt;- \"Mph/DC-2\"\n\ncolLab &lt;- c(\"#2a3b30\", \"#0b6647\", \"#54907e\", \"#94c78a\", \"#6f9568\", \n            \"#8f2810\", \"#a83e0b\", \"#ce6915\",\"#d08821\", \"#d0ac21\",\"#b9bb20\",\n            \"#486584\",\"#56799e\", \"#4b5397\", \"#8873d3\", \"#6e3e7a\")\n            \nnames(colLab) &lt;- c(\"preB\", \"naiveB\", \"GCB\", \"MBC\", \"plasmaCell\",\n                   \"naiveCD4-1\", \"naiveCD4-2\", \"naiveCD4-3\", \"Treg\", \"CD8Tcm\",\n                    \"CTL/NKcell\",\n                   \"ILC3\",\"pDC-1\", \"pDC-2\", \"Mph/DC-1\", \"Mph/DC-2\")"
  },
  {
    "objectID": "analysis/characterizeImmCellsIntegrated.html#visualize-label",
    "href": "analysis/characterizeImmCellsIntegrated.html#visualize-label",
    "title": "characterize immune cells human LN",
    "section": "visualize label",
    "text": "visualize label\n\nIdents(seurat) &lt;- seurat$label\n\nDimPlot(seurat, reduction = \"umap\", cols=colLab, raster = F)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colLab, pt.size=0.5, raster = F)+\n  theme_void()"
  },
  {
    "objectID": "analysis/characterizeImmCellsIntegrated.html#vis-selected-immune-cell-marker",
    "href": "analysis/characterizeImmCellsIntegrated.html#vis-selected-immune-cell-marker",
    "title": "characterize immune cells human LN",
    "section": "vis selected immune cell marker",
    "text": "vis selected immune cell marker\n\ngenes &lt;- data.frame(gene=rownames(seurat)) %&gt;% \n    mutate(geneID=gsub(\"^.*\\\\.\", \"\", gene)) \n\nselGenesAll &lt;- read_tsv(file = paste0(basedir,\n                                      \"/data/overallImmuneCellMarker.txt\")) %&gt;% \n  left_join(., genes, by = \"geneID\")\n\nseurat$label &lt;- factor(seurat$label, levels = names(colLab))\nIdents(seurat) &lt;- seurat$label\n\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colLab, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=F,\n                  cr=F, condCol=F)\n\n\n\n\n\nDotplot\n\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenesAll$gene), scale =T,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenesAll$gene), labels=rev(selGenesAll$geneID)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenesAll$gene), scale =F,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenesAll$gene), labels=rev(selGenesAll$geneID)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\n\n\n\nFeatureplot\n\npList &lt;- sapply(selGenesAll$gene, function(x){\np &lt;- FeaturePlot(seurat, reduction = \"umap\", \n            features = x,\n            cols=c(\"lightgrey\", \"darkred\"),\n            order = F)+\n  theme(legend.position=\"right\")\n  plot(p)\n})"
  },
  {
    "objectID": "analysis/characterizeImmCellsIntegrated.html#save-labeled-seurat-object",
    "href": "analysis/characterizeImmCellsIntegrated.html#save-labeled-seurat-object",
    "title": "characterize immune cells human LN",
    "section": "save labeled seurat object",
    "text": "save labeled seurat object\n\nsaveRDS(seurat, paste0(basedir,\n                            \"/data/AllPatWithoutCM_IMMMerged_integrated_label\",\n                       \"_seurat.rds\"))"
  },
  {
    "objectID": "analysis/characterizeImmCellsIntegrated.html#session-info",
    "href": "analysis/characterizeImmCellsIntegrated.html#session-info",
    "title": "characterize immune cells human LN",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] scater_1.28.0               scuttle_1.10.3              SingleCellExperiment_1.22.0\n [4] SummarizedExperiment_1.30.2 Biobase_2.60.0              GenomicRanges_1.52.1       \n [7] GenomeInfoDb_1.36.4         IRanges_2.36.0              S4Vectors_0.40.1           \n[10] BiocGenerics_0.48.0         MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[13] pheatmap_1.0.12             ggsci_3.0.0                 here_1.0.1                 \n[16] runSeurat3_0.1.0            ggpubr_0.6.0                lubridate_1.9.3            \n[19] forcats_1.0.0               stringr_1.5.1               readr_2.1.5                \n[22] tidyr_1.3.1                 tibble_3.2.1                tidyverse_2.0.0            \n[25] Seurat_5.0.1                SeuratObject_5.0.1          sp_2.1-3                   \n[28] purrr_1.0.2                 cowplot_1.1.3               ggplot2_3.4.4              \n[31] reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             rprojroot_2.0.4          \n [10] vroom_1.6.5               globals_0.16.2            lattice_0.22-5           \n [13] MASS_7.3-60.0.1           backports_1.4.1           magrittr_2.0.3           \n [16] plotly_4.10.4             rmarkdown_2.25            yaml_2.3.8               \n [19] httpuv_1.6.14             sctransform_0.4.1         spam_2.10-0              \n [22] spatstat.sparse_3.0-3     reticulate_1.35.0         pbapply_1.7-2            \n [25] RColorBrewer_1.1-3        abind_1.4-5               zlibbioc_1.46.0          \n [28] Rtsne_0.17                RCurl_1.98-1.14           GenomeInfoDbData_1.2.10  \n [31] ggrepel_0.9.5             irlba_2.3.5.1             listenv_0.9.1            \n [34] spatstat.utils_3.0-4      goftest_1.2-3             RSpectra_0.16-1          \n [37] spatstat.random_3.2-2     fitdistrplus_1.1-11       parallelly_1.37.0        \n [40] DelayedMatrixStats_1.22.6 leiden_0.4.3.1            codetools_0.2-19         \n [43] DelayedArray_0.26.7       tidyselect_1.2.0          farver_2.1.1             \n [46] viridis_0.6.5             ScaledMatrix_1.8.1        spatstat.explore_3.2-6   \n [49] jsonlite_1.8.8            BiocNeighbors_1.18.0      ellipsis_0.3.2           \n [52] progressr_0.14.0          ggridges_0.5.6            survival_3.5-8           \n [55] tools_4.3.0               ica_1.0-3                 Rcpp_1.0.12              \n [58] glue_1.7.0                gridExtra_2.3             xfun_0.42                \n [61] withr_3.0.0               fastmap_1.1.1             fansi_1.0.6              \n [64] rsvd_1.0.5                digest_0.6.34             timechange_0.3.0         \n [67] R6_2.5.1                  mime_0.12                 colorspace_2.1-0         \n [70] scattermore_1.2           tensor_1.5                spatstat.data_3.0-4      \n [73] utf8_1.2.4                generics_0.1.3            data.table_1.15.0        \n [76] httr_1.4.7                htmlwidgets_1.6.4         S4Arrays_1.0.6           \n [79] uwot_0.1.16               pkgconfig_2.0.3           gtable_0.3.4             \n [82] lmtest_0.9-40             XVector_0.40.0            htmltools_0.5.7          \n [85] carData_3.0-5             dotCall64_1.1-1           scales_1.3.0             \n [88] png_0.1-8                 knitr_1.45                rstudioapi_0.15.0        \n [91] tzdb_0.4.0                nlme_3.1-164              zoo_1.8-12               \n [94] KernSmooth_2.23-22        vipor_0.4.7               parallel_4.3.0           \n [97] miniUI_0.1.1.1            pillar_1.9.0              grid_4.3.0               \n[100] vctrs_0.6.5               RANN_2.6.1                promises_1.2.1           \n[103] BiocSingular_1.16.0       car_3.1-2                 beachmat_2.16.0          \n[106] xtable_1.8-4              cluster_2.1.6             beeswarm_0.4.0           \n[109] evaluate_0.23             cli_3.6.2                 compiler_4.3.0           \n[112] rlang_1.1.3               crayon_1.5.2              future.apply_1.11.1      \n[115] ggsignif_0.6.4            labeling_0.4.3            ggbeeswarm_0.7.2         \n[118] plyr_1.8.9                stringi_1.8.3             BiocParallel_1.34.2      \n[121] viridisLite_0.4.2         deldir_2.0-2              munsell_0.5.0            \n[124] lazyeval_0.2.2            spatstat.geom_3.2-8       Matrix_1.6-5             \n[127] RcppHNSW_0.6.0            hms_1.1.3                 patchwork_1.2.0          \n[130] bit64_4.0.5               sparseMatrixStats_1.12.2  future_1.33.1            \n[133] shiny_1.8.0               ROCR_1.0-11               igraph_2.0.2             \n[136] broom_1.0.5               bit_4.0.5                \n\ndate()\n\n[1] \"Wed Mar  6 08:38:43 2024\""
  },
  {
    "objectID": "analysis/visRestingImmCellsIntegrated.html",
    "href": "analysis/visRestingImmCellsIntegrated.html",
    "title": "visualize resting immune cells human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visRestingImmCellsIntegrated.html#load-packages",
    "href": "analysis/visRestingImmCellsIntegrated.html#load-packages",
    "title": "visualize resting immune cells human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visRestingImmCellsIntegrated.html#load-seurat-object",
    "href": "analysis/visRestingImmCellsIntegrated.html#load-seurat-object",
    "title": "visualize resting immune cells human LN",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\nseurat &lt;- readRDS(file= paste0(basedir,\n                            \"/data/AllPatWithoutCM_IMMMerged_integrated_label\",\n                            \"_seurat.rds\"))\n\nIdents(seurat) &lt;- seurat$label\nseurat &lt;- subset(seurat, cond2 == \"resting\")\n\n## set col palettes\ncolPal &lt;- colPal &lt;- c(pal_flatui()(10), pal_frontiers()(8),\n                      pal_nejm()(8))[1:length(unique(seurat$RNA_snn_res.0.25))]\nnames(colPal) &lt;- unique(seurat$RNA_snn_res.0.25)\n\n\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond) &lt;- unique(seurat$cond)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\ncolCond2 &lt;- c(\"#6692a3\",\"#971c1c\")\nnames(colCond2) &lt;- c(\"resting\", \"activated\")\n\ncolLab &lt;- c(\"#2a3b30\", \"#0b6647\", \"#54907e\", \"#94c78a\", \"#6f9568\", \n            \"#8f2810\", \"#a83e0b\", \"#ce6915\",\"#d08821\", \"#d0ac21\",\"#b9bb20\",\n            \"#486584\",\"#56799e\", \"#4b5397\", \"#8873d3\", \"#6e3e7a\")\n            \nnames(colLab) &lt;- c(\"preB\", \"naiveB\", \"GCB\", \"MBC\", \"plasmaCell\",\n                   \"naiveCD4-1\", \"naiveCD4-2\", \"naiveCD4-3\", \"Treg\", \"CD8Tcm\",\n                    \"CTL/NKcell\",\n                   \"ILC3\",\"pDC-1\", \"pDC-2\", \"Mph/DC-1\", \"Mph/DC-2\")"
  },
  {
    "objectID": "analysis/visRestingImmCellsIntegrated.html#visualize-data",
    "href": "analysis/visRestingImmCellsIntegrated.html#visualize-data",
    "title": "visualize resting immune cells human LN",
    "section": "visualize data",
    "text": "visualize data\n\nDimPlot(seurat, reduction = \"umap\", cols=colLab)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colLab, pt.size=0.5)+\n  theme_void()\n\n\n\n\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal, group.by = \"RNA_snn_res.0.25\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPal, pt.size=0.5)+\n  theme_void()\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()"
  },
  {
    "objectID": "analysis/visRestingImmCellsIntegrated.html#vis-selected-immune-cell-marker",
    "href": "analysis/visRestingImmCellsIntegrated.html#vis-selected-immune-cell-marker",
    "title": "visualize resting immune cells human LN",
    "section": "vis selected immune cell marker",
    "text": "vis selected immune cell marker\n\ngenes &lt;- data.frame(gene=rownames(seurat)) %&gt;% \n    mutate(geneID=gsub(\"^.*\\\\.\", \"\", gene)) \n\nselGenesAll &lt;- read_tsv(file = paste0(basedir,\n                                      \"/data/overallImmuneCellMarker.txt\")) %&gt;% \n  left_join(., genes, by = \"geneID\")\n\nseurat$label &lt;- factor(seurat$label, levels = names(colLab))\nIdents(seurat) &lt;- seurat$label\n\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colLab, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=F,\n                  cr=F, condCol=F)\n\n\n\n\n\nDotplot\n\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenesAll$gene), scale =T,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenesAll$gene), labels=rev(selGenesAll$geneID)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenesAll$gene), scale =F,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenesAll$gene), labels=rev(selGenesAll$geneID)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\n\n\n\nFeatureplot\n\npList &lt;- sapply(selGenesAll$gene, function(x){\np &lt;- FeaturePlot(seurat, reduction = \"umap\", \n            features = x,\n            cols=c(\"lightgrey\", \"darkred\"),\n            order = F)+\n  theme(legend.position=\"right\")\n  plot(p)\n})"
  },
  {
    "objectID": "analysis/visRestingImmCellsIntegrated.html#session-info",
    "href": "analysis/visRestingImmCellsIntegrated.html#session-info",
    "title": "visualize resting immune cells human LN",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] scater_1.28.0               scuttle_1.10.3              SingleCellExperiment_1.22.0\n [4] SummarizedExperiment_1.30.2 Biobase_2.60.0              GenomicRanges_1.52.1       \n [7] GenomeInfoDb_1.36.4         IRanges_2.36.0              S4Vectors_0.40.1           \n[10] BiocGenerics_0.48.0         MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[13] pheatmap_1.0.12             ggsci_3.0.1                 here_1.0.1                 \n[16] runSeurat3_0.1.0            ggpubr_0.6.0                lubridate_1.9.3            \n[19] forcats_1.0.0               stringr_1.5.1               readr_2.1.5                \n[22] tidyr_1.3.1                 tibble_3.2.1                tidyverse_2.0.0            \n[25] Seurat_5.0.2                SeuratObject_5.0.1          sp_2.1-3                   \n[28] purrr_1.0.2                 cowplot_1.1.3               ggplot2_3.5.0              \n[31] reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             rprojroot_2.0.4          \n [10] vroom_1.6.5               globals_0.16.2            lattice_0.22-5           \n [13] MASS_7.3-60.0.1           backports_1.4.1           magrittr_2.0.3           \n [16] plotly_4.10.4             rmarkdown_2.26            yaml_2.3.8               \n [19] httpuv_1.6.14             sctransform_0.4.1         spam_2.10-0              \n [22] spatstat.sparse_3.0-3     reticulate_1.35.0         pbapply_1.7-2            \n [25] RColorBrewer_1.1-3        abind_1.4-5               zlibbioc_1.46.0          \n [28] Rtsne_0.17                RCurl_1.98-1.14           GenomeInfoDbData_1.2.10  \n [31] ggrepel_0.9.5             irlba_2.3.5.1             listenv_0.9.1            \n [34] spatstat.utils_3.0-4      goftest_1.2-3             RSpectra_0.16-1          \n [37] spatstat.random_3.2-3     fitdistrplus_1.1-11       parallelly_1.37.1        \n [40] DelayedMatrixStats_1.22.6 leiden_0.4.3.1            codetools_0.2-19         \n [43] DelayedArray_0.26.7       tidyselect_1.2.0          farver_2.1.1             \n [46] viridis_0.6.5             ScaledMatrix_1.8.1        spatstat.explore_3.2-6   \n [49] jsonlite_1.8.8            BiocNeighbors_1.18.0      ellipsis_0.3.2           \n [52] progressr_0.14.0          ggridges_0.5.6            survival_3.5-8           \n [55] tools_4.3.0               ica_1.0-3                 Rcpp_1.0.12              \n [58] glue_1.7.0                gridExtra_2.3             xfun_0.42                \n [61] withr_3.0.0               fastmap_1.1.1             fansi_1.0.6              \n [64] rsvd_1.0.5                digest_0.6.34             timechange_0.3.0         \n [67] R6_2.5.1                  mime_0.12                 colorspace_2.1-0         \n [70] scattermore_1.2           tensor_1.5                spatstat.data_3.0-4      \n [73] utf8_1.2.4                generics_0.1.3            data.table_1.15.2        \n [76] httr_1.4.7                htmlwidgets_1.6.4         S4Arrays_1.0.6           \n [79] uwot_0.1.16               pkgconfig_2.0.3           gtable_0.3.4             \n [82] lmtest_0.9-40             XVector_0.40.0            htmltools_0.5.7          \n [85] carData_3.0-5             dotCall64_1.1-1           scales_1.3.0             \n [88] png_0.1-8                 knitr_1.45                rstudioapi_0.15.0        \n [91] tzdb_0.4.0                nlme_3.1-164              zoo_1.8-12               \n [94] KernSmooth_2.23-22        vipor_0.4.7               parallel_4.3.0           \n [97] miniUI_0.1.1.1            pillar_1.9.0              grid_4.3.0               \n[100] vctrs_0.6.5               RANN_2.6.1                promises_1.2.1           \n[103] BiocSingular_1.16.0       car_3.1-2                 beachmat_2.16.0          \n[106] xtable_1.8-4              cluster_2.1.6             beeswarm_0.4.0           \n[109] evaluate_0.23             cli_3.6.2                 compiler_4.3.0           \n[112] rlang_1.1.3               crayon_1.5.2              future.apply_1.11.1      \n[115] ggsignif_0.6.4            labeling_0.4.3            ggbeeswarm_0.7.2         \n[118] plyr_1.8.9                stringi_1.8.3             BiocParallel_1.34.2      \n[121] viridisLite_0.4.2         deldir_2.0-4              munsell_0.5.0            \n[124] lazyeval_0.2.2            spatstat.geom_3.2-9       Matrix_1.6-5             \n[127] RcppHNSW_0.6.0            hms_1.1.3                 patchwork_1.2.0          \n[130] bit64_4.0.5               sparseMatrixStats_1.12.2  future_1.33.1            \n[133] shiny_1.8.0               ROCR_1.0-11               igraph_2.0.2             \n[136] broom_1.0.5               bit_4.0.5                \n\ndate()\n\n[1] \"Fri Mar  8 08:26:19 2024\""
  },
  {
    "objectID": "analysis/runCellchat_act_vs_res.html",
    "href": "analysis/runCellchat_act_vs_res.html",
    "title": "run cellchat scRNAseq data human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n  library(SingleCellExperiment)\n  library(scran)\n  library(CellChat)\n  library(patchwork)\n  library(ComplexHeatmap)\n})"
  },
  {
    "objectID": "analysis/runCellchat_act_vs_res.html#load-packages",
    "href": "analysis/runCellchat_act_vs_res.html#load-packages",
    "title": "run cellchat scRNAseq data human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n  library(SingleCellExperiment)\n  library(scran)\n  library(CellChat)\n  library(patchwork)\n  library(ComplexHeatmap)\n})"
  },
  {
    "objectID": "analysis/runCellchat_act_vs_res.html#load-seurat-object",
    "href": "analysis/runCellchat_act_vs_res.html#load-seurat-object",
    "title": "run cellchat scRNAseq data human LN",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\nseuratFRC &lt;- readRDS(file= paste0(basedir,\n                            \"/data/AllPatWithoutCM_FRConly_intOrig\", \n                            \"_seurat.rds\"))\nseuratIMM &lt;- readRDS(file= paste0(basedir,\n                            \"/data/AllPatWithoutCM_IMMMerged_integrated_label\",\n                       \"_seurat.rds\"))\n\n## add label FRCs\nseuratFRC$label &lt;- \"medRCIFRC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"7\")] &lt;- \"BRC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"2\")] &lt;- \"TRC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"3\")] &lt;- \"ACTA2+PRC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"4\")] &lt;- \"VSMC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"5\")] &lt;- \"PI16+RC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"6\")] &lt;- \"PRC1\"\n\nseuratFRC$cond2 &lt;- seuratFRC$cond\nseuratFRC$cond2[which(seuratFRC$cond %in% c(\"acute\", \"chronic\"))] &lt;- \"activated\"\n\n## group imm cells\nseuratIMM$label2 &lt;- seuratIMM$label\nseuratIMM$label &lt;- as.character(seuratIMM$label)\nseuratIMM$label[which(seuratIMM$label %in% c(\"naiveCD4-2\", \"naiveCD4-3\",\n                                             \"naiveCD4-1\", \"Treg\" ))] &lt;- \"CD4T\"\nseuratIMM$label[which(seuratIMM$label %in% c(\"pDC-2\", \"pDC-1\" ))] &lt;- \"pDC\"\nseuratIMM$label[which(seuratIMM$label %in% c(\"naiveB\", \"preB\" ))] &lt;- \"naiveB\"\n\n\nseurat &lt;- merge(seuratFRC, c(seuratIMM))\nseurat$label_plus_cond &lt;- paste0(seurat$label, \"_\", seurat$cond2)\ntable(seurat$label_plus_cond)\n\n\n ACTA2+PRC_activated    ACTA2+PRC_resting        BRC_activated          BRC_resting \n                4244                 1560                 1487                  390 \n      CD4T_activated         CD4T_resting     CD8Tcm_activated       CD8Tcm_resting \n               38543                39380                 6234                 4006 \nCTL/NKcell_activated   CTL/NKcell_resting        GCB_activated          GCB_resting \n                4129                10339                  687                  869 \n      ILC3_activated         ILC3_resting        MBC_activated          MBC_resting \n                  79                 1819                10732                17174 \n medRCIFRC_activated    medRCIFRC_resting   Mph/DC-1_activated     Mph/DC-1_resting \n               10342                10129                  118                 2952 \n  Mph/DC-2_activated     Mph/DC-2_resting     naiveB_activated       naiveB_resting \n                 157                  980                 8295                14118 \n       pDC_activated          pDC_resting    PI16+RC_activated      PI16+RC_resting \n                 558                 6750                 1917                  986 \nplasmaCell_activated   plasmaCell_resting       PRC1_activated         PRC1_resting \n                  53                  326                 1528                  760 \n       TRC_activated          TRC_resting       VSMC_activated         VSMC_resting \n                3164                 3773                 2767                  724 \n\nIdents(seurat) &lt;- seurat$label_plus_cond\nseurat &lt;- subset(x = seurat, downsample = 500)\ntable(seurat$label_plus_cond)\n\n\n ACTA2+PRC_activated    ACTA2+PRC_resting        BRC_activated          BRC_resting \n                 500                  500                  500                  390 \n      CD4T_activated         CD4T_resting     CD8Tcm_activated       CD8Tcm_resting \n                 500                  500                  500                  500 \nCTL/NKcell_activated   CTL/NKcell_resting        GCB_activated          GCB_resting \n                 500                  500                  500                  500 \n      ILC3_activated         ILC3_resting        MBC_activated          MBC_resting \n                  79                  500                  500                  500 \n medRCIFRC_activated    medRCIFRC_resting   Mph/DC-1_activated     Mph/DC-1_resting \n                 500                  500                  118                  500 \n  Mph/DC-2_activated     Mph/DC-2_resting     naiveB_activated       naiveB_resting \n                 157                  500                  500                  500 \n       pDC_activated          pDC_resting    PI16+RC_activated      PI16+RC_resting \n                 500                  500                  500                  500 \nplasmaCell_activated   plasmaCell_resting       PRC1_activated         PRC1_resting \n                  53                  326                  500                  500 \n       TRC_activated          TRC_resting       VSMC_activated         VSMC_resting \n                 500                  500                  500                  500 \n\ntable(seurat$patient)\n\n\nP_20200220 P_20200722 P_20200909 P_20210113 P_20210224 P_20220201 P_20220202     ucd010      ucd13 \n      1482        600       1282       1925       1474       2251       2658       1939       1046 \n     ucd14 \n      1466 \n\ndim(seurat)\n\n[1] 39642 16123\n\nremove(seuratIMM, seuratFRC)\nseurat &lt;- NormalizeData(object = seurat)\nseurat &lt;- FindVariableFeatures(object = seurat)\nseurat &lt;- ScaleData(object = seurat, verbose = FALSE)\nseurat &lt;- RunPCA(object = seurat, npcs = 30, verbose = FALSE)\nseurat &lt;- RunTSNE(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- RunUMAP(object = seurat, reduction = \"pca\", dims = 1:20)"
  },
  {
    "objectID": "analysis/runCellchat_act_vs_res.html#set-color-palettes",
    "href": "analysis/runCellchat_act_vs_res.html#set-color-palettes",
    "title": "run cellchat scRNAseq data human LN",
    "section": "set color palettes",
    "text": "set color palettes\n\ncolFRC &lt;- c(\"#800000FF\", \"#FFA319FF\",\"#8A9045FF\", \"#155F83FF\",\n            \"#C16622FF\", \"#6692a3\", \"#3b7f60\")\nnames(colFRC) &lt;- c(\"medRCIFRC\", \"TRC\", \"ACTA2+PRC\", \"VSMC\", \"PI16+RC\", \"PRC1\",\n                   \"BRC\")\n\n\ncolImm &lt;- c(\"#0b6647\", \"#54907e\", \"#94c78a\", \"#6f9568\", \n            \"#8f2810\", \"#d0ac21\",\"#9e9f0b\", \"#486584\",\n            \"#4b5397\", \"#8873d3\", \"#6e3e7a\")\n            \nnames(colImm) &lt;- c(\"naiveB\", \"GCB\", \"MBC\", \"plasmaCell\",\n                   \"CD4T\", \"CD8Tcm\", \"CTL/NKcell\", \"ILC3\", \"pDC\",\n                   \"Mph/DC-1\", \"Mph/DC-2\" )\n\ncolAll &lt;- c(colFRC, colImm) \n\ncolPal &lt;- c(pal_uchicago()(6), \"#6692a3\", \"#3b7f60\")\nnames(colPal) &lt;- c(\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\")\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond) &lt;- unique(seurat$cond)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\ncolCond2 &lt;- c(\"#6692a3\",\"#971c1c\")\nnames(colCond2) &lt;- c(\"resting\", \"activated\")"
  },
  {
    "objectID": "analysis/runCellchat_act_vs_res.html#visualize-data",
    "href": "analysis/runCellchat_act_vs_res.html#visualize-data",
    "title": "run cellchat scRNAseq data human LN",
    "section": "visualize data",
    "text": "visualize data\n\nlabel\n\nDimPlot(seurat, reduction = \"umap\", cols=colAll, group.by = \"label\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond2\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/runCellchat_act_vs_res.html#cellchat-analysis",
    "href": "analysis/runCellchat_act_vs_res.html#cellchat-analysis",
    "title": "run cellchat scRNAseq data human LN",
    "section": "cellchat analysis",
    "text": "cellchat analysis\n\ncreate cellchat object\n\nfuture::plan(\"multisession\", workers = 4) \n\n### --------------- resting LNs ----------------- ###\nseurat.res &lt;- subset(seurat, cond2 == \"resting\")\ndata.inp.res &lt;- seurat.res@assays$RNA$data\nrownames(data.inp.res) &lt;- gsub(\".*\\\\.\", \"\", rownames(data.inp.res))\n\ncellchat.res &lt;- createCellChat(object = data.inp.res, meta = seurat.res@meta.data,\n                           group.by = \"label\")\n\n[1] \"Create a CellChat object from a data matrix\"\nSet cell identities for the new CellChat object \nThe cell groups used for CellChat analysis are  ACTA2+PRC BRC CD4T CD8Tcm CTL/NKcell GCB ILC3 MBC medRCIFRC Mph/DC-1 Mph/DC-2 naiveB pDC PI16+RC plasmaCell PRC1 TRC VSMC \n\nCellChatDB &lt;- CellChatDB.human\ncellchat.res@DB &lt;- CellChatDB\n\n## preprocessing\ncellchat.res &lt;- CellChat::subsetData(cellchat.res) \ncellchat.res &lt;- identifyOverExpressedGenes(cellchat.res)\ncellchat.res &lt;- identifyOverExpressedInteractions(cellchat.res)\n\n\n### --------------- activated LNs ----------------- ###\nseurat.act &lt;- subset(seurat, cond2 == \"activated\")\ndata.inp.act &lt;- seurat.act@assays$RNA$data\nrownames(data.inp.act) &lt;- gsub(\".*\\\\.\", \"\", rownames(data.inp.act))\n\ncellchat.act &lt;- createCellChat(object = data.inp.act, meta = seurat.act@meta.data,\n                           group.by = \"label\")\n\n[1] \"Create a CellChat object from a data matrix\"\nSet cell identities for the new CellChat object \nThe cell groups used for CellChat analysis are  ACTA2+PRC BRC CD4T CD8Tcm CTL/NKcell GCB ILC3 MBC medRCIFRC Mph/DC-1 Mph/DC-2 naiveB pDC PI16+RC plasmaCell PRC1 TRC VSMC \n\ncellchat.act@DB &lt;- CellChatDB\n\n## preprocessing\ncellchat.act &lt;- CellChat::subsetData(cellchat.act) \ncellchat.act &lt;- identifyOverExpressedGenes(cellchat.act)\ncellchat.act &lt;- identifyOverExpressedInteractions(cellchat.act)\n\n\n\ncompute communication probability res\n\ncellchat.res &lt;- computeCommunProb(cellchat.res, type = \"truncatedMean\")\n\ntruncatedMean is used for calculating the average gene expression per cell group. \n[1] \"&gt;&gt;&gt; Run CellChat on sc/snRNA-seq data &lt;&lt;&lt; [2024-03-06 14:44:59.553069]\"\n[1] \"&gt;&gt;&gt; CellChat inference is done. Parameter values are stored in `object@options$parameter` &lt;&lt;&lt; [2024-03-06 15:07:00.97513]\"\n\ncellchat.res &lt;- filterCommunication(cellchat.res, min.cells = 10)\ncellchat.res &lt;- computeCommunProbPathway(cellchat.res)\n\ndf.net.res &lt;- subsetCommunication(cellchat.res,\n                              sources.use = c(\"PI16+RC\", \"PRC1\", \"ACTA2+PRC\"),\n                              targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\",\n                                              \"ILC3\", \"naiveB\", \"MBC\", \n                                              \"plasmaCell\", \"CD8Tcm\", \n                                              \"Mph/DC-1\", \"Mph/DC-2\"))\n\ndf.net2.res &lt;- subsetCommunication(cellchat.res, sources.use = c(\"CD4T\", \"CTL/NKcell\",\n                                                         \"GCB\",\n                                              \"ILC3\", \"naiveB\", \"MBC\", \n                                              \"plasmaCell\", \"CD8Tcm\", \n                                              \"Mph/DC-1\", \"Mph/DC-2\"),\n                              targets.use = c(\"PI16+RC\", \"PRC1\", \"ACTA2+PRC\"))\ncellchat.res &lt;- aggregateNet(cellchat.res)\ncellchat.res &lt;- netAnalysis_computeCentrality(cellchat.res, slot.name = \"netP\")\n\n\nvis int partner rest\n\ngroupSize &lt;- as.numeric(table(cellchat.res@idents))\nmatPre &lt;- cellchat.res@net$weight\nmat &lt;- matPre[names(colAll), names(colAll)] \nfor (i in 1:nrow(mat)) {\n  mat2 &lt;- matrix(0, nrow = nrow(mat), ncol = ncol(mat), dimnames = dimnames(mat))\n  mat2[i, ] &lt;- mat[i, ]\n  netVisual_circle(mat2, vertex.weight = groupSize, weight.scale = T,\n                   edge.weight.max = max(mat), title.name = rownames(mat)[i],\n                   color.use = colAll)\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncompute communication probability act\n\ncellchat.act &lt;- computeCommunProb(cellchat.act, type = \"truncatedMean\")\n\ntruncatedMean is used for calculating the average gene expression per cell group. \n[1] \"&gt;&gt;&gt; Run CellChat on sc/snRNA-seq data &lt;&lt;&lt; [2024-03-06 15:07:07.533031]\"\n[1] \"&gt;&gt;&gt; CellChat inference is done. Parameter values are stored in `object@options$parameter` &lt;&lt;&lt; [2024-03-06 15:18:04.990138]\"\n\ncellchat.act &lt;- filterCommunication(cellchat.act, min.cells = 10)\ncellchat.act &lt;- computeCommunProbPathway(cellchat.act)\n\ndf.net.act &lt;- subsetCommunication(cellchat.act,\n                              sources.use = c(\"PI16+RC\", \"PRC1\", \"ACTA2+PRC\"),\n                              targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\",\n                                              \"ILC3\", \"naiveB\", \"MBC\", \n                                              \"plasmaCell\", \"CD8Tcm\" , \n                                              \"Mph/DC-1\", \"Mph/DC-2\"))\n\ndf.net2.act &lt;- subsetCommunication(cellchat.act, sources.use = c(\"CD4T\", \n                                                                 \"CTL/NKcell\",\n                                                         \"GCB\",\n                                              \"ILC3\", \"naiveB\", \"MBC\", \n                                              \"plasmaCell\", \"CD8Tcm\", \n                                              \"Mph/DC-1\", \"Mph/DC-2\"),\n                              targets.use = c(\"PI16+RC\", \"PRC1\", \"ACTA2+PRC\"))\n\ncellchat.act &lt;- aggregateNet(cellchat.act)\ncellchat.act &lt;- netAnalysis_computeCentrality(cellchat.act, slot.name = \"netP\")\n\n\nvis int partner act\n\ngroupSize &lt;- as.numeric(table(cellchat.act@idents))\nmatPre &lt;- cellchat.act@net$weight\nmat &lt;- matPre[names(colAll), names(colAll)] \nfor (i in 1:nrow(mat)) {\n  mat2 &lt;- matrix(0, nrow = nrow(mat), ncol = ncol(mat), dimnames = dimnames(mat))\n  mat2[i, ] &lt;- mat[i, ]\n  netVisual_circle(mat2, vertex.weight = groupSize, weight.scale = T,\n                   edge.weight.max = max(mat), title.name = rownames(mat)[i],\n                   color.use = colAll)\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ncompare interaction counts/strength\n\nobject.list &lt;- list(act = cellchat.act, res = cellchat.res)\ncellchat.merge &lt;- mergeCellChat(object.list, add.names = names(object.list))\n\ncolCond3 &lt;- colCond2\nnames(colCond3) &lt;- c(\"res\", \"act\")\ngg1 &lt;- compareInteractions(cellchat.merge, show.legend = F,\n                           group = c(\"act\",\"res\")) + \n  scale_fill_manual(values = colCond3)\ngg2 &lt;- compareInteractions(cellchat.merge, show.legend = F, \n                           group = c(\"act\",\"res\"), measure = \"weight\") + \n  scale_fill_manual(values = colCond3)\ngg1 + gg2\n\n\n\nnetVisual_diffInteraction(cellchat.merge, weight.scale = T)\n\n\n\nnetVisual_diffInteraction(cellchat.merge, weight.scale = T, measure = \"weight\")\n\n\n\ngg1 &lt;- netVisual_heatmap(cellchat.merge)\ngg2 &lt;- netVisual_heatmap(cellchat.merge, measure = \"weight\")\ngg1 + gg2\n\n\n\nweight.max &lt;- getMaxWeight(object.list, attribute = c(\"idents\",\"count\"))\npar(mfrow = c(1,2), xpd=TRUE)\nfor (i in 1:length(object.list)) {\n  netVisual_circle(object.list[[i]]@net$count, weight.scale = T, label.edge= F,\n                   edge.weight.max = weight.max[2], edge.width.max = 12,\n                   title.name = paste0(\"Number of interactions - \",\n                                       names(object.list)[i]))\n}\n\n\n\n\n\n\ncomp int cnt/strength subsets\n\n########### ------------ PI16+RC ------------------- #############\n\ngroup.cellType &lt;- c(rep(\"PI16+RC\", 3), rep(\"CD4T\", 3), rep(\"CTL/NKcell\", 3),\n                    rep(\"Mph/DC-2\", 3), rep(\"CD8Tcm\", 3))\ngroup.cellType &lt;- factor(group.cellType, levels = c(\"PI16+RC\", \"CD4T\",\n                                                    \"CTL/NKcell\", \"Mph/DC-2\",\n                                                    \"CD8Tcm\"))\n\nobject.list.sub &lt;- lapply(object.list, function(x) {\n  mergeInteractions(x, group.cellType)})\ncellchat.sub &lt;- mergeCellChat(object.list.sub,\n                              add.names = names(object.list.sub))\n\nweight.max &lt;- getMaxWeight(object.list.sub,\n                           slot.name = c(\"idents\", \"net\", \"net\"),\n                           attribute = c(\"idents\",\"count\", \"count.merged\"))\npar(mfrow = c(1,2), xpd=TRUE)\nfor (i in 1:length(object.list.sub)) {\n  netVisual_circle(object.list.sub[[i]]@net$count.merged, weight.scale = T,\n                   label.edge= T, edge.weight.max = weight.max[3], \n                   edge.width.max = 12,\n                   title.name = paste0(\"Number of interactions - \",\n                                       names(object.list.sub)[i]))\n}\n\n\n\ngroup.cellType &lt;- c(rep(\"PI16+RC\", 3), rep(\"GCB\", 3), rep(\"MBC\", 3),\n                    rep(\"naiveB\", 3), rep(\"plasmaCell\", 3))\ngroup.cellType &lt;- factor(group.cellType, levels = c(\"PI16+RC\",\"GCB\", \"naiveB\", \n                                                    \"MBC\", \"plasmaCell\"))\n\nobject.list.sub &lt;- lapply(object.list, function(x) {\n  mergeInteractions(x, group.cellType)\n  })\ncellchat.sub &lt;- mergeCellChat(object.list.sub, \n                              add.names = names(object.list.sub))\n\nweight.max &lt;- getMaxWeight(object.list.sub,\n                           slot.name = c(\"idents\", \"net\", \"net\"),\n                           attribute = c(\"idents\",\"count\", \"count.merged\"))\npar(mfrow = c(1,2), xpd=TRUE)\nfor (i in 1:length(object.list.sub)) {\n  netVisual_circle(object.list.sub[[i]]@net$count.merged, weight.scale = T,\n                   label.edge= T, edge.weight.max = weight.max[3], \n                   edge.width.max = 12,\n                   title.name = paste0(\"Number of interactions - \",\n                                       names(object.list.sub)[i]))\n}\n\n\n\ngroup.cellType &lt;- c(rep(\"PI16+RC\", 4), rep(\"ILC3\", 4), rep(\"Mph/DC-1\", 4))\ngroup.cellType &lt;- factor(group.cellType, levels = c(\"PI16+RC\", \"ILC3\",\n                                                    \"Mph/DC-1\"))\n\nobject.list.sub &lt;- lapply(object.list, function(x) {\n  mergeInteractions(x, group.cellType)\n  })\ncellchat.sub &lt;- mergeCellChat(object.list.sub,\n                              add.names = names(object.list.sub))\n\nweight.max &lt;- getMaxWeight(object.list.sub,\n                           slot.name = c(\"idents\", \"net\", \"net\"),\n                           attribute = c(\"idents\",\"count\", \"count.merged\"))\npar(mfrow = c(1,2), xpd=TRUE)\nfor (i in 1:length(object.list.sub)) {\n  netVisual_circle(object.list.sub[[i]]@net$count.merged, weight.scale = T,\n                   label.edge= T, edge.weight.max = weight.max[3], \n                   edge.width.max = 12,\n                   title.name = paste0(\"Number of interactions - \",\n                                       names(object.list.sub)[i]))\n}\n\n\n\n########### ------------ PRC1 ------------------- #############\n\ngroup.cellType &lt;- c(rep(\"PRC1\", 3), rep(\"CD4T\", 3), rep(\"CTL/NKcell\", 3),\n                    rep(\"Mph/DC-2\", 3), rep(\"CD8Tcm\", 3))\ngroup.cellType &lt;- factor(group.cellType, levels = c(\"PRC1\", \"CD4T\",\n                                                    \"CTL/NKcell\",\"Mph/DC-2\",\n                                                    \"CD8Tcm\"))\n\nobject.list.sub &lt;- lapply(object.list, function(x) {\n  mergeInteractions(x, group.cellType)})\ncellchat.sub &lt;- mergeCellChat(object.list.sub,\n                              add.names = names(object.list.sub))\n\nweight.max &lt;- getMaxWeight(object.list.sub,\n                           slot.name = c(\"idents\", \"net\", \"net\"),\n                           attribute = c(\"idents\",\"count\", \"count.merged\"))\npar(mfrow = c(1,2), xpd=TRUE)\nfor (i in 1:length(object.list.sub)) {\n  netVisual_circle(object.list.sub[[i]]@net$count.merged, weight.scale = T,\n                   label.edge= T, edge.weight.max = weight.max[3], \n                   edge.width.max = 12,\n                   title.name = paste0(\"Number of interactions - \",\n                                       names(object.list.sub)[i]))\n}\n\n\n\ngroup.cellType &lt;- c(rep(\"PRC1\", 3), rep(\"GCB\", 3), rep(\"MBC\", 3),\n                    rep(\"naiveB\", 3), rep(\"plasmaCell\", 3))\ngroup.cellType &lt;- factor(group.cellType, levels = c(\"PRC1\",\"GCB\", \"naiveB\", \n                                                    \"MBC\", \"plasmaCell\"))\n\nobject.list.sub &lt;- lapply(object.list, function(x) {\n  mergeInteractions(x, group.cellType)\n  })\ncellchat.sub &lt;- mergeCellChat(object.list.sub, \n                              add.names = names(object.list.sub))\n\nweight.max &lt;- getMaxWeight(object.list.sub,\n                           slot.name = c(\"idents\", \"net\", \"net\"),\n                           attribute = c(\"idents\",\"count\", \"count.merged\"))\npar(mfrow = c(1,2), xpd=TRUE)\nfor (i in 1:length(object.list.sub)) {\n  netVisual_circle(object.list.sub[[i]]@net$count.merged, weight.scale = T,\n                   label.edge= T, edge.weight.max = weight.max[3], \n                   edge.width.max = 12,\n                   title.name = paste0(\"Number of interactions - \",\n                                       names(object.list.sub)[i]))\n}\n\n\n\ngroup.cellType &lt;- c(rep(\"PRC1\", 4), rep(\"ILC3\", 4), rep(\"Mph/DC-1\", 4))\ngroup.cellType &lt;- factor(group.cellType, levels = c(\"PRC1\", \"ILC3\", \"Mph/DC-1\"))\n\nobject.list.sub &lt;- lapply(object.list, function(x) {\n  mergeInteractions(x, group.cellType)\n  })\ncellchat.sub &lt;- mergeCellChat(object.list.sub,\n                              add.names = names(object.list.sub))\n\nweight.max &lt;- getMaxWeight(object.list.sub,\n                           slot.name = c(\"idents\", \"net\", \"net\"),\n                           attribute = c(\"idents\",\"count\", \"count.merged\"))\npar(mfrow = c(1,2), xpd=TRUE)\nfor (i in 1:length(object.list.sub)) {\n  netVisual_circle(object.list.sub[[i]]@net$count.merged, weight.scale = T,\n                   label.edge= T, edge.weight.max = weight.max[3], \n                   edge.width.max = 12,\n                   title.name = paste0(\"Number of interactions - \",\n                                       names(object.list.sub)[i]))\n}\n\n\n\n########### ------------ PRC1 ------------------- #############\n\ngroup.cellType &lt;- c(rep(\"PRC1\", 3), rep(\"CD4T\", 3), rep(\"CTL/NKcell\", 3),\n                    rep(\"Mph/DC-2\", 3), rep(\"CD8Tcm\", 3))\ngroup.cellType &lt;- factor(group.cellType, levels = c(\"PRC1\", \"CD4T\",\n                                                    \"CTL/NKcell\",\"Mph/DC-2\",\n                                                    \"CD8Tcm\"))\n\nobject.list.sub &lt;- lapply(object.list, function(x) {\n  mergeInteractions(x, group.cellType)})\ncellchat.sub &lt;- mergeCellChat(object.list.sub,\n                              add.names = names(object.list.sub))\n\nweight.max &lt;- getMaxWeight(object.list.sub,\n                           slot.name = c(\"idents\", \"net\", \"net\"),\n                           attribute = c(\"idents\",\"count\", \"count.merged\"))\npar(mfrow = c(1,2), xpd=TRUE)\nfor (i in 1:length(object.list.sub)) {\n  netVisual_circle(object.list.sub[[i]]@net$count.merged, weight.scale = T,\n                   label.edge= T, edge.weight.max = weight.max[3], \n                   edge.width.max = 12,\n                   title.name = paste0(\"Number of interactions - \",\n                                       names(object.list.sub)[i]))\n}\n\n\n\ngroup.cellType &lt;- c(rep(\"PRC1\", 3), rep(\"GCB\", 3), rep(\"MBC\", 3),\n                    rep(\"naiveB\", 3), rep(\"plasmaCell\", 3))\ngroup.cellType &lt;- factor(group.cellType, levels = c(\"PRC1\",\"GCB\", \"naiveB\", \n                                                    \"MBC\", \"plasmaCell\"))\n\nobject.list.sub &lt;- lapply(object.list, function(x) {\n  mergeInteractions(x, group.cellType)\n  })\ncellchat.sub &lt;- mergeCellChat(object.list.sub, \n                              add.names = names(object.list.sub))\n\nweight.max &lt;- getMaxWeight(object.list.sub,\n                           slot.name = c(\"idents\", \"net\", \"net\"),\n                           attribute = c(\"idents\",\"count\", \"count.merged\"))\npar(mfrow = c(1,2), xpd=TRUE)\nfor (i in 1:length(object.list.sub)) {\n  netVisual_circle(object.list.sub[[i]]@net$count.merged, weight.scale = T,\n                   label.edge= T, edge.weight.max = weight.max[3], \n                   edge.width.max = 12,\n                   title.name = paste0(\"Number of interactions - \",\n                                       names(object.list.sub)[i]))\n}\n\n\n\ngroup.cellType &lt;- c(rep(\"PRC1\", 4), rep(\"ILC3\", 4), rep(\"Mph/DC-1\", 4))\ngroup.cellType &lt;- factor(group.cellType, levels = c(\"PRC1\", \"ILC3\", \"Mph/DC-1\"))\n\nobject.list.sub &lt;- lapply(object.list, function(x) {\n  mergeInteractions(x, group.cellType)\n  })\ncellchat.sub &lt;- mergeCellChat(object.list.sub,\n                              add.names = names(object.list.sub))\n\nweight.max &lt;- getMaxWeight(object.list.sub,\n                           slot.name = c(\"idents\", \"net\", \"net\"),\n                           attribute = c(\"idents\",\"count\", \"count.merged\"))\npar(mfrow = c(1,2), xpd=TRUE)\nfor (i in 1:length(object.list.sub)) {\n  netVisual_circle(object.list.sub[[i]]@net$count.merged, weight.scale = T,\n                   label.edge= T, edge.weight.max = weight.max[3], \n                   edge.width.max = 12,\n                   title.name = paste0(\"Number of interactions - \",\n                                       names(object.list.sub)[i]))\n}\n\n\n\n########### ------------ ACTA2+PRC ------------------- #############\n\ngroup.cellType &lt;- c(rep(\"ACTA2+PRC\", 3), rep(\"CD4T\", 3), rep(\"CTL/NKcell\", 3),\n                    rep(\"Mph/DC-2\", 3), rep(\"CD8Tcm\", 3))\ngroup.cellType &lt;- factor(group.cellType, levels = c(\"ACTA2+PRC\", \"CD4T\",\n                                                    \"CTL/NKcell\",\"Mph/DC-2\",\n                                                    \"CD8Tcm\"))\n\nobject.list.sub &lt;- lapply(object.list, function(x) {\n  mergeInteractions(x, group.cellType)})\ncellchat.sub &lt;- mergeCellChat(object.list.sub,\n                              add.names = names(object.list.sub))\n\nweight.max &lt;- getMaxWeight(object.list.sub,\n                           slot.name = c(\"idents\", \"net\", \"net\"),\n                           attribute = c(\"idents\",\"count\", \"count.merged\"))\npar(mfrow = c(1,2), xpd=TRUE)\nfor (i in 1:length(object.list.sub)) {\n  netVisual_circle(object.list.sub[[i]]@net$count.merged, weight.scale = T,\n                   label.edge= T, edge.weight.max = weight.max[3], \n                   edge.width.max = 12,\n                   title.name = paste0(\"Number of interactions - \",\n                                       names(object.list.sub)[i]))\n}\n\n\n\ngroup.cellType &lt;- c(rep(\"ACTA2+PRC\", 3), rep(\"GCB\", 3), rep(\"MBC\", 3),\n                    rep(\"naiveB\", 3), rep(\"plasmaCell\", 3))\ngroup.cellType &lt;- factor(group.cellType, levels = c(\"ACTA2+PRC\",\"GCB\", \"naiveB\", \n                                                    \"MBC\", \"plasmaCell\"))\n\nobject.list.sub &lt;- lapply(object.list, function(x) {\n  mergeInteractions(x, group.cellType)\n  })\ncellchat.sub &lt;- mergeCellChat(object.list.sub, \n                              add.names = names(object.list.sub))\n\nweight.max &lt;- getMaxWeight(object.list.sub,\n                           slot.name = c(\"idents\", \"net\", \"net\"),\n                           attribute = c(\"idents\",\"count\", \"count.merged\"))\npar(mfrow = c(1,2), xpd=TRUE)\nfor (i in 1:length(object.list.sub)) {\n  netVisual_circle(object.list.sub[[i]]@net$count.merged, weight.scale = T,\n                   label.edge= T, edge.weight.max = weight.max[3], \n                   edge.width.max = 12,\n                   title.name = paste0(\"Number of interactions - \",\n                                       names(object.list.sub)[i]))\n}\n\n\n\ngroup.cellType &lt;- c(rep(\"ACTA2+PRC\", 4), rep(\"ILC3\", 4), rep(\"Mph/DC-1\", 4))\ngroup.cellType &lt;- factor(group.cellType, levels = c(\"ACTA2+PRC\", \"ILC3\",\n                                                    \"Mph/DC-1\"))\n\nobject.list.sub &lt;- lapply(object.list, function(x) {\n  mergeInteractions(x, group.cellType)\n  })\ncellchat.sub &lt;- mergeCellChat(object.list.sub,\n                              add.names = names(object.list.sub))\n\nweight.max &lt;- getMaxWeight(object.list.sub,\n                           slot.name = c(\"idents\", \"net\", \"net\"),\n                           attribute = c(\"idents\",\"count\", \"count.merged\"))\npar(mfrow = c(1,2), xpd=TRUE)\nfor (i in 1:length(object.list.sub)) {\n  netVisual_circle(object.list.sub[[i]]@net$count.merged, weight.scale = T,\n                   label.edge= T, edge.weight.max = weight.max[3], \n                   edge.width.max = 12,\n                   title.name = paste0(\"Number of interactions - \",\n                                       names(object.list.sub)[i]))\n}\n\n\n\n\n\n\nchanges in signaling of subsets\n\nnum.link &lt;- sapply(object.list, function(x) {rowSums(x@net$count) + \n    colSums(x@net$count)-diag(x@net$count)})\nweight.MinMax &lt;- c(min(num.link), max(num.link)) \n\ngg &lt;- list()\nfor (i in 1:length(object.list)) {\n  gg[[i]] &lt;- netAnalysis_signalingRole_scatter(object.list[[i]],\n                                               title = names(object.list)[i], weight.MinMax = weight.MinMax)\n}\npatchwork::wrap_plots(plots = gg)\n\n\n\ngg1 &lt;- netAnalysis_signalingChanges_scatter(cellchat.merge,\n                                            idents.use = \"PI16+RC\")\ngg2 &lt;- netAnalysis_signalingChanges_scatter(cellchat.merge,\n                                            idents.use = \"PRC1\")\ngg3 &lt;- netAnalysis_signalingChanges_scatter(cellchat.merge,\n                                            idents.use = \"ACTA2+PRC\")\ngg1\n\n\n\ngg2\n\n\n\ngg3\n\n\n\n\n\n\nsignaling pathways between cond\n\ncellchat.merge &lt;- computeNetSimilarityPairwise(cellchat.merge, type = \"functional\")\n\nCompute signaling network similarity for datasets 1 2 \n\ncellchat.merge &lt;- netEmbedding(cellchat.merge, type = \"functional\", umap.method = \"uwot\")\n\nManifold learning of the signaling networks for datasets 1 2 \n\ncellchat.merge &lt;- netClustering(cellchat.merge, type = \"functional\", do.parallel = F)\n\nClassification learning of the signaling networks for datasets 1 2 \n\nnetVisual_embeddingPairwise(cellchat.merge, type = \"functional\", label.size = 2,\n                            top.label=100)\n\n2D visualization of signaling networks from datasets 1 2 \n\n\n\n\ncellchat.merge &lt;- computeNetSimilarityPairwise(cellchat.merge, type = \"structural\")\n\nCompute signaling network similarity for datasets 1 2 \n\ncellchat.merge &lt;- netEmbedding(cellchat.merge, type = \"structural\", umap.method = \"uwot\")\n\nManifold learning of the signaling networks for datasets 1 2 \n\ncellchat.merge &lt;- netClustering(cellchat.merge, type = \"structural\", do.parallel = F)\n\nClassification learning of the signaling networks for datasets 1 2 \n\nnetVisual_embeddingPairwise(cellchat.merge, type = \"structural\", label.size = 2)\n\n2D visualization of signaling networks from datasets 1 2 \n\n\n\n\nrankSimilarity(cellchat.merge, type = \"functional\")\n\nCompute the distance of signaling networks between datasets 1 2 \n\n\n\n\n\n\n\ndiff usage of PW\n\ngg1 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = TRUE)\ngg2 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = F, do.stat = TRUE)\ngg1\n\n\n\ngg2\n\n\n\n\n\n\nin out signalling\n\ni = 1\npathway.union &lt;- union(object.list[[i]]@netP$pathways, object.list[[i+1]]@netP$pathways)\nht1 = netAnalysis_signalingRole_heatmap(object.list[[i]], pattern = \"outgoing\", signaling = pathway.union, title = names(object.list)[i], width = 12, height = 26)\nht2 = netAnalysis_signalingRole_heatmap(object.list[[i+1]], pattern = \"outgoing\", signaling = pathway.union, title = names(object.list)[i+1], width = 12, height = 26)\ndraw(ht1 + ht2, ht_gap = unit(0.5, \"cm\"))\n\n\n\nht1 = netAnalysis_signalingRole_heatmap(object.list[[i]], pattern = \"incoming\", signaling = pathway.union, title = names(object.list)[i], width = 12, height = 26, color.heatmap = \"GnBu\")\nht2 = netAnalysis_signalingRole_heatmap(object.list[[i+1]], pattern = \"incoming\", signaling = pathway.union, title = names(object.list)[i+1], width = 12, height = 26, color.heatmap = \"GnBu\")\ndraw(ht1 + ht2, ht_gap = unit(0.5, \"cm\"))\n\n\n\n\n\n\nR L pairs\n\nvis exp of RL pairs\n\nnetVisual_bubble(cellchat.merge, sources.use = \"PI16+RC\",\n                 targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                 comparison = c(1, 2), angle.x = 45)\n\n\n\nnetVisual_bubble(cellchat.merge, sources.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                 targets.use = \"PI16+RC\",\n                 comparison = c(1, 2), angle.x = 45)\n\n\n\nnetVisual_bubble(cellchat.merge, sources.use = \"PRC1\",\n                 targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                 comparison = c(1, 2), angle.x = 45)\n\n\n\nnetVisual_bubble(cellchat.merge, sources.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                 targets.use = \"PRC1\",\n                 comparison = c(1, 2), angle.x = 45)\n\n\n\nnetVisual_bubble(cellchat.merge, sources.use = \"ACTA2+PRC\",\n                 targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                 comparison = c(1, 2), angle.x = 45)\n\n\n\nnetVisual_bubble(cellchat.merge, sources.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                 targets.use = \"ACTA2+PRC\",\n                 comparison = c(1, 2), angle.x = 45)\n\n\n\n\n\n\nvis exp of diff RL pairs\n\n##### ----------------- FRC to immune cells ------------------- ######\n\ngg1 &lt;- netVisual_bubble(cellchat.merge, sources.use = \"PI16+RC\",\n                        targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"), \n                        comparison = c(1, 2), max.dataset = 2,\n                        title.name = \"Increased signaling in resting\", angle.x = 45,\n                        remove.isolate = T)\ngg2 &lt;- netVisual_bubble(cellchat.merge, sources.use = \"PI16+RC\",\n                        targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                        comparison = c(1, 2), max.dataset = 1,\n                        title.name = \"Increased signaling in activated\", angle.x = 45,\n                        remove.isolate = T)\ngg1 + gg2\n\n\n\ngg1 &lt;- netVisual_bubble(cellchat.merge, sources.use = \"PRC1\",\n                        targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"), \n                        comparison = c(1, 2), max.dataset = 2,\n                        title.name = \"Increased signaling in resting\", angle.x = 45,\n                        remove.isolate = T)\ngg2 &lt;- netVisual_bubble(cellchat.merge, sources.use = \"PRC1\",\n                        targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                        comparison = c(1, 2), max.dataset = 1,\n                        title.name = \"Increased signaling in activated\", angle.x = 45,\n                        remove.isolate = T)\ngg1 + gg2\n\n\n\ngg1 &lt;- netVisual_bubble(cellchat.merge, sources.use = \"ACTA2+PRC\",\n                        targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"), \n                        comparison = c(1, 2), max.dataset = 2,\n                        title.name = \"Increased signaling in resting\", angle.x = 45,\n                        remove.isolate = T)\ngg2 &lt;- netVisual_bubble(cellchat.merge, sources.use = \"ACTA2+PRC\",\n                        targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                        comparison = c(1, 2), max.dataset = 1,\n                        title.name = \"Increased signaling in activated\", angle.x = 45,\n                        remove.isolate = T)\ngg1 + gg2\n\n\n\n##### ----------------- Immune cells to FRCs ------------------- ######\n\ngg1 &lt;- netVisual_bubble(cellchat.merge, sources.use = c(\"CD4T\", \"CTL/NKcell\",\n                                                        \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                        targets.use = \"PI16+RC\", \n                        comparison = c(1, 2), max.dataset = 2,\n                        title.name = \"Increased signaling in resting\", angle.x = 45,\n                        remove.isolate = T)\ngg2 &lt;- netVisual_bubble(cellchat.merge, sources.use = c(\"CD4T\", \"CTL/NKcell\",\n                                                        \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                        targets.use = \"PI16+RC\",\n                        comparison = c(1, 2), max.dataset = 1,\n                        title.name = \"Increased signaling in activated\", angle.x = 45,\n                        remove.isolate = T)\ngg1 + gg2\n\n\n\ngg1 &lt;- netVisual_bubble(cellchat.merge, sources.use = c(\"CD4T\", \"CTL/NKcell\",\n                                                        \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                        targets.use = \"PRC1\", \n                        comparison = c(1, 2), max.dataset = 2,\n                        title.name = \"Increased signaling in resting\", angle.x = 45,\n                        remove.isolate = T)\ngg2 &lt;- netVisual_bubble(cellchat.merge, sources.use = c(\"CD4T\", \"CTL/NKcell\",\n                                                        \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                        targets.use = \"PRC1\",\n                        comparison = c(1, 2), max.dataset = 1,\n                        title.name = \"Increased signaling in activated\", angle.x = 45,\n                        remove.isolate = T)\ngg1 + gg2\n\n\n\ngg1 &lt;- netVisual_bubble(cellchat.merge, sources.use = c(\"CD4T\", \"CTL/NKcell\",\n                                                        \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                        targets.use = \"ACTA2+PRC\", \n                        comparison = c(1, 2), max.dataset = 2,\n                        title.name = \"Increased signaling in resting\", angle.x = 45,\n                        remove.isolate = T)\ngg2 &lt;- netVisual_bubble(cellchat.merge, sources.use = c(\"CD4T\", \"CTL/NKcell\",\n                                                        \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                        targets.use = \"ACTA2+PRC\",\n                        comparison = c(1, 2), max.dataset = 1,\n                        title.name = \"Increased signaling in activated\", angle.x = 45,\n                        remove.isolate = T)\ngg1 + gg2\n\n\n\n\n\n\ndiff RL pairs based on DE genes\n\npos.dataset = \"act\"\nfeatures.name = pos.dataset\ncellchat.merge &lt;- identifyOverExpressedGenes(cellchat.merge,\n                                             group.dataset = \"datasets\",\n                                       pos.dataset = pos.dataset,\n                                       features.name = features.name,\n                                       only.pos = FALSE, thresh.pc = 0.05,\n                                       thresh.fc = 0.05, thresh.p = 1) \nnet &lt;- netMappingDEG(cellchat.merge, features.name = features.name)\nnet.up &lt;- subsetCommunication(cellchat.merge, net = net, datasets = \"act\",\n                              ligand.logFC = 0.05, receptor.logFC = 0.05)\nnet.down &lt;- subsetCommunication(cellchat.merge, net = net, datasets = \"res\",\n                                ligand.logFC = -0.05, receptor.logFC = -0.05)\n\ngene.up &lt;- extractGeneSubsetFromPair(net.up, cellchat.merge)\ngene.down &lt;- extractGeneSubsetFromPair(net.down, cellchat.merge)\n\npairLR.use.up = net.up[, \"interaction_name\", drop = F]\npairLR.use.down = net.down[, \"interaction_name\", drop = F]\n\n##### ----------------- FRCs to immune cells ------------------- ######\n\ngg1 &lt;- netVisual_bubble(cellchat.merge, pairLR.use = pairLR.use.up,\n                        sources.use = \"PI16+RC\",\n                        targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\",\n                                        \"ILC3\", \"naiveB\", \"MBC\", \"plasmaCell\",\n                                        \"CD8Tcm\", \"Mph/DC-1\", \"Mph/DC-2\"),\n                        comparison = c(1, 2),  angle.x = 90, remove.isolate = T,\n                        title.name = paste0(\"Up-regulated signaling in \",\n                                            names(object.list)[1]))\n\n\ngg2 &lt;- netVisual_bubble(cellchat.merge, pairLR.use = pairLR.use.down,\n                        sources.use = \"PI16+RC\",\n                        targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\",\n                                        \"ILC3\", \"naiveB\", \"MBC\", \"plasmaCell\",\n                                        \"CD8Tcm\", \"Mph/DC-1\", \"Mph/DC-2\"),\n                        comparison = c(1, 2),  angle.x = 90, remove.isolate = T,\n                        title.name = paste0(\"Down-regulated signaling in \", \n                                            names(object.list)[1]))\ngg1 + gg2\n\n\n\ngg1 &lt;- netVisual_bubble(cellchat.merge, pairLR.use = pairLR.use.up,\n                        sources.use = \"PRC1\",\n                        targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\",\n                                        \"ILC3\", \"naiveB\", \"MBC\", \"plasmaCell\",\n                                        \"CD8Tcm\", \"Mph/DC-1\", \"Mph/DC-2\"),\n                        comparison = c(1, 2),  angle.x = 90, remove.isolate = T,\n                        title.name = paste0(\"Up-regulated signaling in \",\n                                            names(object.list)[1]))\n\n\ngg2 &lt;- netVisual_bubble(cellchat.merge, pairLR.use = pairLR.use.down,\n                        sources.use = \"PRC1\",\n                        targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\",\n                                        \"ILC3\", \"naiveB\", \"MBC\", \"plasmaCell\",\n                                        \"CD8Tcm\", \"Mph/DC-1\", \"Mph/DC-2\"),\n                        comparison = c(1, 2),  angle.x = 90, remove.isolate = T,\n                        title.name = paste0(\"Down-regulated signaling in \", \n                                            names(object.list)[1]))\ngg1 + gg2\n\n\n\ngg1 &lt;- netVisual_bubble(cellchat.merge, pairLR.use = pairLR.use.up,\n                        sources.use = \"ACTA2+PRC\",\n                        targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\",\n                                        \"ILC3\", \"naiveB\", \"MBC\", \"plasmaCell\",\n                                        \"CD8Tcm\", \"Mph/DC-1\", \"Mph/DC-2\"),\n                        comparison = c(1, 2),  angle.x = 90, remove.isolate = T,\n                        title.name = paste0(\"Up-regulated signaling in \",\n                                            names(object.list)[1]))\n\n\ngg2 &lt;- netVisual_bubble(cellchat.merge, pairLR.use = pairLR.use.down,\n                        sources.use = \"ACTA2+PRC\",\n                        targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\",\n                                        \"ILC3\", \"naiveB\", \"MBC\", \"plasmaCell\",\n                                        \"CD8Tcm\", \"Mph/DC-1\", \"Mph/DC-2\"),\n                        comparison = c(1, 2),  angle.x = 90, remove.isolate = T,\n                        title.name = paste0(\"Down-regulated signaling in \", \n                                            names(object.list)[1]))\ngg1 + gg2\n\n\n\n##### ----------------- Immune cells to FRCs ------------------- ######\n\ngg1 &lt;- netVisual_bubble(cellchat.merge, pairLR.use = pairLR.use.up,\n                        sources.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\",\n                                        \"ILC3\", \"naiveB\", \"MBC\", \"plasmaCell\",\n                                        \"CD8Tcm\",\"Mph/DC-1\", \"Mph/DC-2\"),\n                        targets.use = \"PI16+RC\",\n                        comparison = c(1, 2),  angle.x = 90, remove.isolate = T,\n                        title.name = paste0(\"Up-regulated signaling in \",\n                                            names(object.list)[1]))\n\n\ngg2 &lt;- netVisual_bubble(cellchat.merge, pairLR.use = pairLR.use.down,\n                        sources.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\",\n                                        \"ILC3\", \"naiveB\", \"MBC\", \"plasmaCell\",\n                                        \"CD8Tcm\",\"Mph/DC-1\", \"Mph/DC-2\"),\n                        targets.use = \"PI16+RC\",\n                        comparison = c(1, 2),  angle.x = 90, remove.isolate = T,\n                        title.name = paste0(\"Down-regulated signaling in \", \n                                            names(object.list)[1]))\ngg1 + gg2\n\n\n\ngg1 &lt;- netVisual_bubble(cellchat.merge, pairLR.use = pairLR.use.up,\n                        sources.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\",\n                                        \"ILC3\", \"naiveB\", \"MBC\", \"plasmaCell\",\n                                        \"CD8Tcm\",\"Mph/DC-1\", \"Mph/DC-2\"),\n                        targets.use = \"PRC1\",\n                        comparison = c(1, 2),  angle.x = 90, remove.isolate = T,\n                        title.name = paste0(\"Up-regulated signaling in \",\n                                            names(object.list)[1]))\n\n\ngg2 &lt;- netVisual_bubble(cellchat.merge, pairLR.use = pairLR.use.down,\n                        sources.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\",\n                                        \"ILC3\", \"naiveB\", \"MBC\", \"plasmaCell\",\n                                        \"CD8Tcm\",\"Mph/DC-1\", \"Mph/DC-2\"),\n                        targets.use = \"PRC1\",\n                        comparison = c(1, 2),  angle.x = 90, remove.isolate = T,\n                        title.name = paste0(\"Down-regulated signaling in \", \n                                            names(object.list)[1]))\ngg1 + gg2\n\n\n\ngg1 &lt;- netVisual_bubble(cellchat.merge, pairLR.use = pairLR.use.up,\n                        sources.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\",\n                                        \"ILC3\", \"naiveB\", \"MBC\", \"plasmaCell\",\n                                        \"CD8Tcm\",\"Mph/DC-1\", \"Mph/DC-2\"),\n                        targets.use = \"ACTA2+PRC\",\n                        comparison = c(1, 2),  angle.x = 90, remove.isolate = T,\n                        title.name = paste0(\"Up-regulated signaling in \",\n                                            names(object.list)[1]))\n\n\ngg2 &lt;- netVisual_bubble(cellchat.merge, pairLR.use = pairLR.use.down,\n                        sources.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\",\n                                        \"ILC3\", \"naiveB\", \"MBC\", \"plasmaCell\",\n                                        \"CD8Tcm\",\"Mph/DC-1\", \"Mph/DC-2\"),\n                        targets.use = \"ACTA2+PRC\",\n                        comparison = c(1, 2),  angle.x = 90, remove.isolate = T,\n                        title.name = paste0(\"Down-regulated signaling in \", \n                                            names(object.list)[1]))\ngg1 + gg2"
  },
  {
    "objectID": "analysis/runCellchat_act_vs_res.html#save-cellchat-objects",
    "href": "analysis/runCellchat_act_vs_res.html#save-cellchat-objects",
    "title": "run cellchat scRNAseq data human LN",
    "section": "save cellchat objects",
    "text": "save cellchat objects\n\nsaveRDS(cellchat.merge, file = paste0(basedir, \"/data/cellchat/FRCplusImmune_\",\n                                      \"resPlusActMerge_cellchat.rds\"))\n\nsaveRDS(cellchat.res, file = paste0(basedir, \"/data/cellchat/FRCplusImmune_\",\n                                      \"resOnly_cellchat.rds\"))\n\nsaveRDS(cellchat.act, file = paste0(basedir, \"/data/cellchat/FRCplusImmune_\",\n                                      \"actOnly_cellchat.rds\"))"
  },
  {
    "objectID": "analysis/runCellchat_act_vs_res.html#session-info",
    "href": "analysis/runCellchat_act_vs_res.html#session-info",
    "title": "run cellchat scRNAseq data human LN",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] grid      stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] ComplexHeatmap_2.16.0       patchwork_1.2.0             CellChat_1.6.1             \n [4] igraph_2.0.2                scran_1.28.2                scater_1.28.0              \n [7] scuttle_1.10.3              SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2\n[10] Biobase_2.60.0              GenomicRanges_1.52.1        GenomeInfoDb_1.36.4        \n[13] IRanges_2.36.0              S4Vectors_0.40.1            BiocGenerics_0.48.0        \n[16] MatrixGenerics_1.12.3       matrixStats_1.2.0           pheatmap_1.0.12            \n[19] ggsci_3.0.0                 here_1.0.1                  runSeurat3_0.1.0           \n[22] ggpubr_0.6.0                lubridate_1.9.3             forcats_1.0.0              \n[25] stringr_1.5.1               readr_2.1.5                 tidyr_1.3.1                \n[28] tibble_3.2.1                tidyverse_2.0.0             Seurat_5.0.1               \n[31] SeuratObject_5.0.1          sp_2.1-3                    purrr_1.0.2                \n[34] ggplot2_3.4.4               reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] spatstat.sparse_3.0-3     bitops_1.0-7              httr_1.4.7               \n  [4] RColorBrewer_1.1-3        doParallel_1.0.17         tools_4.3.0              \n  [7] sctransform_0.4.1         backports_1.4.1           utf8_1.2.4               \n [10] R6_2.5.1                  lazyeval_0.2.2            uwot_0.1.16              \n [13] GetoptLong_1.0.5          withr_3.0.0               gridExtra_2.3            \n [16] progressr_0.14.0          textshaping_0.3.7         cli_3.6.2                \n [19] Cairo_1.6-2               spatstat.explore_3.2-6    fastDummies_1.7.3        \n [22] network_1.18.2            labeling_0.4.3            spatstat.data_3.0-4      \n [25] ggridges_0.5.6            pbapply_1.7-2             systemfonts_1.0.5        \n [28] svglite_2.1.3             parallelly_1.37.0         limma_3.56.2             \n [31] rstudioapi_0.15.0         FNN_1.1.4                 generics_0.1.3           \n [34] shape_1.4.6               ica_1.0-3                 spatstat.random_3.2-2    \n [37] car_3.1-2                 Matrix_1.6-5              ggbeeswarm_0.7.2         \n [40] fansi_1.0.6               abind_1.4-5               lifecycle_1.0.4          \n [43] yaml_2.3.8                edgeR_3.42.4              carData_3.0-5            \n [46] Rtsne_0.17                promises_1.2.1            dqrng_0.3.2              \n [49] crayon_1.5.2              miniUI_0.1.1.1            lattice_0.22-5           \n [52] beachmat_2.16.0           cowplot_1.1.3             magick_2.8.3             \n [55] sna_2.7-2                 pillar_1.9.0              knitr_1.45               \n [58] metapod_1.8.0             rjson_0.2.21              future.apply_1.11.1      \n [61] codetools_0.2-19          leiden_0.4.3.1            glue_1.7.0               \n [64] data.table_1.15.0         vctrs_0.6.5               png_0.1-8                \n [67] spam_2.10-0               gtable_0.3.4              xfun_0.42                \n [70] S4Arrays_1.0.6            mime_0.12                 coda_0.19-4.1            \n [73] survival_3.5-8            iterators_1.0.14          statmod_1.5.0            \n [76] bluster_1.10.0            ellipsis_0.3.2            fitdistrplus_1.1-11      \n [79] ROCR_1.0-11               nlme_3.1-164              RcppAnnoy_0.0.22         \n [82] rprojroot_2.0.4           irlba_2.3.5.1             vipor_0.4.7              \n [85] KernSmooth_2.23-22        colorspace_2.1-0          tidyselect_1.2.0         \n [88] compiler_4.3.0            BiocNeighbors_1.18.0      DelayedArray_0.26.7      \n [91] plotly_4.10.4             scales_1.3.0              lmtest_0.9-40            \n [94] NMF_0.27                  digest_0.6.34             goftest_1.2-3            \n [97] spatstat.utils_3.0-4      rmarkdown_2.25            XVector_0.40.0           \n[100] htmltools_0.5.7           pkgconfig_2.0.3           sparseMatrixStats_1.12.2 \n[103] fastmap_1.1.1             rlang_1.1.3               GlobalOptions_0.1.2      \n[106] htmlwidgets_1.6.4         shiny_1.8.0               DelayedMatrixStats_1.22.6\n[109] farver_2.1.1              zoo_1.8-12                jsonlite_1.8.8           \n[112] statnet.common_4.9.0      BiocParallel_1.34.2       BiocSingular_1.16.0      \n[115] RCurl_1.98-1.14           magrittr_2.0.3            ggnetwork_0.5.13         \n[118] GenomeInfoDbData_1.2.10   dotCall64_1.1-1           munsell_0.5.0            \n[121] Rcpp_1.0.12               viridis_0.6.5             reticulate_1.35.0        \n[124] stringi_1.8.3             ggalluvial_0.12.5         zlibbioc_1.46.0          \n[127] MASS_7.3-60.0.1           plyr_1.8.9                parallel_4.3.0           \n[130] listenv_0.9.1             ggrepel_0.9.5             deldir_2.0-2             \n[133] splines_4.3.0             tensor_1.5                hms_1.1.3                \n[136] circlize_0.4.16           locfit_1.5-9.8            spatstat.geom_3.2-8      \n[139] ggsignif_0.6.4            RcppHNSW_0.6.0            rngtools_1.5.2           \n[142] ScaledMatrix_1.8.1        evaluate_0.23             tzdb_0.4.0               \n[145] foreach_1.5.2             httpuv_1.6.14             RANN_2.6.1               \n[148] polyclip_1.10-6           future_1.33.1             clue_0.3-65              \n[151] scattermore_1.2           gridBase_0.4-7            rsvd_1.0.5               \n[154] broom_1.0.5               xtable_1.8-4              RSpectra_0.16-1          \n[157] rstatix_0.7.2             later_1.3.2               ragg_1.2.7               \n[160] viridisLite_0.4.2         beeswarm_0.4.0            registry_0.5-1           \n[163] cluster_2.1.6             timechange_0.3.0          globals_0.16.2           \n\ndate()\n\n[1] \"Wed Mar  6 15:38:58 2024\""
  },
  {
    "objectID": "analysis/runCellchat_act_vs_res_PI16.html",
    "href": "analysis/runCellchat_act_vs_res_PI16.html",
    "title": "run cellchat scRNAseq data on PI16+RC",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n  library(SingleCellExperiment)\n  library(scran)\n  library(CellChat)\n  library(patchwork)\n  library(ComplexHeatmap)\n})"
  },
  {
    "objectID": "analysis/runCellchat_act_vs_res_PI16.html#load-packages",
    "href": "analysis/runCellchat_act_vs_res_PI16.html#load-packages",
    "title": "run cellchat scRNAseq data on PI16+RC",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n  library(SingleCellExperiment)\n  library(scran)\n  library(CellChat)\n  library(patchwork)\n  library(ComplexHeatmap)\n})"
  },
  {
    "objectID": "analysis/runCellchat_act_vs_res_PI16.html#load-seurat-object",
    "href": "analysis/runCellchat_act_vs_res_PI16.html#load-seurat-object",
    "title": "run cellchat scRNAseq data on PI16+RC",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\nseuratFRC &lt;- readRDS(file= paste0(basedir,\n                            \"/data/AllPatWithoutCM_FRConly_intOrig\", \n                            \"_seurat.rds\"))\nseuratIMM &lt;- readRDS(file= paste0(basedir,\n                            \"/data/AllPatWithoutCM_IMMMerged_integrated_label\",\n                       \"_seurat.rds\"))\n\n## add label FRCs\nseuratFRC$label &lt;- \"medRCIFRC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"7\")] &lt;- \"BRC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"2\")] &lt;- \"TRC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"3\")] &lt;- \"ACTA2+PRC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"4\")] &lt;- \"VSMC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"5\")] &lt;- \"PI16+RC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"6\")] &lt;- \"PRC1\"\n\nseuratFRC$cond2 &lt;- seuratFRC$cond\nseuratFRC$cond2[which(seuratFRC$cond %in% c(\"acute\", \"chronic\"))] &lt;- \"activated\"\n\n## group imm cells\nseuratIMM$label2 &lt;- seuratIMM$label\nseuratIMM$label &lt;- as.character(seuratIMM$label)\nseuratIMM$label[which(seuratIMM$label %in% c(\"naiveCD4-2\", \"naiveCD4-3\",\n                                             \"naiveCD4-1\", \"Treg\" ))] &lt;- \"CD4T\"\nseuratIMM$label[which(seuratIMM$label %in% c(\"pDC-2\", \"pDC-1\" ))] &lt;- \"pDC\"\nseuratIMM$label[which(seuratIMM$label %in% c(\"naiveB\", \"preB\" ))] &lt;- \"naiveB\"\n\n\nseurat &lt;- merge(seuratFRC, c(seuratIMM))\nseurat$label_plus_cond &lt;- paste0(seurat$label, \"_\", seurat$cond2)\ntable(seurat$label_plus_cond)\n\n\n ACTA2+PRC_activated    ACTA2+PRC_resting        BRC_activated          BRC_resting \n                4244                 1560                 1487                  390 \n      CD4T_activated         CD4T_resting     CD8Tcm_activated       CD8Tcm_resting \n               38543                39380                 6234                 4006 \nCTL/NKcell_activated   CTL/NKcell_resting        GCB_activated          GCB_resting \n                4129                10339                  687                  869 \n      ILC3_activated         ILC3_resting        MBC_activated          MBC_resting \n                  79                 1819                10732                17174 \n medRCIFRC_activated    medRCIFRC_resting   Mph/DC-1_activated     Mph/DC-1_resting \n               10342                10129                  118                 2952 \n  Mph/DC-2_activated     Mph/DC-2_resting     naiveB_activated       naiveB_resting \n                 157                  980                 8295                14118 \n       pDC_activated          pDC_resting    PI16+RC_activated      PI16+RC_resting \n                 558                 6750                 1917                  986 \nplasmaCell_activated   plasmaCell_resting       PRC1_activated         PRC1_resting \n                  53                  326                 1528                  760 \n       TRC_activated          TRC_resting       VSMC_activated         VSMC_resting \n                3164                 3773                 2767                  724 \n\nIdents(seurat) &lt;- seurat$label_plus_cond\nseurat &lt;- subset(x = seurat, downsample = 500)\ntable(seurat$label_plus_cond)\n\n\n ACTA2+PRC_activated    ACTA2+PRC_resting        BRC_activated          BRC_resting \n                 500                  500                  500                  390 \n      CD4T_activated         CD4T_resting     CD8Tcm_activated       CD8Tcm_resting \n                 500                  500                  500                  500 \nCTL/NKcell_activated   CTL/NKcell_resting        GCB_activated          GCB_resting \n                 500                  500                  500                  500 \n      ILC3_activated         ILC3_resting        MBC_activated          MBC_resting \n                  79                  500                  500                  500 \n medRCIFRC_activated    medRCIFRC_resting   Mph/DC-1_activated     Mph/DC-1_resting \n                 500                  500                  118                  500 \n  Mph/DC-2_activated     Mph/DC-2_resting     naiveB_activated       naiveB_resting \n                 157                  500                  500                  500 \n       pDC_activated          pDC_resting    PI16+RC_activated      PI16+RC_resting \n                 500                  500                  500                  500 \nplasmaCell_activated   plasmaCell_resting       PRC1_activated         PRC1_resting \n                  53                  326                  500                  500 \n       TRC_activated          TRC_resting       VSMC_activated         VSMC_resting \n                 500                  500                  500                  500 \n\ntable(seurat$patient)\n\n\nP_20200220 P_20200722 P_20200909 P_20210113 P_20210224 P_20220201 P_20220202     ucd010      ucd13 \n      1482        600       1282       1925       1474       2251       2658       1939       1046 \n     ucd14 \n      1466 \n\ndim(seurat)\n\n[1] 39642 16123\n\nremove(seuratIMM, seuratFRC)\nseurat &lt;- NormalizeData(object = seurat)\nseurat &lt;- FindVariableFeatures(object = seurat)\nseurat &lt;- ScaleData(object = seurat, verbose = FALSE)\nseurat &lt;- RunPCA(object = seurat, npcs = 30, verbose = FALSE)\nseurat &lt;- RunTSNE(object = seurat, reduction = \"pca\", dims = 1:20)\nseurat &lt;- RunUMAP(object = seurat, reduction = \"pca\", dims = 1:20)"
  },
  {
    "objectID": "analysis/runCellchat_act_vs_res_PI16.html#set-color-palettes",
    "href": "analysis/runCellchat_act_vs_res_PI16.html#set-color-palettes",
    "title": "run cellchat scRNAseq data on PI16+RC",
    "section": "set color palettes",
    "text": "set color palettes\n\ncolFRC &lt;- c(\"#800000FF\", \"#FFA319FF\",\"#8A9045FF\", \"#155F83FF\",\n            \"#C16622FF\", \"#6692a3\", \"#3b7f60\")\nnames(colFRC) &lt;- c(\"medRCIFRC\", \"TRC\", \"ACTA2+PRC\", \"VSMC\", \"PI16+RC\", \"PRC1\",\n                   \"BRC\")\n\n\ncolImm &lt;- c(\"#0b6647\", \"#54907e\", \"#94c78a\", \"#6f9568\", \n            \"#8f2810\", \"#d0ac21\",\"#9e9f0b\", \"#486584\",\n            \"#4b5397\", \"#8873d3\", \"#6e3e7a\")\n            \nnames(colImm) &lt;- c(\"naiveB\", \"GCB\", \"MBC\", \"plasmaCell\",\n                   \"CD4T\", \"CD8Tcm\", \"CTL/NKcell\", \"ILC3\", \"pDC\", \n                   \"Mph/DC-1\", \"Mph/DC-2\")\n\ncolAll &lt;- c(colFRC, colImm) \n\ncolPal &lt;- c(pal_uchicago()(6), \"#6692a3\", \"#3b7f60\")\nnames(colPal) &lt;- c(\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\")\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond) &lt;- unique(seurat$cond)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\ncolCond2 &lt;- c(\"#6692a3\",\"#971c1c\")\nnames(colCond2) &lt;- c(\"resting\", \"activated\")"
  },
  {
    "objectID": "analysis/runCellchat_act_vs_res_PI16.html#visualize-data",
    "href": "analysis/runCellchat_act_vs_res_PI16.html#visualize-data",
    "title": "run cellchat scRNAseq data on PI16+RC",
    "section": "visualize data",
    "text": "visualize data\n\nlabel\n\nDimPlot(seurat, reduction = \"umap\", cols=colAll, group.by = \"label\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\ncond2\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/runCellchat_act_vs_res_PI16.html#load-cellchat-object",
    "href": "analysis/runCellchat_act_vs_res_PI16.html#load-cellchat-object",
    "title": "run cellchat scRNAseq data on PI16+RC",
    "section": "load cellchat object",
    "text": "load cellchat object\n\ncellchat.merge &lt;- readRDS(file = paste0(basedir,\"/data/cellchat/FRCplusImmune_\",\n                                      \"resPlusActMerge_cellchat.rds\"))\n\ncellchat.res &lt;- readRDS(file = paste0(basedir, \"/data/cellchat/FRCplusImmune_\",\n                                      \"resOnly_cellchat.rds\"))\n\ncellchat.act &lt;- readRDS(file = paste0(basedir, \"/data/cellchat/FRCplusImmune_\",\n                                      \"actOnly_cellchat.rds\"))\nobject.list &lt;- list(act = cellchat.act, res = cellchat.res)\n\n\ncompare interaction counts/strength\n\ncolCond3 &lt;- colCond2\nnames(colCond3) &lt;- c(\"res\", \"act\")\ngg1 &lt;- compareInteractions(cellchat.merge, show.legend = F,\n                           group = c(\"act\",\"res\")) + \n  scale_fill_manual(values = colCond3)\ngg2 &lt;- compareInteractions(cellchat.merge, show.legend = F, \n                           group = c(\"act\",\"res\"), measure = \"weight\") + \n  scale_fill_manual(values = colCond3)\ngg1 + gg2\n\n\n\nnetVisual_diffInteraction(cellchat.merge, weight.scale = T)\n\n\n\nnetVisual_diffInteraction(cellchat.merge, weight.scale = T, measure = \"weight\")\n\n\n\ngg1 &lt;- netVisual_heatmap(cellchat.merge)\ngg2 &lt;- netVisual_heatmap(cellchat.merge, measure = \"weight\")\ngg1 + gg2\n\n\n\npar(mfrow = c(1,2), xpd=TRUE)\nfor(i in 1:length(colCond3)) {\n  groupSize &lt;- as.numeric(table(cellchat.merge@idents[i])[c(\"PI16+RC\",names(colImm))])\n  matPre &lt;- cellchat.merge@net[[i]]$weight\n  mat &lt;- matPre[c(\"PI16+RC\",names(colImm)), c(\"PI16+RC\",names(colImm))] \n  mat2 &lt;- matrix(0, nrow = nrow(mat), ncol = ncol(mat), dimnames = dimnames(mat))\n  mat2[\"PI16+RC\", ] &lt;- mat[\"PI16+RC\", ]\n  netVisual_circle(mat2, vertex.weight = groupSize, weight.scale = T,\n                   edge.weight.max = max(mat), title.name = names(colCond3)[i],\n                   color.use = colAll[c(\"PI16+RC\",names(colImm))])\n}\n\n\n\npar(mfrow = c(1,2), xpd=TRUE)\nfor(i in 1:length(colCond3)) {\n  groupSize &lt;- as.numeric(table(cellchat.merge@idents[i])[c(\"PI16+RC\",names(colImm))])\n  matPre &lt;- cellchat.merge@net[[i]]$count\n  mat &lt;- matPre[c(\"PI16+RC\",names(colImm)), c(\"PI16+RC\",names(colImm))] \n  mat2 &lt;- matrix(0, nrow = nrow(mat), ncol = ncol(mat), dimnames = dimnames(mat))\n  mat2[\"PI16+RC\", ] &lt;- mat[\"PI16+RC\", ]\n  netVisual_circle(mat2, vertex.weight = groupSize, weight.scale = T,\n                   edge.weight.max = max(mat), title.name = names(colCond3)[i],\n                   color.use = colAll[c(\"PI16+RC\",names(colImm))])\n}\n\n\n\n\n\n\nchanges in signaling of subsets\n\nnum.link &lt;- sapply(object.list, function(x) {rowSums(x@net$count) + \n    colSums(x@net$count)-diag(x@net$count)})\nweight.MinMax &lt;- c(min(num.link), max(num.link)) \n\ngg &lt;- list()\nfor (i in 1:length(object.list)) {\n  gg[[i]] &lt;- netAnalysis_signalingRole_scatter(object.list[[i]],\n                                               title = names(object.list)[i],\n                                               weight.MinMax = weight.MinMax)\n}\npatchwork::wrap_plots(plots = gg)\n\n\n\ngg &lt;- list()\nfor (i in 1:length(object.list)) {\n  object.list[[i]] &lt;- netAnalysis_computeCentrality(object.list[[i]], slot.name = \"net\")\n  gg[[i]] &lt;- netAnalysis_signalingRole_scatter(object.list[[i]],\n                                               title = names(object.list)[i],\n                                               weight.MinMax = weight.MinMax,\n                                               slot.name = \"net\")\n}\npatchwork::wrap_plots(plots = gg)\n\n\n\ngg1 &lt;- netAnalysis_signalingChanges_scatter(cellchat.merge,\n                                            idents.use = \"PI16+RC\")\ngg1\n\n\n\ngg1 &lt;- netAnalysis_signalingChanges_scatter(cellchat.merge,\n                                            idents.use = \"PI16+RC\",\n                                            xlims = c(-0.01, 0.001),\n                                            ylims = c(-0.01, 0.001),\n                                            top.label=1)\ngg1\n\n\n\n\n\n\nsignaling pathways between cond\n\nnetVisual_embeddingPairwise(cellchat.merge, type = \"functional\", label.size = 2,\n                            top.label=100)\n\n2D visualization of signaling networks from datasets 1 2 \n\n\n\n\nnetVisual_embeddingPairwise(cellchat.merge, type = \"structural\", label.size = 2)\n\n2D visualization of signaling networks from datasets 1 2 \n\n\n\n\nrankSimilarity(cellchat.merge, type = \"functional\")\n\nCompute the distance of signaling networks between datasets 1 2 \n\n\n\n\n\n\n\ndiff usage of PW PI16+ to imm cells\n\ngg1 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = TRUE,\n               color.use = colCond3, measure = \"weight\",\n               sources.use = \"PI16+RC\", targets.use = c(names(colImm)))\ngg3 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = TRUE,\n               color.use = colCond3, measure = \"count\",\n               sources.use = \"PI16+RC\", targets.use = c(names(colImm)))\ngg2 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = F, do.stat = TRUE,\n               color.use = colCond3,\n               sources.use = \"PI16+RC\", targets.use = c(names(colImm)))\ngg4 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = F, do.stat = TRUE,\n               color.use = colCond3, measure = \"count\",\n               sources.use = \"PI16+RC\", targets.use = c(names(colImm)))\ngg1\n\n\n\ngg2\n\n\n\ngg3\n\n\n\ngg4\n\n\n\n\n\n\nIF filtered for top PW PI16 to IMM\n\n## Information flow based on interaction strength\nIFweight &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = TRUE,\n               color.use = colCond3, measure = \"weight\", return.data = T,\n               sources.use = \"PI16+RC\", targets.use = c(names(colImm)))\n\n### filter for Sign PW with IF sign diff and top 10 scaled contribution\nIFweightFilAct &lt;- IFweight$signaling.contribution %&gt;% \n  filter(pvalues &lt; 0.01 & contribution.relative.1 &lt; 1 & group == \"act\") %&gt;% \n  slice_max(order_by = contribution.scaled, n = 10)\n\nIFweightFilRes &lt;- IFweight$signaling.contribution %&gt;% \n  filter(pvalues &lt; 0.01 & contribution.relative.1 &gt; 1 & group == \"res\") %&gt;% \n  slice_max(order_by = contribution.scaled, n = 10)\n\n### filter for Sign PW with IF sign diff and top rel contribution\nIFweightFilAct2 &lt;- IFweight$signaling.contribution %&gt;% \n  filter(pvalues &lt; 0.01 & contribution.relative.1 &lt; 1 & group == \"act\") \n\ngg1 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = F,\n               color.use = colCond3, measure = \"weight\",\n               signaling = c(IFweightFilAct$name, IFweightFilRes$name),\n               sources.use = \"PI16+RC\", targets.use = c(names(colImm)))\ngg2 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = F, do.stat = TRUE,\n               color.use = colCond3, , measure = \"weight\",\n               signaling = c(IFweightFilAct$name, IFweightFilRes$name),\n               sources.use = \"PI16+RC\", targets.use = c(names(colImm)))\ngg3 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = F,\n               color.use = colCond3, measure = \"weight\",\n               signaling = IFweightFilAct2$name,\n               sources.use = \"PI16+RC\", targets.use = c(names(colImm)))\ngg1\n\n\n\ngg2\n\n\n\ngg3\n\n\n\n## Information flow based on interaction counts\nIFcnts &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = TRUE,\n               color.use = colCond3, measure = \"count\", return.data = T,\n               sources.use = \"PI16+RC\", targets.use = c(names(colImm)))\n\n### filter for Sign PW with IF sign diff and top 10 rel contribution\nIFcntsFilAct &lt;- IFcnts$signaling.contribution %&gt;% \n  filter(pvalues &lt; 0.01 & contribution.relative.1 &lt; 1 & group == \"act\") %&gt;% \n  slice_max(order_by = contribution.scaled, n = 10)\n\nIFcntsFilRes &lt;- IFcnts$signaling.contribution %&gt;% \n  filter(pvalues &lt; 0.01 & contribution.relative.1 &gt; 1 & group == \"res\") %&gt;% \n  slice_max(order_by = contribution.scaled, n = 10)\n\n### filter for Sign PW with IF sign diff and top rel contribution\nIFcntsFilAct2 &lt;- IFcnts$signaling.contribution %&gt;% \n  filter(pvalues &lt; 0.01 & contribution.relative.1 &lt; 1 & group == \"act\") %&gt;% \n  slice_min(order_by = contribution.relative.1, n = 10)\n\ngg1 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = F,\n               color.use = colCond3, measure = \"weight\",\n               signaling = c(IFcntsFilAct$name, IFcntsFilRes$name),\n               sources.use = \"PI16+RC\", targets.use = c(names(colImm)))\ngg2 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = F, do.stat = TRUE,\n               color.use = colCond3, measure = \"weight\",\n               signaling = c(IFcntsFilAct$name, IFcntsFilRes$name),\n               sources.use = \"PI16+RC\", targets.use = names(colImm))\ngg3 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = F,\n               color.use = colCond3, measure = \"weight\",\n               signaling = IFcntsFilAct2$name,\n               sources.use = \"PI16+RC\", targets.use = c(names(colImm)))\ngg1\n\n\n\ngg2\n\n\n\ngg3\n\n\n\n\n\nvis exp of RL pairs top PW PI16 to IMM\n\n## filter R-L pairs based on PW\nLRpairDat &lt;- cellchat.merge@LR[[\"act\"]][[\"LRsig\"]] %&gt;%\n  filter(pathway_name %in% IFweightFilAct2$name) %&gt;% \n  dplyr::select(interaction_name)\n\nnetVisual_bubble(cellchat.merge, sources.use = \"PI16+RC\",\n                 targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                 comparison = c(1, 2), angle.x = 45,\n                 pairLR.use = LRpairDat)\n\n\n\nLRint &lt;- netVisual_bubble(cellchat.merge, sources.use = \"PI16+RC\",\n                 targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                 comparison = c(1, 2), angle.x = 45, return.data=T,\n                 pairLR.use = LRpairDat)\n\nLRintFil &lt;- LRint$communication %&gt;%\n  dplyr::select(target, interaction_name, dataset, prob) %&gt;% \n  dplyr::group_by(target, interaction_name,) %&gt;% \n  dplyr::slice(which.max(prob)) %&gt;%\n  ungroup() %&gt;% filter(dataset==\"act\") %&gt;% \n  dplyr::select(interaction_name)\n\nnetVisual_bubble(cellchat.merge, sources.use = \"PI16+RC\",\n                 targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                 comparison = c(1, 2), angle.x = 45,\n                 pairLR.use = LRintFil)\n\n\n\n\n\n\n\ndiff usage of PW imm cells to Pi16\n\ngg1 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = TRUE,\n               color.use = colCond3, measure = \"weight\",\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm),\"PI16+RC\"))\ngg3 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = TRUE,\n               color.use = colCond3, measure = \"count\",\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm),\"PI16+RC\"))\ngg2 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = F, do.stat = TRUE,\n               color.use = colCond3,\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm), \"PI16+RC\"))\ngg4 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = F, do.stat = TRUE,\n               color.use = colCond3, measure = \"count\",\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm), \"PI16+RC\"))\ngg1\n\n\n\ngg2\n\n\n\ngg3\n\n\n\ngg4\n\n\n\n### sources only imm\ngg1 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = TRUE,\n               color.use = colCond3, measure = \"weight\",\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm)))\ngg3 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = TRUE,\n               color.use = colCond3, measure = \"count\",\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm)))\ngg2 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = F, do.stat = TRUE,\n               color.use = colCond3,\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm)))\ngg4 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = F, do.stat = TRUE,\n               color.use = colCond3, measure = \"count\",\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm)))\ngg1\n\n\n\ngg2\n\n\n\ngg3\n\n\n\ngg4\n\n\n\n\n\n\nIF filtered for top PW IMM plus PI16 to PI16\n\n## Information flow based on interaction strength\nIFweight &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = TRUE,\n               color.use = colCond3, measure = \"weight\", return.data = T,\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm), \"PI16+RC\"))\n\n### filter for Sign PW with IF sign diff and top 10 scaled contribution\nIFweightFilAct &lt;- IFweight$signaling.contribution %&gt;% \n  filter(pvalues &lt; 0.01 & contribution.relative.1 &lt; 1 & group == \"act\") %&gt;% \n  slice_max(order_by = contribution.scaled, n = 10)\n\nIFweightFilRes &lt;- IFweight$signaling.contribution %&gt;% \n  filter(pvalues &lt; 0.01 & contribution.relative.1 &gt; 1 & group == \"res\") %&gt;% \n  slice_max(order_by = contribution.scaled, n = 10)\n\n### filter for Sign PW with IF sign diff and top rel contribution\nIFweightFilAct2 &lt;- IFweight$signaling.contribution %&gt;% \n  filter(pvalues &lt; 0.01 & contribution.relative.1 &lt; 1 & group == \"act\") \n\ngg1 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = F,\n               color.use = colCond3, measure = \"weight\",\n               signaling = c(IFweightFilAct$name, IFweightFilRes$name),\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm), \"PI16+RC\"))\ngg2 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = F, do.stat = TRUE,\n               color.use = colCond3, measure = \"weight\",\n               signaling = c(IFweightFilAct$name, IFweightFilRes$name),\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm), \"PI16+RC\"))\ngg3 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = F,\n               color.use = colCond3, measure = \"weight\",\n               signaling = IFweightFilAct2$name,\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm), \"PI16+RC\"))\ngg1\n\n\n\ngg2\n\n\n\ngg3\n\n\n\n## Information flow based on interaction counts\nIFcnts &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = TRUE,\n               color.use = colCond3, measure = \"count\", return.data = T,\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm), \"PI16+RC\"))\n\n### filter for Sign PW with IF sign diff and top 10 rel contribution\nIFcntsFilAct &lt;- IFcnts$signaling.contribution %&gt;% \n  filter(pvalues &lt; 0.01 & contribution.relative.1 &lt; 1 & group == \"act\") %&gt;% \n  slice_max(order_by = contribution.scaled, n = 10)\n\nIFcntsFilRes &lt;- IFcnts$signaling.contribution %&gt;% \n  filter(pvalues &lt; 0.01 & contribution.relative.1 &gt; 1 & group == \"res\") %&gt;% \n  slice_max(order_by = contribution.scaled, n = 10)\n\n### filter for Sign PW with IF sign diff and top rel contribution\nIFcntsFilAct2 &lt;- IFcnts$signaling.contribution %&gt;% \n  filter(pvalues &lt; 0.01 & contribution.relative.1 &lt; 1 & group == \"act\") %&gt;% \n  slice_min(order_by = contribution.relative.1, n = 10)\n\ngg1 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = F,\n               color.use = colCond3, measure = \"weight\",\n               signaling = c(IFcntsFilAct$name, IFcntsFilRes$name),\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm), \"PI16+RC\"))\ngg2 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = F, do.stat = TRUE,\n               color.use = colCond3, measure = \"weight\",\n               signaling = c(IFcntsFilAct$name, IFcntsFilRes$name),\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm), \"PI16+RC\"))\ngg3 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = F,\n               color.use = colCond3, measure = \"weight\",\n               signaling = IFcntsFilAct2$name,\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm), \"PI16+RC\"))\ngg1\n\n\n\ngg2\n\n\n\ngg3\n\n\n\n\n\nvis exp of RL pairs top PW IMM plus PI16 to PI16\n\n## filter R-L pairs based on PW\nLRpairDat &lt;- cellchat.merge@LR[[\"act\"]][[\"LRsig\"]] %&gt;%\n  filter(pathway_name %in% IFweightFilAct2$name) %&gt;% \n  dplyr::select(interaction_name)\n\nnetVisual_bubble(cellchat.merge, \n                 targets.use = \"PI16+RC\",\n                 sources.use = c(names(colImm), \"PI16+RC\"),\n                 comparison = c(1, 2), angle.x = 45,\n                 pairLR.use = LRpairDat)\n\n\n\nLRint &lt;- netVisual_bubble(cellchat.merge, targets.use = \"PI16+RC\", \n                          sources.use = c(names(colImm), \"PI16+RC\"),\n                 comparison = c(1, 2), angle.x = 45, return.data=T,\n                 pairLR.use = LRpairDat)\n\nLRintFil &lt;- LRint$communication %&gt;%\n  dplyr::select(target, interaction_name, dataset, prob) %&gt;% \n  dplyr::group_by(target, interaction_name,) %&gt;% \n  dplyr::slice(which.max(prob)) %&gt;%\n  ungroup() %&gt;% filter(dataset==\"act\") %&gt;% \n  dplyr::select(interaction_name)\n\nnetVisual_bubble(cellchat.merge, targets.use = \"PI16+RC\",\n                 sources.use = c(names(colImm), \"PI16+RC\"),\n                 comparison = c(1, 2), angle.x = 45,\n                 pairLR.use = LRintFil)\n\n\n\n\n\n\n\nIF filtered for top PW IMM to PI16\n\n## Information flow based on interaction strength\nIFweight &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = TRUE,\n               color.use = colCond3, measure = \"weight\", return.data = T,\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm)))\n\n\n### filter for Sign PW with IF sign diff and top rel contribution\nIFweightFilAct2 &lt;- IFweight$signaling.contribution %&gt;% \n  filter(pvalues &lt; 0.01 & contribution.relative.1 &lt; 1 & group == \"act\") \n\ngg3 &lt;- rankNet(cellchat.merge, mode = \"comparison\", stacked = T, do.stat = F,\n               color.use = colCond3, measure = \"weight\",\n               signaling = IFweightFilAct2$name,\n               targets.use = \"PI16+RC\", sources.use = c(names(colImm)))\ngg3\n\n\n\n\n\nvis exp of RL pairs top PW IMM to PI16\n\n## filter R-L pairs based on PW - source only imm cells\nLRpairDat &lt;- cellchat.merge@LR[[\"act\"]][[\"LRsig\"]] %&gt;%\n  filter(pathway_name %in% IFweightFilAct2$name) %&gt;% \n  dplyr::select(interaction_name)\n\nnetVisual_bubble(cellchat.merge, \n                 targets.use = \"PI16+RC\",\n                 sources.use = c(names(colImm)),\n                 comparison = c(1, 2), angle.x = 45,\n                 pairLR.use = LRpairDat)\n\n\n\nLRint &lt;- netVisual_bubble(cellchat.merge, targets.use = \"PI16+RC\", \n                          sources.use = c(names(colImm)),\n                 comparison = c(1, 2), angle.x = 45, return.data=T,\n                 pairLR.use = LRpairDat)\n\nLRintFil &lt;- LRint$communication %&gt;%\n  dplyr::select(target, interaction_name, dataset, prob) %&gt;% \n  dplyr::group_by(target, interaction_name,) %&gt;% \n  dplyr::slice(which.max(prob)) %&gt;%\n  ungroup() %&gt;% filter(dataset==\"act\") %&gt;% \n  dplyr::select(interaction_name)\n\nnetVisual_bubble(cellchat.merge, targets.use = \"PI16+RC\",\n                 sources.use = c(names(colImm)),\n                 comparison = c(1, 2), angle.x = 45,\n                 pairLR.use = LRintFil)\n\n\n\n\n\n\n\nin out signalling\n\ni = 1\npathway.union &lt;- union(object.list[[i]]@netP$pathways, object.list[[i+1]]@netP$pathways)\nht1 = netAnalysis_signalingRole_heatmap(object.list[[i]], pattern = \"outgoing\",\n                                        signaling = pathway.union,\n                                        title = names(object.list)[i],\n                                        width = 12, height = 26)\nht2 = netAnalysis_signalingRole_heatmap(object.list[[i+1]],\n                                        pattern = \"outgoing\",\n                                        signaling = pathway.union,\n                                        title = names(object.list)[i+1],\n                                        width = 12, height = 26)\ndraw(ht1 + ht2, ht_gap = unit(0.5, \"cm\"))\n\n\n\nht1 = netAnalysis_signalingRole_heatmap(object.list[[i]], pattern = \"incoming\",\n                                        signaling = pathway.union,\n                                        title = names(object.list)[i],\n                                        width = 12, height = 26,\n                                        color.heatmap = \"GnBu\")\nht2 = netAnalysis_signalingRole_heatmap(object.list[[i+1]],\n                                        pattern = \"incoming\",\n                                        signaling = pathway.union,\n                                        title = names(object.list)[i+1],\n                                        width = 12, height = 26, \n                                        color.heatmap = \"GnBu\")\ndraw(ht1 + ht2, ht_gap = unit(0.5, \"cm\"))\n\n\n\n\n\n\nR L pairs\n\nvis exp of RL pairs\n\nnetVisual_bubble(cellchat.merge, sources.use = \"PI16+RC\",\n                 targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                 comparison = c(1, 2), angle.x = 45)\n\n\n\nnetVisual_bubble(cellchat.merge, sources.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                 targets.use = \"PI16+RC\",\n                 comparison = c(1, 2), angle.x = 45)\n\n\n\n\n\n\nvis exp of diff RL pairs\n\n##### ----------------- FRC to immune cells ------------------- ######\n\ngg1 &lt;- netVisual_bubble(cellchat.merge, sources.use = \"PI16+RC\",\n                        targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"), \n                        comparison = c(1, 2), max.dataset = 2,\n                        title.name = \"Increased signaling in resting\", angle.x = 45,\n                        remove.isolate = T)\ngg2 &lt;- netVisual_bubble(cellchat.merge, sources.use = \"PI16+RC\",\n                        targets.use = c(\"CD4T\", \"CTL/NKcell\", \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                        comparison = c(1, 2), max.dataset = 1,\n                        title.name = \"Increased signaling in activated\", angle.x = 45,\n                        remove.isolate = T)\ngg1 + gg2\n\n\n\n##### ----------------- Immune cells to FRCs ------------------- ######\n\ngg1 &lt;- netVisual_bubble(cellchat.merge, sources.use = c(\"CD4T\", \"CTL/NKcell\",\n                                                        \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                        targets.use = \"PI16+RC\", \n                        comparison = c(1, 2), max.dataset = 2,\n                        title.name = \"Increased signaling in resting\", angle.x = 45,\n                        remove.isolate = T)\ngg2 &lt;- netVisual_bubble(cellchat.merge, sources.use = c(\"CD4T\", \"CTL/NKcell\",\n                                                        \"GCB\", \"ILC3\",\n                                 \"naiveB\", \"MBC\", \"plasmaCell\", \"CD8Tcm\",\n                                 \"Mph/DC-1\", \"Mph/DC-2\"),\n                        targets.use = \"PI16+RC\",\n                        comparison = c(1, 2), max.dataset = 1,\n                        title.name = \"Increased signaling in activated\", angle.x = 45,\n                        remove.isolate = T)\ngg1 + gg2"
  },
  {
    "objectID": "analysis/runCellchat_act_vs_res_PI16.html#session-info",
    "href": "analysis/runCellchat_act_vs_res_PI16.html#session-info",
    "title": "run cellchat scRNAseq data on PI16+RC",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] grid      stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] ComplexHeatmap_2.16.0       patchwork_1.2.0             CellChat_1.6.1             \n [4] igraph_2.0.2                scran_1.28.2                scater_1.28.0              \n [7] scuttle_1.10.3              SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2\n[10] Biobase_2.60.0              GenomicRanges_1.52.1        GenomeInfoDb_1.36.4        \n[13] IRanges_2.36.0              S4Vectors_0.40.1            BiocGenerics_0.48.0        \n[16] MatrixGenerics_1.12.3       matrixStats_1.2.0           pheatmap_1.0.12            \n[19] ggsci_3.0.0                 here_1.0.1                  runSeurat3_0.1.0           \n[22] ggpubr_0.6.0                lubridate_1.9.3             forcats_1.0.0              \n[25] stringr_1.5.1               readr_2.1.5                 tidyr_1.3.1                \n[28] tibble_3.2.1                tidyverse_2.0.0             Seurat_5.0.1               \n[31] SeuratObject_5.0.1          sp_2.1-3                    purrr_1.0.2                \n[34] ggplot2_3.4.4               reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] spatstat.sparse_3.0-3     bitops_1.0-7              httr_1.4.7               \n  [4] RColorBrewer_1.1-3        doParallel_1.0.17         tools_4.3.0              \n  [7] sctransform_0.4.1         backports_1.4.1           utf8_1.2.4               \n [10] R6_2.5.1                  lazyeval_0.2.2            uwot_0.1.16              \n [13] GetoptLong_1.0.5          withr_3.0.0               gridExtra_2.3            \n [16] progressr_0.14.0          cli_3.6.2                 Cairo_1.6-2              \n [19] spatstat.explore_3.2-6    fastDummies_1.7.3         network_1.18.2           \n [22] labeling_0.4.3            spatstat.data_3.0-4       ggridges_0.5.6           \n [25] pbapply_1.7-2             systemfonts_1.0.5         svglite_2.1.3            \n [28] parallelly_1.37.0         limma_3.56.2              rstudioapi_0.15.0        \n [31] FNN_1.1.4                 generics_0.1.3            shape_1.4.6              \n [34] ica_1.0-3                 spatstat.random_3.2-2     car_3.1-2                \n [37] Matrix_1.6-5              ggbeeswarm_0.7.2          fansi_1.0.6              \n [40] abind_1.4-5               lifecycle_1.0.4           yaml_2.3.8               \n [43] edgeR_3.42.4              carData_3.0-5             Rtsne_0.17               \n [46] promises_1.2.1            dqrng_0.3.2               crayon_1.5.2             \n [49] miniUI_0.1.1.1            lattice_0.22-5            beachmat_2.16.0          \n [52] cowplot_1.1.3             magick_2.8.3              sna_2.7-2                \n [55] pillar_1.9.0              knitr_1.45                metapod_1.8.0            \n [58] rjson_0.2.21              future.apply_1.11.1       codetools_0.2-19         \n [61] leiden_0.4.3.1            glue_1.7.0                data.table_1.15.0        \n [64] vctrs_0.6.5               png_0.1-8                 spam_2.10-0              \n [67] gtable_0.3.4              xfun_0.42                 S4Arrays_1.0.6           \n [70] mime_0.12                 coda_0.19-4.1             survival_3.5-8           \n [73] iterators_1.0.14          statmod_1.5.0             bluster_1.10.0           \n [76] ellipsis_0.3.2            fitdistrplus_1.1-11       ROCR_1.0-11              \n [79] nlme_3.1-164              RcppAnnoy_0.0.22          rprojroot_2.0.4          \n [82] irlba_2.3.5.1             vipor_0.4.7               KernSmooth_2.23-22       \n [85] colorspace_2.1-0          tidyselect_1.2.0          compiler_4.3.0           \n [88] BiocNeighbors_1.18.0      DelayedArray_0.26.7       plotly_4.10.4            \n [91] scales_1.3.0              lmtest_0.9-40             NMF_0.27                 \n [94] digest_0.6.34             goftest_1.2-3             spatstat.utils_3.0-4     \n [97] rmarkdown_2.25            XVector_0.40.0            htmltools_0.5.7          \n[100] pkgconfig_2.0.3           sparseMatrixStats_1.12.2  fastmap_1.1.1            \n[103] rlang_1.1.3               GlobalOptions_0.1.2       htmlwidgets_1.6.4        \n[106] shiny_1.8.0               DelayedMatrixStats_1.22.6 farver_2.1.1             \n[109] zoo_1.8-12                jsonlite_1.8.8            statnet.common_4.9.0     \n[112] BiocParallel_1.34.2       BiocSingular_1.16.0       RCurl_1.98-1.14          \n[115] magrittr_2.0.3            ggnetwork_0.5.13          GenomeInfoDbData_1.2.10  \n[118] dotCall64_1.1-1           munsell_0.5.0             Rcpp_1.0.12              \n[121] viridis_0.6.5             reticulate_1.35.0         stringi_1.8.3            \n[124] ggalluvial_0.12.5         zlibbioc_1.46.0           MASS_7.3-60.0.1          \n[127] plyr_1.8.9                parallel_4.3.0            listenv_0.9.1            \n[130] ggrepel_0.9.5             deldir_2.0-2              splines_4.3.0            \n[133] tensor_1.5                hms_1.1.3                 circlize_0.4.16          \n[136] locfit_1.5-9.8            spatstat.geom_3.2-8       ggsignif_0.6.4           \n[139] RcppHNSW_0.6.0            rngtools_1.5.2            ScaledMatrix_1.8.1       \n[142] evaluate_0.23             tzdb_0.4.0                foreach_1.5.2            \n[145] httpuv_1.6.14             RANN_2.6.1                polyclip_1.10-6          \n[148] future_1.33.1             clue_0.3-65               scattermore_1.2          \n[151] gridBase_0.4-7            rsvd_1.0.5                broom_1.0.5              \n[154] xtable_1.8-4              RSpectra_0.16-1           rstatix_0.7.2            \n[157] later_1.3.2               viridisLite_0.4.2         beeswarm_0.4.0           \n[160] registry_0.5-1            cluster_2.1.6             timechange_0.3.0         \n[163] globals_0.16.2           \n\ndate()\n\n[1] \"Thu Mar  7 09:15:56 2024\""
  },
  {
    "objectID": "analysis/QCplusNorm_SThumanLN.html",
    "href": "analysis/QCplusNorm_SThumanLN.html",
    "title": "merge ST data human LN - batch 1",
    "section": "",
    "text": "Load packages\n\nlibrary(tidyverse)\nlibrary(SpatialExperiment)\nlibrary(here)\nlibrary(ggspavis)\nlibrary(scater)\nlibrary(scran)\nlibrary(ggpubr)\nlibrary(ggsci)\nlibrary(pheatmap)\n\n\n\nLoad and merge spe objects\n\nbasedir &lt;- here()\nmetaDat &lt;- read_tsv(paste0(basedir, \"/data/ST/metadata.txt\"), col_names = T)\n\nassignSamples &lt;- function(smpNam, basedirSmp){\n  smpNamFull &lt;- list.files(path = paste0(basedirSmp, \"/data/ST/\"),\n                 pattern = paste0(smpNam, \".*_spe.rds\"))\n  speSmp &lt;- readRDS(paste0(basedirSmp, \"/data/ST/\", smpNamFull))\n  return(speSmp)\n}\n\n####################################################################\n\nfor(i in 1:length(metaDat$Sample)){\n  speX &lt;- assignSamples(smpNam = metaDat$Sample[i],\n                           basedirSmp = basedir)\n  if(exists(\"spe\")){\n    spe &lt;- cbind(spe, speX)\n  }else{\n    spe &lt;- speX\n  }\n}\n\nremove(speX)\n\n\n\nExamine samples before removal of low quality spots\n\n## before QC\ntable(spe@colData$sample_id)\n\n\n318981_1-1_20230531_Hu_pat58_LN_squA 318981_2-2_20230531_Hu_pat56_LN_squB \n                                4992                                 4992 \n318981_3-3_20230531_Hu_pat55_LN_squC 318981_4-4_20230531_Hu_pat55_LN_squD \n                                4992                                 4992 \n\ndim(spe)\n\n[1] 60666 19968\n\nplotSpots(spe) + facet_grid(~ sample_id)\n\n\n\n# subset to keep only spots over tissue\nspe &lt;- spe[, colData(spe)$in_tissue == 1]\ndim(spe)\n\n[1] 60666  5153\n\ntable(spe@colData$sample_id)\n\n\n318981_1-1_20230531_Hu_pat58_LN_squA 318981_2-2_20230531_Hu_pat56_LN_squB \n                                 747                                 2194 \n318981_3-3_20230531_Hu_pat55_LN_squC 318981_4-4_20230531_Hu_pat55_LN_squD \n                                1019                                 1193 \n\nplotSpots(spe) + facet_grid(~ sample_id)\n\n\n\n\n\n\nrun QC\n\n# identify mitochondrial genes\nis_mito &lt;- grepl(\"(^MT-)|(^mt-)\", rowData(spe)$symbol)\ntable(is_mito)\n\nis_mito\nFALSE  TRUE \n60629    37 \n\nrowData(spe)$symbol[is_mito]\n\n [1] \"MT-TF\"   \"MT-RNR1\" \"MT-TV\"   \"MT-RNR2\" \"MT-TL1\"  \"MT-ND1\"  \"MT-TI\"  \n [8] \"MT-TQ\"   \"MT-TM\"   \"MT-ND2\"  \"MT-TW\"   \"MT-TA\"   \"MT-TN\"   \"MT-TC\"  \n[15] \"MT-TY\"   \"MT-CO1\"  \"MT-TS1\"  \"MT-TD\"   \"MT-CO2\"  \"MT-TK\"   \"MT-ATP8\"\n[22] \"MT-ATP6\" \"MT-CO3\"  \"MT-TG\"   \"MT-ND3\"  \"MT-TR\"   \"MT-ND4L\" \"MT-ND4\" \n[29] \"MT-TH\"   \"MT-TS2\"  \"MT-TL2\"  \"MT-ND5\"  \"MT-ND6\"  \"MT-TE\"   \"MT-CYB\" \n[36] \"MT-TT\"   \"MT-TP\"  \n\n# run QC parameters per sample\nspeList &lt;- lapply(unique(colData(spe)$sample_id), function(sid){\n  speSub &lt;- spe[, which(colData(spe)$sample_id == sid)]\n  \n  speSub &lt;- addPerCellQC(speSub, subsets = list(mito = is_mito))\n  hist(colData(speSub)$sum, breaks = 50,\n       main = paste0(\"sum - \", sid), xlab = \"sum\")\n  hist(colData(speSub)$detected, breaks = 50,\n       main = paste0(\"detected - \", sid), xlab = \"detected\")\n  hist(colData(speSub)$subsets_mito_percent, breaks = 50,\n       main = paste0(\"subsets_mito_percent - \", sid),\n       xlab = \"subsets_mito_percent\")\n  \n  ## remove spots with high deviation from median\n  speSub@colData$total_counts_drop &lt;- isOutlier(speSub@colData$sum, nmads = 5,\n                                     type = \"both\", log = TRUE)\n  speSub@colData$total_features_drop &lt;- isOutlier(speSub@colData$detected,\n                                                  nmads = 5, type = \"both\",\n                                                  log = TRUE)\n  speSub@colData$mito_drop &lt;- isOutlier(speSub@colData$subsets_mito_percent,\n                                        nmads = 10, type = \"higher\",\n                                        log = FALSE)\n  speSub@colData$mito_drop &lt;- FALSE\n  speSub &lt;- speSub\n})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## vis spots with low quality\nlapply(speList, function(speSub){\n  p &lt;- plotQC(speSub, type = \"spots\", \n       discard = \"total_counts_drop\") +\n    ggtitle(speSub@colData$sample_id)\n  p\n})\n\n[[1]]\n\n\n\n\n\n\n[[2]]\n\n\n\n\n\n\n[[3]]\n\n\n\n\n\n\n[[4]]\n\n\n\n\nlapply(speList, function(speSub){\n  p &lt;- plotQC(speSub, type = \"spots\", \n       discard = \"total_features_drop\") +\n    ggtitle(speSub@colData$sample_id)\n  p\n})\n\n[[1]]\n\n\n\n\n\n\n[[2]]\n\n\n\n\n\n\n[[3]]\n\n\n\n\n\n\n[[4]]\n\n\n\n\nlapply(speList, function(speSub){\n  p &lt;- plotQC(speSub, type = \"spots\", \n       discard = \"mito_drop\") +\n    ggtitle(speSub@colData$sample_id)\n  p\n})\n\n[[1]]\n\n\n\n\n\n\n[[2]]\n\n\n\n\n\n\n[[3]]\n\n\n\n\n\n\n[[4]]\n\n\n\n\n## cnt spots with low quality\nlapply(speList, function(speSub){\n  table(speSub@colData$total_counts_drop)\n})\n\n[[1]]\n\nFALSE \n  747 \n\n[[2]]\n\nFALSE  TRUE \n 2192     2 \n\n[[3]]\n\nFALSE  TRUE \n 1015     4 \n\n[[4]]\n\nFALSE  TRUE \n 1191     2 \n\nlapply(speList, function(speSub){\n  table(speSub@colData$total_features_drop)\n})\n\n[[1]]\n\nFALSE \n  747 \n\n[[2]]\n\nFALSE  TRUE \n 2188     6 \n\n[[3]]\n\nFALSE  TRUE \n 1013     6 \n\n[[4]]\n\nFALSE  TRUE \n 1186     7 \n\nlapply(speList, function(speSub){\n  table(speSub@colData$mito_drop)\n})\n\n[[1]]\n\nFALSE \n  747 \n\n[[2]]\n\nFALSE \n 2194 \n\n[[3]]\n\nFALSE \n 1019 \n\n[[4]]\n\nFALSE \n 1193 \n\n## remove plots with low quality\nspeList &lt;- lapply(speList, function(speSub){\n  speSub &lt;- speSub[, !(speSub@colData$total_counts_drop |\n                         speSub@colData$total_features_drop |\n                         speSub@colData$mito_drop)]\n  sid &lt;- unique(colData(speSub)$sample_id)\n  ## after QC\n  hist(colData(speSub)$sum, breaks = 50,\n       main = paste0(\"sum after QC - \", sid), xlab = \"sum\")\n  hist(colData(speSub)$detected, breaks = 50,\n       main = paste0(\"detected after QC - \", sid), xlab = \"detected\")\n  hist(colData(speSub)$subsets_mito_percent, breaks = 50,\n       main = paste0(\"subsets_mito_percent after QC - \", sid),\n       xlab = \"subsets_mito_percent\")\n  speSub &lt;- speSub\n})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nnames(speList) &lt;- unique(colData(spe)$sample_id)\n\n\n\nExamine samples after removal of low quality spots\n\n## vis spots after QC\nlapply(speList, function(speSub){\n  p &lt;- plotSpots(speSub) +\n    ggtitle(speSub@colData$sample_id)\n  p\n\n})\n\n$`318981_1-1_20230531_Hu_pat58_LN_squA`\n\n\n\n\n\n\n$`318981_2-2_20230531_Hu_pat56_LN_squB`\n\n\n\n\n\n\n$`318981_3-3_20230531_Hu_pat55_LN_squC`\n\n\n\n\n\n\n$`318981_4-4_20230531_Hu_pat55_LN_squD`\n\n\n\n\n## cnt spots after QC\nlapply(speList, function(speSub){\n  dim(speSub)\n})\n\n$`318981_1-1_20230531_Hu_pat58_LN_squA`\n[1] 60666   747\n\n$`318981_2-2_20230531_Hu_pat56_LN_squB`\n[1] 60666  2188\n\n$`318981_3-3_20230531_Hu_pat55_LN_squC`\n[1] 60666  1013\n\n$`318981_4-4_20230531_Hu_pat55_LN_squD`\n[1] 60666  1186\n\n\n\n\nNormalization\n\nspeList &lt;- lapply(speList, function(speSub){\n  speSub &lt;- computeLibraryFactors(speSub)\n  summary(sizeFactors(speSub))\n  sid &lt;- unique(colData(speSub)$sample_id)\n  hist(sizeFactors(speSub), breaks = 20, main = sid)\n  speSub &lt;- logNormCounts(speSub)\n})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFeature selection\n\nhvgList &lt;- lapply(speList, function(speSub){\n  # fit mean-variance relationship\n  dec &lt;- modelGeneVar(speSub)\n\n  # visualize mean-variance relationship\n  fit &lt;- metadata(dec)\n  plot(fit$mean, fit$var, \n     xlab = \"mean of log-expression\", ylab = \"variance of log-expression\")\n  curve(fit$trend(x), col = \"dodgerblue\", add = TRUE, lwd = 2)\n  top_hvgs &lt;- getTopHVGs(dec, prop = 0.1)\n})\n\n\n\n\n\n\n\n\n\n\n\n\nnames(hvgList) &lt;- names(speList)\nlengths(hvgList)\n\n318981_1-1_20230531_Hu_pat58_LN_squA 318981_2-2_20230531_Hu_pat56_LN_squB \n                                1114                                 1779 \n318981_3-3_20230531_Hu_pat55_LN_squC 318981_4-4_20230531_Hu_pat55_LN_squD \n                                1457                                 1454 \n\n\n\n\nDimensionality reduction\n\nspeList &lt;- lapply(speList, function(speSub){\n  sid &lt;- unique(colData(speSub)$sample_id)\n  top_hvgs &lt;- hvgList[[sid]]\n  speSub &lt;- runPCA(speSub, subset_row = top_hvgs)\n  speSub &lt;- runUMAP(speSub, dimred = \"PCA\")\n  colnames(reducedDim(speSub, \"UMAP\")) &lt;- paste0(\"UMAP\", 1:2)\n  speSub &lt;- speSub\n})\n\nlapply(speList, function(speSub){\n  sid &lt;- unique(colData(speSub)$sample_id)\n  plotDimRed(speSub, type = \"PCA\") + \n    ggtitle(sid)\n})\n\n$`318981_1-1_20230531_Hu_pat58_LN_squA`\n\n\n\n\n\n\n$`318981_2-2_20230531_Hu_pat56_LN_squB`\n\n\n\n\n\n\n$`318981_3-3_20230531_Hu_pat55_LN_squC`\n\n\n\n\n\n\n$`318981_4-4_20230531_Hu_pat55_LN_squD`\n\n\n\n\nlapply(speList, function(speSub){\n  sid &lt;- unique(colData(speSub)$sample_id)\n  plotDimRed(speSub, type = \"UMAP\") + \n    ggtitle(sid)\n})\n\n$`318981_1-1_20230531_Hu_pat58_LN_squA`\n\n\n\n\n\n\n$`318981_2-2_20230531_Hu_pat56_LN_squB`\n\n\n\n\n\n\n$`318981_3-3_20230531_Hu_pat55_LN_squC`\n\n\n\n\n\n\n$`318981_4-4_20230531_Hu_pat55_LN_squD`\n\n\n\n\n\n\n\nclustering\n\nspeList &lt;- lapply(speList, function(speSub){\n  # graph-based clustering\n  k &lt;- 15\n  g &lt;- buildSNNGraph(speSub, k = k, use.dimred = \"PCA\")\n  g_walk &lt;- igraph::cluster_walktrap(g)\n  clus &lt;- g_walk$membership\n  table(clus)\n  colLabels(speSub) &lt;- factor(clus)\n  speSub &lt;- speSub\n})\n\ncolPal &lt;- c(\"#F0027F\", \"#377EB8\", \"#4DAF4A\", \"#984EA3\", \"#FFD700\", \"#FF7F00\",\n            \"#1A1A1A\", \"#666666\", pal_futurama()(10))\nlapply(speList, function(speSub){\n  sid &lt;- unique(colData(speSub)$sample_id)\n  plotSpots(speSub, annotate = \"label\", \n          palette = colPal) + \n    ggtitle(sid)\n})\n\n$`318981_1-1_20230531_Hu_pat58_LN_squA`\n\n\n\n\n\n\n$`318981_2-2_20230531_Hu_pat56_LN_squB`\n\n\n\n\n\n\n$`318981_3-3_20230531_Hu_pat55_LN_squC`\n\n\n\n\n\n\n$`318981_4-4_20230531_Hu_pat55_LN_squD`\n\n\n\n\nlapply(speList, function(speSub){\n  sid &lt;- unique(colData(speSub)$sample_id)\n  plotDimRed(speSub, type = \"UMAP\", \n           annotate = \"label\", palette = colPal) + \n    ggtitle(sid)\n})\n\n$`318981_1-1_20230531_Hu_pat58_LN_squA`\n\n\n\n\n\n\n$`318981_2-2_20230531_Hu_pat56_LN_squB`\n\n\n\n\n\n\n$`318981_3-3_20230531_Hu_pat55_LN_squC`\n\n\n\n\n\n\n$`318981_4-4_20230531_Hu_pat55_LN_squD`\n\n\n\n\nlapply(speList, function(speSub){\n  sid &lt;- unique(colData(speSub)$sample_id)\n  plotDimRed(speSub, type = \"PCA\", \n           annotate = \"label\", palette = colPal) + \n    ggtitle(sid)\n})\n\n$`318981_1-1_20230531_Hu_pat58_LN_squA`\n\n\n\n\n\n\n$`318981_2-2_20230531_Hu_pat56_LN_squB`\n\n\n\n\n\n\n$`318981_3-3_20230531_Hu_pat55_LN_squC`\n\n\n\n\n\n\n$`318981_4-4_20230531_Hu_pat55_LN_squD`\n\n\n\n\n\n\n\nMarker genes\n\nmarkerList &lt;- lapply(speList, function(speSub){\n  rownames(speSub) &lt;- rowData(speSub)$symbol\n  markers &lt;- findMarkers(speSub, test = \"binom\", direction = \"up\")\n})\n\nnames(markerList) &lt;- names(speList)\n\n\n\nSave data\n\nsaveRDS(speList, file = paste0(basedir, \"/data/speAllLN.rds\"))\nsaveRDS(markerList, file = paste0(basedir, \"/data/markerAllLN.rds\"))\n\n\n\nsession info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods  \n[8] base     \n\nother attached packages:\n [1] Matrix_1.6-5                pheatmap_1.0.12            \n [3] ggsci_3.0.1                 ggpubr_0.6.0               \n [5] scran_1.28.2                scater_1.28.0              \n [7] scuttle_1.10.3              ggspavis_1.6.0             \n [9] here_1.0.1                  SpatialExperiment_1.10.0   \n[11] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2\n[13] Biobase_2.60.0              GenomicRanges_1.52.1       \n[15] GenomeInfoDb_1.36.4         IRanges_2.36.0             \n[17] S4Vectors_0.40.1            BiocGenerics_0.48.0        \n[19] MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[21] lubridate_1.9.3             forcats_1.0.0              \n[23] stringr_1.5.1               dplyr_1.1.4                \n[25] purrr_1.0.2                 readr_2.1.5                \n[27] tidyr_1.3.1                 tibble_3.2.1               \n[29] ggplot2_3.5.0               tidyverse_2.0.0            \n\nloaded via a namespace (and not attached):\n  [1] RColorBrewer_1.1-3        rstudioapi_0.15.0        \n  [3] jsonlite_1.8.8            magrittr_2.0.3           \n  [5] ggbeeswarm_0.7.2          magick_2.8.3             \n  [7] farver_2.1.1              rmarkdown_2.26           \n  [9] zlibbioc_1.46.0           vctrs_0.6.5              \n [11] DelayedMatrixStats_1.22.6 RCurl_1.98-1.14          \n [13] rstatix_0.7.2             htmltools_0.5.7          \n [15] S4Arrays_1.0.6            BiocNeighbors_1.18.0     \n [17] broom_1.0.5               Rhdf5lib_1.22.1          \n [19] rhdf5_2.44.0              htmlwidgets_1.6.4        \n [21] igraph_2.0.2              lifecycle_1.0.4          \n [23] ggside_0.3.1              pkgconfig_2.0.3          \n [25] rsvd_1.0.5                R6_2.5.1                 \n [27] fastmap_1.1.1             GenomeInfoDbData_1.2.10  \n [29] digest_0.6.34             colorspace_2.1-0         \n [31] rprojroot_2.0.4           dqrng_0.3.2              \n [33] irlba_2.3.5.1             beachmat_2.16.0          \n [35] labeling_0.4.3            fansi_1.0.6              \n [37] timechange_0.3.0          abind_1.4-5              \n [39] compiler_4.3.0            bit64_4.0.5              \n [41] withr_3.0.0               backports_1.4.1          \n [43] BiocParallel_1.34.2       carData_3.0-5            \n [45] viridis_0.6.5             HDF5Array_1.28.1         \n [47] R.utils_2.12.3            ggsignif_0.6.4           \n [49] DelayedArray_0.26.7       rjson_0.2.21             \n [51] bluster_1.10.0            tools_4.3.0              \n [53] vipor_0.4.7               beeswarm_0.4.0           \n [55] R.oo_1.26.0               glue_1.7.0               \n [57] rhdf5filters_1.12.1       grid_4.3.0               \n [59] cluster_2.1.6             generics_0.1.3           \n [61] gtable_0.3.4              tzdb_0.4.0               \n [63] R.methodsS3_1.8.2         hms_1.1.3                \n [65] BiocSingular_1.16.0       ScaledMatrix_1.8.1       \n [67] metapod_1.8.0             car_3.1-2                \n [69] utf8_1.2.4                XVector_0.40.0           \n [71] ggrepel_0.9.5             pillar_1.9.0             \n [73] vroom_1.6.5               limma_3.56.2             \n [75] lattice_0.22-5            FNN_1.1.4                \n [77] bit_4.0.5                 tidyselect_1.2.0         \n [79] locfit_1.5-9.9            knitr_1.45               \n [81] gridExtra_2.3             edgeR_3.42.4             \n [83] xfun_0.42                 statmod_1.5.0            \n [85] DropletUtils_1.20.0       stringi_1.8.3            \n [87] yaml_2.3.8                evaluate_0.23            \n [89] codetools_0.2-19          cli_3.6.2                \n [91] uwot_0.1.16               munsell_0.5.0            \n [93] Rcpp_1.0.12               parallel_4.3.0           \n [95] sparseMatrixStats_1.12.2  bitops_1.0-7             \n [97] viridisLite_0.4.2         scales_1.3.0             \n [99] crayon_1.5.2              rlang_1.1.3"
  },
  {
    "objectID": "analysis/QCplusNorm_SThumanLN_B2.html",
    "href": "analysis/QCplusNorm_SThumanLN_B2.html",
    "title": "merge ST data human LN - batch2",
    "section": "",
    "text": "Load packages\n\nlibrary(tidyverse)\nlibrary(SpatialExperiment)\nlibrary(here)\nlibrary(ggspavis)\nlibrary(scater)\nlibrary(scran)\nlibrary(ggpubr)\nlibrary(ggsci)\nlibrary(pheatmap)\n\n\n\nLoad and merge spe objects\n\nbasedir &lt;- here()\nmetaDat &lt;- read_tsv(paste0(basedir, \"/data/ST/metadataB2.txt\"), col_names = T)\n\nassignSamples &lt;- function(smpNam, basedirSmp){\n  smpNamFull &lt;- list.files(path = paste0(basedirSmp, \"/data/ST/\"),\n                 pattern = paste0(smpNam, \".*_spe.rds\"))\n  speSmp &lt;- readRDS(paste0(basedirSmp, \"/data/ST/\", smpNamFull))\n  return(speSmp)\n}\n\n####################################################################\n\nfor(i in 1:length(metaDat$Sample)){\n  speX &lt;- assignSamples(smpNam = metaDat$Sample[i],\n                           basedirSmp = basedir)\n  if(exists(\"spe\")){\n    spe &lt;- cbind(spe, speX)\n  }else{\n    spe &lt;- speX\n  }\n}\n\nremove(speX)\n\n\n\nExamine samples before removal of low quality spots\n\n## before QC\ntable(spe@colData$sample_id)\n\n\n334131_11-1_20231103_Hu_pat03_07_squA 334131_12-2_20231103_Hu_pat03_10_squB \n                                 4992                                  4992 \n334131_13-3_20231103_Hu_pat03_9a_squC 334131_14-4_20231103_Hu_pat03_11_squD \n                                 4992                                  4992 \n\ndim(spe)\n\n[1] 60666 19968\n\nplotSpots(spe) + facet_grid(~ sample_id)\n\n\n\n# subset to keep only spots over tissue\nspe &lt;- spe[, colData(spe)$in_tissue == 1]\ndim(spe)\n\n[1] 60666  7632\n\ntable(spe@colData$sample_id)\n\n\n334131_11-1_20231103_Hu_pat03_07_squA 334131_12-2_20231103_Hu_pat03_10_squB \n                                 1143                                  2823 \n334131_13-3_20231103_Hu_pat03_9a_squC 334131_14-4_20231103_Hu_pat03_11_squD \n                                 1997                                  1669 \n\nplotSpots(spe) + facet_grid(~ sample_id)\n\n\n\n\n\n\nrun QC\n\n# identify mitochondrial genes\nis_mito &lt;- grepl(\"(^MT-)|(^mt-)\", rowData(spe)$symbol)\ntable(is_mito)\n\nis_mito\nFALSE  TRUE \n60629    37 \n\nrowData(spe)$symbol[is_mito]\n\n [1] \"MT-TF\"   \"MT-RNR1\" \"MT-TV\"   \"MT-RNR2\" \"MT-TL1\"  \"MT-ND1\"  \"MT-TI\"  \n [8] \"MT-TQ\"   \"MT-TM\"   \"MT-ND2\"  \"MT-TW\"   \"MT-TA\"   \"MT-TN\"   \"MT-TC\"  \n[15] \"MT-TY\"   \"MT-CO1\"  \"MT-TS1\"  \"MT-TD\"   \"MT-CO2\"  \"MT-TK\"   \"MT-ATP8\"\n[22] \"MT-ATP6\" \"MT-CO3\"  \"MT-TG\"   \"MT-ND3\"  \"MT-TR\"   \"MT-ND4L\" \"MT-ND4\" \n[29] \"MT-TH\"   \"MT-TS2\"  \"MT-TL2\"  \"MT-ND5\"  \"MT-ND6\"  \"MT-TE\"   \"MT-CYB\" \n[36] \"MT-TT\"   \"MT-TP\"  \n\n# run QC parameters per sample\nspeList &lt;- lapply(unique(colData(spe)$sample_id), function(sid){\n  speSub &lt;- spe[, which(colData(spe)$sample_id == sid)]\n  \n  speSub &lt;- addPerCellQC(speSub, subsets = list(mito = is_mito))\n  hist(colData(speSub)$sum, breaks = 50,\n       main = paste0(\"sum - \", sid), xlab = \"sum\")\n  hist(colData(speSub)$detected, breaks = 50,\n       main = paste0(\"detected - \", sid), xlab = \"detected\")\n  hist(colData(speSub)$subsets_mito_percent, breaks = 50,\n       main = paste0(\"subsets_mito_percent - \", sid),\n       xlab = \"subsets_mito_percent\")\n  \n  ## remove spots with high deviation from median\n  speSub@colData$total_counts_drop &lt;- isOutlier(speSub@colData$sum, nmads = 5,\n                                     type = \"both\", log = TRUE)\n  speSub@colData$total_features_drop &lt;- isOutlier(speSub@colData$detected,\n                                                  nmads = 5, type = \"both\",\n                                                  log = TRUE)\n  speSub@colData$mito_drop &lt;- isOutlier(speSub@colData$subsets_mito_percent,\n                                        nmads = 10, type = \"higher\",\n                                        log = FALSE)\n  speSub@colData$mito_drop &lt;- FALSE\n  speSub &lt;- speSub\n})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n## vis spots with low quality\nlapply(speList, function(speSub){\n  p &lt;- plotQC(speSub, type = \"spots\", \n       discard = \"total_counts_drop\") +\n    ggtitle(speSub@colData$sample_id)\n  p\n})\n\n[[1]]\n\n\n\n\n\n\n[[2]]\n\n\n\n\n\n\n[[3]]\n\n\n\n\n\n\n[[4]]\n\n\n\n\nlapply(speList, function(speSub){\n  p &lt;- plotQC(speSub, type = \"spots\", \n       discard = \"total_features_drop\") +\n    ggtitle(speSub@colData$sample_id)\n  p\n})\n\n[[1]]\n\n\n\n\n\n\n[[2]]\n\n\n\n\n\n\n[[3]]\n\n\n\n\n\n\n[[4]]\n\n\n\n\nlapply(speList, function(speSub){\n  p &lt;- plotQC(speSub, type = \"spots\", \n       discard = \"mito_drop\") +\n    ggtitle(speSub@colData$sample_id)\n  p\n})\n\n[[1]]\n\n\n\n\n\n\n[[2]]\n\n\n\n\n\n\n[[3]]\n\n\n\n\n\n\n[[4]]\n\n\n\n\n## cnt spots with low quality\nlapply(speList, function(speSub){\n  table(speSub@colData$total_counts_drop)\n})\n\n[[1]]\n\nFALSE \n 1143 \n\n[[2]]\n\nFALSE  TRUE \n 2820     3 \n\n[[3]]\n\nFALSE  TRUE \n 1992     5 \n\n[[4]]\n\nFALSE \n 1669 \n\nlapply(speList, function(speSub){\n  table(speSub@colData$total_features_drop)\n})\n\n[[1]]\n\nFALSE \n 1143 \n\n[[2]]\n\nFALSE  TRUE \n 2809    14 \n\n[[3]]\n\nFALSE  TRUE \n 1992     5 \n\n[[4]]\n\nFALSE \n 1669 \n\nlapply(speList, function(speSub){\n  table(speSub@colData$mito_drop)\n})\n\n[[1]]\n\nFALSE \n 1143 \n\n[[2]]\n\nFALSE \n 2823 \n\n[[3]]\n\nFALSE \n 1997 \n\n[[4]]\n\nFALSE \n 1669 \n\n## remove plots with low quality\nspeList &lt;- lapply(speList, function(speSub){\n  speSub &lt;- speSub[, !(speSub@colData$total_counts_drop |\n                         speSub@colData$total_features_drop |\n                         speSub@colData$mito_drop)]\n  sid &lt;- unique(colData(speSub)$sample_id)\n  ## after QC\n  hist(colData(speSub)$sum, breaks = 50,\n       main = paste0(\"sum after QC - \", sid), xlab = \"sum\")\n  hist(colData(speSub)$detected, breaks = 50,\n       main = paste0(\"detected after QC - \", sid), xlab = \"detected\")\n  hist(colData(speSub)$subsets_mito_percent, breaks = 50,\n       main = paste0(\"subsets_mito_percent after QC - \", sid),\n       xlab = \"subsets_mito_percent\")\n  speSub &lt;- speSub\n})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nnames(speList) &lt;- unique(colData(spe)$sample_id)\n\n\n\nExamine samples after removal of low quality spots\n\n## vis spots after QC\nlapply(speList, function(speSub){\n  p &lt;- plotSpots(speSub) +\n    ggtitle(speSub@colData$sample_id)\n  p\n\n})\n\n$`334131_11-1_20231103_Hu_pat03_07_squA`\n\n\n\n\n\n\n$`334131_12-2_20231103_Hu_pat03_10_squB`\n\n\n\n\n\n\n$`334131_13-3_20231103_Hu_pat03_9a_squC`\n\n\n\n\n\n\n$`334131_14-4_20231103_Hu_pat03_11_squD`\n\n\n\n\n## cnt spots after QC\nlapply(speList, function(speSub){\n  dim(speSub)\n})\n\n$`334131_11-1_20231103_Hu_pat03_07_squA`\n[1] 60666  1143\n\n$`334131_12-2_20231103_Hu_pat03_10_squB`\n[1] 60666  2809\n\n$`334131_13-3_20231103_Hu_pat03_9a_squC`\n[1] 60666  1992\n\n$`334131_14-4_20231103_Hu_pat03_11_squD`\n[1] 60666  1669\n\n\n\n\nNormalization\n\nspeList &lt;- lapply(speList, function(speSub){\n  speSub &lt;- computeLibraryFactors(speSub)\n  summary(sizeFactors(speSub))\n  sid &lt;- unique(colData(speSub)$sample_id)\n  hist(sizeFactors(speSub), breaks = 20, main = sid)\n  speSub &lt;- logNormCounts(speSub)\n})\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nFeature selection\n\nhvgList &lt;- lapply(speList, function(speSub){\n  # fit mean-variance relationship\n  dec &lt;- modelGeneVar(speSub)\n\n  # visualize mean-variance relationship\n  fit &lt;- metadata(dec)\n  plot(fit$mean, fit$var, \n     xlab = \"mean of log-expression\", ylab = \"variance of log-expression\")\n  curve(fit$trend(x), col = \"dodgerblue\", add = TRUE, lwd = 2)\n  top_hvgs &lt;- getTopHVGs(dec, prop = 0.1)\n})\n\n\n\n\n\n\n\n\n\n\n\n\nnames(hvgList) &lt;- names(speList)\nlengths(hvgList)\n\n334131_11-1_20231103_Hu_pat03_07_squA 334131_12-2_20231103_Hu_pat03_10_squB \n                                 1150                                  1592 \n334131_13-3_20231103_Hu_pat03_9a_squC 334131_14-4_20231103_Hu_pat03_11_squD \n                                 1620                                  1055 \n\n\n\n\nDimensionality reduction\n\nspeList &lt;- lapply(speList, function(speSub){\n  sid &lt;- unique(colData(speSub)$sample_id)\n  top_hvgs &lt;- hvgList[[sid]]\n  speSub &lt;- runPCA(speSub, subset_row = top_hvgs)\n  speSub &lt;- runUMAP(speSub, dimred = \"PCA\")\n  colnames(reducedDim(speSub, \"UMAP\")) &lt;- paste0(\"UMAP\", 1:2)\n  speSub &lt;- speSub\n})\n\nlapply(speList, function(speSub){\n  sid &lt;- unique(colData(speSub)$sample_id)\n  plotDimRed(speSub, type = \"PCA\") + \n    ggtitle(sid)\n})\n\n$`334131_11-1_20231103_Hu_pat03_07_squA`\n\n\n\n\n\n\n$`334131_12-2_20231103_Hu_pat03_10_squB`\n\n\n\n\n\n\n$`334131_13-3_20231103_Hu_pat03_9a_squC`\n\n\n\n\n\n\n$`334131_14-4_20231103_Hu_pat03_11_squD`\n\n\n\n\nlapply(speList, function(speSub){\n  sid &lt;- unique(colData(speSub)$sample_id)\n  plotDimRed(speSub, type = \"UMAP\") + \n    ggtitle(sid)\n})\n\n$`334131_11-1_20231103_Hu_pat03_07_squA`\n\n\n\n\n\n\n$`334131_12-2_20231103_Hu_pat03_10_squB`\n\n\n\n\n\n\n$`334131_13-3_20231103_Hu_pat03_9a_squC`\n\n\n\n\n\n\n$`334131_14-4_20231103_Hu_pat03_11_squD`\n\n\n\n\n\n\n\nclustering\n\nspeList &lt;- lapply(speList, function(speSub){\n  # graph-based clustering\n  k &lt;- 15\n  g &lt;- buildSNNGraph(speSub, k = k, use.dimred = \"PCA\")\n  g_walk &lt;- igraph::cluster_walktrap(g)\n  clus &lt;- g_walk$membership\n  table(clus)\n  colLabels(speSub) &lt;- factor(clus)\n  speSub &lt;- speSub\n})\n\ncolPal &lt;- c(\"#F0027F\", \"#377EB8\", \"#4DAF4A\", \"#984EA3\", \"#FFD700\", \"#FF7F00\",\n            \"#1A1A1A\", \"#666666\", pal_futurama()(10))\nlapply(speList, function(speSub){\n  sid &lt;- unique(colData(speSub)$sample_id)\n  plotSpots(speSub, annotate = \"label\", \n          palette = colPal) + \n    ggtitle(sid)\n})\n\n$`334131_11-1_20231103_Hu_pat03_07_squA`\n\n\n\n\n\n\n$`334131_12-2_20231103_Hu_pat03_10_squB`\n\n\n\n\n\n\n$`334131_13-3_20231103_Hu_pat03_9a_squC`\n\n\n\n\n\n\n$`334131_14-4_20231103_Hu_pat03_11_squD`\n\n\n\n\nlapply(speList, function(speSub){\n  sid &lt;- unique(colData(speSub)$sample_id)\n  plotDimRed(speSub, type = \"UMAP\", \n           annotate = \"label\", palette = colPal) + \n    ggtitle(sid)\n})\n\n$`334131_11-1_20231103_Hu_pat03_07_squA`\n\n\n\n\n\n\n$`334131_12-2_20231103_Hu_pat03_10_squB`\n\n\n\n\n\n\n$`334131_13-3_20231103_Hu_pat03_9a_squC`\n\n\n\n\n\n\n$`334131_14-4_20231103_Hu_pat03_11_squD`\n\n\n\n\nlapply(speList, function(speSub){\n  sid &lt;- unique(colData(speSub)$sample_id)\n  plotDimRed(speSub, type = \"PCA\", \n           annotate = \"label\", palette = colPal) + \n    ggtitle(sid)\n})\n\n$`334131_11-1_20231103_Hu_pat03_07_squA`\n\n\n\n\n\n\n$`334131_12-2_20231103_Hu_pat03_10_squB`\n\n\n\n\n\n\n$`334131_13-3_20231103_Hu_pat03_9a_squC`\n\n\n\n\n\n\n$`334131_14-4_20231103_Hu_pat03_11_squD`\n\n\n\n\n\n\n\nMarker genes\n\nmarkerList &lt;- lapply(speList, function(speSub){\n  rownames(speSub) &lt;- rowData(speSub)$symbol\n  markers &lt;- findMarkers(speSub, test = \"binom\", direction = \"up\")\n})\n\nnames(markerList) &lt;- names(speList)\n\n\n\nSave data\n\nsaveRDS(speList, file = paste0(basedir, \"/data/speAllLNB2.rds\"))\nsaveRDS(markerList, file = paste0(basedir, \"/data/markerAllLNB2.rds\"))\n\n\n\nsession info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods  \n[8] base     \n\nother attached packages:\n [1] Matrix_1.6-5                pheatmap_1.0.12            \n [3] ggsci_3.0.1                 ggpubr_0.6.0               \n [5] scran_1.28.2                scater_1.28.0              \n [7] scuttle_1.10.3              ggspavis_1.6.0             \n [9] here_1.0.1                  SpatialExperiment_1.10.0   \n[11] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2\n[13] Biobase_2.60.0              GenomicRanges_1.52.1       \n[15] GenomeInfoDb_1.36.4         IRanges_2.36.0             \n[17] S4Vectors_0.40.1            BiocGenerics_0.48.0        \n[19] MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[21] lubridate_1.9.3             forcats_1.0.0              \n[23] stringr_1.5.1               dplyr_1.1.4                \n[25] purrr_1.0.2                 readr_2.1.5                \n[27] tidyr_1.3.1                 tibble_3.2.1               \n[29] ggplot2_3.5.0               tidyverse_2.0.0            \n\nloaded via a namespace (and not attached):\n  [1] RColorBrewer_1.1-3        rstudioapi_0.15.0        \n  [3] jsonlite_1.8.8            magrittr_2.0.3           \n  [5] ggbeeswarm_0.7.2          magick_2.8.3             \n  [7] farver_2.1.1              rmarkdown_2.26           \n  [9] zlibbioc_1.46.0           vctrs_0.6.5              \n [11] DelayedMatrixStats_1.22.6 RCurl_1.98-1.14          \n [13] rstatix_0.7.2             htmltools_0.5.7          \n [15] S4Arrays_1.0.6            BiocNeighbors_1.18.0     \n [17] broom_1.0.5               Rhdf5lib_1.22.1          \n [19] rhdf5_2.44.0              htmlwidgets_1.6.4        \n [21] igraph_2.0.2              lifecycle_1.0.4          \n [23] ggside_0.3.1              pkgconfig_2.0.3          \n [25] rsvd_1.0.5                R6_2.5.1                 \n [27] fastmap_1.1.1             GenomeInfoDbData_1.2.10  \n [29] digest_0.6.34             colorspace_2.1-0         \n [31] rprojroot_2.0.4           dqrng_0.3.2              \n [33] irlba_2.3.5.1             beachmat_2.16.0          \n [35] labeling_0.4.3            fansi_1.0.6              \n [37] timechange_0.3.0          abind_1.4-5              \n [39] compiler_4.3.0            bit64_4.0.5              \n [41] withr_3.0.0               backports_1.4.1          \n [43] BiocParallel_1.34.2       carData_3.0-5            \n [45] viridis_0.6.5             HDF5Array_1.28.1         \n [47] R.utils_2.12.3            ggsignif_0.6.4           \n [49] DelayedArray_0.26.7       rjson_0.2.21             \n [51] bluster_1.10.0            tools_4.3.0              \n [53] vipor_0.4.7               beeswarm_0.4.0           \n [55] R.oo_1.26.0               glue_1.7.0               \n [57] rhdf5filters_1.12.1       grid_4.3.0               \n [59] cluster_2.1.6             generics_0.1.3           \n [61] gtable_0.3.4              tzdb_0.4.0               \n [63] R.methodsS3_1.8.2         hms_1.1.3                \n [65] BiocSingular_1.16.0       ScaledMatrix_1.8.1       \n [67] metapod_1.8.0             car_3.1-2                \n [69] utf8_1.2.4                XVector_0.40.0           \n [71] ggrepel_0.9.5             pillar_1.9.0             \n [73] vroom_1.6.5               limma_3.56.2             \n [75] lattice_0.22-5            FNN_1.1.4                \n [77] bit_4.0.5                 tidyselect_1.2.0         \n [79] locfit_1.5-9.9            knitr_1.45               \n [81] gridExtra_2.3             edgeR_3.42.4             \n [83] xfun_0.42                 statmod_1.5.0            \n [85] DropletUtils_1.20.0       stringi_1.8.3            \n [87] yaml_2.3.8                evaluate_0.23            \n [89] codetools_0.2-19          cli_3.6.2                \n [91] uwot_0.1.16               munsell_0.5.0            \n [93] Rcpp_1.0.12               parallel_4.3.0           \n [95] sparseMatrixStats_1.12.2  bitops_1.0-7             \n [97] viridisLite_0.4.2         scales_1.3.0             \n [99] crayon_1.5.2              rlang_1.1.3"
  },
  {
    "objectID": "analysis/visLECMarkerGenes_woCM.html",
    "href": "analysis/visLECMarkerGenes_woCM.html",
    "title": "visualize marker genes LECs",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visLECMarkerGenes_woCM.html#load-packages",
    "href": "analysis/visLECMarkerGenes_woCM.html#load-packages",
    "title": "visualize marker genes LECs",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visLECMarkerGenes_woCM.html#load-seurat-object",
    "href": "analysis/visLECMarkerGenes_woCM.html#load-seurat-object",
    "title": "visualize marker genes LECs",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\nseurat &lt;- readRDS(file= paste0(basedir,\n                            \"/data/AllPatWithoutCM_LEConly_intOrig_seurat.rds\"))\n\nDefaultAssay(object = seurat) &lt;- \"RNA\"\nseurat$intCluster &lt;- seurat$integrated_snn_res.0.25\nIdents(seurat) &lt;- seurat$intCluster\n\n\n## set col palettes\ncolPal &lt;- colPal &lt;- c(pal_nejm()(8))[1:length(unique(seurat$intCluster))]\nnames(colPal) &lt;- unique(seurat$intCluster)\ncolLab &lt;- c(\"#79AF97FF\",\"#374E55FF\",\"#B24745FF\",\"#DF8F44FF\",\"#6A6599FF\",\n             \"#D595A7FF\")\nnames(colLab) &lt;- c(\"SCScLEC\",\"MedCapsLEC\",  \"SCSfLEC\", \"MedSinusLEC\",  \n                   \"ParacortLEC\",\"ValveLEC\")\n\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond) &lt;- unique(seurat$cond)\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\n\ncolCond2 &lt;- c(\"#6692a3\",\"#971c1c\")\nnames(colCond2) &lt;- c(\"resting\", \"activated\")"
  },
  {
    "objectID": "analysis/visLECMarkerGenes_woCM.html#visualize-data",
    "href": "analysis/visLECMarkerGenes_woCM.html#visualize-data",
    "title": "visualize marker genes LECs",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPal, pt.size=0.5)+\n  theme_void()\n\n\n\n\n\n\ncluster split by cond\n\nDimPlot(seurat, reduction = \"umap\", cols=colPal, pt.size=0.5,\n        split.by = \"cond2\")+\n  theme_void()\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()\n\n\n\n\n\n\ncond\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()\n\n\n\n\n\n\ngrp\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/visLECMarkerGenes_woCM.html#vis-cluster-marker",
    "href": "analysis/visLECMarkerGenes_woCM.html#vis-cluster-marker",
    "title": "visualize marker genes LECs",
    "section": "vis cluster marker",
    "text": "vis cluster marker\n\nmarker genes\n\nseurat_markers_all &lt;- FindAllMarkers(object = seurat, assay =\"RNA\",\n                                     only.pos = TRUE, min.pct = 0.25,\n                                     logfc.threshold = 0.25,\n                                     test.use = \"wilcox\")\n\n\n\navg heatmap\n\ncluster &lt;- levels(seurat)\nselGenesAll &lt;- seurat_markers_all %&gt;% group_by(cluster) %&gt;% \n  top_n(-20, p_val_adj) %&gt;% \n  top_n(20, avg_log2FC)\nselGenesAll &lt;- selGenesAll %&gt;% mutate(geneIDval=gsub(\"^.*\\\\.\", \"\", gene)) %&gt;% filter(nchar(geneIDval)&gt;1)\n\nIdents(seurat) &lt;- seurat$intCluster\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=FALSE,\n                  cr=T, condCol=F)"
  },
  {
    "objectID": "analysis/visLECMarkerGenes_woCM.html#write-table",
    "href": "analysis/visLECMarkerGenes_woCM.html#write-table",
    "title": "visualize marker genes LECs",
    "section": "write table",
    "text": "write table\n\nwrite.table(seurat_markers_all,\n            file=paste0(basedir,\n                        \"/data/AllPatWithoutCM_LEConly_intOrig_markerGenes.txt\"),\n            row.names = FALSE, col.names = TRUE, quote = FALSE, sep = \"\\t\")"
  },
  {
    "objectID": "analysis/visLECMarkerGenes_woCM.html#asign-labels",
    "href": "analysis/visLECMarkerGenes_woCM.html#asign-labels",
    "title": "visualize marker genes LECs",
    "section": "asign labels",
    "text": "asign labels\n\nseurat$label &lt;- \"SCScLEC\"\nseurat$label[which(seurat$intCluster %in% c(\"1\"))] &lt;- \"SCSfLEC\"\nseurat$label[which(seurat$intCluster %in% c(\"2\"))] &lt;- \"MedSinusLEC\"\nseurat$label[which(seurat$intCluster %in% c(\"3\"))] &lt;- \"MedCapsLEC\"\nseurat$label[which(seurat$intCluster %in% c(\"4\"))] &lt;- \"ParacortLEC\"\nseurat$label[which(seurat$intCluster %in% c(\"7\"))] &lt;- \"ValveLEC\""
  },
  {
    "objectID": "analysis/visLECMarkerGenes_woCM.html#visualize-label",
    "href": "analysis/visLECMarkerGenes_woCM.html#visualize-label",
    "title": "visualize marker genes LECs",
    "section": "visualize label",
    "text": "visualize label\n\nIdents(seurat) &lt;- seurat$label\n\nDimPlot(seurat, reduction = \"umap\", cols=colLab)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colLab, pt.size=0.5)+\n  theme_void()"
  },
  {
    "objectID": "analysis/visLECMarkerGenes_woCM.html#vis-selected-lec-marker",
    "href": "analysis/visLECMarkerGenes_woCM.html#vis-selected-lec-marker",
    "title": "visualize marker genes LECs",
    "section": "vis selected LEC marker",
    "text": "vis selected LEC marker\n\ngenes &lt;- data.frame(gene=rownames(seurat)) %&gt;% \n    mutate(geneID=gsub(\"^.*\\\\.\", \"\", gene)) \n\nselGenesAll &lt;- read_tsv(file = paste0(basedir,\n                                      \"/data/overallLECMarker.txt\")) %&gt;% \n  left_join(., genes, by = \"geneID\")\n\nseurat$label &lt;- factor(seurat$label, levels = names(colLab))\nIdents(seurat) &lt;- seurat$label\n\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colLab, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=F,\n                  cr=F, condCol=F)\n\n\n\n\n\nDotplot\n\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenesAll$gene), scale =T,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenesAll$gene), labels=rev(selGenesAll$geneID)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenesAll$gene), scale =F,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenesAll$gene), labels=rev(selGenesAll$geneID)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\n\n\n\nFeatureplot\n\npList &lt;- sapply(selGenesAll$gene, function(x){\np &lt;- FeaturePlot(seurat, reduction = \"umap\", \n            features = x,\n            cols=c(\"lightgrey\", \"darkred\"),\n            order = F)+\n  theme(legend.position=\"right\")\n  plot(p)\n})"
  },
  {
    "objectID": "analysis/visLECMarkerGenes_woCM.html#save-labeled-seurat-object",
    "href": "analysis/visLECMarkerGenes_woCM.html#save-labeled-seurat-object",
    "title": "visualize marker genes LECs",
    "section": "save labeled seurat object",
    "text": "save labeled seurat object\n\nsaveRDS(seurat, paste0(basedir,\n                            \"/data/AllPatWithoutCM_LEConly_intOrig_label\",\n                       \"_seurat.rds\"))"
  },
  {
    "objectID": "analysis/visLECMarkerGenes_woCM.html#session-info",
    "href": "analysis/visLECMarkerGenes_woCM.html#session-info",
    "title": "visualize marker genes LECs",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] scater_1.28.0               scuttle_1.10.3              SingleCellExperiment_1.22.0\n [4] SummarizedExperiment_1.30.2 Biobase_2.60.0              GenomicRanges_1.52.1       \n [7] GenomeInfoDb_1.36.4         IRanges_2.36.0              S4Vectors_0.40.1           \n[10] BiocGenerics_0.48.0         MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[13] pheatmap_1.0.12             ggsci_3.0.1                 here_1.0.1                 \n[16] runSeurat3_0.1.0            ggpubr_0.6.0                lubridate_1.9.3            \n[19] forcats_1.0.0               stringr_1.5.1               readr_2.1.5                \n[22] tidyr_1.3.1                 tibble_3.2.1                tidyverse_2.0.0            \n[25] Seurat_5.0.2                SeuratObject_5.0.1          sp_2.1-3                   \n[28] purrr_1.0.2                 cowplot_1.1.3               ggplot2_3.5.0              \n[31] reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             rprojroot_2.0.4          \n [10] vroom_1.6.5               globals_0.16.2            lattice_0.22-5           \n [13] MASS_7.3-60.0.1           backports_1.4.1           magrittr_2.0.3           \n [16] limma_3.56.2              plotly_4.10.4             rmarkdown_2.26           \n [19] yaml_2.3.8                httpuv_1.6.14             sctransform_0.4.1        \n [22] spam_2.10-0               spatstat.sparse_3.0-3     reticulate_1.35.0        \n [25] pbapply_1.7-2             RColorBrewer_1.1-3        abind_1.4-5              \n [28] zlibbioc_1.46.0           Rtsne_0.17                RCurl_1.98-1.14          \n [31] GenomeInfoDbData_1.2.10   ggrepel_0.9.5             irlba_2.3.5.1            \n [34] listenv_0.9.1             spatstat.utils_3.0-4      goftest_1.2-3            \n [37] RSpectra_0.16-1           spatstat.random_3.2-3     fitdistrplus_1.1-11      \n [40] parallelly_1.37.1         DelayedMatrixStats_1.22.6 leiden_0.4.3.1           \n [43] codetools_0.2-19          DelayedArray_0.26.7       tidyselect_1.2.0         \n [46] farver_2.1.1              viridis_0.6.5             ScaledMatrix_1.8.1       \n [49] spatstat.explore_3.2-6    jsonlite_1.8.8            BiocNeighbors_1.18.0     \n [52] ellipsis_0.3.2            progressr_0.14.0          ggridges_0.5.6           \n [55] survival_3.5-8            tools_4.3.0               ica_1.0-3                \n [58] Rcpp_1.0.12               glue_1.7.0                gridExtra_2.3            \n [61] xfun_0.42                 withr_3.0.0               fastmap_1.1.1            \n [64] fansi_1.0.6               rsvd_1.0.5                digest_0.6.34            \n [67] timechange_0.3.0          R6_2.5.1                  mime_0.12                \n [70] colorspace_2.1-0          scattermore_1.2           tensor_1.5               \n [73] spatstat.data_3.0-4       utf8_1.2.4                generics_0.1.3           \n [76] data.table_1.15.2         httr_1.4.7                htmlwidgets_1.6.4        \n [79] S4Arrays_1.0.6            uwot_0.1.16               pkgconfig_2.0.3          \n [82] gtable_0.3.4              lmtest_0.9-40             XVector_0.40.0           \n [85] htmltools_0.5.7           carData_3.0-5             dotCall64_1.1-1          \n [88] scales_1.3.0              png_0.1-8                 knitr_1.45               \n [91] rstudioapi_0.15.0         tzdb_0.4.0                nlme_3.1-164             \n [94] zoo_1.8-12                KernSmooth_2.23-22        vipor_0.4.7              \n [97] parallel_4.3.0            miniUI_0.1.1.1            pillar_1.9.0             \n[100] grid_4.3.0                vctrs_0.6.5               RANN_2.6.1               \n[103] promises_1.2.1            BiocSingular_1.16.0       car_3.1-2                \n[106] beachmat_2.16.0           xtable_1.8-4              cluster_2.1.6            \n[109] beeswarm_0.4.0            evaluate_0.23             cli_3.6.2                \n[112] compiler_4.3.0            rlang_1.1.3               crayon_1.5.2             \n[115] future.apply_1.11.1       ggsignif_0.6.4            labeling_0.4.3           \n[118] ggbeeswarm_0.7.2          plyr_1.8.9                stringi_1.8.3            \n[121] BiocParallel_1.34.2       viridisLite_0.4.2         deldir_2.0-4             \n[124] munsell_0.5.0             lazyeval_0.2.2            spatstat.geom_3.2-9      \n[127] Matrix_1.6-5              RcppHNSW_0.6.0            hms_1.1.3                \n[130] patchwork_1.2.0           bit64_4.0.5               sparseMatrixStats_1.12.2 \n[133] future_1.33.1             shiny_1.8.0               ROCR_1.0-11              \n[136] igraph_2.0.2              broom_1.0.5               bit_4.0.5                \n\ndate()\n\n[1] \"Thu Mar  7 10:16:46 2024\""
  },
  {
    "objectID": "analysis/visBECMarkerGenes_woCM.html",
    "href": "analysis/visBECMarkerGenes_woCM.html",
    "title": "visualize BEC marker human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visBECMarkerGenes_woCM.html#load-packages",
    "href": "analysis/visBECMarkerGenes_woCM.html#load-packages",
    "title": "visualize BEC marker human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visBECMarkerGenes_woCM.html#load-seurat-object",
    "href": "analysis/visBECMarkerGenes_woCM.html#load-seurat-object",
    "title": "visualize BEC marker human LN",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\n\nseurat &lt;- readRDS(file= paste0(basedir,\n                            \"/data/AllPatWithoutCM_BEConly_intOrig_seurat.rds\"))\n\nDefaultAssay(object = seurat) &lt;- \"RNA\"\nseurat$intCluster &lt;- seurat$integrated_snn_res.0.4\nIdents(seurat) &lt;- seurat$intCluster\n\n\n## set col palettes\ncolPal &lt;- colPal &lt;- c(pal_nejm()(8))[1:length(unique(seurat$intCluster))]\nnames(colPal) &lt;- unique(seurat$intCluster)\n\ncolLab &lt;- c(\"#79AF97FF\",\"#374E55FF\",\"#B24745FF\",\"#DF8F44FF\",\"#6A6599FF\",\n             \"#D595A7FF\")\nnames(colLab) &lt;- c(\"SCScLEC\",\"MedCapsLEC\",  \"SCSfLEC\", \"MedSinusLEC\",  \n                   \"ParacortLEC\",\"ValveLEC\")\n\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond) &lt;- unique(seurat$cond)\ncolGrp &lt;- pal_uchicago()(length(unique(seurat$grp)))\nnames(colGrp) &lt;- unique(seurat$grp)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\n\ncolCond2 &lt;- c(\"#6692a3\",\"#971c1c\")\nnames(colCond2) &lt;- c(\"resting\", \"activated\")"
  },
  {
    "objectID": "analysis/visBECMarkerGenes_woCM.html#visualize-data",
    "href": "analysis/visBECMarkerGenes_woCM.html#visualize-data",
    "title": "visualize BEC marker human LN",
    "section": "visualize data",
    "text": "visualize data\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPal, pt.size=0.5)+\n  theme_void()\n\n\n\n\n\n\ncluster split by cond\n\nDimPlot(seurat, reduction = \"umap\", cols=colPal, pt.size=0.5,\n        split.by = \"cond2\")+\n  theme_void()\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()\n\n\n\n\n\n\ncond\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colCond2, group.by = \"cond2\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()\n\n\n\n\n\n\ngrp\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colGrp, group.by = \"grp\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\n\n\n\norigin\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colOri, group.by = \"origin\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")"
  },
  {
    "objectID": "analysis/visBECMarkerGenes_woCM.html#vis-cluster-marker",
    "href": "analysis/visBECMarkerGenes_woCM.html#vis-cluster-marker",
    "title": "visualize BEC marker human LN",
    "section": "vis cluster marker",
    "text": "vis cluster marker\n\nmarker genes\n\nseurat_markers_all &lt;- FindAllMarkers(object = seurat, assay =\"RNA\",\n                                     only.pos = TRUE, min.pct = 0.25,\n                                     logfc.threshold = 0.25,\n                                     test.use = \"wilcox\")\n\n\n\navg heatmap\n\ncluster &lt;- levels(seurat)\nselGenesAll &lt;- seurat_markers_all %&gt;% group_by(cluster) %&gt;% \n  top_n(-20, p_val_adj) %&gt;% \n  top_n(20, avg_log2FC)\nselGenesAll &lt;- selGenesAll %&gt;% mutate(geneIDval=gsub(\"^.*\\\\.\", \"\", gene)) %&gt;% filter(nchar(geneIDval)&gt;1)\n\nIdents(seurat) &lt;- seurat$intCluster\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colPal, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=FALSE,\n                  cr=T, condCol=F)"
  },
  {
    "objectID": "analysis/visBECMarkerGenes_woCM.html#write-table",
    "href": "analysis/visBECMarkerGenes_woCM.html#write-table",
    "title": "visualize BEC marker human LN",
    "section": "write table",
    "text": "write table\n\nwrite.table(seurat_markers_all,\n            file=paste0(basedir,\n                        \"/data/AllPatWithoutCM_LEConly_intOrig_markerGenes.txt\"),\n            row.names = FALSE, col.names = TRUE, quote = FALSE, sep = \"\\t\")"
  },
  {
    "objectID": "analysis/visBECMarkerGenes_woCM.html#asign-labels",
    "href": "analysis/visBECMarkerGenes_woCM.html#asign-labels",
    "title": "visualize BEC marker human LN",
    "section": "asign labels",
    "text": "asign labels\n\nseurat$label &lt;- \"ABEC\"\nseurat$label[which(seurat$intCluster %in% c(\"3\"))] &lt;- \"aBEC\"\nseurat$label[which(seurat$intCluster %in% c(\"2\"))] &lt;- \"cBEC\"\nseurat$label[which(seurat$intCluster %in% c(\"9\"))] &lt;- \"CapIfn\"\nseurat$label[which(seurat$intCluster %in% c(\"6\"))] &lt;- \"VBEC\"\nseurat$label[which(seurat$intCluster %in% c(\"0\"))] &lt;- \"aHEV\"\nseurat$label[which(seurat$intCluster %in% c(\"1\"))] &lt;- \"hHEV1\"\nseurat$label[which(seurat$intCluster %in% c(\"4\"))] &lt;- \"hHEV2\"\n\n\nseurat$label2 &lt;- \"Venous\"\nseurat$label2[which(seurat$intCluster %in% c(\"2\", \"9\"))] &lt;- \"Cappilary\"\nseurat$label2[which(seurat$intCluster %in% c(\"5\", \"3\"))] &lt;- \"Arterial\"\n\n\ncolLab &lt;- c(\"#74242a\", \"#a74a51\", \"#c79113\", \"#71530b\", \"#242b3f\", \"#3f4a6e\",\n                     \"#5f6a8e\", \"#a4aabf\")\nnames(colLab) &lt;- c(\"ABEC\",\"aBEC\",  \"cBEC\", \"CapIfn\", \"VBEC\", \"hHEV1\", \n                   \"hHEV2\", \"aHEV\")\n\ncolLab2 &lt;- c(\"#48557e\", \"#e3a616\",\"#9a3038\")\nnames(colLab2) &lt;- c(\"Venous\", \"Cappilary\", \"Arterial\")"
  },
  {
    "objectID": "analysis/visBECMarkerGenes_woCM.html#visualize-label",
    "href": "analysis/visBECMarkerGenes_woCM.html#visualize-label",
    "title": "visualize BEC marker human LN",
    "section": "visualize label",
    "text": "visualize label\n\nIdents(seurat) &lt;- seurat$label\n\nDimPlot(seurat, reduction = \"umap\", cols=colLab)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colLab, pt.size=0.5)+\n  theme_void()"
  },
  {
    "objectID": "analysis/visBECMarkerGenes_woCM.html#visualize-label2",
    "href": "analysis/visBECMarkerGenes_woCM.html#visualize-label2",
    "title": "visualize BEC marker human LN",
    "section": "visualize label2",
    "text": "visualize label2\n\nIdents(seurat) &lt;- seurat$label2\n\nDimPlot(seurat, reduction = \"umap\", cols=colLab2)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colLab2, pt.size=0.5)+\n  theme_void()"
  },
  {
    "objectID": "analysis/visBECMarkerGenes_woCM.html#vis-selected-bec-marker",
    "href": "analysis/visBECMarkerGenes_woCM.html#vis-selected-bec-marker",
    "title": "visualize BEC marker human LN",
    "section": "vis selected BEC marker",
    "text": "vis selected BEC marker\n\ngenes &lt;- data.frame(gene=rownames(seurat)) %&gt;% \n    mutate(geneID=gsub(\"^.*\\\\.\", \"\", gene)) \n\nselGenesAll &lt;- read_tsv(file = paste0(basedir,\n                                      \"/data/overallBECMarker.txt\")) %&gt;% \n  left_join(., genes, by = \"geneID\")\n\nseurat$label &lt;- factor(seurat$label, levels = names(colLab))\nIdents(seurat) &lt;- seurat$label\n\npOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n                  colVecIdent = colLab, \n                  ordVec=levels(seurat),\n                  gapVecR=NULL, gapVecC=NULL,cc=F,\n                  cr=F, condCol=F)\n\n\n\n\n\nDotplot\n\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenesAll$gene), scale =T,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenesAll$gene), labels=rev(selGenesAll$geneID)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenesAll$gene), scale =F,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenesAll$gene), labels=rev(selGenesAll$geneID)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\n\n\n\nFeatureplot\n\npList &lt;- sapply(selGenesAll$gene, function(x){\np &lt;- FeaturePlot(seurat, reduction = \"umap\", \n            features = x,\n            cols=c(\"lightgrey\", \"darkred\"),\n            order = F)+\n  theme(legend.position=\"right\")\n  plot(p)\n})"
  },
  {
    "objectID": "analysis/visBECMarkerGenes_woCM.html#save-labeled-seurat-object",
    "href": "analysis/visBECMarkerGenes_woCM.html#save-labeled-seurat-object",
    "title": "visualize BEC marker human LN",
    "section": "save labeled seurat object",
    "text": "save labeled seurat object\n\nsaveRDS(seurat, paste0(basedir,\n                            \"/data/AllPatWithoutCM_BEConly_intOrig_label\",\n                       \"_seurat.rds\"))"
  },
  {
    "objectID": "analysis/visBECMarkerGenes_woCM.html#session-info",
    "href": "analysis/visBECMarkerGenes_woCM.html#session-info",
    "title": "visualize BEC marker human LN",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] scater_1.28.0               scuttle_1.10.3              SingleCellExperiment_1.22.0\n [4] SummarizedExperiment_1.30.2 Biobase_2.60.0              GenomicRanges_1.52.1       \n [7] GenomeInfoDb_1.36.4         IRanges_2.36.0              S4Vectors_0.40.1           \n[10] BiocGenerics_0.48.0         MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[13] pheatmap_1.0.12             ggsci_3.0.1                 here_1.0.1                 \n[16] runSeurat3_0.1.0            ggpubr_0.6.0                lubridate_1.9.3            \n[19] forcats_1.0.0               stringr_1.5.1               readr_2.1.5                \n[22] tidyr_1.3.1                 tibble_3.2.1                tidyverse_2.0.0            \n[25] Seurat_5.0.2                SeuratObject_5.0.1          sp_2.1-3                   \n[28] purrr_1.0.2                 cowplot_1.1.3               ggplot2_3.5.0              \n[31] reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             rprojroot_2.0.4          \n [10] vroom_1.6.5               globals_0.16.2            lattice_0.22-5           \n [13] MASS_7.3-60.0.1           backports_1.4.1           magrittr_2.0.3           \n [16] limma_3.56.2              plotly_4.10.4             rmarkdown_2.26           \n [19] yaml_2.3.8                httpuv_1.6.14             sctransform_0.4.1        \n [22] spam_2.10-0               spatstat.sparse_3.0-3     reticulate_1.35.0        \n [25] pbapply_1.7-2             RColorBrewer_1.1-3        abind_1.4-5              \n [28] zlibbioc_1.46.0           Rtsne_0.17                RCurl_1.98-1.14          \n [31] GenomeInfoDbData_1.2.10   ggrepel_0.9.5             irlba_2.3.5.1            \n [34] listenv_0.9.1             spatstat.utils_3.0-4      goftest_1.2-3            \n [37] RSpectra_0.16-1           spatstat.random_3.2-3     fitdistrplus_1.1-11      \n [40] parallelly_1.37.1         DelayedMatrixStats_1.22.6 leiden_0.4.3.1           \n [43] codetools_0.2-19          DelayedArray_0.26.7       tidyselect_1.2.0         \n [46] farver_2.1.1              viridis_0.6.5             ScaledMatrix_1.8.1       \n [49] spatstat.explore_3.2-6    jsonlite_1.8.8            BiocNeighbors_1.18.0     \n [52] ellipsis_0.3.2            progressr_0.14.0          ggridges_0.5.6           \n [55] survival_3.5-8            tools_4.3.0               ica_1.0-3                \n [58] Rcpp_1.0.12               glue_1.7.0                gridExtra_2.3            \n [61] xfun_0.42                 withr_3.0.0               fastmap_1.1.1            \n [64] fansi_1.0.6               rsvd_1.0.5                digest_0.6.34            \n [67] timechange_0.3.0          R6_2.5.1                  mime_0.12                \n [70] colorspace_2.1-0          scattermore_1.2           tensor_1.5               \n [73] spatstat.data_3.0-4       utf8_1.2.4                generics_0.1.3           \n [76] data.table_1.15.2         httr_1.4.7                htmlwidgets_1.6.4        \n [79] S4Arrays_1.0.6            uwot_0.1.16               pkgconfig_2.0.3          \n [82] gtable_0.3.4              lmtest_0.9-40             XVector_0.40.0           \n [85] htmltools_0.5.7           carData_3.0-5             dotCall64_1.1-1          \n [88] scales_1.3.0              png_0.1-8                 knitr_1.45               \n [91] rstudioapi_0.15.0         tzdb_0.4.0                nlme_3.1-164             \n [94] zoo_1.8-12                KernSmooth_2.23-22        vipor_0.4.7              \n [97] parallel_4.3.0            miniUI_0.1.1.1            pillar_1.9.0             \n[100] grid_4.3.0                vctrs_0.6.5               RANN_2.6.1               \n[103] promises_1.2.1            BiocSingular_1.16.0       car_3.1-2                \n[106] beachmat_2.16.0           xtable_1.8-4              cluster_2.1.6            \n[109] beeswarm_0.4.0            evaluate_0.23             cli_3.6.2                \n[112] compiler_4.3.0            rlang_1.1.3               crayon_1.5.2             \n[115] future.apply_1.11.1       ggsignif_0.6.4            labeling_0.4.3           \n[118] ggbeeswarm_0.7.2          plyr_1.8.9                stringi_1.8.3            \n[121] BiocParallel_1.34.2       viridisLite_0.4.2         deldir_2.0-4             \n[124] munsell_0.5.0             lazyeval_0.2.2            spatstat.geom_3.2-9      \n[127] Matrix_1.6-5              RcppHNSW_0.6.0            hms_1.1.3                \n[130] patchwork_1.2.0           bit64_4.0.5               sparseMatrixStats_1.12.2 \n[133] future_1.33.1             shiny_1.8.0               ROCR_1.0-11              \n[136] igraph_2.0.2              broom_1.0.5               bit_4.0.5                \n\ndate()\n\n[1] \"Thu Mar  7 10:20:23 2024\""
  },
  {
    "objectID": "analysis/createRefDatasetIntImm.html",
    "href": "analysis/createRefDatasetIntImm.html",
    "title": "create Ref dataset celltype decomposition",
    "section": "",
    "text": "library(tidyverse)\nlibrary(SpatialExperiment)\nlibrary(here)\nlibrary(ggspavis)\nlibrary(scater)\nlibrary(ggsci)\nlibrary(scran)\nlibrary(pheatmap)\nlibrary(SpaTalk)\nlibrary(Matrix)\nlibrary(Seurat)\nlibrary(igraph)"
  },
  {
    "objectID": "analysis/createRefDatasetIntImm.html#sample-1",
    "href": "analysis/createRefDatasetIntImm.html#sample-1",
    "title": "create Ref dataset celltype decomposition",
    "section": "Sample 1",
    "text": "Sample 1\n\nLoad reference data and fuse label\n\nbasedir &lt;- here()\n\nseuratFRC &lt;- readRDS(file= paste0(basedir,\n                            \"/data/AllPatWithoutCM_FRConly_intOrig\", \n                            \"_seurat.rds\"))\nseuratBEC &lt;- readRDS(file= paste0(basedir,\n                            \"/data/AllPatWithoutCM_BEConly_intOrig_label\", \n                            \"_seurat.rds\"))\nseuratLEC &lt;- readRDS(file= paste0(basedir,\n                            \"/data/AllPatWithoutCM_LEConly_intOrig_label\", \n                            \"_seurat.rds\"))\nseuratIMM &lt;- readRDS(file= paste0(basedir,\n                            \"/data/AllPatWithoutCM_IMMMerged_integrated_label\",\n                       \"_seurat.rds\"))\n\n## add label FRCs\nseuratFRC$label &lt;- \"medRCIFRC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"7\")] &lt;- \"BRC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"2\")] &lt;- \"TRC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"3\")] &lt;- \"ACTA2+PRC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"4\")] &lt;- \"VSMC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"5\")] &lt;- \"PI16+RC\"\nseuratFRC$label[which(seuratFRC$intCluster == \"6\")] &lt;- \"PRC1\"\n\n## group imm cells\nseuratIMM$label2 &lt;- seuratIMM$label\nseuratIMM$label &lt;- as.character(seuratIMM$label)\nseuratIMM$label[which(seuratIMM$label %in% c(\"naiveCD4-2\", \"naiveCD4-3\",\n                                             \"naiveCD4-1\", \"Treg\" ))] &lt;- \"CD4T\"\nseuratIMM$label[which(seuratIMM$label %in% c(\"pDC-2\", \"pDC-1\" ))] &lt;- \"pDC\"\nseuratIMM$label[which(seuratIMM$label %in% c(\"naiveB\", \"preB\" ))] &lt;- \"naiveB\"\n\n\n## group BEC\nseuratBEC$label3 &lt;- seuratBEC$label\nseuratBEC$label &lt;- \"artBEC\"\nseuratBEC$label[which(seuratBEC$label2 == \"Cappilary\")] &lt;- \"capBEC\"\nseuratBEC$label[which(seuratBEC$label2 == \"Venous\")] &lt;- \"venBEC\"\n\n## group LEC\n#seuratLEC$label2 &lt;- seuratLEC$label\nseuratLEC$label &lt;- as.character(seuratLEC$label)\nseuratLEC &lt;- subset(seuratLEC, label %in% c(\"SCScLEC\", \"SCSfLEC\", \"MedSinusLEC\"))\n#seuratLEC$label[which(seuratLEC$label2 %in% c(\"MedCapsLEC\", \"SCScLEC\",\n#                                              \"ValveLEC\"))] &lt;- \"cLECcaps\"\n#seuratLEC$label[which(seuratLEC$label2 %in% c(\"MedSinusLEC\",\n#                                              \"ParacortLEC\"))] &lt;-\"MedSinPlusParaLEC\"\n\n\nrefSeurat &lt;- merge(seuratFRC, c(seuratIMM, seuratBEC, seuratLEC))\nremove(seuratIMM, seuratLEC, seuratBEC, seuratFRC)\nrefSeurat &lt;- subset(refSeurat, cond == \"resting\")\nrefSeurat &lt;- NormalizeData(object = refSeurat)\nrefSeurat &lt;- FindVariableFeatures(object = refSeurat)\nrefSeurat &lt;- ScaleData(object = refSeurat, verbose = FALSE)\nrefSeurat &lt;- RunPCA(object = refSeurat, npcs = 30, verbose = FALSE)\nrefSeurat &lt;- RunTSNE(object = refSeurat, reduction = \"pca\", dims = 1:20)\nrefSeurat &lt;- RunUMAP(object = refSeurat, reduction = \"pca\", dims = 1:20)\n\nsaveRDS(refSeurat, file = paste0(basedir, \"/data/refSeurat_allCelltypesIntImm.rds\"))\n\n\n\nset color palettes\n\ncolLEC &lt;- c(\"#79AF97FF\",\"#B24745FF\",\"#DF8F44FF\")\nnames(colLEC) &lt;- c(\"SCScLEC\", \"SCSfLEC\", \"MedSinusLEC\")\n\ncolBEC &lt;- c(\"#48557e\", \"#e3a616\",\"#9a3038\")\nnames(colBEC) &lt;- c(\"venBEC\", \"capBEC\", \"artBEC\")\n\n\ncolFRC &lt;- c(\"#800000FF\", \"#FFA319FF\",\"#8A9045FF\", \"#155F83FF\",\n            \"#C16622FF\", \"#6692a3\", \"#3b7f60\")\nnames(colFRC) &lt;- c(\"medRCIFRC\", \"TRC\", \"ACTA2+PRC\", \"VSMC\", \"PI16+RC\", \"PRC1\",\n                   \"BRC\")\n\n\ncolImm &lt;- c(\"#0b6647\", \"#54907e\", \"#94c78a\", \"#6f9568\", \n            \"#8f2810\", \"#d0ac21\",\"#9e9f0b\", \"#486584\",\n            \"#4b5397\", \"#8873d3\", \"#6e3e7a\")\n            \nnames(colImm) &lt;- c(\"naiveB\", \"GCB\", \"MBC\", \"plasmaCell\",\n                   \"CD4T\", \"CD8Tcm\", \"CTL/NKcell\", \"ILC3\", \"pDC\", \"Mph/DC-1\",\n                   \"Mph/DC-2\")\n\ncolAll &lt;- c(colFRC, colBEC, colLEC, colImm) \n\ncolPal &lt;- c(\"#F0027F\", \"#377EB8\", \"#4DAF4A\", \"#984EA3\", \"#FFD700\",\n            \"#FF7F00\", \"#1A1A1A\", \"#666666\", pal_futurama()(10))\n\n\n\nvis ref data\n\nIdents(refSeurat) &lt;- refSeurat$label\nDimPlot(refSeurat, reduction = \"umap\", cols = colAll, raster = F, shuffle = T)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(refSeurat, reduction = \"umap\", cols = colAll, raster = F, shuffle = T,\n        pt.size=0.7)+\n  theme_void()"
  },
  {
    "objectID": "analysis/createRefDatasetIntImm.html#session-info",
    "href": "analysis/createRefDatasetIntImm.html#session-info",
    "title": "create Ref dataset celltype decomposition",
    "section": "Session info",
    "text": "Session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] parallel  stats4    stats     graphics  grDevices utils     datasets \n[8] methods   base     \n\nother attached packages:\n [1] igraph_2.0.2                Seurat_5.0.2               \n [3] SeuratObject_5.0.1          sp_2.1-3                   \n [5] Matrix_1.6-5                SpaTalk_1.0                \n [7] doParallel_1.0.17           iterators_1.0.14           \n [9] foreach_1.5.2               ggalluvial_0.12.5          \n[11] pheatmap_1.0.12             scran_1.28.2               \n[13] ggsci_3.0.1                 scater_1.28.0              \n[15] scuttle_1.10.3              ggspavis_1.6.0             \n[17] here_1.0.1                  SpatialExperiment_1.10.0   \n[19] SingleCellExperiment_1.22.0 SummarizedExperiment_1.30.2\n[21] Biobase_2.60.0              GenomicRanges_1.52.1       \n[23] GenomeInfoDb_1.36.4         IRanges_2.36.0             \n[25] S4Vectors_0.40.1            BiocGenerics_0.48.0        \n[27] MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[29] lubridate_1.9.3             forcats_1.0.0              \n[31] stringr_1.5.1               dplyr_1.1.4                \n[33] purrr_1.0.2                 readr_2.1.5                \n[35] tidyr_1.3.1                 tibble_3.2.1               \n[37] ggplot2_3.5.0               tidyverse_2.0.0            \n\nloaded via a namespace (and not attached):\n  [1] spatstat.sparse_3.0-3     bitops_1.0-7             \n  [3] httr_1.4.7                RColorBrewer_1.1-3       \n  [5] backports_1.4.1           tools_4.3.0              \n  [7] sctransform_0.4.1         utf8_1.2.4               \n  [9] R6_2.5.1                  HDF5Array_1.28.1         \n [11] lazyeval_0.2.2            uwot_0.1.16              \n [13] rhdf5filters_1.12.1       withr_3.0.0              \n [15] prettyunits_1.2.0         gridExtra_2.3            \n [17] progressr_0.14.0          cli_3.6.2                \n [19] spatstat.explore_3.2-6    fastDummies_1.7.3        \n [21] scatterpie_0.2.1          labeling_0.4.3           \n [23] spatstat.data_3.0-4       ggridges_0.5.6           \n [25] pbapply_1.7-2             R.utils_2.12.3           \n [27] parallelly_1.37.1         limma_3.56.2             \n [29] rstudioapi_0.15.0         generics_0.1.3           \n [31] ica_1.0-3                 spatstat.random_3.2-3    \n [33] car_3.1-2                 ggbeeswarm_0.7.2         \n [35] fansi_1.0.6               abind_1.4-5              \n [37] R.methodsS3_1.8.2         lifecycle_1.0.4          \n [39] yaml_2.3.8                edgeR_3.42.4             \n [41] carData_3.0-5             rhdf5_2.44.0             \n [43] Rtsne_0.17                grid_4.3.0               \n [45] promises_1.2.1            dqrng_0.3.2              \n [47] crayon_1.5.2              miniUI_0.1.1.1           \n [49] lattice_0.22-5            beachmat_2.16.0          \n [51] cowplot_1.1.3             magick_2.8.3             \n [53] pillar_1.9.0              knitr_1.45               \n [55] metapod_1.8.0             rjson_0.2.21             \n [57] future.apply_1.11.1       codetools_0.2-19         \n [59] leiden_0.4.3.1            glue_1.7.0               \n [61] ggfun_0.1.4               data.table_1.15.2        \n [63] vctrs_0.6.5               png_0.1-8                \n [65] spam_2.10-0               gtable_0.3.4             \n [67] xfun_0.42                 S4Arrays_1.0.6           \n [69] mime_0.12                 DropletUtils_1.20.0      \n [71] NNLM_0.4.4                ggside_0.3.1             \n [73] survival_3.5-8            statmod_1.5.0            \n [75] bluster_1.10.0            ellipsis_0.3.2           \n [77] fitdistrplus_1.1-11       ROCR_1.0-11              \n [79] nlme_3.1-164              progress_1.2.3           \n [81] RcppAnnoy_0.0.22          rprojroot_2.0.4          \n [83] irlba_2.3.5.1             vipor_0.4.7              \n [85] KernSmooth_2.23-22        colorspace_2.1-0         \n [87] tidyselect_1.2.0          compiler_4.3.0           \n [89] BiocNeighbors_1.18.0      DelayedArray_0.26.7      \n [91] plotly_4.10.4             scales_1.3.0             \n [93] lmtest_0.9-40             digest_0.6.34            \n [95] goftest_1.2-3             spatstat.utils_3.0-4     \n [97] rmarkdown_2.26            XVector_0.40.0           \n [99] htmltools_0.5.7           pkgconfig_2.0.3          \n[101] sparseMatrixStats_1.12.2  fastmap_1.1.1            \n[103] rlang_1.1.3               htmlwidgets_1.6.4        \n[105] shiny_1.8.0               DelayedMatrixStats_1.22.6\n[107] farver_2.1.1              zoo_1.8-12               \n[109] jsonlite_1.8.8            BiocParallel_1.34.2      \n[111] R.oo_1.26.0               BiocSingular_1.16.0      \n[113] RCurl_1.98-1.14           magrittr_2.0.3           \n[115] GenomeInfoDbData_1.2.10   dotCall64_1.1-1          \n[117] patchwork_1.2.0           Rhdf5lib_1.22.1          \n[119] munsell_0.5.0             Rcpp_1.0.12              \n[121] viridis_0.6.5             reticulate_1.35.0        \n[123] stringi_1.8.3             zlibbioc_1.46.0          \n[125] MASS_7.3-60.0.1           plyr_1.8.9               \n[127] listenv_0.9.1             ggrepel_0.9.5            \n[129] deldir_2.0-4              splines_4.3.0            \n[131] tensor_1.5                hms_1.1.3                \n[133] locfit_1.5-9.9            ggpubr_0.6.0             \n[135] spatstat.geom_3.2-9       ggsignif_0.6.4           \n[137] RcppHNSW_0.6.0            reshape2_1.4.4           \n[139] ScaledMatrix_1.8.1        evaluate_0.23            \n[141] tzdb_0.4.0                tweenr_2.0.3             \n[143] httpuv_1.6.14             RANN_2.6.1               \n[145] polyclip_1.10-6           future_1.33.1            \n[147] scattermore_1.2           ggforce_0.4.2            \n[149] ggExtra_0.10.1            rsvd_1.0.5               \n[151] broom_1.0.5               xtable_1.8-4             \n[153] RSpectra_0.16-1           rstatix_0.7.2            \n[155] later_1.3.2               viridisLite_0.4.2        \n[157] beeswarm_0.4.0            cluster_2.1.6            \n[159] timechange_0.3.0          globals_0.16.2           \n\ndate()\n\n[1] \"Thu Mar  7 11:24:40 2024\""
  },
  {
    "objectID": "analysis/visActivatedImmCellsIntegrated.html",
    "href": "analysis/visActivatedImmCellsIntegrated.html",
    "title": "visualize activated immune cells human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visActivatedImmCellsIntegrated.html#load-packages",
    "href": "analysis/visActivatedImmCellsIntegrated.html#load-packages",
    "title": "visualize activated immune cells human LN",
    "section": "",
    "text": "## load packages \nsuppressPackageStartupMessages({\n  library(dplyr)\n  library(reshape2)\n  library(ggplot2)\n  library(cowplot)\n  library(purrr)\n  library(Seurat)\n  library(tidyverse)\n  library(ggpubr)\n  library(runSeurat3)\n  library(here)\n  library(ggsci)\n  library(pheatmap)\n  library(scater)\n})"
  },
  {
    "objectID": "analysis/visActivatedImmCellsIntegrated.html#load-seurat-object",
    "href": "analysis/visActivatedImmCellsIntegrated.html#load-seurat-object",
    "title": "visualize activated immune cells human LN",
    "section": "load seurat object",
    "text": "load seurat object\n\nbasedir &lt;- here()\nseurat &lt;- readRDS(file= paste0(basedir,\n                            \"/data/AllPatWithoutCM_IMMMerged_integrated_label\",\n                            \"_seurat.rds\"))\n\nIdents(seurat) &lt;- seurat$label\nseurat &lt;- subset(seurat, cond2 == \"activated\")\n\n## set col palettes\ncolPal &lt;- colPal &lt;- c(pal_flatui()(10), pal_frontiers()(8),\n                      pal_nejm()(8))[1:length(unique(seurat$RNA_snn_res.0.25))]\nnames(colPal) &lt;- unique(seurat$RNA_snn_res.0.25)\n\n\ncolPat &lt;- c(pal_nejm()(7),pal_futurama()(12))[1:length(unique(seurat$patient))]\nnames(colPat) &lt;- unique(seurat$patient)\ncolCond &lt;- c(\"#6692a3\",\"#971c1c\",\"#d17d67\")\nnames(colCond) &lt;- unique(seurat$cond)\ncolOri &lt;- pal_npg()(length(unique(seurat$origin)))\nnames(colOri) &lt;- unique(seurat$origin)\ncolCond2 &lt;- c(\"#6692a3\",\"#971c1c\")\nnames(colCond2) &lt;- c(\"resting\", \"activated\")\n\ncolLab &lt;- c(\"#2a3b30\", \"#0b6647\", \"#54907e\", \"#94c78a\", \"#6f9568\", \n            \"#8f2810\", \"#a83e0b\", \"#ce6915\",\"#d08821\", \"#d0ac21\",\"#b9bb20\",\n            \"#486584\",\"#56799e\", \"#4b5397\", \"#8873d3\", \"#6e3e7a\")\n            \nnames(colLab) &lt;- c(\"preB\", \"naiveB\", \"GCB\", \"MBC\", \"plasmaCell\",\n                   \"naiveCD4-1\", \"naiveCD4-2\", \"naiveCD4-3\", \"Treg\", \"CD8Tcm\",\n                    \"CTL/NKcell\",\n                   \"ILC3\",\"pDC-1\", \"pDC-2\", \"Mph/DC-1\", \"Mph/DC-2\")"
  },
  {
    "objectID": "analysis/visActivatedImmCellsIntegrated.html#visualize-data",
    "href": "analysis/visActivatedImmCellsIntegrated.html#visualize-data",
    "title": "visualize activated immune cells human LN",
    "section": "visualize data",
    "text": "visualize data\n\nDimPlot(seurat, reduction = \"umap\", cols=colLab)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colLab, pt.size=1)+\n  theme_void()\n\n\n\n\n\nclustering\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPal, group.by = \"RNA_snn_res.0.25\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", group.by = \"RNA_snn_res.0.25\",\n        cols=colPal, pt.size=0.5)+\n  theme_void()\n\n\n\n\n\n\npatient\n\n## visualize input data\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\")+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nDimPlot(seurat, reduction = \"umap\", cols=colPat, group.by = \"patient\",\n        pt.size=0.5, shuffle = T)+\n  theme_void()"
  },
  {
    "objectID": "analysis/visActivatedImmCellsIntegrated.html#vis-selected-immune-cell-marker",
    "href": "analysis/visActivatedImmCellsIntegrated.html#vis-selected-immune-cell-marker",
    "title": "visualize activated immune cells human LN",
    "section": "vis selected immune cell marker",
    "text": "vis selected immune cell marker\n\ngenes &lt;- data.frame(gene=rownames(seurat)) %&gt;% \n    mutate(geneID=gsub(\"^.*\\\\.\", \"\", gene)) \n\nselGenesAll &lt;- read_tsv(file = paste0(basedir,\n                                      \"/data/overallImmuneCellMarker.txt\")) %&gt;% \n  left_join(., genes, by = \"geneID\")\n\nseurat$label &lt;- factor(seurat$label, levels = names(colLab))\nIdents(seurat) &lt;- seurat$label\n\n# pOut &lt;- avgHeatmap(seurat = seurat, selGenes = selGenesAll,\n#                   colVecIdent = colLab, \n#                   ordVec=levels(seurat),\n#                   gapVecR=NULL, gapVecC=NULL,cc=F,\n#                   cr=F, condCol=F)\n\n\nDotplot\n\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenesAll$gene), scale =T,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenesAll$gene), labels=rev(selGenesAll$geneID)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\nDotPlot(seurat, assay=\"RNA\", features = rev(selGenesAll$gene), scale =F,\n        cluster.idents = F) +\n  scale_color_viridis_c() +\n  coord_flip() +\n  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +\n  scale_x_discrete(breaks=rev(selGenesAll$gene), labels=rev(selGenesAll$geneID)) +\n  xlab(\"\") + ylab(\"\")\n\n\n\n\n\n\nFeatureplot\n\npList &lt;- sapply(selGenesAll$gene, function(x){\np &lt;- FeaturePlot(seurat, reduction = \"umap\", \n            features = x,\n            cols=c(\"lightgrey\", \"darkred\"),\n            order = F)+\n  theme(legend.position=\"right\")\n  plot(p)\n})"
  },
  {
    "objectID": "analysis/visActivatedImmCellsIntegrated.html#session-info",
    "href": "analysis/visActivatedImmCellsIntegrated.html#session-info",
    "title": "visualize activated immune cells human LN",
    "section": "session info",
    "text": "session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats4    stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] scater_1.28.0               scuttle_1.10.3              SingleCellExperiment_1.22.0\n [4] SummarizedExperiment_1.30.2 Biobase_2.60.0              GenomicRanges_1.52.1       \n [7] GenomeInfoDb_1.36.4         IRanges_2.36.0              S4Vectors_0.40.1           \n[10] BiocGenerics_0.48.0         MatrixGenerics_1.12.3       matrixStats_1.2.0          \n[13] pheatmap_1.0.12             ggsci_3.0.1                 here_1.0.1                 \n[16] runSeurat3_0.1.0            ggpubr_0.6.0                lubridate_1.9.3            \n[19] forcats_1.0.0               stringr_1.5.1               readr_2.1.5                \n[22] tidyr_1.3.1                 tibble_3.2.1                tidyverse_2.0.0            \n[25] Seurat_5.0.2                SeuratObject_5.0.1          sp_2.1-3                   \n[28] purrr_1.0.2                 cowplot_1.1.3               ggplot2_3.5.0              \n[31] reshape2_1.4.4              dplyr_1.1.4                \n\nloaded via a namespace (and not attached):\n  [1] RcppAnnoy_0.0.22          splines_4.3.0             later_1.3.2              \n  [4] bitops_1.0-7              polyclip_1.10-6           fastDummies_1.7.3        \n  [7] lifecycle_1.0.4           rstatix_0.7.2             rprojroot_2.0.4          \n [10] vroom_1.6.5               globals_0.16.2            lattice_0.22-5           \n [13] MASS_7.3-60.0.1           backports_1.4.1           magrittr_2.0.3           \n [16] plotly_4.10.4             rmarkdown_2.26            yaml_2.3.8               \n [19] httpuv_1.6.14             sctransform_0.4.1         spam_2.10-0              \n [22] spatstat.sparse_3.0-3     reticulate_1.35.0         pbapply_1.7-2            \n [25] RColorBrewer_1.1-3        abind_1.4-5               zlibbioc_1.46.0          \n [28] Rtsne_0.17                RCurl_1.98-1.14           GenomeInfoDbData_1.2.10  \n [31] ggrepel_0.9.5             irlba_2.3.5.1             listenv_0.9.1            \n [34] spatstat.utils_3.0-4      goftest_1.2-3             RSpectra_0.16-1          \n [37] spatstat.random_3.2-3     fitdistrplus_1.1-11       parallelly_1.37.1        \n [40] DelayedMatrixStats_1.22.6 leiden_0.4.3.1            codetools_0.2-19         \n [43] DelayedArray_0.26.7       tidyselect_1.2.0          farver_2.1.1             \n [46] viridis_0.6.5             ScaledMatrix_1.8.1        spatstat.explore_3.2-6   \n [49] jsonlite_1.8.8            BiocNeighbors_1.18.0      ellipsis_0.3.2           \n [52] progressr_0.14.0          ggridges_0.5.6            survival_3.5-8           \n [55] tools_4.3.0               ica_1.0-3                 Rcpp_1.0.12              \n [58] glue_1.7.0                gridExtra_2.3             xfun_0.42                \n [61] withr_3.0.0               fastmap_1.1.1             fansi_1.0.6              \n [64] rsvd_1.0.5                digest_0.6.34             timechange_0.3.0         \n [67] R6_2.5.1                  mime_0.12                 colorspace_2.1-0         \n [70] scattermore_1.2           tensor_1.5                spatstat.data_3.0-4      \n [73] utf8_1.2.4                generics_0.1.3            data.table_1.15.2        \n [76] httr_1.4.7                htmlwidgets_1.6.4         S4Arrays_1.0.6           \n [79] uwot_0.1.16               pkgconfig_2.0.3           gtable_0.3.4             \n [82] lmtest_0.9-40             XVector_0.40.0            htmltools_0.5.7          \n [85] carData_3.0-5             dotCall64_1.1-1           scales_1.3.0             \n [88] png_0.1-8                 knitr_1.45                rstudioapi_0.15.0        \n [91] tzdb_0.4.0                nlme_3.1-164              zoo_1.8-12               \n [94] KernSmooth_2.23-22        vipor_0.4.7               parallel_4.3.0           \n [97] miniUI_0.1.1.1            pillar_1.9.0              grid_4.3.0               \n[100] vctrs_0.6.5               RANN_2.6.1                promises_1.2.1           \n[103] BiocSingular_1.16.0       car_3.1-2                 beachmat_2.16.0          \n[106] xtable_1.8-4              cluster_2.1.6             beeswarm_0.4.0           \n[109] evaluate_0.23             cli_3.6.2                 compiler_4.3.0           \n[112] rlang_1.1.3               crayon_1.5.2              future.apply_1.11.1      \n[115] ggsignif_0.6.4            labeling_0.4.3            ggbeeswarm_0.7.2         \n[118] plyr_1.8.9                stringi_1.8.3             BiocParallel_1.34.2      \n[121] viridisLite_0.4.2         deldir_2.0-4              munsell_0.5.0            \n[124] lazyeval_0.2.2            spatstat.geom_3.2-9       Matrix_1.6-5             \n[127] RcppHNSW_0.6.0            hms_1.1.3                 patchwork_1.2.0          \n[130] bit64_4.0.5               sparseMatrixStats_1.12.2  future_1.33.1            \n[133] shiny_1.8.0               ROCR_1.0-11               igraph_2.0.2             \n[136] broom_1.0.5               bit_4.0.5                \n\ndate()\n\n[1] \"Fri Mar  8 08:19:16 2024\""
  },
  {
    "objectID": "analysis/runSpatalkDecomp_s4.html",
    "href": "analysis/runSpatalkDecomp_s4.html",
    "title": "Run spatalk decomposition - s4 batch1",
    "section": "",
    "text": "library(tidyverse)\nlibrary(SpatialExperiment)\nlibrary(here)\nlibrary(ggspavis)\nlibrary(scater)\nlibrary(ggsci)\nlibrary(scran)\nlibrary(pheatmap)\nlibrary(SpaTalk)\nlibrary(Matrix)\nlibrary(Seurat)\nlibrary(igraph)\nlibrary(biomaRt)"
  },
  {
    "objectID": "analysis/runSpatalkDecomp_s4.html#sample-4",
    "href": "analysis/runSpatalkDecomp_s4.html#sample-4",
    "title": "Run spatalk decomposition - s4 batch1",
    "section": "Sample 4",
    "text": "Sample 4\n\nLoad reference and spe object\n\nbasedir &lt;- here()\n\n\nrefSeurat &lt;- readRDS(paste0(basedir, \"/data/refSeurat_allCelltypesIntImm.rds\"))\n\nspeAll &lt;- readRDS(paste0(basedir, \"/data/speAllLN.rds\"))\n\ngenes &lt;- data.frame(geneLong=rownames(refSeurat)) %&gt;%\n  mutate(EnsID=gsub(\"\\\\..*\", \"\", geneLong)) %&gt;% \n  mutate(symbol=substr(geneLong, start=17, stop=nchar(geneLong)))\n\n\n\nset color palettes\n\ncolLEC &lt;- c(\"#79AF97FF\",\"#B24745FF\",\"#DF8F44FF\")\nnames(colLEC) &lt;- c(\"SCScLEC\", \"SCSfLEC\", \"MedSinusLEC\")\n\ncolBEC &lt;- c(\"#48557e\", \"#e3a616\",\"#9a3038\")\nnames(colBEC) &lt;- c(\"venBEC\", \"capBEC\", \"artBEC\")\n\n\ncolFRC &lt;- c(\"#800000FF\", \"#FFA319FF\",\"#8A9045FF\", \"#155F83FF\",\n            \"#C16622FF\", \"#6692a3\", \"#3b7f60\")\nnames(colFRC) &lt;- c(\"medRCIFRC\", \"TRC\", \"ACTA2+PRC\", \"VSMC\", \"PI16+RC\", \"PRC1\",\n                   \"BRC\")\n\n\ncolImm &lt;- c(\"#0b6647\", \"#54907e\", \"#94c78a\", \"#6f9568\", \n            \"#8f2810\", \"#d0ac21\",\"#9e9f0b\", \"#486584\",\n            \"#4b5397\", \"#8873d3\", \"#6e3e7a\")\n            \nnames(colImm) &lt;- c(\"naiveB\", \"GCB\", \"MBC\", \"plasmaCell\",\n                   \"CD4T\", \"CD8Tcm\", \"CTL/NKcell\", \"ILC3\", \"pDC\", \"Mph/DC-1\",\n                   \"Mph/DC-2\")\n\ncolAll &lt;- c(colFRC, colBEC, colLEC, colImm) \n\ncolPal &lt;- c(\"#F0027F\", \"#377EB8\", \"#4DAF4A\", \"#984EA3\", \"#FFD700\",\n            \"#FF7F00\", \"#1A1A1A\", \"#666666\", pal_futurama()(10))\n\n\n\nformat sc reference data\n\n## downsample\ndim(refSeurat)\n\n[1]  39642 122538\n\ntable(refSeurat$label)\n\n\n  ACTA2+PRC      artBEC         BRC      capBEC        CD4T      CD8Tcm \n       1560        1048         390        1091       39380        4006 \n CTL/NKcell         GCB        ILC3         MBC   medRCIFRC MedSinusLEC \n      10339         869        1819       17174       10129          42 \n   Mph/DC-1    Mph/DC-2      naiveB         pDC     PI16+RC  plasmaCell \n       2952         980       14118        6750         986         326 \n       PRC1     SCScLEC     SCSfLEC         TRC      venBEC        VSMC \n        760         332         129        3773        2861         724 \n\n#refSeurat$pat_plus_label &lt;- paste0(refSeurat$patient, \"_\", refSeurat$label)\n#table(refSeurat$pat_plus_label)\n#Idents(refSeurat) &lt;- refSeurat$pat_plus_label\nIdents(refSeurat) &lt;- refSeurat$label\nrefSeurat &lt;- subset(x = refSeurat, downsample = 500)\ndim(refSeurat)\n\n[1] 39642 10719\n\n#table(refSeurat$pat_plus_label)\ntable(refSeurat$label)\n\n\n  ACTA2+PRC      artBEC         BRC      capBEC        CD4T      CD8Tcm \n        500         500         390         500         500         500 \n CTL/NKcell         GCB        ILC3         MBC   medRCIFRC MedSinusLEC \n        500         500         500         500         500          42 \n   Mph/DC-1    Mph/DC-2      naiveB         pDC     PI16+RC  plasmaCell \n        500         500         500         500         500         326 \n       PRC1     SCScLEC     SCSfLEC         TRC      venBEC        VSMC \n        500         332         129         500         500         500 \n\n## counts\nsc_data &lt;- refSeurat@assays$RNA@counts\nrownames(sc_data) &lt;- substr(rownames(sc_data), start=17,\n                            stop=nchar(rownames(sc_data)))\n\n## celltypes\nsc_celltype &lt;- refSeurat$label\n\n## remove CC marker\nCCmarker &lt;- c(cc.genes.updated.2019$s.genes, cc.genes.updated.2019$g2m.genes)\ndim(sc_data)\n\n[1] 39642 10719\n\nsc_data &lt;- sc_data[-which(rownames(sc_data) %in% CCmarker),]\ndim(sc_data)\n\n[1] 39545 10719\n\n## remove Mito and Ribosomal genes from reference\nmito.genes &lt;- grep(pattern = \"^MT-\", x = rownames(sc_data), value = TRUE)\nRPS.genes &lt;- grep(pattern = \"^RPS\", x = rownames(sc_data), value = TRUE)\nRPL.genes &lt;- grep(pattern = \"^RPL\", x = rownames(sc_data), value = TRUE)\n\ndim(sc_data)\n\n[1] 39545 10719\n\nsc_data &lt;- sc_data[-which(rownames(sc_data) %in% c(mito.genes, RPS.genes,\n                                                   RPL.genes)),]\ndim(sc_data)\n\n[1] 38478 10719\n\n\n\n\nvis input data\n\nref data\n\nIdents(refSeurat) &lt;- refSeurat$label\nDimPlot(refSeurat, reduction = \"umap\", cols = colAll, raster = F, shuffle = T)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nremove(refSeurat)\n\n\n\nST data\n\ni &lt;- 4\nsid &lt;- names(speAll[i])\nspe &lt;- speAll[[i]]\n\nplotSpots(spe, annotate = \"label\", \n          palette = colPal, size = 0.8) + \n    ggtitle(sid)\n\n\n\nremove(speAll)\n\n\n\n\nformat spatial data\n\n## counts\nst_data &lt;- spe@assays@data$counts\n\n## transform gene names\ngenesST &lt;- data.frame(EnsID=rownames(st_data)) %&gt;%\n  left_join(., genes, by=\"EnsID\") \n\nmart &lt;- useDataset(\"hsapiens_gene_ensembl\", useMart(\"ensembl\"))\ngene_IDs &lt;- getBM(filters= \"ensembl_gene_id\", attributes= c(\"ensembl_gene_id\",\"hgnc_symbol\"),\n              values = genesST$EnsID, mart= mart, useCache = F)\ncolnames(gene_IDs) &lt;- c(\"EnsID\", \"symbolMart\")\ngene_IDs &lt;- gene_IDs[-which(duplicated(gene_IDs$EnsID)),]\n\ngenesST &lt;- genesST %&gt;% left_join(., gene_IDs, by=\"EnsID\") %&gt;% \n  mutate(symbolFin=ifelse(is.na(symbol),ifelse(symbolMart ==\"\", EnsID, symbolMart),symbol))\nrownames(st_data) &lt;- genesST$symbolFin\n\nst_data &lt;- rev_gene(data = st_data,\n                         data_type = \"count\",\n                         species = \"Human\",\n                         geneinfo = geneinfo)\n\nRevising gene symbols for count data \n***Done*** \n\n## coords\nst_meta &lt;- data.frame(spot=colnames(spe),\n                      x=spe@int_colData@listData$spatialCoords[,\"pxl_col_in_fullres\"],\n                     y=-1*(spe@int_colData@listData$spatialCoords[,\"pxl_row_in_fullres\"]))\n\nobj &lt;- createSpaTalk(st_data = as.matrix(st_data),\n                     st_meta = st_meta,\n                     species = \"Human\",\n                     if_st_is_sc = F,\n                     spot_max_cell = 30)\n\n\n\nsave object to run CT on server\n\n\ncelltype decomposition\n\nremove(st_data)\nremove(st_meta)\nremove(mart)\n\nobj &lt;- dec_celltype(object = obj,\n                    sc_data = sc_data,\n                    sc_celltype = sc_celltype,\n                    if_use_hvg = T,\n                    use_n_cores = 6,\n                    iter_num = 100,\n                    if_use_normalize_data = F)\n\n\nsaveRDS(obj, file=paste0(basedir, \"/data/ST/spatalk/spatalkDecomp_s4.rds\"))\n\n\n\nvis predicted celltypes\n\n\nInfer cell-cell communications"
  },
  {
    "objectID": "analysis/runSpatalkDecomp_s4.html#vis-top-int",
    "href": "analysis/runSpatalkDecomp_s4.html#vis-top-int",
    "title": "Run spatalk decomposition - s4 batch1",
    "section": "vis top int",
    "text": "vis top int\n\nPRC to lec\n\n\nlec to PRC\n\n\nPRC to bec\n\n\nbec to PRC\n\n\nPRC to imm\n\n\nimm to PRC"
  },
  {
    "objectID": "analysis/runSpatalkDecomp_s4.html#session-info",
    "href": "analysis/runSpatalkDecomp_s4.html#session-info",
    "title": "Run spatalk decomposition - s4 batch1",
    "section": "Session info",
    "text": "Session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] parallel  stats4    stats     graphics  grDevices utils     datasets \n[8] methods   base     \n\nother attached packages:\n [1] biomaRt_2.56.1              igraph_2.0.2               \n [3] Seurat_5.0.2                SeuratObject_5.0.1         \n [5] sp_2.1-3                    Matrix_1.6-5               \n [7] SpaTalk_1.0                 doParallel_1.0.17          \n [9] iterators_1.0.14            foreach_1.5.2              \n[11] ggalluvial_0.12.5           pheatmap_1.0.12            \n[13] scran_1.28.2                ggsci_3.0.1                \n[15] scater_1.28.0               scuttle_1.10.3             \n[17] ggspavis_1.6.0              here_1.0.1                 \n[19] SpatialExperiment_1.10.0    SingleCellExperiment_1.22.0\n[21] SummarizedExperiment_1.30.2 Biobase_2.60.0             \n[23] GenomicRanges_1.52.1        GenomeInfoDb_1.36.4        \n[25] IRanges_2.36.0              S4Vectors_0.40.1           \n[27] BiocGenerics_0.48.0         MatrixGenerics_1.12.3      \n[29] matrixStats_1.2.0           lubridate_1.9.3            \n[31] forcats_1.0.0               stringr_1.5.1              \n[33] dplyr_1.1.4                 purrr_1.0.2                \n[35] readr_2.1.5                 tidyr_1.3.1                \n[37] tibble_3.2.1                ggplot2_3.5.0              \n[39] tidyverse_2.0.0            \n\nloaded via a namespace (and not attached):\n  [1] spatstat.sparse_3.0-3     bitops_1.0-7             \n  [3] httr_1.4.7                RColorBrewer_1.1-3       \n  [5] backports_1.4.1           tools_4.3.0              \n  [7] sctransform_0.4.1         utf8_1.2.4               \n  [9] R6_2.5.1                  HDF5Array_1.28.1         \n [11] lazyeval_0.2.2            uwot_0.1.16              \n [13] rhdf5filters_1.12.1       withr_3.0.0              \n [15] prettyunits_1.2.0         gridExtra_2.3            \n [17] progressr_0.14.0          cli_3.6.2                \n [19] spatstat.explore_3.2-6    fastDummies_1.7.3        \n [21] scatterpie_0.2.1          labeling_0.4.3           \n [23] spatstat.data_3.0-4       ggridges_0.5.6           \n [25] pbapply_1.7-2             R.utils_2.12.3           \n [27] parallelly_1.37.1         limma_3.56.2             \n [29] RSQLite_2.3.5             rstudioapi_0.15.0        \n [31] generics_0.1.3            ica_1.0-3                \n [33] spatstat.random_3.2-3     car_3.1-2                \n [35] ggbeeswarm_0.7.2          fansi_1.0.6              \n [37] abind_1.4-5               R.methodsS3_1.8.2        \n [39] lifecycle_1.0.4           yaml_2.3.8               \n [41] edgeR_3.42.4              carData_3.0-5            \n [43] BiocFileCache_2.8.0       rhdf5_2.44.0             \n [45] Rtsne_0.17                blob_1.2.4               \n [47] grid_4.3.0                promises_1.2.1           \n [49] dqrng_0.3.2               crayon_1.5.2             \n [51] miniUI_0.1.1.1            lattice_0.22-5           \n [53] beachmat_2.16.0           cowplot_1.1.3            \n [55] KEGGREST_1.40.1           magick_2.8.3             \n [57] pillar_1.9.0              knitr_1.45               \n [59] metapod_1.8.0             rjson_0.2.21             \n [61] future.apply_1.11.1       codetools_0.2-19         \n [63] leiden_0.4.3.1            glue_1.7.0               \n [65] ggfun_0.1.4               data.table_1.15.2        \n [67] vctrs_0.6.5               png_0.1-8                \n [69] spam_2.10-0               gtable_0.3.4             \n [71] cachem_1.0.8              xfun_0.42                \n [73] S4Arrays_1.0.6            mime_0.12                \n [75] DropletUtils_1.20.0       NNLM_0.4.4               \n [77] ggside_0.3.1              survival_3.5-8           \n [79] statmod_1.5.0             bluster_1.10.0           \n [81] ellipsis_0.3.2            fitdistrplus_1.1-11      \n [83] ROCR_1.0-11               nlme_3.1-164             \n [85] bit64_4.0.5               filelock_1.0.3           \n [87] progress_1.2.3            RcppAnnoy_0.0.22         \n [89] rprojroot_2.0.4           irlba_2.3.5.1            \n [91] vipor_0.4.7               KernSmooth_2.23-22       \n [93] DBI_1.2.2                 colorspace_2.1-0         \n [95] tidyselect_1.2.0          curl_5.2.1               \n [97] bit_4.0.5                 compiler_4.3.0           \n [99] BiocNeighbors_1.18.0      xml2_1.3.6               \n[101] DelayedArray_0.26.7       plotly_4.10.4            \n[103] scales_1.3.0              lmtest_0.9-40            \n[105] rappdirs_0.3.3            digest_0.6.34            \n[107] goftest_1.2-3             spatstat.utils_3.0-4     \n[109] rmarkdown_2.26            XVector_0.40.0           \n[111] htmltools_0.5.7           pkgconfig_2.0.3          \n[113] sparseMatrixStats_1.12.2  dbplyr_2.4.0             \n[115] fastmap_1.1.1             rlang_1.1.3              \n[117] htmlwidgets_1.6.4         shiny_1.8.0              \n[119] DelayedMatrixStats_1.22.6 farver_2.1.1             \n[121] zoo_1.8-12                jsonlite_1.8.8           \n[123] BiocParallel_1.34.2       R.oo_1.26.0              \n[125] BiocSingular_1.16.0       RCurl_1.98-1.14          \n[127] magrittr_2.0.3            GenomeInfoDbData_1.2.10  \n[129] dotCall64_1.1-1           patchwork_1.2.0          \n[131] Rhdf5lib_1.22.1           munsell_0.5.0            \n[133] Rcpp_1.0.12               viridis_0.6.5            \n[135] reticulate_1.35.0         stringi_1.8.3            \n[137] zlibbioc_1.46.0           MASS_7.3-60.0.1          \n[139] plyr_1.8.9                listenv_0.9.1            \n[141] ggrepel_0.9.5             deldir_2.0-4             \n[143] Biostrings_2.68.1         splines_4.3.0            \n[145] tensor_1.5                hms_1.1.3                \n[147] locfit_1.5-9.9            ggpubr_0.6.0             \n[149] spatstat.geom_3.2-9       ggsignif_0.6.4           \n[151] RcppHNSW_0.6.0            reshape2_1.4.4           \n[153] ScaledMatrix_1.8.1        XML_3.99-0.16.1          \n[155] evaluate_0.23             tzdb_0.4.0               \n[157] tweenr_2.0.3              httpuv_1.6.14            \n[159] RANN_2.6.1                polyclip_1.10-6          \n[161] future_1.33.1             scattermore_1.2          \n[163] ggforce_0.4.2             ggExtra_0.10.1           \n[165] rsvd_1.0.5                broom_1.0.5              \n[167] xtable_1.8-4              RSpectra_0.16-1          \n[169] rstatix_0.7.2             later_1.3.2              \n[171] viridisLite_0.4.2         memoise_2.0.1            \n[173] AnnotationDbi_1.62.2      beeswarm_0.4.0           \n[175] cluster_2.1.6             timechange_0.3.0         \n[177] globals_0.16.2           \n\ndate()\n\n[1] \"Fri Mar  8 08:39:26 2024\""
  },
  {
    "objectID": "analysis/runSpaTalkDecompB2_s4.html",
    "href": "analysis/runSpaTalkDecompB2_s4.html",
    "title": "Run spatalk decomposition - s4 batch2",
    "section": "",
    "text": "library(tidyverse)\nlibrary(SpatialExperiment)\nlibrary(here)\nlibrary(ggspavis)\nlibrary(scater)\nlibrary(ggsci)\nlibrary(scran)\nlibrary(pheatmap)\nlibrary(SpaTalk)\nlibrary(Matrix)\nlibrary(Seurat)\nlibrary(igraph)\nlibrary(biomaRt)"
  },
  {
    "objectID": "analysis/runSpaTalkDecompB2_s4.html#sample-4",
    "href": "analysis/runSpaTalkDecompB2_s4.html#sample-4",
    "title": "Run spatalk decomposition - s4 batch2",
    "section": "Sample 4",
    "text": "Sample 4\n\nLoad reference and spe object\n\nbasedir &lt;- here()\n\n\nrefSeurat &lt;- readRDS(paste0(basedir, \"/data/refSeurat_allCelltypesIntImm.rds\"))\n\nspeAll &lt;- readRDS(paste0(basedir, \"/data/speAllLNB2.rds\"))\n\ngenes &lt;- data.frame(geneLong=rownames(refSeurat)) %&gt;%\n  mutate(EnsID=gsub(\"\\\\..*\", \"\", geneLong)) %&gt;% \n  mutate(symbol=substr(geneLong, start=17, stop=nchar(geneLong)))\n\n\n\nset color palettes\n\ncolLEC &lt;- c(\"#79AF97FF\",\"#B24745FF\",\"#DF8F44FF\")\nnames(colLEC) &lt;- c(\"SCScLEC\", \"SCSfLEC\", \"MedSinusLEC\")\n\ncolBEC &lt;- c(\"#48557e\", \"#e3a616\",\"#9a3038\")\nnames(colBEC) &lt;- c(\"venBEC\", \"capBEC\", \"artBEC\")\n\n\ncolFRC &lt;- c(\"#800000FF\", \"#FFA319FF\",\"#8A9045FF\", \"#155F83FF\",\n            \"#C16622FF\", \"#6692a3\", \"#3b7f60\")\nnames(colFRC) &lt;- c(\"medRCIFRC\", \"TRC\", \"ACTA2+PRC\", \"VSMC\", \"PI16+RC\", \"PRC1\",\n                   \"BRC\")\n\n\ncolImm &lt;- c(\"#0b6647\", \"#54907e\", \"#94c78a\", \"#6f9568\", \n            \"#8f2810\", \"#d0ac21\",\"#9e9f0b\", \"#486584\",\n            \"#4b5397\", \"#8873d3\", \"#6e3e7a\")\n            \nnames(colImm) &lt;- c(\"naiveB\", \"GCB\", \"MBC\", \"plasmaCell\",\n                   \"CD4T\", \"CD8Tcm\", \"CTL/NKcell\", \"ILC3\", \"pDC\", \"Mph/DC-1\",\n                   \"Mph/DC-2\")\n\ncolAll &lt;- c(colFRC, colBEC, colLEC, colImm) \n\ncolPal &lt;- c(\"#F0027F\", \"#377EB8\", \"#4DAF4A\", \"#984EA3\", \"#FFD700\",\n            \"#FF7F00\", \"#1A1A1A\", \"#666666\", pal_futurama()(10))\n\n\n\nformat sc reference data\n\n## downsample\ndim(refSeurat)\n\n[1]  39642 122538\n\ntable(refSeurat$label)\n\n\n  ACTA2+PRC      artBEC         BRC      capBEC        CD4T      CD8Tcm \n       1560        1048         390        1091       39380        4006 \n CTL/NKcell         GCB        ILC3         MBC   medRCIFRC MedSinusLEC \n      10339         869        1819       17174       10129          42 \n   Mph/DC-1    Mph/DC-2      naiveB         pDC     PI16+RC  plasmaCell \n       2952         980       14118        6750         986         326 \n       PRC1     SCScLEC     SCSfLEC         TRC      venBEC        VSMC \n        760         332         129        3773        2861         724 \n\n#refSeurat$pat_plus_label &lt;- paste0(refSeurat$patient, \"_\", refSeurat$label)\n#table(refSeurat$pat_plus_label)\n#Idents(refSeurat) &lt;- refSeurat$pat_plus_label\nIdents(refSeurat) &lt;- refSeurat$label\nrefSeurat &lt;- subset(x = refSeurat, downsample = 500)\ndim(refSeurat)\n\n[1] 39642 10719\n\n#table(refSeurat$pat_plus_label)\ntable(refSeurat$label)\n\n\n  ACTA2+PRC      artBEC         BRC      capBEC        CD4T      CD8Tcm \n        500         500         390         500         500         500 \n CTL/NKcell         GCB        ILC3         MBC   medRCIFRC MedSinusLEC \n        500         500         500         500         500          42 \n   Mph/DC-1    Mph/DC-2      naiveB         pDC     PI16+RC  plasmaCell \n        500         500         500         500         500         326 \n       PRC1     SCScLEC     SCSfLEC         TRC      venBEC        VSMC \n        500         332         129         500         500         500 \n\n## counts\nsc_data &lt;- refSeurat@assays$RNA@counts\nrownames(sc_data) &lt;- substr(rownames(sc_data), start=17,\n                            stop=nchar(rownames(sc_data)))\n\n## celltypes\nsc_celltype &lt;- refSeurat$label\n\n## remove CC marker\nCCmarker &lt;- c(cc.genes.updated.2019$s.genes, cc.genes.updated.2019$g2m.genes)\ndim(sc_data)\n\n[1] 39642 10719\n\nsc_data &lt;- sc_data[-which(rownames(sc_data) %in% CCmarker),]\ndim(sc_data)\n\n[1] 39545 10719\n\n## remove Mito and Ribosomal genes from reference\nmito.genes &lt;- grep(pattern = \"^MT-\", x = rownames(sc_data), value = TRUE)\nRPS.genes &lt;- grep(pattern = \"^RPS\", x = rownames(sc_data), value = TRUE)\nRPL.genes &lt;- grep(pattern = \"^RPL\", x = rownames(sc_data), value = TRUE)\n\ndim(sc_data)\n\n[1] 39545 10719\n\nsc_data &lt;- sc_data[-which(rownames(sc_data) %in% c(mito.genes, RPS.genes,\n                                                   RPL.genes)),]\ndim(sc_data)\n\n[1] 38478 10719\n\n\n\n\nvis input data\n\nref data\n\nIdents(refSeurat) &lt;- refSeurat$label\nDimPlot(refSeurat, reduction = \"umap\", cols = colAll, raster = F, shuffle = T)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nremove(refSeurat)\n\n\n\nST data\n\ni &lt;- 4\nsid &lt;- names(speAll[i])\nspe &lt;- speAll[[i]]\n\nplotSpots(spe, annotate = \"label\", \n          palette = colPal, size = 0.8) + \n    ggtitle(sid)\n\n\n\nremove(speAll)\n\n\n\n\nformat spatial data\n\n## counts\nst_data &lt;- spe@assays@data$counts\n\n## transform gene names\ngenesST &lt;- data.frame(EnsID=rownames(st_data)) %&gt;%\n  left_join(., genes, by=\"EnsID\") \n\nmart &lt;- useDataset(\"hsapiens_gene_ensembl\", useMart(\"ensembl\"))\ngene_IDs &lt;- getBM(filters= \"ensembl_gene_id\", attributes= c(\"ensembl_gene_id\",\"hgnc_symbol\"),\n              values = genesST$EnsID, mart= mart, useCache = F)\n\ncolnames(gene_IDs) &lt;- c(\"EnsID\", \"symbolMart\")\ngene_IDs &lt;- gene_IDs[-which(duplicated(gene_IDs$EnsID)),]\n\ngenesST &lt;- genesST %&gt;% left_join(., gene_IDs, by=\"EnsID\") %&gt;% \n  mutate(symbolFin=ifelse(is.na(symbol),ifelse(symbolMart ==\"\", EnsID, symbolMart),symbol))\nrownames(st_data) &lt;- genesST$symbolFin\n\nst_data &lt;- rev_gene(data = st_data,\n                         data_type = \"count\",\n                         species = \"Human\",\n                         geneinfo = geneinfo)\n\nRevising gene symbols for count data \n***Done*** \n\n## coords\nst_meta &lt;- data.frame(spot=colnames(spe),\n                      x=spe@int_colData@listData$spatialCoords[,\"pxl_col_in_fullres\"],\n                     y=-1*(spe@int_colData@listData$spatialCoords[,\"pxl_row_in_fullres\"]))\n\nobj &lt;- createSpaTalk(st_data = as.matrix(st_data),\n                     st_meta = st_meta,\n                     species = \"Human\",\n                     if_st_is_sc = F,\n                     spot_max_cell = 30)\n\n\n\nsave object to run CT on server\n\n\ncelltype decomposition\n\nremove(st_data)\nremove(st_meta)\nremove(mart)\n\nobj &lt;- dec_celltype(object = obj,\n                    sc_data = sc_data,\n                    sc_celltype = sc_celltype,\n                    if_use_hvg = T,\n                    use_n_cores = 6,\n                    iter_num = 100,\n                    if_use_normalize_data = F)\n\n\nsaveRDS(obj, file=paste0(basedir, \"/data/ST/spatalk/spatalkDecompB2_s4.rds\"))"
  },
  {
    "objectID": "analysis/runSpaTalkDecompB2_s4.html#session-info",
    "href": "analysis/runSpaTalkDecompB2_s4.html#session-info",
    "title": "Run spatalk decomposition - s4 batch2",
    "section": "Session info",
    "text": "Session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] parallel  stats4    stats     graphics  grDevices utils     datasets \n[8] methods   base     \n\nother attached packages:\n [1] biomaRt_2.56.1              igraph_2.0.2               \n [3] Seurat_5.0.2                SeuratObject_5.0.1         \n [5] sp_2.1-3                    Matrix_1.6-5               \n [7] SpaTalk_1.0                 doParallel_1.0.17          \n [9] iterators_1.0.14            foreach_1.5.2              \n[11] ggalluvial_0.12.5           pheatmap_1.0.12            \n[13] scran_1.28.2                ggsci_3.0.1                \n[15] scater_1.28.0               scuttle_1.10.3             \n[17] ggspavis_1.6.0              here_1.0.1                 \n[19] SpatialExperiment_1.10.0    SingleCellExperiment_1.22.0\n[21] SummarizedExperiment_1.30.2 Biobase_2.60.0             \n[23] GenomicRanges_1.52.1        GenomeInfoDb_1.36.4        \n[25] IRanges_2.36.0              S4Vectors_0.40.1           \n[27] BiocGenerics_0.48.0         MatrixGenerics_1.12.3      \n[29] matrixStats_1.2.0           lubridate_1.9.3            \n[31] forcats_1.0.0               stringr_1.5.1              \n[33] dplyr_1.1.4                 purrr_1.0.2                \n[35] readr_2.1.5                 tidyr_1.3.1                \n[37] tibble_3.2.1                ggplot2_3.5.0              \n[39] tidyverse_2.0.0            \n\nloaded via a namespace (and not attached):\n  [1] spatstat.sparse_3.0-3     bitops_1.0-7             \n  [3] httr_1.4.7                RColorBrewer_1.1-3       \n  [5] backports_1.4.1           tools_4.3.0              \n  [7] sctransform_0.4.1         utf8_1.2.4               \n  [9] R6_2.5.1                  HDF5Array_1.28.1         \n [11] lazyeval_0.2.2            uwot_0.1.16              \n [13] rhdf5filters_1.12.1       withr_3.0.0              \n [15] prettyunits_1.2.0         gridExtra_2.3            \n [17] progressr_0.14.0          cli_3.6.2                \n [19] spatstat.explore_3.2-6    fastDummies_1.7.3        \n [21] scatterpie_0.2.1          labeling_0.4.3           \n [23] spatstat.data_3.0-4       ggridges_0.5.6           \n [25] pbapply_1.7-2             R.utils_2.12.3           \n [27] parallelly_1.37.1         limma_3.56.2             \n [29] RSQLite_2.3.5             rstudioapi_0.15.0        \n [31] generics_0.1.3            ica_1.0-3                \n [33] spatstat.random_3.2-3     car_3.1-2                \n [35] ggbeeswarm_0.7.2          fansi_1.0.6              \n [37] abind_1.4-5               R.methodsS3_1.8.2        \n [39] lifecycle_1.0.4           yaml_2.3.8               \n [41] edgeR_3.42.4              carData_3.0-5            \n [43] BiocFileCache_2.8.0       rhdf5_2.44.0             \n [45] Rtsne_0.17                blob_1.2.4               \n [47] grid_4.3.0                promises_1.2.1           \n [49] dqrng_0.3.2               crayon_1.5.2             \n [51] miniUI_0.1.1.1            lattice_0.22-5           \n [53] beachmat_2.16.0           cowplot_1.1.3            \n [55] KEGGREST_1.40.1           magick_2.8.3             \n [57] pillar_1.9.0              knitr_1.45               \n [59] metapod_1.8.0             rjson_0.2.21             \n [61] future.apply_1.11.1       codetools_0.2-19         \n [63] leiden_0.4.3.1            glue_1.7.0               \n [65] ggfun_0.1.4               data.table_1.15.2        \n [67] vctrs_0.6.5               png_0.1-8                \n [69] spam_2.10-0               gtable_0.3.4             \n [71] cachem_1.0.8              xfun_0.42                \n [73] S4Arrays_1.0.6            mime_0.12                \n [75] DropletUtils_1.20.0       NNLM_0.4.4               \n [77] ggside_0.3.1              survival_3.5-8           \n [79] statmod_1.5.0             bluster_1.10.0           \n [81] ellipsis_0.3.2            fitdistrplus_1.1-11      \n [83] ROCR_1.0-11               nlme_3.1-164             \n [85] bit64_4.0.5               filelock_1.0.3           \n [87] progress_1.2.3            RcppAnnoy_0.0.22         \n [89] rprojroot_2.0.4           irlba_2.3.5.1            \n [91] vipor_0.4.7               KernSmooth_2.23-22       \n [93] DBI_1.2.2                 colorspace_2.1-0         \n [95] tidyselect_1.2.0          curl_5.2.1               \n [97] bit_4.0.5                 compiler_4.3.0           \n [99] BiocNeighbors_1.18.0      xml2_1.3.6               \n[101] DelayedArray_0.26.7       plotly_4.10.4            \n[103] scales_1.3.0              lmtest_0.9-40            \n[105] rappdirs_0.3.3            digest_0.6.34            \n[107] goftest_1.2-3             spatstat.utils_3.0-4     \n[109] rmarkdown_2.26            XVector_0.40.0           \n[111] htmltools_0.5.7           pkgconfig_2.0.3          \n[113] sparseMatrixStats_1.12.2  dbplyr_2.4.0             \n[115] fastmap_1.1.1             rlang_1.1.3              \n[117] htmlwidgets_1.6.4         shiny_1.8.0              \n[119] DelayedMatrixStats_1.22.6 farver_2.1.1             \n[121] zoo_1.8-12                jsonlite_1.8.8           \n[123] BiocParallel_1.34.2       R.oo_1.26.0              \n[125] BiocSingular_1.16.0       RCurl_1.98-1.14          \n[127] magrittr_2.0.3            GenomeInfoDbData_1.2.10  \n[129] dotCall64_1.1-1           patchwork_1.2.0          \n[131] Rhdf5lib_1.22.1           munsell_0.5.0            \n[133] Rcpp_1.0.12               viridis_0.6.5            \n[135] reticulate_1.35.0         stringi_1.8.3            \n[137] zlibbioc_1.46.0           MASS_7.3-60.0.1          \n[139] plyr_1.8.9                listenv_0.9.1            \n[141] ggrepel_0.9.5             deldir_2.0-4             \n[143] Biostrings_2.68.1         splines_4.3.0            \n[145] tensor_1.5                hms_1.1.3                \n[147] locfit_1.5-9.9            ggpubr_0.6.0             \n[149] spatstat.geom_3.2-9       ggsignif_0.6.4           \n[151] RcppHNSW_0.6.0            reshape2_1.4.4           \n[153] ScaledMatrix_1.8.1        XML_3.99-0.16.1          \n[155] evaluate_0.23             tzdb_0.4.0               \n[157] tweenr_2.0.3              httpuv_1.6.14            \n[159] RANN_2.6.1                polyclip_1.10-6          \n[161] future_1.33.1             scattermore_1.2          \n[163] ggforce_0.4.2             ggExtra_0.10.1           \n[165] rsvd_1.0.5                broom_1.0.5              \n[167] xtable_1.8-4              RSpectra_0.16-1          \n[169] rstatix_0.7.2             later_1.3.2              \n[171] viridisLite_0.4.2         memoise_2.0.1            \n[173] AnnotationDbi_1.62.2      beeswarm_0.4.0           \n[175] cluster_2.1.6             timechange_0.3.0         \n[177] globals_0.16.2           \n\ndate()\n\n[1] \"Fri Mar  8 08:57:11 2024\""
  },
  {
    "objectID": "analysis/runSpaTalkDecompB2_s2.html",
    "href": "analysis/runSpaTalkDecompB2_s2.html",
    "title": "Run spatalk decomposition - s2 batch2",
    "section": "",
    "text": "library(tidyverse)\nlibrary(SpatialExperiment)\nlibrary(here)\nlibrary(ggspavis)\nlibrary(scater)\nlibrary(ggsci)\nlibrary(scran)\nlibrary(pheatmap)\nlibrary(SpaTalk)\nlibrary(Matrix)\nlibrary(Seurat)\nlibrary(igraph)\nlibrary(biomaRt)"
  },
  {
    "objectID": "analysis/runSpaTalkDecompB2_s2.html#sample-4",
    "href": "analysis/runSpaTalkDecompB2_s2.html#sample-4",
    "title": "Run spatalk decomposition - s2 batch2",
    "section": "Sample 4",
    "text": "Sample 4\n\nLoad reference and spe object\n\nbasedir &lt;- here()\n\n\nrefSeurat &lt;- readRDS(paste0(basedir, \"/data/refSeurat_allCelltypesIntImm.rds\"))\n\nspeAll &lt;- readRDS(paste0(basedir, \"/data/speAllLNB2.rds\"))\n\ngenes &lt;- data.frame(geneLong=rownames(refSeurat)) %&gt;%\n  mutate(EnsID=gsub(\"\\\\..*\", \"\", geneLong)) %&gt;% \n  mutate(symbol=substr(geneLong, start=17, stop=nchar(geneLong)))\n\n\n\nset color palettes\n\ncolLEC &lt;- c(\"#79AF97FF\",\"#B24745FF\",\"#DF8F44FF\")\nnames(colLEC) &lt;- c(\"SCScLEC\", \"SCSfLEC\", \"MedSinusLEC\")\n\ncolBEC &lt;- c(\"#48557e\", \"#e3a616\",\"#9a3038\")\nnames(colBEC) &lt;- c(\"venBEC\", \"capBEC\", \"artBEC\")\n\n\ncolFRC &lt;- c(\"#800000FF\", \"#FFA319FF\",\"#8A9045FF\", \"#155F83FF\",\n            \"#C16622FF\", \"#6692a3\", \"#3b7f60\")\nnames(colFRC) &lt;- c(\"medRCIFRC\", \"TRC\", \"ACTA2+PRC\", \"VSMC\", \"PI16+RC\", \"PRC1\",\n                   \"BRC\")\n\n\ncolImm &lt;- c(\"#0b6647\", \"#54907e\", \"#94c78a\", \"#6f9568\", \n            \"#8f2810\", \"#d0ac21\",\"#9e9f0b\", \"#486584\",\n            \"#4b5397\", \"#8873d3\", \"#6e3e7a\")\n            \nnames(colImm) &lt;- c(\"naiveB\", \"GCB\", \"MBC\", \"plasmaCell\",\n                   \"CD4T\", \"CD8Tcm\", \"CTL/NKcell\", \"ILC3\", \"pDC\", \"Mph/DC-1\",\n                   \"Mph/DC-2\")\n\ncolAll &lt;- c(colFRC, colBEC, colLEC, colImm) \n\ncolPal &lt;- c(\"#F0027F\", \"#377EB8\", \"#4DAF4A\", \"#984EA3\", \"#FFD700\",\n            \"#FF7F00\", \"#1A1A1A\", \"#666666\", pal_futurama()(10))\n\n\n\nformat sc reference data\n\n## downsample\ndim(refSeurat)\n\n[1]  39642 122538\n\ntable(refSeurat$label)\n\n\n  ACTA2+PRC      artBEC         BRC      capBEC        CD4T      CD8Tcm \n       1560        1048         390        1091       39380        4006 \n CTL/NKcell         GCB        ILC3         MBC   medRCIFRC MedSinusLEC \n      10339         869        1819       17174       10129          42 \n   Mph/DC-1    Mph/DC-2      naiveB         pDC     PI16+RC  plasmaCell \n       2952         980       14118        6750         986         326 \n       PRC1     SCScLEC     SCSfLEC         TRC      venBEC        VSMC \n        760         332         129        3773        2861         724 \n\n#refSeurat$pat_plus_label &lt;- paste0(refSeurat$patient, \"_\", refSeurat$label)\n#table(refSeurat$pat_plus_label)\n#Idents(refSeurat) &lt;- refSeurat$pat_plus_label\nIdents(refSeurat) &lt;- refSeurat$label\nrefSeurat &lt;- subset(x = refSeurat, downsample = 500)\ndim(refSeurat)\n\n[1] 39642 10719\n\n#table(refSeurat$pat_plus_label)\ntable(refSeurat$label)\n\n\n  ACTA2+PRC      artBEC         BRC      capBEC        CD4T      CD8Tcm \n        500         500         390         500         500         500 \n CTL/NKcell         GCB        ILC3         MBC   medRCIFRC MedSinusLEC \n        500         500         500         500         500          42 \n   Mph/DC-1    Mph/DC-2      naiveB         pDC     PI16+RC  plasmaCell \n        500         500         500         500         500         326 \n       PRC1     SCScLEC     SCSfLEC         TRC      venBEC        VSMC \n        500         332         129         500         500         500 \n\n## counts\nsc_data &lt;- refSeurat@assays$RNA@counts\nrownames(sc_data) &lt;- substr(rownames(sc_data), start=17,\n                            stop=nchar(rownames(sc_data)))\n\n## celltypes\nsc_celltype &lt;- refSeurat$label\n\n## remove CC marker\nCCmarker &lt;- c(cc.genes.updated.2019$s.genes, cc.genes.updated.2019$g2m.genes)\ndim(sc_data)\n\n[1] 39642 10719\n\nsc_data &lt;- sc_data[-which(rownames(sc_data) %in% CCmarker),]\ndim(sc_data)\n\n[1] 39545 10719\n\n## remove Mito and Ribosomal genes from reference\nmito.genes &lt;- grep(pattern = \"^MT-\", x = rownames(sc_data), value = TRUE)\nRPS.genes &lt;- grep(pattern = \"^RPS\", x = rownames(sc_data), value = TRUE)\nRPL.genes &lt;- grep(pattern = \"^RPL\", x = rownames(sc_data), value = TRUE)\n\ndim(sc_data)\n\n[1] 39545 10719\n\nsc_data &lt;- sc_data[-which(rownames(sc_data) %in% c(mito.genes, RPS.genes,\n                                                   RPL.genes)),]\ndim(sc_data)\n\n[1] 38478 10719\n\n\n\n\nvis input data\n\nref data\n\nIdents(refSeurat) &lt;- refSeurat$label\nDimPlot(refSeurat, reduction = \"umap\", cols = colAll, raster = F, shuffle = T)+\n  theme_bw() +\n  theme(axis.text = element_blank(), axis.ticks = element_blank(), \n        panel.grid.minor = element_blank()) +\n  xlab(\"UMAP1\") +\n  ylab(\"UMAP2\")\n\n\n\nremove(refSeurat)\n\n\n\nST data\n\ni &lt;- 2\nsid &lt;- names(speAll[i])\nspe &lt;- speAll[[i]]\n\nplotSpots(spe, annotate = \"label\", \n          palette = colPal, size = 0.8) + \n    ggtitle(sid)\n\n\n\nremove(speAll)\n\n\n\n\nformat spatial data\n\n## counts\nst_data &lt;- spe@assays@data$counts\n\n## transform gene names\ngenesST &lt;- data.frame(EnsID=rownames(st_data)) %&gt;%\n  left_join(., genes, by=\"EnsID\") \n\nmart &lt;- useDataset(\"hsapiens_gene_ensembl\", useMart(\"ensembl\"))\ngene_IDs &lt;- getBM(filters= \"ensembl_gene_id\", attributes= c(\"ensembl_gene_id\",\"hgnc_symbol\"),\n              values = genesST$EnsID, mart= mart, useCache = F)\n\ncolnames(gene_IDs) &lt;- c(\"EnsID\", \"symbolMart\")\ngene_IDs &lt;- gene_IDs[-which(duplicated(gene_IDs$EnsID)),]\n\ngenesST &lt;- genesST %&gt;% left_join(., gene_IDs, by=\"EnsID\") %&gt;% \n  mutate(symbolFin=ifelse(is.na(symbol),ifelse(symbolMart ==\"\", EnsID, symbolMart),symbol))\nrownames(st_data) &lt;- genesST$symbolFin\n\nst_data &lt;- rev_gene(data = st_data,\n                         data_type = \"count\",\n                         species = \"Human\",\n                         geneinfo = geneinfo)\n\nRevising gene symbols for count data \n***Done*** \n\n## coords\nst_meta &lt;- data.frame(spot=colnames(spe),\n                      x=spe@int_colData@listData$spatialCoords[,\"pxl_col_in_fullres\"],\n                     y=-1*(spe@int_colData@listData$spatialCoords[,\"pxl_row_in_fullres\"]))\n\nobj &lt;- createSpaTalk(st_data = as.matrix(st_data),\n                     st_meta = st_meta,\n                     species = \"Human\",\n                     if_st_is_sc = F,\n                     spot_max_cell = 30)\n\n\n\nsave object to run CT on server\n\n\ncelltype decomposition\n\nremove(st_data)\nremove(st_meta)\nremove(mart)\n\nobj &lt;- dec_celltype(object = obj,\n                    sc_data = sc_data,\n                    sc_celltype = sc_celltype,\n                    if_use_hvg = T,\n                    use_n_cores = 6,\n                    iter_num = 100,\n                    if_use_normalize_data = F)\n\n\nsaveRDS(obj, file=paste0(basedir, \"/data/ST/spatalk/spatalkDecompB2_s2.rds\"))"
  },
  {
    "objectID": "analysis/runSpaTalkDecompB2_s2.html#session-info",
    "href": "analysis/runSpaTalkDecompB2_s2.html#session-info",
    "title": "Run spatalk decomposition - s2 batch2",
    "section": "Session info",
    "text": "Session info\n\nsessionInfo()\n\nR version 4.3.0 (2023-04-21)\nPlatform: x86_64-apple-darwin20 (64-bit)\nRunning under: macOS Ventura 13.4.1\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] parallel  stats4    stats     graphics  grDevices utils     datasets \n[8] methods   base     \n\nother attached packages:\n [1] biomaRt_2.56.1              igraph_2.0.2               \n [3] Seurat_5.0.2                SeuratObject_5.0.1         \n [5] sp_2.1-3                    Matrix_1.6-5               \n [7] SpaTalk_1.0                 doParallel_1.0.17          \n [9] iterators_1.0.14            foreach_1.5.2              \n[11] ggalluvial_0.12.5           pheatmap_1.0.12            \n[13] scran_1.28.2                ggsci_3.0.1                \n[15] scater_1.28.0               scuttle_1.10.3             \n[17] ggspavis_1.6.0              here_1.0.1                 \n[19] SpatialExperiment_1.10.0    SingleCellExperiment_1.22.0\n[21] SummarizedExperiment_1.30.2 Biobase_2.60.0             \n[23] GenomicRanges_1.52.1        GenomeInfoDb_1.36.4        \n[25] IRanges_2.36.0              S4Vectors_0.40.1           \n[27] BiocGenerics_0.48.0         MatrixGenerics_1.12.3      \n[29] matrixStats_1.2.0           lubridate_1.9.3            \n[31] forcats_1.0.0               stringr_1.5.1              \n[33] dplyr_1.1.4                 purrr_1.0.2                \n[35] readr_2.1.5                 tidyr_1.3.1                \n[37] tibble_3.2.1                ggplot2_3.5.0              \n[39] tidyverse_2.0.0            \n\nloaded via a namespace (and not attached):\n  [1] spatstat.sparse_3.0-3     bitops_1.0-7             \n  [3] httr_1.4.7                RColorBrewer_1.1-3       \n  [5] backports_1.4.1           tools_4.3.0              \n  [7] sctransform_0.4.1         utf8_1.2.4               \n  [9] R6_2.5.1                  HDF5Array_1.28.1         \n [11] lazyeval_0.2.2            uwot_0.1.16              \n [13] rhdf5filters_1.12.1       withr_3.0.0              \n [15] prettyunits_1.2.0         gridExtra_2.3            \n [17] progressr_0.14.0          cli_3.6.2                \n [19] spatstat.explore_3.2-6    fastDummies_1.7.3        \n [21] scatterpie_0.2.1          labeling_0.4.3           \n [23] spatstat.data_3.0-4       ggridges_0.5.6           \n [25] pbapply_1.7-2             R.utils_2.12.3           \n [27] parallelly_1.37.1         limma_3.56.2             \n [29] RSQLite_2.3.5             rstudioapi_0.15.0        \n [31] generics_0.1.3            ica_1.0-3                \n [33] spatstat.random_3.2-3     car_3.1-2                \n [35] ggbeeswarm_0.7.2          fansi_1.0.6              \n [37] abind_1.4-5               R.methodsS3_1.8.2        \n [39] lifecycle_1.0.4           yaml_2.3.8               \n [41] edgeR_3.42.4              carData_3.0-5            \n [43] BiocFileCache_2.8.0       rhdf5_2.44.0             \n [45] Rtsne_0.17                blob_1.2.4               \n [47] grid_4.3.0                promises_1.2.1           \n [49] dqrng_0.3.2               crayon_1.5.2             \n [51] miniUI_0.1.1.1            lattice_0.22-5           \n [53] beachmat_2.16.0           cowplot_1.1.3            \n [55] KEGGREST_1.40.1           magick_2.8.3             \n [57] pillar_1.9.0              knitr_1.45               \n [59] metapod_1.8.0             rjson_0.2.21             \n [61] future.apply_1.11.1       codetools_0.2-19         \n [63] leiden_0.4.3.1            glue_1.7.0               \n [65] ggfun_0.1.4               data.table_1.15.2        \n [67] vctrs_0.6.5               png_0.1-8                \n [69] spam_2.10-0               gtable_0.3.4             \n [71] cachem_1.0.8              xfun_0.42                \n [73] S4Arrays_1.0.6            mime_0.12                \n [75] DropletUtils_1.20.0       NNLM_0.4.4               \n [77] ggside_0.3.1              survival_3.5-8           \n [79] statmod_1.5.0             bluster_1.10.0           \n [81] ellipsis_0.3.2            fitdistrplus_1.1-11      \n [83] ROCR_1.0-11               nlme_3.1-164             \n [85] bit64_4.0.5               filelock_1.0.3           \n [87] progress_1.2.3            RcppAnnoy_0.0.22         \n [89] rprojroot_2.0.4           irlba_2.3.5.1            \n [91] vipor_0.4.7               KernSmooth_2.23-22       \n [93] DBI_1.2.2                 colorspace_2.1-0         \n [95] tidyselect_1.2.0          curl_5.2.1               \n [97] bit_4.0.5                 compiler_4.3.0           \n [99] BiocNeighbors_1.18.0      xml2_1.3.6               \n[101] DelayedArray_0.26.7       plotly_4.10.4            \n[103] scales_1.3.0              lmtest_0.9-40            \n[105] rappdirs_0.3.3            digest_0.6.34            \n[107] goftest_1.2-3             spatstat.utils_3.0-4     \n[109] rmarkdown_2.26            XVector_0.40.0           \n[111] htmltools_0.5.7           pkgconfig_2.0.3          \n[113] sparseMatrixStats_1.12.2  dbplyr_2.4.0             \n[115] fastmap_1.1.1             rlang_1.1.3              \n[117] htmlwidgets_1.6.4         shiny_1.8.0              \n[119] DelayedMatrixStats_1.22.6 farver_2.1.1             \n[121] zoo_1.8-12                jsonlite_1.8.8           \n[123] BiocParallel_1.34.2       R.oo_1.26.0              \n[125] BiocSingular_1.16.0       RCurl_1.98-1.14          \n[127] magrittr_2.0.3            GenomeInfoDbData_1.2.10  \n[129] dotCall64_1.1-1           patchwork_1.2.0          \n[131] Rhdf5lib_1.22.1           munsell_0.5.0            \n[133] Rcpp_1.0.12               viridis_0.6.5            \n[135] reticulate_1.35.0         stringi_1.8.3            \n[137] zlibbioc_1.46.0           MASS_7.3-60.0.1          \n[139] plyr_1.8.9                listenv_0.9.1            \n[141] ggrepel_0.9.5             deldir_2.0-4             \n[143] Biostrings_2.68.1         splines_4.3.0            \n[145] tensor_1.5                hms_1.1.3                \n[147] locfit_1.5-9.9            ggpubr_0.6.0             \n[149] spatstat.geom_3.2-9       ggsignif_0.6.4           \n[151] RcppHNSW_0.6.0            reshape2_1.4.4           \n[153] ScaledMatrix_1.8.1        XML_3.99-0.16.1          \n[155] evaluate_0.23             tzdb_0.4.0               \n[157] tweenr_2.0.3              httpuv_1.6.14            \n[159] RANN_2.6.1                polyclip_1.10-6          \n[161] future_1.33.1             scattermore_1.2          \n[163] ggforce_0.4.2             ggExtra_0.10.1           \n[165] rsvd_1.0.5                broom_1.0.5              \n[167] xtable_1.8-4              RSpectra_0.16-1          \n[169] rstatix_0.7.2             later_1.3.2              \n[171] viridisLite_0.4.2         memoise_2.0.1            \n[173] AnnotationDbi_1.62.2      beeswarm_0.4.0           \n[175] cluster_2.1.6             timechange_0.3.0         \n[177] globals_0.16.2           \n\ndate()\n\n[1] \"Fri Mar  8 09:02:13 2024\""
  }
]